
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Correlation &#8212; The Python Companion of Intuitive Biostatistics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QQY9FLLPJ8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '32 - Correlation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Comparing paired data" href="31%20-%20Comparing%20paired%20data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="The Python Companion of Intuitive Biostatistics - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="The Python Companion of Intuitive Biostatistics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Python Companion Guide to “Intuitive Biostatistics”
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Confidence intervals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="04%20-%20Confidence%20interval%20of%20a%20proportion.html">Confidence interval of a proportion</a></li>
<li class="toctree-l1"><a class="reference internal" href="05%20-%20Confidence%20interval%20of%20survival%20data.html">Confidence interval of survival data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06%20-%20Confidence%20interval%20of%20counted%20data.html">Confidence interval of counted data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Continuous variables</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="09%20-%20Quantifying%20scatter%20of%20continuous%20data.html">Quantifying scatter of continuous data</a></li>
<li class="toctree-l1"><a class="reference internal" href="10%20-%20Gaussian%20distribution.html">The Gaussian distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="12%20-%20Confidence%20interval%20of%20a%20mean.html">Confidence interval of a mean</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical significance and data assumptions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="15%20-%20Statistical%20significance.html">Statistical significance</a></li>
<li class="toctree-l1"><a class="reference internal" href="20%20-%20Statistical%20power%20and%20sample%20size.html">Statistical power and sample size</a></li>
<li class="toctree-l1"><a class="reference internal" href="24%20-%20Normality%20tests%20and%20outliers.html">Normality tests and outliers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical tests</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="27%20-%20Comparing%20proportions.html">Comparing proportions</a></li>
<li class="toctree-l1"><a class="reference internal" href="29%20-%20Comparing%20survival%20curves.html">Comparing survival curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="30%20-%20Comparing%20two%20unpaired%20means.html">Comparing two unpaired means</a></li>
<li class="toctree-l1"><a class="reference internal" href="31%20-%20Comparing%20paired%20data.html">Comparing paired data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Correlation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics/edit/master/32 - Correlation.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/32 - Correlation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Correlation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions">Definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-correlation">What is correlation?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-correlation">Types of correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applications-in-biology">Applications in biology</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-and-visualization">Descriptive statistics and visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics">Descriptive statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scatter-plots">Scatter plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-matrices-and-heatmaps">Correlation matrices and heatmaps</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-of-correlation-analysis">Assumptions of correlation analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linearity">Linearity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity">Homoscedasticity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers">Outliers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measures-of-correlation">Measures of correlation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-correlation-coefficient">Pearson correlation coefficient</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-the-pearson-correlation-coefficient-is-calculated">How the Pearson correlation coefficient is calculated</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r2-coefficient-of-determination">The r² coefficient of determination</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#python-packages-for-computing-pearson-r">Python packages for computing Pearson <span class="math notranslate nohighlight">\(r\)</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spearman-rank-correlation-coefficient">Spearman rank correlation coefficient</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kendall-rank-correlation-coefficient">Kendall rank correlation coefficient</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#python-package-for-computing-spearman-rho-and-kendall-tau">Python package for computing Spearman <span class="math notranslate nohighlight">\(\rho\)</span> and Kendall <span class="math notranslate nohighlight">\(\tau\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-ties">Handling ties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-non-linear-patterns">Exploration of non-linear patterns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-inference">Statistical inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-non-zero-correlation">Testing for non-zero correlation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-t-statistic-for-correlation">Calculating the t-statistic for correlation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-t-critical-and-p-values">Visualizing t, critical and P values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval">Confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-statistical-inference-in-python">Performing statistical inference in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutation-tests-for-correlation-analysis">Bootstrapping and permutation tests for correlation analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-bootstrap-paired-data">Generating bootstrap paired data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-of-the-confidence-interval">Estimate of the confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value-using-permutation">P value using permutation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-assumptions">Assessing assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Measures of correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Statistical inference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutations">Bootstrapping and permutations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-replicates-and-confidence-intervals">Bootstrap replicates and confidence intervals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-r-to-z-transforms-with-pingouin">Bootstrap r-to-z transforms with Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bca-bootstrap-with-scipy">BCa bootstrap with SciPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">P value using permutation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="correlation">
<h1>Correlation<a class="headerlink" href="#correlation" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In biology, it’s often crucial to understand how different variables relate to each other. Does the abundance of a particular species increase with temperature? Is there a relationship between gene expression levels and disease severity? Correlation analysis provides the tools to quantify these relationships.</p>
<p>This chapter explores correlation, a statistical method for measuring the strength and direction of the association between two continuous variables. We’ll focus on Pearson correlation, which quantifies the linear relationship between variables. It’s important to remember that <strong>correlation</strong> is distinct from <strong>regression</strong> (covered in the next chapter). While regression analyzes how one variable predicts another, correlation simply assesses the degree to which they move together. In correlation, X and Y are interchangeable, unlike in regression.</p>
<p>While correlation assesses the general relationship between two variables, there are cases where we want to evaluate the agreement between two methods measuring the same quantity. For example, we might compare a new, less expensive assay to a gold-standard method. In these situations, <a class="reference external" href="https://en.wikipedia.org/wiki/Bland%E2%80%93Altman_plot">Bland-Altman plots</a> are a valuable tool, but won’t be discussed in this chapter, but the Pingouin package offers a <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.plot_blandaltman.html#r5bbb6e366078-2">convenient function for comparing visually two sets of measurements</a>.</p>
<p>We’ll begin this chapter by visualizing relationships with scatter plots and exploring different types of correlation.  Next, we’ll delve into the assumptions underlying correlation analysis, including linearity, normality, and the absence of outliers. We’ll then introduce various measures of correlation, including covariance, Pearson’s <em>r</em> correlation coefficient, Spearman’s rank correlation, and Kendall’s rank correlation, providing Python code examples for their calculation.</p>
<p>The chapter will also cover statistical inference for correlation, including hypothesis testing to determine if a correlation is significantly different from zero, and methods for calculating confidence intervals. We’ll explore both parametric approaches and bootstrapping, demonstrating their implementation in Python.</p>
<p>Finally, we’ll emphasize the crucial distinction between correlation and causation, illustrating this concept with biologically relevant examples. By the end of this chapter, you’ll have a solid understanding of correlation analysis and be equipped to apply it to your own biological research using Python.</p>
</section>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Link to this heading">#</a></h2>
<section id="what-is-correlation">
<h3>What is correlation?<a class="headerlink" href="#what-is-correlation" title="Link to this heading">#</a></h3>
<p>Correlation is a statistical measure that describes the strength and direction of the relationship between two continuous variables. In simpler terms, it tells us how strongly two things are related and whether they tend to move together in the same direction or in opposite directions.</p>
<p>Imagine you’re observing the height and weight of a group of people. You might notice that taller individuals generally weigh more. This suggests a positive correlation between height and weight - as one increases, the other tends to increase as well. Conversely, if you were looking at the relationship between exercise frequency and resting heart rate, you might find a negative correlation - people who exercise more often tend to have lower resting heart rates.</p>
</section>
<section id="types-of-correlation">
<h3>Types of correlation<a class="headerlink" href="#types-of-correlation" title="Link to this heading">#</a></h3>
<p>Correlation is a powerful tool because it allows us to quantify these relationships. Correlation can be classified into three main types based on the direction and strength of the relationship, with the <strong>correlation coefficient</strong>, often denoted by <strong><em>r</em></strong>, expressing this relationship as a number ranging <strong>from -1 to +1</strong>:</p>
<ul class="simple">
<li><p>Positive correlation (<span class="math notranslate nohighlight">\(0 \lt r \le 1\)</span>): as one variable increases, the other tends to increase as well. A perfect positive correlation is represented by a correlation coefficient of +1, e.g., height and weight, study time and exam scores.</p></li>
<li><p>Negative correlation (<span class="math notranslate nohighlight">\(-1 \le r \lt 0\)</span>): as one variable increases, the other tends to decrease. A perfect negative correlation has a coefficient of -1, e.g., exercise and resting heart rate, stress and immune function.</p></li>
<li><p>No correlation (<span class="math notranslate nohighlight">\(r=0\)</span>): there is no apparent linear relationship between the variables. The correlation coefficient is close to 0, indicating that changes in one variable don’t reliably predict changes in the other, e.g., shoe size and IQ, hair color and favorite movie genre.</p></li>
</ul>
<p>When two variables show a very large correlation, one can be said to be a <strong>predictor</strong> of the other, in the sense that knowing the value of one of the two variable allows us to make a reasonnable guess about the value of the second variable. Another way of looking at this relationship is to see those variable as redundant, in the sense that they carry the same information: knowing the value of both variable does not bring much more insight compared to knowing the value of only one.</p>
</section>
<section id="applications-in-biology">
<h3>Applications in biology<a class="headerlink" href="#applications-in-biology" title="Link to this heading">#</a></h3>
<p>Correlation analysis has numerous applications in biological research, including:</p>
<ul class="simple">
<li><p>Gene expression analysis: identifying correlations between the expression levels of different genes to understand regulatory networks and pathways.</p></li>
<li><p>Ecology: studying the relationship between species abundance and environmental factors like temperature or rainfall.</p></li>
<li><p>Drug discovery: examining the correlation between drug dosage and therapeutic effect or side effects.</p></li>
<li><p>Evolutionary biology:investigating the correlation between morphological traits and environmental pressures.</p></li>
<li><p>Epidemiology: exploring the correlation between lifestyle factors (diet, exercise) and disease risk.</p></li>
</ul>
<p>By understanding and quantifying these relationships, biologists can gain valuable insights into complex biological processes and phenomena.</p>
</section>
</section>
<section id="descriptive-statistics-and-visualization">
<h2>Descriptive statistics and visualization<a class="headerlink" href="#descriptive-statistics-and-visualization" title="Link to this heading">#</a></h2>
<p>To illustrate the concepts of correlation and how to explore relationships between variables, we’ll use data from a study by <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/8418404/">Borkman and colleagues</a>. They investigated the link between the fatty-acid composition of skeletal-muscle phospholipids and insulin sensitivity. Their research involved two groups of subjects, but we will focus on the group of 13 normal men, where insulin sensitivity was assessed using euglycemic-clamp studies, with muscle biopsies taken from the vastus lateralis. Specifically, we’ll examine the relationship between insulin sensitivity and the percentage of C20-22 fatty acids in the muscle phospholipids, as summarized in Table 32.1 on page 319 from “Intuitive Biostatistics 4th Edition”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Example data from the book, page 319 (directly into a DataFrame)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1"># percentage of C20-22 fatty acids</span>
    <span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">17.9</span><span class="p">,</span> <span class="mf">18.3</span><span class="p">,</span> <span class="mf">18.3</span><span class="p">,</span> <span class="mf">18.4</span><span class="p">,</span> <span class="mf">18.4</span><span class="p">,</span> <span class="mf">20.2</span><span class="p">,</span> <span class="mf">20.3</span><span class="p">,</span> <span class="mf">21.8</span><span class="p">,</span> <span class="mf">21.9</span><span class="p">,</span> <span class="mf">22.1</span><span class="p">,</span> <span class="mf">23.1</span><span class="p">,</span> <span class="mf">24.2</span><span class="p">,</span> <span class="mf">24.4</span><span class="p">],</span>
    <span class="c1"># insulin sensitivity index</span>
    <span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">530</span><span class="p">,</span> <span class="mi">375</span><span class="p">],</span>
<span class="p">})</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>per_C2022_fatacids</th>
      <th>insulin_sensitivity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.9</td>
      <td>250</td>
    </tr>
    <tr>
      <th>1</th>
      <td>18.3</td>
      <td>220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.3</td>
      <td>145</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18.4</td>
      <td>115</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18.4</td>
      <td>230</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="descriptive-statistics">
<h3>Descriptive statistics<a class="headerlink" href="#descriptive-statistics" title="Link to this heading">#</a></h3>
<p>A crucial first step in any correlation analysis is to explore the data visually and through descriptive statistics. This allows us to identify potential patterns, outliers, and the overall distribution of the variables, which can inform our subsequent analysis and interpretation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display descriptive statistics using Pandas&#39; describe()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Descriptive statistics using Pandas:&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Descriptive statistics using Pandas:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>per_C2022_fatacids</th>
      <th>insulin_sensitivity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>13.000000</td>
      <td>13.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>20.715385</td>
      <td>284.230769</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.356850</td>
      <td>113.886752</td>
    </tr>
    <tr>
      <th>min</th>
      <td>17.900000</td>
      <td>115.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>18.400000</td>
      <td>220.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>20.300000</td>
      <td>260.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>22.100000</td>
      <td>370.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.400000</td>
      <td>530.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">describe</span>

<span class="c1"># Display additional statistics using SciPy</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Additional Statistics using SciPy:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Insulin Sensitivity:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">describe</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">%C20-20 fatty acids:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">describe</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Additional Statistics using SciPy:
Insulin Sensitivity:
 DescribeResult(nobs=13, minmax=(115, 530), mean=284.2307692307692, variance=12970.192307692307, skewness=0.5429430677319255, kurtosis=-0.19429352446593473)

%C20-20 fatty acids:
 DescribeResult(nobs=13, minmax=(17.9, 24.4), mean=20.71538461538461, variance=5.55474358974359, skewness=0.2382148683128159, kurtosis=-1.3626759485656732)
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">#</a></h3>
</section>
<section id="scatter-plots">
<span id="scatter-plot"></span><h3>Scatter plots<a class="headerlink" href="#scatter-plots" title="Link to this heading">#</a></h3>
<p>Scatter plots are a fundamental tool for visualizing the relationship between two continuous variables. They provide an intuitive way to grasp the strength and direction of a correlation by displaying the data as a collection of points on a two-dimensional graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation between %C20-22 and insulin sensitivity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;%C20-22 fatty acids&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Insulin sensitivity (mg/m²/min)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="mi">16</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/62ea3e626120cac36ce80f06829f78e656b9cf4c36ead15af248eeb22b546b4a.png" src="_images/62ea3e626120cac36ce80f06829f78e656b9cf4c36ead15af248eeb22b546b4a.png" />
</div>
</div>
<p>Observing the scatter plot, we can see an upward trend in the data points. This indicates that individuals with higher percentages of C20-22 fatty acids in their muscle tissue tend to have higher insulin sensitivity. While there is some variability, the overall pattern suggests a positive association between these two variables.</p>
</section>
<section id="correlation-matrices-and-heatmaps">
<h3>Correlation matrices and heatmaps<a class="headerlink" href="#correlation-matrices-and-heatmaps" title="Link to this heading">#</a></h3>
<p>Scatter plots are excellent for visualizing the relationship between two variables. However, biological datasets often contain many variables, and we might be interested in exploring the relationships between all possible pairs. For this purpose, we can use correlation matrices and heatmaps, which provide a concise overview of the correlations between <strong>multiple variables</strong>.</p>
<p>A <strong>correlation matrix</strong> is a table that displays the correlation coefficients between all pairs of variables in a dataset. Each row and column represents a variable, and the cells at the intersection show the corresponding correlation coefficient. We’ll delve deeper into the meaning and calculation of these correlation coefficients in the next section.</p>
<p>A <strong>heatmap</strong> is a graphical representation of a correlation matrix, where the values of the correlation coefficients are represented by colors. Typically, a gradient of colors is used, with warmer colors (e.g., red) indicating stronger positive correlations, cooler colors (e.g., blue) indicating stronger negative correlations, and lighter colors (e.g., white or pale yellow) indicating weak or no correlation.</p>
<p>Heatmaps make it easy to identify patterns of correlation at a glance. For example, we can quickly spot clusters of variables that are highly correlated with each other or identify variables that are negatively correlated with most other variables. Let’s illustrate this concept using the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/30%20-%20Comparing%20Two%20Unpaired%20Means.html#working-with-real-world-data">Palmer penguins dataset introduced in a previous chapter</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>

<span class="c1"># List all available datasets in pingouin (commented out)</span>
<span class="c1"># pg.list_dataset()</span>

<span class="c1"># Load the &#39;penguins&#39; dataset</span>
<span class="n">penguins</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;penguins&#39;</span><span class="p">)</span>

<span class="c1"># Display the first 5 rows of the dataset</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>37.8</td>
      <td>18.3</td>
      <td>174.0</td>
      <td>3400.0</td>
      <td>female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>37.7</td>
      <td>18.7</td>
      <td>180.0</td>
      <td>3600.0</td>
      <td>male</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>35.9</td>
      <td>19.2</td>
      <td>189.0</td>
      <td>3800.0</td>
      <td>female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>38.2</td>
      <td>18.1</td>
      <td>185.0</td>
      <td>3950.0</td>
      <td>male</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>38.8</td>
      <td>17.2</td>
      <td>180.0</td>
      <td>3800.0</td>
      <td>male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the correlation matrix (excluding non-numeric columns)</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">penguins</span><span class="p">[[</span><span class="s1">&#39;bill_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;body_mass_g&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Create a heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation matrix heatmap for Palmer penguins dataset&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ef640fc68a2c4188d6ea2266f641afdaa650fdf3b50363ee8324c5bdd27f9282.png" src="_images/ef640fc68a2c4188d6ea2266f641afdaa650fdf3b50363ee8324c5bdd27f9282.png" />
</div>
</div>
<p>When testing for multiple pairwise correlations, especially with a large number of correlation coefficients, it’s important to adjust the P values to account for <em>multiple comparisons</em>, <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/15%20-%20P%20Values%20and%20Statistical%20Significance.html#the-challenge-of-multiple-comparisons">as discussed in a previous chapter</a>. This helps control the false positive rate. The <code class="docutils literal notranslate"><span class="pre">pairwise_corr</span></code> function in the Pingouin library provides a convenient way to do this using the ‘padjust’ argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">pairwise_corr</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bill_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;body_mass_g&#39;</span><span class="p">],</span>
    <span class="n">padjust</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">,</span>  <span class="c1"># one-step Bonferroni correction</span>
<span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X</th>
      <th>Y</th>
      <th>method</th>
      <th>alternative</th>
      <th>n</th>
      <th>r</th>
      <th>CI95%</th>
      <th>p-unc</th>
      <th>p-corr</th>
      <th>p-adjust</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bill_length_mm</td>
      <td>bill_depth_mm</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>-0.235</td>
      <td>[-0.33, -0.13]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>1005.717</td>
      <td>0.993</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bill_length_mm</td>
      <td>flipper_length_mm</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>0.656</td>
      <td>[0.59, 0.71]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>1.46e+40</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bill_length_mm</td>
      <td>body_mass_g</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>0.595</td>
      <td>[0.52, 0.66]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>8.34e+30</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bill_depth_mm</td>
      <td>flipper_length_mm</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>-0.584</td>
      <td>[-0.65, -0.51]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>2.679e+29</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bill_depth_mm</td>
      <td>body_mass_g</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>-0.472</td>
      <td>[-0.55, -0.39]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>2.103e+17</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>flipper_length_mm</td>
      <td>body_mass_g</td>
      <td>pearson</td>
      <td>two-sided</td>
      <td>342</td>
      <td>0.871</td>
      <td>[0.84, 0.89]</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>bonf</td>
      <td>1.87e+103</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="assumptions-of-correlation-analysis">
<h2>Assumptions of correlation analysis<a class="headerlink" href="#assumptions-of-correlation-analysis" title="Link to this heading">#</a></h2>
<p>Before we delve into the calculation and interpretation of correlation coefficients, it’s essential to understand the assumptions that underlie correlation analysis. These assumptions are crucial because violating them can lead to misleading or inaccurate results.</p>
<p>In this section, we’ll examine the key assumptions of correlation analysis, focusing primarily on <a class="reference internal" href="#pearson"><span class="std std-ref">Pearson’s correlation coefficient</span></a>, as it is the most commonly used method and has more stringent assumptions compared to non-parametric alternatives like <a class="reference internal" href="#spearman"><span class="std std-ref">Spearman</span></a> and <a class="reference internal" href="#kandall"><span class="xref myst">Kendall</span></a>:</p>
<ul class="simple">
<li><p><strong>Linearity:</strong> Pearson’s correlation measures the strength of a linear relationship. This means that the relationship between the two variables should roughly follow a straight line pattern.</p></li>
<li><p><strong>Normality:</strong> for hypothesis testing with Pearson’s correlation, the data should be approximately normally distributed. This assumption is less critical for estimating the correlation coefficient itself but becomes important when assessing statistical significance.</p></li>
<li><p><strong>Homoscedasticity:</strong> this assumption refers to the equal spread of data points across the range of values for both variables. In other words, the variability of one variable should be roughly the same across all values of the other variable.</p></li>
<li><p><strong>No outliers:</strong> outliers, which are extreme data points that deviate significantly from the rest of the data, can have a disproportionate influence on the correlation coefficient.</p></li>
</ul>
<section id="linearity">
<h3>Linearity<a class="headerlink" href="#linearity" title="Link to this heading">#</a></h3>
<p>The most important assumption for Pearson’s correlation is linearity. This means that the relationship between the two variables should be linear. In other words, if we were to plot the variables on a scatter plot, we should be able to draw a straight line through the points that captures the general trend of the data.</p>
<p>To assess linearity, the primary tool is the <a class="reference internal" href="#scatter-plot"><span class="std std-ref">scatter plot</span></a>. By examining the scatter plot of insulin sensitivity and C20-20 fatty acids that we created earlier, we can see that the points appear to cluster around a straight line, supporting the assumption of linearity.</p>
<p>While the scatter plot provides a visual assessment, we can also calculate the Pearson correlation coefficient (<span class="math notranslate nohighlight">\(r\)</span>). We will see in the next section that a high absolute value of <span class="math notranslate nohighlight">\(r\)</span> (e.g., above 0.7) can provide further support for a linear relationship. For a more detailed analysis, we can create a residual plot. This involves plotting the <strong>residuals</strong> (the differences between the observed values and the values predicted by a linear regression line) against the predicted values. If the residuals are randomly scattered around zero, it supports the linearity assumption. If there are clear patterns in the residuals, it suggests non-linearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit a linear regression model using Pingouin</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">linear_regression</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span>
    <span class="c1"># remove_na=True,</span>
<span class="p">)</span>

<span class="c1"># Extract the residuals using the residuals_ attribute</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">residuals_</span>

<span class="c1"># Create a residual plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
    <span class="n">lowess</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Adding a smooth curve to visualize the trend of the residuals</span>
    <span class="n">line_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;%C20-22 fatty acids&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/87a364a8a524ed126bef5b7faa49cb2f9a5d80859d720402fa5ca215d57d96b7.png" src="_images/87a364a8a524ed126bef5b7faa49cb2f9a5d80859d720402fa5ca215d57d96b7.png" />
</div>
</div>
<p>If the relationship appears non-linear, we have a few options:</p>
<ul class="simple">
<li><p><strong>Transformations</strong>: we may consider applying transformations to the data (e.g., logarithmic, square root, or reciprocal transformations) to see if we can <em>linearize</em> the relationship.</p></li>
<li><p><strong>Non-parametric</strong> methods: we can use non-parametric correlation coefficients like <a class="reference internal" href="#spearman"><span class="std std-ref">Spearman’s rank correlation</span></a> or <a class="reference internal" href="#kendall"><span class="std std-ref">Kendall’s tau</span></a>, which don’t require the assumption of linearity.</p></li>
</ul>
</section>
<section id="normality">
<h3>Normality<a class="headerlink" href="#normality" title="Link to this heading">#</a></h3>
<p>The normality assumption in the context of correlation analysis refers to the assumption that <em>both variables being analyzed are approximately normally distributed</em>. This means that the distribution of the data points for each variable should roughly follow a bell-shaped curve.</p>
<p>The normality assumption is particularly important when we want to perform <em>hypothesis tests</em> to determine the statistical significance of the correlation. Many common statistical tests for correlation rely on the assumption of normality. Normality is also assumed when calculating confidence intervals for the correlation coefficient.</p>
<p>There are several methods to assess the normality of the data, as discussed in more details in <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html">a previous chapter</a>.</p>
<p>Visual inspection includes:</p>
<ul class="simple">
<li><p>Histograms: we can create histograms for each variable. A histogram provides a visual representation of the distribution of the data, allowing us to see <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#variability-of-gaussian-samples">if it resembles a bell-shaped curve</a>.</p></li>
<li><p>Q-Q plots: we can also generate <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#q-q-plots">Q-Q plots (quantile-quantile plots)</a> for each variable. A Q-Q plot compares the quantiles of the data to the quantiles of a normal distribution. If the data is normally distributed, the points on the Q-Q plot should fall approximately along a straight line.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting Q-Q plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="n">data</span><span class="p">],</span>
        <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="c1"># compare the data against the normal distribution</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="c1"># Add 95% confidence intervals</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q-Q plot: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f090fae82e417351b2e2af100655da54f80d68f25b415c8eb51b66f1b271271.png" src="_images/7f090fae82e417351b2e2af100655da54f80d68f25b415c8eb51b66f1b271271.png" />
</div>
</div>
<p>We can also leverage statistical tests:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#d-agostino-pearson-omnibus-k2-normality-test">D’Agostino-Pearson omnibus K²</a> and <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#shapiro-wilk-test">Shapiro-Wilk</a> tests: this are widely used statistical tests specifically designed to assess normality. They test the null hypothesis that the data is drawn from a normal distribution.</p></li>
<li><p><a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#kolmogorov-smirnov-test">Kolmogorov-Smirnov test</a>: this is another test for normality, but it’s generally less powerful than the Shapiro-Wilk test.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shapiro-Wilk test for normality:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shapiro-Wilk test for normality:
                           W      pval  normal
per_C2022_fatacids  0.890774  0.099953    True
                           W      pval  normal
insulin_sensitivity  0.96256  0.792641    True
</pre></div>
</div>
</div>
</div>
<p>If the normality assumption is violated, we have several options:</p>
<ul class="simple">
<li><p>Transformations: we may consider applying transformations to the data (e.g., logarithmic, square root) to see if we can normalize the distribution.</p></li>
<li><p>Non-parametric methods: we could use non-parametric correlation coefficients like <a class="reference internal" href="#spearman"><span class="std std-ref">Spearman’s rank correlation</span></a> or <a class="reference internal" href="#kendall"><span class="std std-ref">Kendall’s tau</span></a>, which do not require the assumption of normality.</p></li>
<li><p><a class="reference internal" href="#permutations"><span class="std std-ref">Permutation tests</span></a>: these are resampling-based methods that can be used to test the significance of the correlation without relying on distributional assumptions.</p></li>
</ul>
</section>
<section id="homoscedasticity">
<h3>Homoscedasticity<a class="headerlink" href="#homoscedasticity" title="Link to this heading">#</a></h3>
<p>The assumption of <strong>homoscedasticity</strong> (also known as homogeneity of variance) refers to the equal spread of data points across the range of values for both variables. In simpler terms, the variability of one variable should be roughly the same across all values of the other variable.</p>
<p>Homoscedasticity is important for obtaining reliable estimates of the correlation coefficient. When the variability of one variable changes significantly across the range of the other variable, it can distort the correlation estimate. Violations of homoscedasticity can also affect the accuracy of hypothesis tests for correlation.</p>
<p>The most common way to assess homoscedasticity is to examine the scatter plot of the two variables, looking for any <em>patterns in the spread</em> of the data points. If the spread of the points is roughly consistent across the range of values, it suggests homoscedasticity. If the spread appears to change (e.g., fanning out or narrowing in), it indicates heteroscedasticity (non-constant variance).</p>
<p>Statistical tests can also be leveraged, as shown in <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/30%20-%20Comparing%20Two%20Unpaired%20Means.html#homoscedasticity-testing">the chapter compairing unpaired means</a>. For example, Levene’s test is a statistical test specifically designed to assess the equality of variances between groups. In the context of correlation, we can <em>divide the data into groups</em> based on the values of one variable and then test for equal variances in the other variable across those groups. Bartlett’s test is another test for equality of variances, but it’s more sensitive to deviations from normality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Divide the data into groups based on %C20-22 fatty acids</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>  <span class="c1"># Use of the median as a cut-off</span>
<span class="n">low_fatacids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">high_fatacids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># Levene&#39;s test for homoscedasticity</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Levene&#39;s test for homoscedasticity:&quot;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">low_fatacids</span><span class="p">,</span> <span class="n">high_fatacids</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levene&#39;s test for homoscedasticity:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>W</th>
      <th>pval</th>
      <th>equal_var</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>levene</th>
      <td>0.319637</td>
      <td>0.583173</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If the homoscedasticity assumption is violated, we can consider these options:</p>
<ul class="simple">
<li><p>Transformations: transformations of the data (e.g., logarithmic, square root) might help stabilize the variance and reduce heteroscedasticity.</p></li>
<li><p>Non-parametric methods: non-parametric correlation coefficients like Spearman or Kendall are less sensitive to violations of homoscedasticity.</p></li>
<li><p>Other robust correlation methods: there are other robust correlation methods available that are less affected by heteroscedasticity, e.g., Winsorized correlation, biweight midcorrelation, percentage bend correlation, gamma correlation, etc. as <a class="reference external" href="https://cloud.r-project.org/web/packages/correlation/vignettes/types.html">summarized elsewhere</a>.</p></li>
</ul>
</section>
<section id="outliers">
<h3>Outliers<a class="headerlink" href="#outliers" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#outliers">As shown previously</a>, <strong>outliers</strong> are data points that deviate significantly from the overall pattern of the data. They can have a disproportionate influence on the correlation coefficient, potentially leading to misleading results.</p>
<p>Outliers can either inflate or deflate the correlation coefficient, giving a false impression of the true relationship between the variables. The presence of outliers can also lead to incorrect conclusions about the strength and direction of the correlation.</p>
<p>We can carefully examine the scatter plot for any data points that are far removed from the main cluster of points. These are potential outliers. Boxplots can also help identify outliers by visually displaying the interquartile range (IQR) and any points that fall outside of the “whiskers” of the boxplot.</p>
<p>Statistical methods include:</p>
<ul class="simple">
<li><p>Z-scores: calculate the z-score for each data point. Data points with a z-score above a certain threshold (e.g., 2 or 3) can be considered potential outliers.</p></li>
<li><p>IQR method: identify outliers as data points that fall below (Q1 - 1.5 * IQR) or above (Q3 + 1.5 * IQR), where Q1 and Q3 are the first and third quartiles, respectively.</p></li>
<li><p>Grubb’s, Dixon’s Q, and other detection methods, as described in <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#statistical-outlier-detection">the chapter about normality and outliers</a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create separate boxplots for each variable to respect each scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">boxprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">},</span>  <span class="c1"># Make the boxplot transparent</span>
    <span class="n">medianprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;%C20-22 fatty acids&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">boxprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">},</span>
    <span class="n">medianprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Insulin sensitivity&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d6c5fb8787e643915b61ac216da5315b46ceb174d3ead4df92ecfc9a350b1707.png" src="_images/d6c5fb8787e643915b61ac216da5315b46ceb174d3ead4df92ecfc9a350b1707.png" />
</div>
</div>
</section>
</section>
<section id="measures-of-correlation">
<h2>Measures of correlation<a class="headerlink" href="#measures-of-correlation" title="Link to this heading">#</a></h2>
<p>In this section, we’ll introduce different measures of correlation, each with its own way of capturing the relationship between variables.</p>
<section id="covariance">
<h3>Covariance<a class="headerlink" href="#covariance" title="Link to this heading">#</a></h3>
<p><strong>Covariance</strong> measures the extent to which two variables change together. If <span class="math notranslate nohighlight">\(x = x_1, x_2, \dots, x_n\)</span> and <span class="math notranslate nohighlight">\(y = y_1, y_2, \dots, y_n\)</span> represent two variables, <span class="math notranslate nohighlight">\(\bar{x}\)</span> and <span class="math notranslate nohighlight">\(\bar{y}\)</span> are their respective means, and <span class="math notranslate nohighlight">\(n\)</span> is the number of data points, then the <strong>sample covariance</strong>, often denoted <span class="math notranslate nohighlight">\(\sigma\)</span>, is defined as:</p>
<div class="math notranslate nohighlight">
\[\mathrm{cov_s}(x, y) = \sigma_{xy} = \frac{1}{n - 1} \sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})\]</div>
<p>When two variables, <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>, are not correlated, the positive products <span class="math notranslate nohighlight">\((x_i - \bar{x})(y_i - \bar{y})\)</span> in the covariance formula will approximately balance out the negative ones, resulting in a covariance and correlation coefficient close to zero.</p>
<p><strong>Population covariance</strong> represents the true covariance between two variables in the <em>entire population</em> of interest. It’s a parameter, meaning it’s a fixed value that describes the population. It is defined as <span class="math notranslate nohighlight">\(\mathrm{cov_p}(x, y) = \frac{1}{n}\sum_{i = 1}^{n}(x_i - \bar{x})(y_i - \bar{y})\)</span>. In most real-world scenarios, we don’t have access to the entire population, so we can’t directly calculate the population covariance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calculate the covariance using NumPy</span>
<span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Covariance between %C20-22 fatty acids and insulin sensitivity:&quot;</span><span class="p">,</span> <span class="n">covariance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Covariance between %C20-22 fatty acids and insulin sensitivity: 206.67948717948718
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.cov.html">Pandas <code class="docutils literal notranslate"><span class="pre">cov</span></code> method</a> computes the pairwise covariance between columns of a DataFrame. The primary output is a <strong>covariance matrix</strong> (<span class="math notranslate nohighlight">\(\Sigma\)</span>). This is a square matrix that shows the covariances between all possible pairs of columns in the DataFrame. The diagonal elements of the matrix represent the <strong>variances</strong> of individual columns (covariance of a variable with itself), and the off-diagonal elements represent the <strong>covariances</strong> between different pairs of columns:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Sigma = \begin{bmatrix}\sigma_x^2 &amp; \sigma_{xy}\\ \sigma_{yx} &amp; \sigma_y^2 \end{bmatrix}\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Covariance matrix of the dataframe:&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span>
    <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># sample covariance</span>
<span class="p">)</span>
<span class="c1"># same as np.cov(df[&#39;per_C2022_fatacids&#39;], df[&#39;insulin_sensitivity&#39;])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Covariance matrix of the dataframe:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>per_C2022_fatacids</th>
      <th>insulin_sensitivity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>per_C2022_fatacids</th>
      <td>5.554744</td>
      <td>206.679487</td>
    </tr>
    <tr>
      <th>insulin_sensitivity</th>
      <td>206.679487</td>
      <td>12970.192308</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>While covariance gives us the direction of the relationship, its value is dependent on the scales of the variables, making it difficult to compare covariances across different datasets. It also doesn’t tell us the strength of the relationship. That’s where the Pearson’s correlation coefficient comes in.</p>
</section>
<section id="pearson-correlation-coefficient">
<span id="pearson"></span><h3>Pearson correlation coefficient<a class="headerlink" href="#pearson-correlation-coefficient" title="Link to this heading">#</a></h3>
<section id="how-the-pearson-correlation-coefficient-is-calculated">
<h4>How the Pearson correlation coefficient is calculated<a class="headerlink" href="#how-the-pearson-correlation-coefficient-is-calculated" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">The Pearson correlation coefficient</a>, often denoted by <span class="math notranslate nohighlight">\(r\)</span> or <span class="math notranslate nohighlight">\(r_{xy}\)</span>, is the most widely used measure of correlation. It quantifies the strength and direction of the <em>linear</em> relationship between two continuous variables. The Pearson correlation coefficient is calculated through the process:</p>
<ol class="arabic simple">
<li><p>Calculate the average of all <span class="math notranslate nohighlight">\(X\)</span> values. Same for all <span class="math notranslate nohighlight">\(Y\)</span> values. These two averages define a point at the <strong>center of gravity</strong> of the data.</p></li>
<li><p>Compare the position of each point with respect to that center, i.e., subtract the average <span class="math notranslate nohighlight">\(X\)</span> value from each <span class="math notranslate nohighlight">\(X\)</span> value, and subtract the average <span class="math notranslate nohighlight">\(Y\)</span> value from each <span class="math notranslate nohighlight">\(Y\)</span> value.</p></li>
<li><p>Standardize those distances (from step 2) by dividing by the standard deviation of all <span class="math notranslate nohighlight">\(X\)</span> values; do the same for the <span class="math notranslate nohighlight">\(Y\)</span> distances. These <strong>standardized distances</strong> are now in standard deviation units.</p></li>
<li><p>For each data point, multiply the two standardized distances (from step 3).</p></li>
<li><p>Add up all the products from step 4.</p></li>
<li><p>Divide the sum from step 5 by <span class="math notranslate nohighlight">\((n-1)\)</span>, where <span class="math notranslate nohighlight">\(n\)</span> is the number of XY pairs. This accounts for sample size and gives us the Pearson correlation coefficient.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pearson_r_custom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Pearson correlation coefficient between XY pairs,</span>
<span class="sd">    illustrating the step-by-step calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Get the number of data points</span>

    <span class="c1"># 1. Calculate the means</span>
    <span class="n">mean_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># 2. Calculate the distances to the center of gravity (array of data)</span>
    <span class="n">dist_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mean_x</span>
    <span class="n">dist_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">mean_y</span>

    <span class="c1"># 3. Standardize the distances</span>
    <span class="n">std_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use ddof=1 for sample standard deviation</span>
    <span class="n">std_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">std_dist_x</span> <span class="o">=</span> <span class="n">dist_x</span> <span class="o">/</span> <span class="n">std_x</span>
    <span class="n">std_dist_y</span> <span class="o">=</span> <span class="n">dist_y</span> <span class="o">/</span> <span class="n">std_y</span>

    <span class="c1"># 4. Multiply the standardized distances</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">std_dist_x</span> <span class="o">*</span> <span class="n">std_dist_y</span>

    <span class="c1"># 5. Sum the products</span>
    <span class="n">sum_products</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>

    <span class="c1"># 6. Divide by n-1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sum_products</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pearson correlation coefficient obtained with the custom function:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r_custom</span><span class="o">:=</span><span class="n">pearson_r_custom</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pearson correlation coefficient obtained with the custom function:
0.7700025428371727
</pre></div>
</div>
</div>
</div>
<p>Thus, Pearson correlation coefficient divides the covariance by the product of the standard deviations of the two variables:</p>
<div class="math notranslate nohighlight">
\[r = \frac{\sigma_{xy}}{\sigma_x \sigma_y}\]</div>
<p>That provides a standardized measure of the linear relationship between two variables, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>. This standardization creates a scale of <span class="math notranslate nohighlight">\(-1\)</span> to <span class="math notranslate nohighlight">\(+1\)</span> for <span class="math notranslate nohighlight">\(r\)</span>, allowing for an intuitive understanding of both the <strong>direction</strong> and <strong>strength</strong> of the relationship. A value of <span class="math notranslate nohighlight">\(-1\)</span> indicates a perfect negative correlation, meaning that <span class="math notranslate nohighlight">\(x\)</span> increases perfectly as <span class="math notranslate nohighlight">\(y\)</span> decreases. Conversely, a value of <span class="math notranslate nohighlight">\(+1\)</span> signifies a perfect positive correlation, where <span class="math notranslate nohighlight">\(x\)</span> increases perfectly as <span class="math notranslate nohighlight">\(y\)</span> increases. A value of <span class="math notranslate nohighlight">\(0\)</span> indicates no linear relationship between the two variables. The magnitude of <span class="math notranslate nohighlight">\(r\)</span> reflects the <strong>strength</strong> of the linear association. Values closer to <span class="math notranslate nohighlight">\(-1\)</span> or <span class="math notranslate nohighlight">\(+1\)</span> suggest a stronger relationship, while values closer to <span class="math notranslate nohighlight">\(0\)</span> imply a weaker association. This <strong>scale-independence</strong> enables comparisons of correlation coefficients across different datasets with varying units of measurement.</p>
</section>
<section id="the-r2-coefficient-of-determination">
<h4>The r² coefficient of determination<a class="headerlink" href="#the-r2-coefficient-of-determination" title="Link to this heading">#</a></h4>
<p>The square of the Pearson correlation coefficient, denoted as  <span class="math notranslate nohighlight">\(r^2\)</span>, also known as the <strong>coefficient of determination</strong>, has a special interpretation. It represents the proportion of the total <em>variability</em> in one variable that can be <em>explained</em> by its linear relationship with the other variable, or expressed differently, <span class="math notranslate nohighlight">\(r^2\)</span> is the fraction of the variance shared between the two variables.</p>
<p>Obviously, <span class="math notranslate nohighlight">\(r^2\)</span> values always range from 0 to 1, with 0 indicating that none of the variability in one variable is explained by its linear relationship with the other variable., and 1 indicating that all of the variability in one variable is explained by its linear relationship with the other variable.</p>
<p>While  <span class="math notranslate nohighlight">\(r^2\)</span>  is often used in the context of regression analysis, as we will see in the next chapter about linear regression, it’s important to remember that it can also be interpreted in the context of correlation without explicitly referring to regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r² coefficient of determination = </span><span class="si">{</span><span class="n">r_custom</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r² coefficient of determination = 0.5929
</pre></div>
</div>
</div>
</div>
<p>An <span class="math notranslate nohighlight">\(r^2\)</span> of 0.5929 means that 59.29% of the variance in one variable is shared with the other variable. In other words, 59.29% of the variation in one variable can be explained by its linear relationship with the other variable.</p>
<p>The remaining 40.71% of the variance in each variable is explained by other factors that are not included in the correlation analysis. These other factors could include other variables, measurement error, non-linear effects, and random variation.</p>
</section>
<section id="python-packages-for-computing-pearson-r">
<h4>Python packages for computing Pearson <span class="math notranslate nohighlight">\(r\)</span><a class="headerlink" href="#python-packages-for-computing-pearson-r" title="Link to this heading">#</a></h4>
<p>We can use many different ready-to-use functions to calculate correlation coefficients:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.corrcoef.html"><code class="docutils literal notranslate"><span class="pre">corrcoef</span></code> from NumPy</a></p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.corr.html"><code class="docutils literal notranslate"><span class="pre">corr</span></code> from Pandas</a> as we saw at the beginning of the chapter while drawing a heatmap</p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.pearsonr.html"><code class="docutils literal notranslate"><span class="pre">pearsonr</span></code> from SciPy</a> as shown below</p></li>
<li><p><a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.compute_effsize.html"><code class="docutils literal notranslate"><span class="pre">compute_effsize</span></code> from Pingouin</a> with method set to ‘r’ for ‘Pearson correlation coefficient’</p></li>
<li><p><a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.corr.html"><code class="docutils literal notranslate"><span class="pre">corr</span></code> from Pingouin</a>, function that provides additional information beyond the correlation coefficient, e.g., P value and confidence interval, which we’ll discuss later in this chapter.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>

<span class="c1"># Calculate the Pearson correlation coefficient</span>
<span class="n">pearson_r</span><span class="p">,</span> <span class="n">pearson_p_value</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pearson correlation coefficient:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pearson_r</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pearson correlation coefficient: 0.770003
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="non-parametric-methods">
<h3>Non-parametric methods<a class="headerlink" href="#non-parametric-methods" title="Link to this heading">#</a></h3>
<section id="spearman-rank-correlation-coefficient">
<span id="spearman"></span><h4>Spearman rank correlation coefficient<a class="headerlink" href="#spearman-rank-correlation-coefficient" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">The Spearman rank correlation coefficient</a>, often denoted as <span class="math notranslate nohighlight">\(\rho\)</span>, offers a <strong>non-parametric</strong> approach to assess the <strong>monotonicity</strong> of the relationship between two variables. Unlike the Pearson correlation, Spearman’s correlation doesn’t assume that the data is normally distributed, making it <em>robust to outliers</em> and suitable for <em>non-linear relationships</em>, as long as they are monotonic. A monotonic relationship is one that consistently increases or decreases, but not necessarily in a linear fashion.</p>
<p>Mathematically, the Spearman correlation coefficient is equivalent to calculating the Pearson correlation coefficient on the ranked values of the variables. This means that instead of using the raw data, we rank the observations within each variable and then compute the correlation based on these ranks.</p>
<p>A Spearman correlation of -1 indicates a perfect negative monotonic relationship (as one variable increases, the other strictly decreases), while +1 indicates a perfect positive monotonic relationship (both variables increase or decrease together). A value of 0 suggests no monotonic association.</p>
<p>The formula to calculate Spearman’s rank correlation coefficient between two variables, <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>, with <span class="math notranslate nohighlight">\(n\)</span> observations is:</p>
<div class="math notranslate nohighlight">
\[\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(i\)</span> is the observation number</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the total number of observations</p></li>
<li><p><span class="math notranslate nohighlight">\(d_i\)</span> is the difference in <strong>ranks</strong> between the corresponding <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> values for observation <span class="math notranslate nohighlight">\(i\)</span>: <span class="math notranslate nohighlight">\(d_i = \mathrm{rank}(x_i) - \mathrm{rank}(y_i)\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">spearman_rho_custom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Spearman&#39;s rank correlation coefficient between XY pairs,</span>
<span class="sd">    illustrating the step-by-step calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># 1. Rank the data using numpy.argsort</span>
    <span class="n">rank_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">rank_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="c1"># 2. Calculate the difference in ranks (di) - array</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">rank_x</span> <span class="o">-</span> <span class="n">rank_y</span>

    <span class="c1"># 3. Square the differences (di^2)</span>
    <span class="n">d_squared</span> <span class="o">=</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># 4. Sum the squared differences</span>
    <span class="n">sum_d_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d_squared</span><span class="p">)</span>

    <span class="c1"># 5. Apply the Spearman formula</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">sum_d_squared</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">rho</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Spearman&#39;s rank correlation coefficient obtained with the custom function:&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">spearman_rho_custom</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spearman&#39;s rank correlation coefficient obtained with the custom function: 0.74725
</pre></div>
</div>
</div>
</div>
</section>
<section id="kendall-rank-correlation-coefficient">
<span id="kendall"></span><h4>Kendall rank correlation coefficient<a class="headerlink" href="#kendall-rank-correlation-coefficient" title="Link to this heading">#</a></h4>
<p>As we’ve explored, there are multiple ways to define a correlation coefficient. Pearson’s correlation utilizes the <em>product of standardized distances</em> from the mean, while Spearman’s correlation employs the <em>ranks of the data</em>. Now, let’s introduce another approach to measuring correlation: Kendall’s tau (<span class="math notranslate nohighlight">\(\tau\)</span>).</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">Kendall’s tau</a> is based on the concept of <strong>concordant and discordant pairs</strong> of observations. A concordant pair, is a pair of observations <span class="math notranslate nohighlight">\((i, j)\)</span>, where <span class="math notranslate nohighlight">\(i \lt j\)</span>, is concordant if the order of the values for both variables is the same. That is, either  <span class="math notranslate nohighlight">\(x_i \gt x_j\)</span> and <span class="math notranslate nohighlight">\(y_i \gt y_j\)</span>, or <span class="math notranslate nohighlight">\(x_i \lt x_j\)</span> and <span class="math notranslate nohighlight">\(y_i \lt y_j\)</span>. In contrast, a discordant pair is discordant if the order of the values for the variables is opposite. That is, either <span class="math notranslate nohighlight">\(x_i \gt x_j\)</span> and <span class="math notranslate nohighlight">\(y_i \lt y_j\)</span>, or <span class="math notranslate nohighlight">\(x_i \lt x_j\)</span> and <span class="math notranslate nohighlight">\(y_i \gt y_j\)</span>.</p>
<p>Kendall’s tau is calculated as:</p>
<div class="math notranslate nohighlight">
\[\tau = \frac{\text{number of concordant pairs} - \text{number of discordant pairs}}{\binom{n}{2}}\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the total number of observations. Note that <span class="math notranslate nohighlight">\(\binom{n}{2} = n(n - 1) / 2\)</span>.</p>
<p>The coefficient ranges from <span class="math notranslate nohighlight">\(-1\)</span> to <span class="math notranslate nohighlight">\(+1\)</span>, with <span class="math notranslate nohighlight">\(0\)</span> indicating no association. The denominator, <span class="math notranslate nohighlight">\(n(n - 1) / 2\)</span>, represents the total number of unique pairs of observations.</p>
<p>An alternative way to express Kendall’s tau, which is mathematically equivalent, is based on the ranks of the data:</p>
<div class="math notranslate nohighlight">
\[\tau = \frac{2}{n(n - 1)} \sum_{i \lt j} \text{sgn}(x_i - x_j) \ast \text{sgn}(y_i - y_j)\]</div>
<p>where <span class="math notranslate nohighlight">\(\text{sgn()}\)</span> is the sign function, i.e., -1 if negative, 0 if zero, +1 if positive.</p>
<p>Compared to Pearson and Spearman, Kendall’s tau is less influenced by the magnitude of differences between data points, making it more robust to outliers.
It’s also suitable for <em>ordinal data</em>, where the ranks of the values are more important than the exact magnitudes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kendall_tau_custom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Kendall&#39;s tau correlation coefficient,</span>
<span class="sd">    illustrating the step-by-step calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="c1"># Calculate the number of concordant and discordant pairs</span>
    <span class="n">concordant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">discordant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>  <span class="c1"># Iterate through all unique pairs</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">concordant</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">discordant</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Calculate Kendall&#39;s tau</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="n">concordant</span> <span class="o">-</span> <span class="n">discordant</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tau</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Kendall&#39;s tau correlation coefficient obtained with the custom function:&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">kendall_tau_custom</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Kendall&#39;s tau correlation coefficient obtained with the custom function: 0.51282
</pre></div>
</div>
</div>
</div>
</section>
<section id="python-package-for-computing-spearman-rho-and-kendall-tau">
<h4>Python package for computing Spearman <span class="math notranslate nohighlight">\(\rho\)</span> and Kendall <span class="math notranslate nohighlight">\(\tau\)</span><a class="headerlink" href="#python-package-for-computing-spearman-rho-and-kendall-tau" title="Link to this heading">#</a></h4>
<p>To calculate the Spearman <span class="math notranslate nohighlight">\(\rho\)</span> correlation coefficient, we can use ready-to-use functions like [<code class="docutils literal notranslate"><span class="pre">spearmanr</span></code> from SciPy][<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.spearmanr.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.spearmanr.html</a>], <code class="docutils literal notranslate"><span class="pre">corr</span></code> from Pandas by specifying the method as ‘spearman’, and <code class="docutils literal notranslate"><span class="pre">corr</span></code> from <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> with method parameter set to ‘spearman’.</p>
<p>It is also possible to use <code class="docutils literal notranslate"><span class="pre">corrcoef</span></code> from NumPy, although we would first need to rank your data using <code class="docutils literal notranslate"><span class="pre">argsort</span></code>, as we did in the previous custom function <code class="docutils literal notranslate"><span class="pre">spearman_rho</span></code>, or using <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rankdata.html"><code class="docutils literal notranslate"><span class="pre">scipy.stats.rankdata</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">spearmanr</span>

<span class="c1"># Calculate the Spearman rank correlation coefficient</span>
<span class="n">spearman_r</span><span class="p">,</span> <span class="n">spearman_p_value</span> <span class="o">=</span> <span class="n">spearmanr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Spearman rank correlation coefficient:&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">spearman_r</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spearman rank correlation coefficient: 0.7438
</pre></div>
</div>
</div>
</div>
<p>Similarly for Kendall <span class="math notranslate nohighlight">\(\tau\)</span>, we can leverage functions like <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kendalltau.html"><code class="docutils literal notranslate"><span class="pre">kendalltau</span></code> from SciPy</a>,  <code class="docutils literal notranslate"><span class="pre">corr</span></code> from Pandas with the <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter set to ‘kendall’, and <code class="docutils literal notranslate"><span class="pre">corr</span></code> from Pingouin with the <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter set to ‘kendall’, to calculate Kendall’s tau correlation coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kendalltau</span>

<span class="c1"># Calculate the Spearman rank correlation coefficient</span>
<span class="n">kendall_tau</span><span class="p">,</span> <span class="n">kendall_p_value</span> <span class="o">=</span> <span class="n">kendalltau</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Kendall rank correlation coefficient:&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">kendall_tau</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Kendall rank correlation coefficient: 0.51952
</pre></div>
</div>
</div>
</div>
</section>
<section id="handling-ties">
<h4>Handling ties<a class="headerlink" href="#handling-ties" title="Link to this heading">#</a></h4>
<p>When working with data that contains ties (identical values), it’s crucial to be aware of how ties are handled in the ranking process. Different methods for handling ties can lead to slightly different results in the calculation of Spearman’s rank correlation coefficient. Common approaches for dealing with ties include assigning the average rank to tied values or using other tie-breaking methods. By default, <code class="docutils literal notranslate"><span class="pre">spearmanr</span></code> uses the ‘average’ rank method for handling <strong>ties</strong>, when <code class="docutils literal notranslate"><span class="pre">np.argsort</span></code>, i.e., in our custom function, uses an ‘ordinal’ rank method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank</span>
<span class="c1"># Same results as `spearmanr`</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank (average):&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">),</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">5</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank (average): 0.7438
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank</span>
<span class="c1"># Same as our custom function that uses numpy.argsort</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank (ordinal):&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">5</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Spearman rank correlation coefficient using np.corrcoef and pd.Series.rank (ordinal): 0.74725
</pre></div>
</div>
</div>
</div>
<p>Similarly, the custom function provides a simplified illustration of Kendall’s tau calculation but might not perfectly match the results from <code class="docutils literal notranslate"><span class="pre">scipy.stats.kendalltau</span></code> due to the complexities of tie handling. The <code class="docutils literal notranslate"><span class="pre">kendalltau</span></code> function has a more sophisticated approach to handling ties, which involves adjustments to the formula based on the number and types of ties present in the data, as <a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient#Accounting_for_ties">explained elsewhere</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kendall_tau_b</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes Kendall&#39;s tau-b correlation coefficient,</span>
<span class="sd">    illustrating the step-by-step calculation with tie handling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Calculate the number of concordant, discordant, and tied pairs</span>
    <span class="n">concordant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">discordant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ties_x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ties_y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">concordant</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">discordant</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">ties_x</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">ties_y</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Calculate Kendall&#39;s tau-b</span>
    <span class="n">tau_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">concordant</span> <span class="o">-</span> <span class="n">discordant</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="p">(</span><span class="n">concordant</span> <span class="o">+</span> <span class="n">discordant</span> <span class="o">+</span> <span class="n">ties_x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">concordant</span> <span class="o">+</span> <span class="n">discordant</span> <span class="o">+</span> <span class="n">ties_y</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tau_b</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Kendall&#39;s tau (tau_b) correlation coefficient obtained with tie handling:&quot;</span><span class="p">,</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">kendall_tau_b</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Kendall&#39;s tau (tau_b) correlation coefficient obtained with tie handling: 0.51952
</pre></div>
</div>
</div>
</div>
<p>It’s important to consult the documentation of the specific function or software package we’re using to understand how ties are handled. This will ensure that we interpret the results accurately and that the analysis is consistent with the chosen method for addressing ties. The issue of tie handling is not limited to correlation analysis. It’s a general consideration in many non-parametric methods that involve ranking data, as the presence of ties can affect the resulting ranks and subsequent calculations.</p>
</section>
</section>
<section id="exploration-of-non-linear-patterns">
<h3>Exploration of non-linear patterns<a class="headerlink" href="#exploration-of-non-linear-patterns" title="Link to this heading">#</a></h3>
<p>While Pearson’s correlation is a powerful tool for quantifying <em>linear relationships</em>, many relationships in biology are non-linear. It’s essential to understand how different correlation coefficients capture these non-linear patterns.</p>
<ul class="simple">
<li><p>Linear relationships: Pearson’s correlation is the ideal choice for measuring the strength of linear relationships, where the change in one variable is proportional to the change in the other. Both Spearman and Kendall will also detect linear relationships, but they might not be as efficient as Pearson’s correlation.</p></li>
<li><p>Monotonic relationships: Spearman and Kendall’s correlations are specifically designed to measure <strong>monotonic relationships</strong>, where the variables consistently increase or decrease together, but not necessarily in a linear fashion. Pearson’s correlation might underestimate the strength of the relationship in these cases, especially if the pattern is strongly non-linear.</p></li>
<li><p>Non-monotonic relationships: neither Pearson, Spearman, nor Kendall is suitable for capturing non-monotonic relationships, where the direction of the association changes. For such patterns, alternative methods like <em>polynomial regression</em> or spline fitting might be more appropriate.</p></li>
</ul>
<p>Let’s illustrate these concepts with some examples. The following plots show different types of relationships and the corresponding values of Pearson, Spearman, and Kendall correlation coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">5</span>

<span class="c1"># Generate data for each type of relationship</span>
<span class="n">linear</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)]</span>
<span class="n">monotonic</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u</span><span class="p">,</span> <span class="mi">50</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.8</span><span class="o">**</span><span class="p">(</span><span class="n">u</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">300</span><span class="p">)]</span>
<span class="n">non_monotonic</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">250</span><span class="p">)]</span>

<span class="c1"># Combine the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Linear&quot;</span><span class="p">:</span> <span class="n">linear</span><span class="p">,</span>
    <span class="s2">&quot;Monotonic&quot;</span><span class="p">:</span> <span class="n">monotonic</span><span class="p">,</span>
    <span class="s2">&quot;Non-monotonic&quot;</span><span class="p">:</span> <span class="n">non_monotonic</span>
<span class="p">}</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Plot each relationship</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">model</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">model</span><span class="p">]</span>
    
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="c1"># Calculate and display correlation coefficients</span>
    <span class="n">pearson_corr</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">spearman_corr</span> <span class="o">=</span> <span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">kendall_corr</span> <span class="o">=</span> <span class="n">kendalltau</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">.085</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">.95</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pearson: </span><span class="si">{</span><span class="n">pearson_corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Spearman: </span><span class="si">{</span><span class="n">spearman_corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Kendall: </span><span class="si">{</span><span class="n">kendall_corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span>  <span class="c1"># Specifies that x,y coordinates are for axis</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/571647c918a1bd28421844b4e9787da35e60dde0e323b8c1c7e00dfe367c8461.png" src="_images/571647c918a1bd28421844b4e9787da35e60dde0e323b8c1c7e00dfe367c8461.png" />
</div>
</div>
<p>While both Spearman’s rho and Kendall’s tau are valuable tools for assessing correlation, Kendall’s tau might be preferred in situations with <em>smaller sample sizes</em>, increased concern about <em>outliers</em>, <em>frequent tied values</em>, specific theoretical considerations (e.g., survival analysis or studies of event ordering), or when <em>computational efficiency</em> is a priority.</p>
</section>
</section>
<section id="statistical-inference">
<h2>Statistical inference<a class="headerlink" href="#statistical-inference" title="Link to this heading">#</a></h2>
<section id="testing-for-non-zero-correlation">
<h3>Testing for non-zero correlation<a class="headerlink" href="#testing-for-non-zero-correlation" title="Link to this heading">#</a></h3>
<section id="calculating-the-t-statistic-for-correlation">
<h4>Calculating the t-statistic for correlation<a class="headerlink" href="#calculating-the-t-statistic-for-correlation" title="Link to this heading">#</a></h4>
<p>Correlation coefficients provide a point estimate of the relationship between variables based on our sample data. However, we often want to go beyond the sample and infer whether a correlation exists in the <em>broader population</em>. Hypothesis testing allows us to do this.</p>
<p>To test for a non-zero correlation between two variables, we can use a <strong>t-test</strong>, similar to t-test we discussed in previous chapters about the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/30%20-%20Comparing%20Two%20Unpaired%20Means.html">comparison of two unpaired means</a> and in <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/31%20-%20Comparing%20Paired%20Data.html">paired data</a>. This test assesses whether the observed correlation in our sample is statistically significant, meaning it’s unlikely to have occurred by chance if there were no correlation in the population. We can state the hypotheses as follows:</p>
<ul class="simple">
<li><p>Null hypothesis (H0): the population correlation coefficient is zero (no correlation).</p></li>
<li><p>Alternative hypothesis (H1): the population correlation coefficient is not zero (correlation exists).</p></li>
</ul>
<p>The test statistic for the t-test for correlation is defined as:</p>
<div class="math notranslate nohighlight">
\[t = \frac{r}{\mathrm{SE}(r)} = r \sqrt{\frac{n-2}{1 - r^2}}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the sample correlation coefficient,</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the sample size.</p></li>
</ul>
<p>Degrees of freedom represent the number of independent pieces of information available to estimate a parameter. In the context of the t-test for correlation, we are estimating the population correlation coefficient based on the sample correlation coefficient. To calculate the sample correlation coefficient, we first need to estimate two other parameters: the mean of <span class="math notranslate nohighlight">\(X\)</span> and the mean of <span class="math notranslate nohighlight">\(Y\)</span>. These two estimated parameters reduce the degrees of freedom. Each data point provides one piece of information. However, since we’ve already estimated two parameters from the data, we lose two degrees of freedom, thus <span class="math notranslate nohighlight">\(\mathrm{DF} = n - 2\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the t-statistic and DF for correlation</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">])</span>  <span class="c1"># Sample size</span>
<span class="n">df_corr</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span>                    <span class="c1"># Degrees of freedom</span>
<span class="n">t_stat_corr</span> <span class="o">=</span> <span class="n">pearson_r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pearson_r</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># type: ignore</span>

<span class="c1"># Print the t-statistic</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic for correlation = </span><span class="si">{</span><span class="n">t_stat_corr</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">df_corr</span><span class="si">}</span><span class="s2"> degrees of freedom&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t-statistic for correlation = 4.0026 with 11 degrees of freedom
</pre></div>
</div>
</div>
</div>
</section>
<section id="p-value">
<h4>P value<a class="headerlink" href="#p-value" title="Link to this heading">#</a></h4>
<p>Having calculated the t-statistic and degrees of freedom, we can now determine the P value for the correlation. We’ll use the t-distribution’s cumulative distribution function (CDF) to compute the P value. This P value quantifies the probability of observing a correlation coefficient as extreme as the one calculated (or even more extreme) if the null hypothesis of no correlation were true.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">t_dist</span>

<span class="c1"># Calculate the p-value (two-sided test)</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_stat_corr</span><span class="p">),</span> <span class="n">df_corr</span><span class="p">))</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for the correlation coefficient = </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value for the correlation coefficient = 0.00208
</pre></div>
</div>
</div>
</div>
<p>This low P value provides strong evidence against the null hypothesis, suggesting that there is a statistically significant correlation between the variables. More precisely, there is a 0.208% chance of obtaining a greater <strong>absolute</strong> correlation coefficient if the null hypothesis were true.</p>
</section>
<section id="visualizing-t-critical-and-p-values">
<h4>Visualizing t, critical and P values<a class="headerlink" href="#visualizing-t-critical-and-p-values" title="Link to this heading">#</a></h4>
<p>We can visualize how the P and critical values are determined based on the t-statistic (<span class="math notranslate nohighlight">\(t\)</span>) and the t-distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Significance level (alpha)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Calculate critical t-values (two-tailed test)</span>
<span class="n">t_crit_lower</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_corr</span><span class="p">)</span>
<span class="n">t_crit_upper</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_corr</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">hx_t</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">df_corr</span><span class="p">)</span>

<span class="c1"># Plot the t-distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">hx_t</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Plot the critical t-values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_lower</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_upper</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$t^\ast$ (</span><span class="si">{</span><span class="n">t_crit_upper</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Shade the rejection regions (alpha)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower</span><span class="p">],</span>
    <span class="n">hx_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$\alpha$ (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper</span><span class="p">],</span>
    <span class="n">hx_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">)</span>

<span class="c1"># Plot the observed t-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_stat_corr</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$t$ (</span><span class="si">{</span><span class="n">t_stat_corr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Shade the P value areas (two-tailed)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_stat_corr</span><span class="p">)],</span>
    <span class="n">hx_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_stat_corr</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P (</span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_stat_corr</span><span class="p">)],</span>
    <span class="n">hx_t</span><span class="p">[</span><span class="n">x_t</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_stat_corr</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$t$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t distribution (DF=</span><span class="si">{</span><span class="n">df_corr</span><span class="si">}</span><span class="s2">) | Pearson correlation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aec8fc0ac41a1338c794887ba48d4aceea31d8343ee7a6f98c9893ef9993c646.png" src="_images/aec8fc0ac41a1338c794887ba48d4aceea31d8343ee7a6f98c9893ef9993c646.png" />
</div>
</div>
</section>
<section id="effect-size">
<h4>Effect size<a class="headerlink" href="#effect-size" title="Link to this heading">#</a></h4>
<p>While statistical significance (P value) tells us whether a correlation is likely to exist in the population, it doesn’t tell us how strong the correlation is. That’s where <strong>effect size</strong> comes in.</p>
<p>In correlation analysis, the correlation coefficient itself (Pearson’s <span class="math notranslate nohighlight">\(r\)</span>, Spearman’s <span class="math notranslate nohighlight">\(\rho\)</span>, or Kendall’s <span class="math notranslate nohighlight">\(\tau\)</span>) serves as the effect size. It provides a standardized measure of the strength of the association between the variables:</p>
<ul class="simple">
<li><p>Small effect: <span class="math notranslate nohighlight">\(|r| = 0.1\)</span></p></li>
<li><p>Medium effect: <span class="math notranslate nohighlight">\(|r| = 0.3\)</span></p></li>
<li><p>Large effect: <span class="math notranslate nohighlight">\(|r|  = 0.5\)</span></p></li>
</ul>
<p>These are general guidelines, and the interpretation of effect size can vary depending on the specific research area and context.</p>
<p>It’s important to recognize that a statistically significant correlation might have a small effect size, indicating that the relationship, while likely present in the population, might not be practically meaningful. However, effect size is crucial because it allows us to compare the strength of correlations across different studies or variables. This is why effect sizes are essential for meta-analysis, which combines the results of multiple studies.</p>
</section>
</section>
<section id="confidence-interval">
<span id="ci"></span><h3>Confidence interval<a class="headerlink" href="#confidence-interval" title="Link to this heading">#</a></h3>
<p>A confidence interval provides a range of plausible values for the true population correlation coefficient based on the sample correlation coefficient. It gives us an idea of the <em>precision</em> of our estimate. Similarly to what we discussed for confidence intervals of a <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/04%20-%20Confidence%20Interval%20of%20a%20Proportion.html#">proportion</a>, of <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/05%20-%20Confidence%20Interval%20of%20Survival%20Data.html">survival data</a>, of <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/06%20-%20Confidence%20Interval%20of%20Counted%20Data%20%28Poisson%20Distribution%29.html">counted data</a>, for the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/12%20-%20Confidence%20Interval%20of%20a%20Mean.html">confidence interval of a mean</a>, or for the mean difference when assessing the significance of <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/31%20-%20Comparing%20Paired%20Data.html#p-value-and-confidence-interval">paired difference mean</a> or <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/30%20-%20Comparing%20Two%20Unpaired%20Means.html#welch-s-p-value-and-confidence-interval">mean differences in unpaired data</a>, we need to compute the <strong>margin of error</strong>, which is often based on the <strong>standard error</strong>.</p>
<p>A common method for calculating confidence intervals for Pearson’s correlation coefficient is to use <a class="reference external" href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient#Using_the_Fisher_transformation"><strong>Fisher’s r-to-z transformation</strong></a>. This transformation helps to normalize the sampling distribution of the correlation coefficient, especially when the correlation is not close to zero. It works as follows:</p>
<ol class="arabic">
<li><p>The correlation coefficient (<span class="math notranslate nohighlight">\(r\)</span>) is transformed to a z-score, also known as Fisher’s Z-score, using the Fisher transformation:</p>
<div class="math notranslate nohighlight">
\[z = 1/2 \log\left(\frac{1 + r}{1 - r}\right) = \mathrm{arctanh}(r)\]</div>
</li>
<li><p>The standard error of the transformed z-score is calculated as <span class="math notranslate nohighlight">\(\mathrm{SE}_z = 1 / \sqrt{n - 3}\)</span>, where <span class="math notranslate nohighlight">\(n\)</span> is the sample size.</p></li>
<li><p>The confidence interval for the transformed z-score is calculated in the <em>z-space</em> using the <strong>standard normal distribution</strong>:</p>
<div class="math notranslate nohighlight">
\[\mathrm{CI}_z = z \pm z^\ast \times \mathrm{SE}_z\]</div>
<p>where <span class="math notranslate nohighlight">\(z^\ast\)</span>, the critical value of <span class="math notranslate nohighlight">\(z\)</span> at <span class="math notranslate nohighlight">\(\alpha / 2\)</span>, is obtained from the standard normal distribution based on the desired confidence level (<span class="math notranslate nohighlight">\(\alpha\)</span>).</p>
</li>
<li><p>The confidence interval in z-space is back-transformed to the original correlation scale (<em>r-space</em>) using the inverse Fisher transformation:</p>
<div class="math notranslate nohighlight">
\[\mathrm{CI}_r = \frac{\exp(2 \mathrm{CI}_z) - 1}{\exp(2 \mathrm{CI}_z) + 1} = \mathrm{tanh}(\mathrm{CI}_z)\]</div>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="c1"># Fisher&#39;s r-to-z transformation</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">pearson_r</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="c1"># or 0.5 * np.log((1 + r) / (1 - r))</span>
<span class="n">se</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Calculate the confidence interval (e.g., 95% confidence)</span>
<span class="n">confidence_level</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">critical_z</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">margin_of_error</span> <span class="o">=</span> <span class="n">critical_z</span> <span class="o">*</span> <span class="n">se</span>
<span class="n">ci_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">margin_of_error</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">margin_of_error</span><span class="p">)</span>  <span class="c1"># CI in z-space</span>

<span class="c1"># Back-transform to r-space</span>
<span class="n">ci_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">ci_z</span><span class="p">)</span>  <span class="c1"># or ci_r_lower = (np.exp(2 * ci_z[0]) - 1) / (np.exp(2 * ci_z[0]) + 1)...</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson correlation coefficient: </span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% confidence interval for the correlation: [</span><span class="si">{</span><span class="n">ci_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ci_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pearson correlation coefficient: 0.770
95% confidence interval for the correlation: [0.3804, 0.9275]
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.compute_esci.html">Pingouin function <code class="docutils literal notranslate"><span class="pre">compute_esci</span></code></a> computes the parametric confidence interval around a Pearson <span class="math notranslate nohighlight">\(r\)</span> correlation coefficient by applying the Fisher’s r-to-z transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Parametric confidence intervals around Pearson r=</span><span class="si">{</span><span class="n">pg</span><span class="o">.</span><span class="n">compute_effsize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">eftype</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">compute_esci</span><span class="p">(</span>
        <span class="n">stat</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">compute_effsize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eftype</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">),</span>
        <span class="n">nx</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">eftype</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parametric confidence intervals around Pearson r=0.77: [0.38 0.93]
</pre></div>
</div>
</div>
</div>
<p>Based on the calculated 95% confidence interval of [0.3804, 0.9275], we can be 95% confident that the true population correlation coefficient between %C20-22 fatty acids and insulin sensitivity falls within this range. This assumes that our data is a representative random sample from the larger population.</p>
</section>
<section id="performing-statistical-inference-in-python">
<h3>Performing statistical inference in Python<a class="headerlink" href="#performing-statistical-inference-in-python" title="Link to this heading">#</a></h3>
<p>As we’ve seen throughout this chapter, we can calculate correlation coefficients and perform statistical inference manually using Python libraries like NumPy, SciPy, and Pandas. However, there are also convenient functions available that streamline the process.</p>
<p>The <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.corr.html">Pingouin package offers a <code class="docutils literal notranslate"><span class="pre">corr</span></code> function</a> that calculates correlation coefficients and provides additional information like P values and confidence intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate Pearson correlation with P value and confidence interval</span>
<span class="n">pg</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n</th>
      <th>r</th>
      <th>CI95%</th>
      <th>p-val</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>pearson</th>
      <td>13</td>
      <td>0.770003</td>
      <td>[0.38, 0.93]</td>
      <td>0.002077</td>
      <td>23.947</td>
      <td>0.912954</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The function also offers non-parametric methods such as Spearman and Kendall, as well as alternative hypothesis for one-sided test. Let’s say we want to use Spearman correlation, and test if there is a <em>positive correlation</em> between the percentage of C20-20 fatty acids and insulin sensitivity in the population. We’re specifically interested in whether the correlation is <em>greater than zero</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n</th>
      <th>r</th>
      <th>CI95%</th>
      <th>p-val</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>spearman</th>
      <td>13</td>
      <td>0.743804</td>
      <td>[0.41, 1.0]</td>
      <td>0.001779</td>
      <td>0.9322</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="bootstrapping-and-permutation-tests-for-correlation-analysis">
<h2>Bootstrapping and permutation tests for correlation analysis<a class="headerlink" href="#bootstrapping-and-permutation-tests-for-correlation-analysis" title="Link to this heading">#</a></h2>
<p>As we’ve seen in previous chapters, <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/31%20-%20Comparing%20Paired%20Data.html#bootstrapping-and-permutation-tests-for-paired-data">for example in paired t-test</a>, bootstrapping is a valuable tool for statistical inference, especially when dealing with <em>small sample sizes</em> or when the assumptions of traditional methods are not met. It allows us to estimate parameters and confidence intervals directly from the data without relying on strong distributional assumptions.</p>
<p><a class="reference external" href="https://jmasm.com/index.php/jmasm/article/view/1069/1069">Recent research has explored the application of bootstrap and permutation methods to correlation analysis</a>, and these methods have been shown to provide valid and robust inferences for correlation coefficients, especially when dealing with small sample sizes or non-linear relationships. By resampling or permuting the data, we can estimate the sampling distribution of the correlation coefficient under the null hypothesis or construct confidence intervals without relying on parametric assumptions.</p>
<section id="generating-bootstrap-paired-data">
<h3>Generating bootstrap paired data<a class="headerlink" href="#generating-bootstrap-paired-data" title="Link to this heading">#</a></h3>
<p>The core idea behind bootstrapping for correlation analysis is to treat the observed sample of <em>paired</em> data points as a miniature representation of the population. We <a class="reference external" href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient#Using_a_bootstrap">resample pairs of observations with replacement</a>, preserving the relationship between the two measurements within each pair.</p>
<p>Technically, this method involves resampling of <span class="math notranslate nohighlight">\(n\)</span> <span class="math notranslate nohighlight">\((x_i, y_i)\)</span> pairs <em>with replacement</em> many times (<span class="math notranslate nohighlight">\(B\)</span>), and calculating the correlation coefficient for each resampled dataset. The empirical distribution of these resampled correlation coefficients is then used to approximate the sampling distribution of the statistic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_bs_pairs</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">pearsonr</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># type: ignore</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform pairs bootstrap for correlation and compute single statistics </span>
<span class="sd">    from the replicates.</span>

<span class="sd">    This function performs pairs bootstrap resampling for correlation analysis.</span>
<span class="sd">    It takes two arrays (x and y) and a function (func) as input. It resamples</span>
<span class="sd">    pairs of data points from x and y with replacement and applies the </span>
<span class="sd">    provided function to calculate a statistic (e.g., correlation coefficient) </span>
<span class="sd">    for each bootstrap sample.</span>

<span class="sd">    Args:</span>
<span class="sd">      x: The first data array.</span>
<span class="sd">      y: The second data array.</span>
<span class="sd">      func: The function from scipy.stats to apply to the resampled data (default: pearsonr).</span>
<span class="sd">      size: The number of bootstrap replicates to generate (default: 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">      An array of bootstrap replicates of the statistic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set up array of indices to sample from</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Initialize array to store bootstrap replicates</span>
    <span class="n">bs_replicates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="c1"># Generate replicates</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="c1"># Resample indices with replacement</span>
        <span class="n">bs_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Get the resampled data (go by pairs)</span>
        <span class="n">bs_x</span><span class="p">,</span> <span class="n">bs_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">]</span>
        
        <span class="c1"># Calculate the statistic using the provided function</span>
        <span class="n">bs_replicates</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">bs_x</span><span class="p">,</span> <span class="n">bs_y</span><span class="p">)</span>  <span class="c1"># Extract the correlation coefficient</span>

    <span class="k">return</span> <span class="n">bs_replicates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Set the number of replicates</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10_000</span>

<span class="c1"># Generate bootstrap replicates of Pearson&#39;s r</span>
<span class="n">bs_replicates</span> <span class="o">=</span> <span class="n">draw_bs_pairs</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>  <span class="c1"># Make sure we send an array</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="n">func</span><span class="o">=</span><span class="n">pearsonr</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">B</span><span class="p">)</span>

<span class="c1"># Print the 10 first replicates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bs_replicates</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.76800734 0.75033014 0.75872762 0.83040812 0.84306196 0.75067324
 0.76837891 0.74724487 0.75046652 0.90883332]
</pre></div>
</div>
</div>
</div>
<p>We can also achieve the same result using a more concise and efficient “pythonic” implementation with list comprehension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">bs_replicates_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">bs_inds</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Print the 10 first replicates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bs_replicates_b</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.76800734 0.75033014 0.75872762 0.83040812 0.84306196 0.75067324
 0.76837891 0.74724487 0.75046652 0.90883332]
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimate-of-the-confidence-interval">
<h3>Estimate of the confidence interval<a class="headerlink" href="#estimate-of-the-confidence-interval" title="Link to this heading">#</a></h3>
<p>Once we have the bootstrap distribution of correlation coefficients, we can estimate the confidence interval by finding the percentiles corresponding to the desired confidence level. For a 95% confidence interval, we typically use the 2.5th and 97.5th percentiles of the bootstrap distribution. This means that 95% of the bootstrapped correlation coefficients fall within this interval, providing a range of plausible values for the true population correlation coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the 95% confidence interval using np.percentile</span>
<span class="n">bs_ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bs_replicates</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap 95% CI estimate = </span><span class="si">{</span><span class="n">bs_ci</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bootstrap 95% CI estimate = [0.542 0.916]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of the bootstrap distribution of correlation coefficients</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">bs_replicates</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Bootstrap $r$&#39;</span><span class="p">)</span>

<span class="c1"># Annotate the observed mean difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">pearson_r</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;Observed $r$ (</span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add lines for the confidence interval</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;2.5th (</span><span class="si">{</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;97.5th (</span><span class="si">{</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Bootstrap distribution of $r$ (B=</span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bbb9c6b34185329b24451f0e37140597a9119a90d9e4224e9836d134d2a2b243.png" src="_images/bbb9c6b34185329b24451f0e37140597a9119a90d9e4224e9836d134d2a2b243.png" />
</div>
</div>
<p>Correlation coefficients have a bounded range (-1 to +1), so that, when the true correlation is near the boundaries, the bootstrap distribution can become <em>skewed</em> because it cannot extend beyond these limits. This is why we applied the <a class="reference internal" href="#ci"><span class="std std-ref">Fisher’s r-to-z transformation for calculating the parametric confidence interval</span></a>. The skewness can affect the accuracy of the confidence interval calculated from the percentiles of the bootstrap distribution.</p>
<p>One solution would be to apply a transformation (like Fisher’s r-to-z transformation) to the correlation coefficients before bootstrapping to help reducing skewness and improving the accuracy of the confidence interval. Let’s take this opportunity to use the <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.compute_bootci.html"><code class="docutils literal notranslate"><span class="pre">pingouin</span></code> function <code class="docutils literal notranslate"><span class="pre">compute_bootci</span></code></a> that computes bootstrapped confidence intervals of univariate and bivariate functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;95</span><span class="si">% c</span><span class="s2">onfidence interval (bootstrap with r-to-z transformation):&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">compute_bootci</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">],</span>
        <span class="n">paired</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Resample the pairs (x_i, y_i)</span>
        <span class="c1"># r-to-z transformation</span>
        <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="c1"># type: ignore</span>
        <span class="c1"># func=&#39;pearson&#39;,  # Use pearsonr for normal correlation</span>
        <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span>  <span class="c1"># Simple percentile</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span>
        <span class="n">n_boot</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">return_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set to False to only return the CI</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>95% confidence interval (bootstrap with r-to-z transformation):
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.53704957, 0.91542046])
</pre></div>
</div>
</div>
</div>
<p>There are also <a class="reference external" href="https://besjournals.onlinelibrary.wiley.com/doi/pdf/10.1111/1365-2656.12382">more advanced bootstrapping methods that adjusts for bias and skewness</a> in the bootstrap distribution, for example <em>bias-corrected and accelerated</em> (BCa) bootstrap. They can provide more accurate confidence intervals, especially when the distribution is skewed. The <code class="docutils literal notranslate"><span class="pre">scipy.stats.pearsonr</span></code> function natively returns a ‘result’ object associate to a <code class="docutils literal notranslate"><span class="pre">confidence_interval</span></code> method that can computes a bootstrap confidence interval of the correlation coefficient statistic using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.bootstrap.html#scipy.stats.bootstrap"><code class="docutils literal notranslate"><span class="pre">scipy.stats.bootstrap</span></code></a>. It’s worth noting that the <code class="docutils literal notranslate"><span class="pre">compute_bootci</span></code> function in Pingouin uses a bias correction method for the bootstrap distribution that differs from the BCa method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">BootstrapMethod</span>

<span class="n">method</span> <span class="o">=</span> <span class="n">BootstrapMethod</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;BCa&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">111</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>
<span class="n">ci_bca</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">(</span><span class="n">confidence_level</span><span class="o">=</span><span class="mf">.95</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;95</span><span class="si">% c</span><span class="s2">onfidence interval (BCa):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ci_bca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>95% confidence interval (BCa):
 ConfidenceInterval(low=0.5252399567436714, high=0.9081916163196986)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="n">t</span>

<span class="c1"># ... (your DataFrame &#39;df&#39; with &#39;C2022_fatacids&#39; and &#39;insulin_sensitiv&#39;) ...</span>

<span class="k">def</span> <span class="nf">draw_bs_pairs_t_stat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform pairs bootstrap for correlation and compute t-statistics </span>
<span class="sd">    from the replicates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">bs_t_stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Calculate sample size here</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">bs_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bs_x</span><span class="p">,</span> <span class="n">bs_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">]</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">bs_x</span><span class="p">,</span> <span class="n">bs_y</span><span class="p">)</span>
        <span class="n">t_stat</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># type: ignore</span>
        <span class="n">bs_t_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_stat</span>
    <span class="k">return</span> <span class="n">bs_t_stats</span>

<span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Generate 10000 bootstrap replicates of the t-statistic</span>
<span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">bs_t_replicates</span> <span class="o">=</span> <span class="n">draw_bs_pairs_t_stat</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_replicates</span>
<span class="p">)</span>

<span class="c1"># Calculate the P value using bootstrapping, considering the direction of the observed t-statistic</span>
<span class="k">if</span> <span class="n">t_stat_corr</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_replicates</span> <span class="o">&gt;=</span> <span class="n">t_stat_corr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">bs_t_replicates</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_replicates</span> <span class="o">&lt;=</span> <span class="n">t_stat_corr</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">bs_t_replicates</span><span class="p">)</span>

<span class="c1"># Print the P value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value obtained using bootstrapped t-statistics = </span><span class="si">{</span><span class="n">p_value_bs_shifted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value obtained using bootstrapped t-statistics = 0.5382
</pre></div>
</div>
</div>
</div>
</section>
<section id="p-value-using-permutation">
<span id="permutations"></span><h3>P value using permutation<a class="headerlink" href="#p-value-using-permutation" title="Link to this heading">#</a></h3>
<p>Bootstrapping and permutation tests offer flexibility in testing hypotheses about correlation. We can manipulate the data to simulate the null hypothesis of no correlation, allowing us to calculate P values. The choice of test statistic in correlation analysis often depends on the specific hypothesis and the nature of the data. Common test statistics include the correlation coefficient Pearson’s <span class="math notranslate nohighlight">\(r\)</span>, Spearman’s <span class="math notranslate nohighlight">\(\rho\)</span>, or Kendall’s <span class="math notranslate nohighlight">\(\tau\)</span>. But the flexibility of resampling methods allows us to explore other relevant statistics as well.</p>
<p><strong>Permutation</strong> tests are a common resampling method for hypothesis testing in correlation analysis. In this approach, we randomly shuffle the values of one of the variables while keeping the other variable fixed. This <em>shuffling</em> breaks the association between the variables, simulating the null hypothesis of no correlation. By calculating the correlation coefficient for each permuted dataset, we generate a permutation distribution of correlation coefficients under the null hypothesis. We can then compare the observed correlation from our original data to this permutation distribution to assess its significance (P value).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">permute_for_correlation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a permuted sample for correlation analysis </span>
<span class="sd">    under the null hypothesis of no association.</span>

<span class="sd">    Args:</span>
<span class="sd">      x: The first data array.</span>
<span class="sd">      y: The second data array.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A new array with the values of x permuted randomly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Permute the values of x</span>
    <span class="n">permuted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">permuted_x</span><span class="p">,</span> <span class="n">y</span>  <span class="c1"># Return the permuted x and the original y</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we determine how frequently the correlation coefficients calculated from the permuted datasets are as extreme as, or even more extreme than, the observed correlation coefficient in our original data. This proportion represents the P value. In essence, it tells us the likelihood of observing a correlation as strong as the one we found, purely by chance, if there were truly no association between the variables (i.e., if the null hypothesis were true).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Generate 10,000 permutation replicates of the correlation coefficient</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">permuted_corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="c1"># Generate permuted correlation coefficients</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="c1"># Permute the data</span>
    <span class="n">permuted_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">permute_for_correlation</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">])</span>
    
    <span class="c1"># Calculate the correlation coefficient for this permuted sample</span>
    <span class="n">permuted_corrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">permuted_x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Print the first 6 replicate correlation coefficients</span>
<span class="nb">print</span><span class="p">(</span><span class="n">permuted_corrs</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.09216053  0.10482992 -0.06654712 -0.46068324  0.55469462  0.04537575]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Same with a &#39;pythonic&#39; implementation using list comprehension</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;per_C2022_fatacids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;insulin_sensitivity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">permuted_corrs_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">pearsonr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># type: ignore</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">permuted_corrs_b</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.09216053  0.10482992 -0.06654712 -0.46068324  0.55469462  0.04537575]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the P value using the distribution of Pearson&#39;s r replicates of permuted pairs,</span>
<span class="c1"># considering the direction of the observed correlation coefficient</span>
<span class="k">if</span> <span class="n">pearson_r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># type: ignore</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_corrs</span> <span class="o">&gt;=</span> <span class="n">pearson_r</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_corrs</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_corrs</span> <span class="o">&lt;=</span> <span class="n">pearson_r</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_corrs</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Print the p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value obtained using permutation = </span><span class="si">{</span><span class="n">p_value_permutation</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value obtained using permutation = 0.0012
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="c1"># Plot the histogram of the Pearson r of shuffled pairs</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">permuted_corrs</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="o">**</span><span class="mf">.5</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
    <span class="c1"># alpha=0.75,</span>
<span class="p">)</span>

<span class="c1"># Annotate the observed mean difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">pearson_r</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;Observed $r$ (</span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Determine the direction of the observed difference and plot accordingly</span>
<span class="k">if</span> <span class="n">pearson_r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># type: ignore</span>
    <span class="c1"># Plot the histogram of the mean differences &gt;= observed mean difference </span>
    <span class="n">extreme_diffs</span> <span class="o">=</span> <span class="n">permuted_corrs</span><span class="p">[</span><span class="n">permuted_corrs</span> <span class="o">&gt;=</span> <span class="n">pearson_r</span><span class="p">]</span> <span class="c1"># type: ignore</span>
    <span class="c1"># Change the color of the bars based on the direction parameter</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&gt;=</span> <span class="n">extreme_diffs</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Plot the histogram of the mean differences &lt;= observed mean difference</span>
    <span class="n">extreme_diffs</span> <span class="o">=</span> <span class="n">permuted_corrs</span><span class="p">[</span><span class="n">permuted_mean_diffs</span> <span class="o">&lt;=</span> <span class="n">pearson_r</span><span class="p">]</span> <span class="c1"># type: ignore</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&lt;=</span> <span class="n">extreme_diffs</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Distribution of $r$ under H0 (B=</span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Create a copy of the original patch for the legend</span>
<span class="n">original_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Permuted $r$&#39;</span><span class="p">)</span>
<span class="c1"># Create a patch for the legend</span>
<span class="n">p_value_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;P (</span><span class="si">{</span><span class="n">p_value_permutation</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add the patches to the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">original_patch</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_value_patch</span><span class="p">]);</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df3b4637ac4e96d487f6697118545d7510cab37c2360548f8983a3c921147b5e.png" src="_images/df3b4637ac4e96d487f6697118545d7510cab37c2360548f8983a3c921147b5e.png" />
</div>
</div>
<p>All the P values we calculated for the correlation between the percentage of C20-22 fatty acids and insulin sensitivity are considerably smaller than the typical significance level of 0.05. This indicates strong evidence to reject the null hypothesis of no correlation between the variables. Therefore, we can confidently conclude that there is a statistically significant correlation between the percentage of C20-22 fatty acids and insulin sensitivity.</p>
<p>The slightly different P values obtained from the various methods (parametric test, permutation test, bootstrapping) might reflect subtle differences in how these methods handle the data and estimate the P value. However, the overall conclusion of a statistically significant correlation remains consistent across all tests.</p>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>In this chapter, we explored <strong>correlation</strong> analysis, a fundamental statistical method for understanding the relationship between continuous variables. We focused on <strong>Pearson’s correlation coefficient</strong>, which measures the strength and direction of linear relationships, and discussed its <strong>assumptions</strong>, <strong>interpretation</strong>, and <strong>statistical inference</strong>. We also introduced <strong>non-parametric</strong> correlation coefficients like Spearman’s rho and Kendall’s tau, which are suitable for non-linear monotonic relationships.</p>
<p>We demonstrated how to calculate these correlation coefficients using Python libraries such as NumPy, SciPy, Pandas, and Pingouin. Additionally, we explored resampling methods like <strong>bootstrapping</strong> and <strong>permutation</strong> tests, which offer robust alternatives for statistical inference, especially when dealing with small sample sizes or violations of assumptions.</p>
<p>It’s crucial to emphasize that <em>correlation does not imply causation</em>. Even if we observe a strong correlation between two variables, we cannot conclude that one variable causes the other. There might be other confounding factors or underlying relationships that explain the observed correlation. For example, if we find a positive correlation between ice cream sales and drowning incidents, it doesn’t mean that eating ice cream causes drowning. Both variables might be influenced by a third factor, such as warm weather, which leads to increased ice cream consumption and more people swimming.</p>
<p>Therefore, it’s essential to interpret correlation analysis cautiously and consider alternative explanations for the observed relationships. Further investigation, experimental studies, or more advanced statistical modeling might be needed to establish causal links between variables.</p>
</section>
<section id="cheat-sheet">
<h2>Cheat sheet<a class="headerlink" href="#cheat-sheet" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Descriptive statistics and visualization<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display descriptive statistics using Pandas&#39; describe()</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="c1"># Display additional statistics using SciPy</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">describe</span>
<span class="n">describe</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="c1"># Scatter plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>

<span class="c1"># Correlation matrix heatmap</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="c1">#pg.pairwise_corr(df, columns=[x, y, z], padjust=&#39;bonf&#39;)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="assessing-assumptions">
<h3>Assessing assumptions<a class="headerlink" href="#assessing-assumptions" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linearity</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">linear_regression</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">residuals_</span>
<span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Q-Q plot</span>
<span class="n">pg</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c1"># Normality test</span>
<span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="c1"># Homoscedasticity (divide the data into groups)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">group1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">group2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>

<span class="c1"># Outliers</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Measures of correlation<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Covariance</span>
<span class="n">df</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># same as np.cov(df[x], df[y])</span>

<span class="c1"># Pearson correlation coefficient</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="n">pearsonr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>

<span class="c1"># Spearman rank correlation coefficient</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">spearmanr</span>
<span class="n">spearmanr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>

<span class="c1"># Kendall tau</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kendalltau</span>
<span class="n">kendalltau</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Statistical inference<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate Pearson correlation with P value and confidence interval</span>
<span class="n">pg</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bootstrapping-and-permutations">
<h3>Bootstrapping and permutations<a class="headerlink" href="#bootstrapping-and-permutations" title="Link to this heading">#</a></h3>
<section id="bootstrap-replicates-and-confidence-intervals">
<h4>Bootstrap replicates and confidence intervals<a class="headerlink" href="#bootstrap-replicates-and-confidence-intervals" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Generate B bootstrap replicates of the pearson r</span>
<span class="c1"># !Make sure to choose exactly N elements randomly **with replacement**</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">bs_replicates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">bs_inds</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">bs_inds</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Confidence interval</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bs_replicates</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="bootstrap-r-to-z-transforms-with-pingouin">
<h4>Bootstrap r-to-z transforms with Pingouin<a class="headerlink" href="#bootstrap-r-to-z-transforms-with-pingouin" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bs_ci_z</span><span class="p">,</span> <span class="n">bs_z</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">compute_bootci</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">],</span>
    <span class="n">paired</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Resample the pairs (x_i, y_i)</span>
    <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span>
    <span class="n">return_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Back-transformation to the r-space</span>
<span class="n">bs_ci_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">bs_ci_z</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bca-bootstrap-with-scipy">
<h4>BCa bootstrap with SciPy<a class="headerlink" href="#bca-bootstrap-with-scipy" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">BootstrapMethod</span>

<span class="n">method</span> <span class="o">=</span> <span class="n">BootstrapMethod</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;BCa&#39;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
<span class="n">ci_bca</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>P value using permutation<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate B replicates of r from permutated pairs</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">permuted_corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">pearsonr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Calculate the P value using the distribution of Pearson&#39;s r replicates of permuted pairs,</span>
<span class="c1"># considering the direction of the observed correlation coefficient</span>
<span class="k">if</span> <span class="n">pearson_r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_corrs</span> <span class="o">&gt;=</span> <span class="n">pearson_r</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_corrs</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_corrs</span> <span class="o">&lt;=</span> <span class="n">pearson_r</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_corrs</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="session-information">
<h2>Session information<a class="headerlink" href="#session-information" title="Link to this heading">#</a></h2>
<p>The output below details all packages and version necessary to reproduce the results in this report.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>--version
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">importlib.metadata</span> <span class="kn">import</span> <span class="n">version</span>

<span class="c1"># List of packages we want to check the version</span>
<span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn&#39;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="s1">&#39;pingouin&#39;</span><span class="p">]</span>

<span class="c1"># Initialize an empty list to store the versions</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop over the packages</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the version of the package</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="c1"># Append the version to the list</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Use a more general exception for broader compatibility</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Not installed&#39;</span><span class="p">)</span>

<span class="c1"># Print the versions</span>
<span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.12.7
-------------
numpy: 1.26.4
pandas: 2.2.2
matplotlib: 3.9.2
seaborn: 0.13.2
scipy: 1.14.1
pingouin: 0.5.5
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="31%20-%20Comparing%20paired%20data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comparing paired data</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions">Definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-correlation">What is correlation?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-correlation">Types of correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applications-in-biology">Applications in biology</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-and-visualization">Descriptive statistics and visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics">Descriptive statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scatter-plots">Scatter plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-matrices-and-heatmaps">Correlation matrices and heatmaps</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-of-correlation-analysis">Assumptions of correlation analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linearity">Linearity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity">Homoscedasticity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers">Outliers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measures-of-correlation">Measures of correlation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance">Covariance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-correlation-coefficient">Pearson correlation coefficient</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-the-pearson-correlation-coefficient-is-calculated">How the Pearson correlation coefficient is calculated</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r2-coefficient-of-determination">The r² coefficient of determination</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#python-packages-for-computing-pearson-r">Python packages for computing Pearson <span class="math notranslate nohighlight">\(r\)</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spearman-rank-correlation-coefficient">Spearman rank correlation coefficient</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kendall-rank-correlation-coefficient">Kendall rank correlation coefficient</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#python-package-for-computing-spearman-rho-and-kendall-tau">Python package for computing Spearman <span class="math notranslate nohighlight">\(\rho\)</span> and Kendall <span class="math notranslate nohighlight">\(\tau\)</span></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-ties">Handling ties</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-non-linear-patterns">Exploration of non-linear patterns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-inference">Statistical inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-non-zero-correlation">Testing for non-zero correlation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-t-statistic-for-correlation">Calculating the t-statistic for correlation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-t-critical-and-p-values">Visualizing t, critical and P values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval">Confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-statistical-inference-in-python">Performing statistical inference in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutation-tests-for-correlation-analysis">Bootstrapping and permutation tests for correlation analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-bootstrap-paired-data">Generating bootstrap paired data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-of-the-confidence-interval">Estimate of the confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value-using-permutation">P value using permutation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-assumptions">Assessing assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Measures of correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Statistical inference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutations">Bootstrapping and permutations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-replicates-and-confidence-intervals">Bootstrap replicates and confidence intervals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-r-to-z-transforms-with-pingouin">Bootstrap r-to-z transforms with Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bca-bootstrap-with-scipy">BCa bootstrap with SciPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">P value using permutation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sébastien Wieckowski
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>