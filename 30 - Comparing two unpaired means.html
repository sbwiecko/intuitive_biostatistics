
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Comparing two unpaired means &#8212; The Python Companion of Intuitive Biostatistics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QQY9FLLPJ8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '30 - Comparing two unpaired means';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Comparing paired data" href="31%20-%20Comparing%20paired%20data.html" />
    <link rel="prev" title="Comparing survival curves" href="29%20-%20Comparing%20survival%20curves.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="The Python Companion of Intuitive Biostatistics - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="The Python Companion of Intuitive Biostatistics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Python Companion Guide to “Intuitive Biostatistics”
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Confidence intervals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="04%20-%20Confidence%20interval%20of%20a%20proportion.html">Confidence interval of a proportion</a></li>
<li class="toctree-l1"><a class="reference internal" href="05%20-%20Confidence%20interval%20of%20survival%20data.html">Confidence interval of survival data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06%20-%20Confidence%20interval%20of%20counted%20data.html">Confidence interval of counted data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Continuous variables</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="09%20-%20Quantifying%20scatter%20of%20continuous%20data.html">Quantifying scatter of continuous data</a></li>
<li class="toctree-l1"><a class="reference internal" href="10%20-%20Gaussian%20distribution.html">The Gaussian distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="12%20-%20Confidence%20interval%20of%20a%20mean.html">Confidence interval of a mean</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical significance and data assumptions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="15%20-%20Statistical%20significance.html">Statistical significance</a></li>
<li class="toctree-l1"><a class="reference internal" href="20%20-%20Statistical%20power%20and%20sample%20size.html">Statistical power and sample size</a></li>
<li class="toctree-l1"><a class="reference internal" href="24%20-%20Normality%20tests%20and%20outliers.html">Normality tests and outliers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical tests</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="27%20-%20Comparing%20proportions.html">Comparing proportions</a></li>
<li class="toctree-l1"><a class="reference internal" href="29%20-%20Comparing%20survival%20curves.html">Comparing survival curves</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Comparing two unpaired means</a></li>
<li class="toctree-l1"><a class="reference internal" href="31%20-%20Comparing%20paired%20data.html">Comparing paired data</a></li>
<li class="toctree-l1"><a class="reference internal" href="32%20-%20Correlation.html">Correlation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fitting models to data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="33%20-%20Simple%20linear%20regression.html">Simple linear regression</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics/edit/master/30 - Comparing two unpaired means.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/30 - Comparing two unpaired means.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Comparing two unpaired means</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-data-for-hypothesis-testing">Preparing data for hypothesis testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-and-visualization">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-assumptions">Assessing assumptions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality-testing">Normality testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-testing">Homoscedasticity testing</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#f-test-of-equality-of-variances">F-test of equality of variances</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#levene-and-bartlett-tests">Levene and Bartlett tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-the-significance-of-mean-differences-with-t-test">Assessing the significance of mean differences with t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-ratio">The t-ratio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-t-test">Welch’s t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-the-welch-s-t-ratio">Manual calculation of the Welch’s t-ratio</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-p-value">Welch’s P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-welch-s-values">Visualizing Welch’s values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-confidence-interval">Welch’s confidence interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-welch-s-t-test-in-python">Performing the Welch’s t-test in Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#student-t-test">Student t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-t-ratio-formula">Student’s t-ratio formula</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#special-case-of-equal-variances-and-sample-sizes">Special case of equal variances and sample sizes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-p-value">Student’s P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-student-s-values">Visualizing Student’s values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-confidence-interval">Student’s confidence interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-student-s-t-test-in-python">Performing the Student’s t-test in Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-real-world-data">Working with real world data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-data">Understanding the data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-assumptions">Checking assumptions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-missing-values">The problem of missing values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-t-test">Performing t-test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overlapping-distributions">Overlapping distributions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one-sided-t-test">One-sided t-test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-mann-whitney-u-test-manually">Performing the Mann-Whitney U test manually</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exact-method">Exact method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#asymptotic-approach">Asymptotic approach</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-tools-for-non-parametric-unpaired-t-test">Python tools for non-parametric unpaired t-test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutation-tests">Bootstrapping and permutation tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-essence-of-bootstrapping">The essence of bootstrapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-of-the-confidence-interval">Estimate of the confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-with-pingouin">Bootstrapping with pingouin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-p-value">Bootstrap P value</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapped-t-statistics-of-shifted-data">Bootstrapped t-statistics of shifted data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permutation">Permutation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Assessing assumptions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Normality testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#q-q-plot">Q-Q plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Homoscedasticity testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-test">T-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Welch’s t-test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-t-test">Student’s t-test</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Effect size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-mann-whitney-u-test">Non-parametric Mann-Whitney U test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Bootstrapping and permutation tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping">Bootstrapping</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Bootstrapping with pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Bootstrapped t-statistics of shifted data</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Permutation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session Information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="comparing-two-unpaired-means">
<h1>Comparing two unpaired means<a class="headerlink" href="#comparing-two-unpaired-means" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In hypothesis testing, the unpaired t-test is a valuable tool for determining if two separate groups have truly different average values. Whether we’re investigating the impact of a new drug on blood pressure or comparing crop yields from two different fertilizers, the unpaired t-test helps us draw statistically sound conclusions from our data.</p>
<p>We use the unpaired t-test specifically when we have <strong>two independent groups or samples</strong>. These groups are not paired or matched in any way. For instance, we might have one group of patients receiving a new medication and another group receiving a placebo. The test assesses whether any observed difference in the means of these two groups is statistically significant or simply due to chance.</p>
<p>Before applying the unpaired t-test, it’s important to make sure our data meets certain assumptions:</p>
<ul class="simple">
<li><p><strong>Independence</strong>: the observations within each group should be independent of each other.</p></li>
<li><p><strong>Normality</strong>: the data within each group should ideally follow a normal distribution. However, the t-test is reasonably robust to moderate deviations from normality, especially with larger sample sizes.</p></li>
<li><p><strong>Equal variances</strong>: the variances of the two groups should be approximately equal. If the variances differ significantly, alternative versions of the t-test (such as Welch’s t-test) can be used.</p></li>
</ul>
<p>The unpaired t-test works by calculating a test statistic that quantifies the <em>difference between the means</em> of the two groups relative to the variability within each group. This test statistic follows a <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/12%20-%20Confidence%20Interval%20of%20a%20Mean.html#the-t-distribution">known distribution (the <strong>t-distribution</strong>)</a> under the null hypothesis of no difference between the group means. By comparing the calculated test statistic to the expected distribution, we obtain a P value. If the P value falls below our chosen significance level (alpha), we reject the null hypothesis and conclude that a statistically significant difference exists between the two group means.</p>
<p>In the following sections, we’ll delve deeper into the mathematical foundations of the unpaired t-test, explore its practical applications, and provide the knowledge needed to confidently apply this test in our own analyses.</p>
</section>
<section id="preparing-data-for-hypothesis-testing">
<h2>Preparing data for hypothesis testing<a class="headerlink" href="#preparing-data-for-hypothesis-testing" title="Link to this heading">#</a></h2>
<section id="descriptive-statistics-and-visualization">
<h3>Descriptive statistics and visualization<a class="headerlink" href="#descriptive-statistics-and-visualization" title="Link to this heading">#</a></h3>
<p>In this section, we will introduce the importance of descriptive statistics and visualization in understanding the characteristics of the two samples being compared. We will emphasize how these techniques provide valuable insights into the central tendency, spread, and distribution of the data, which are crucial for interpreting the results of the unpaired t-test.</p>
<p><a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/16736152/">Frazier and colleagues</a> investigated the impact of norepinephrine on bladder muscle relaxation in rats. Their study specifically examined the maximum relaxation (<span class="math notranslate nohighlight">\(\%\text{E}_\text{max}\)</span>) achievable with high doses of this neurotransmitter, comparing the responses of old (‘old’) and young (‘yng’) rats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># We use the data from Table 30.1 of the book Intuitive Biostatistics</span>
<span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">20.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">33.3</span><span class="p">,</span> <span class="mf">29.4</span><span class="p">,</span> <span class="mf">38.9</span><span class="p">,</span> <span class="mf">29.4</span><span class="p">,</span> <span class="mf">52.6</span><span class="p">,</span> <span class="mf">14.3</span><span class="p">])</span>  <span class="c1"># old rats</span>
<span class="n">yng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">45.5</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mf">60.7</span><span class="p">,</span> <span class="mf">61.5</span><span class="p">,</span> <span class="mf">61.1</span><span class="p">,</span> <span class="mf">65.5</span><span class="p">,</span> <span class="mf">42.9</span><span class="p">,</span> <span class="mf">37.5</span><span class="p">])</span>       <span class="c1"># young rats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="c1"># Descriptive statistics</span>
<span class="n">old_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="n">yng_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Descriptive statistics for &#39;old&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">old_stats</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Descriptive statistics for &#39;young&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">yng_stats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Descriptive statistics for &#39;old&#39;:
 DescribeResult(nobs=9, minmax=(2.8, 52.6), mean=30.16666666666667, variance=259.0375, skewness=-0.17569385392311104, kurtosis=-0.8080848898945967) 

Descriptive statistics for &#39;young&#39;:
 DescribeResult(nobs=8, minmax=(37.5, 65.5), mean=53.7125, variance=107.4069642857143, skewness=-0.4421628669270582, kurtosis=-1.3632352105713499)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Box and swarm plots</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\%\text</span><span class="si">{E}</span><span class="s2">_\text</span><span class="si">{max}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="s1">&#39;young&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Box and swarm plots for old vs. young rats&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9d37260576c0e80e5598551912c786619d20c08df1e7c267c19cdeb067e4900c.png" src="_images/9d37260576c0e80e5598551912c786619d20c08df1e7c267c19cdeb067e4900c.png" />
</div>
</div>
</section>
<section id="assessing-assumptions">
<h3>Assessing assumptions<a class="headerlink" href="#assessing-assumptions" title="Link to this heading">#</a></h3>
<p>Before proceeding with any hypothesis test, it’s crucial to verify that our data adheres to the underlying assumptions of the chosen statistical method. This subsection emphasizes the importance of checking for normality and homogeneity of variance, two common assumptions in many parametric tests, including the unpaired t-test. We’ll briefly discuss the methods used to assess these assumptions, such as normality tests and tests for equal variances, and outline the potential consequences of violating these assumptions. Additionally, we’ll highlight the available remedies or alternative approaches when assumptions are not met, ensuring the robustness and validity of our statistical inferences.</p>
<section id="normality-testing">
<h4>Normality testing<a class="headerlink" href="#normality-testing" title="Link to this heading">#</a></h4>
<p>One of the fundamental assumptions of the unpaired t-test is that the data within each group is approximately normally distributed. To assess this assumption, we employ normality tests such as the D’Agostino-Pearson omnibus K² and Shapiro-Wilk tests, or visual inspections of histograms or Q-Q plots, <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html">as discussed in greater details in a previous chapter about normality test</a>. These tests help us gauge whether the observed data aligns with the expected characteristics of a normal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normality tests</span>
<span class="c1"># D&#39;Agostino-Pearson K² test</span>
<span class="n">k2_old</span><span class="p">,</span> <span class="n">pval_k2_old</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="n">k2_yng</span><span class="p">,</span> <span class="n">pval_k2_yng</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;old&#39;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;D&#39;Agostino-Pearson omnibus: K2=</span><span class="si">{</span><span class="n">k2_old</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, P value=</span><span class="si">{</span><span class="n">pval_k2_old</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;young&#39;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;D&#39;Agostino-Pearson omnibus: K2=</span><span class="si">{</span><span class="n">k2_yng</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, P value=</span><span class="si">{</span><span class="n">pval_k2_yng</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Shapiro-Wilk</span>
<span class="n">shapiro_old</span><span class="p">,</span> <span class="n">pval_shapiro_old</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="n">shapiro_yng</span><span class="p">,</span> <span class="n">pval_shapiro_yng</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;old&#39;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;Shapiro-Wilk&#39;s normality test P value=</span><span class="si">{</span><span class="n">pval_shapiro_old</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;young&#39;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;Shapiro-Wilk&#39;s normality test P value=</span><span class="si">{</span><span class="n">pval_shapiro_yng</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Interpret the results</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># Set the desired significance level</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pval_k2_old</span> <span class="o">&gt;</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">pval_k2_yng</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">)</span> \
<span class="ow">or</span> <span class="p">(</span><span class="n">pval_shapiro_old</span> <span class="o">&gt;</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">pval_shapiro_yng</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Both groups&#39; data are not inconsistent with a normal distribution</span><span class="se">\n\</span>
<span class="s2">(failed to reject null hypothesis of normality)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">At least one group&#39;s data is not consistent with a normal distribution&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>old	D&#39;Agostino-Pearson omnibus: K2=0.11, P value=0.947
young	D&#39;Agostino-Pearson omnibus: K2=1.75, P value=0.418
old	Shapiro-Wilk&#39;s normality test P value=0.900
young	Shapiro-Wilk&#39;s normality test P value=0.238

Both groups&#39; data are not inconsistent with a normal distribution
(failed to reject null hypothesis of normality)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Sébastien\Documents\data_science\biostatistics\intuitive_biostatistics\.env\Lib\site-packages\scipy\stats\_axis_nan_policy.py:418: UserWarning: `kurtosistest` p-value may be inaccurate with fewer than 20 observations; only n=9 observations were given.
  return hypotest_fun_in(*args, **kwds)
c:\Users\Sébastien\Documents\data_science\biostatistics\intuitive_biostatistics\.env\Lib\site-packages\scipy\stats\_axis_nan_policy.py:418: UserWarning: `kurtosistest` p-value may be inaccurate with fewer than 20 observations; only n=8 observations were given.
  return hypotest_fun_in(*args, **kwds)
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#normality-tests-using-pingouin">As discussed previsouly</a>, Pingouin’s normality function actually performs both the Shapiro-Wilk test and the D’Agostino-Pearson test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>

<span class="c1"># Function to perform tests and print results</span>
<span class="k">def</span> <span class="nf">normality_tests</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sample_type</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Test&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;W&#39;</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;P value&#39;</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;normal&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normality tests for </span><span class="si">{</span><span class="n">sample_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="c1"># D&#39;Agostino-Pearson Test</span>
    <span class="n">dagostino_results</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;normaltest&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;D</span><span class="se">\&#39;</span><span class="s1">Agostino-Pearson&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dagostino_results</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;6.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="si">{</span><span class="n">dagostino_results</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;8.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dagostino_results</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Shapiro-Wilk Test</span>
    <span class="n">shapiro_results</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;shapiro&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Shapiro-Wilk&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">shapiro_results</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;6.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="si">{</span><span class="n">shapiro_results</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;8.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">shapiro_results</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1"># Perform tests and print results</span>
<span class="n">normality_tests</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="s2">&quot;old rats&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">normality_tests</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="s2">&quot;young rats&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------Normality tests for old rats-------
Test                 W      P value  normal
D&#39;Agostino-Pearson   0.11   0.947    True
Shapiro-Wilk         0.97   0.900    True
-------------------------------------------


-------Normality tests for young rats------
Test                 W      P value  normal
D&#39;Agostino-Pearson   1.75   0.418    True
Shapiro-Wilk         0.89   0.238    True
-------------------------------------------
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Sébastien\Documents\data_science\biostatistics\intuitive_biostatistics\.env\Lib\site-packages\scipy\stats\_axis_nan_policy.py:418: UserWarning: `kurtosistest` p-value may be inaccurate with fewer than 20 observations; only n=8 observations were given.
  return hypotest_fun_in(*args, **kwds)
</pre></div>
</div>
</div>
</div>
<p>Additionally, the Pingouin library provides a convenient function for generating Q-Q plots, which offer a visual assessment of normality by comparing the observed data quantiles against the expected quantiles of a normal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting Q-Q plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Q-Q plot: old rats&quot;</span><span class="p">,</span> <span class="s2">&quot;Q-Q plot: young rats&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">],</span> <span class="n">titles</span><span class="p">)):</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ensures plots don&#39;t overlap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f3c72a475cf3a82e704399cd51517a8cbdf11a87a134393d53a38bbd521e8aeb.png" src="_images/f3c72a475cf3a82e704399cd51517a8cbdf11a87a134393d53a38bbd521e8aeb.png" />
</div>
</div>
<p>While the <em>unpaired t-test is reasonably robust</em> to moderate deviations from normality, <em>especially with larger sample sizes</em>, severe violations can impact the accuracy of the test’s results. When the normality assumption is not met, the calculated P value may be unreliable, potentially leading to incorrect conclusions about the statistical significance of the difference between group means.</p>
<p>In such cases, we have a few options:</p>
<ul class="simple">
<li><p>Transform the data: if the data exhibits a clear pattern of non-normality, we might attempt to transform it (e.g., using log transformations or square root transformations) to achieve a more normal distribution.</p></li>
<li><p>Use non-parametric alternatives: when transformations are ineffective or impractical, we can consider non-parametric tests like the <em>Mann-Whitney U test</em>, <a class="reference internal" href="#nonparametric"><span class="std std-ref">as discussed in the dedicated section</span></a>, which do not rely on the normality assumption.</p></li>
<li><p>Proceed with caution: if the sample sizes are relatively large and the deviations from normality are not severe, we might proceed with the unpaired t-test, acknowledging the potential limitations in the interpretation of the results.</p></li>
</ul>
</section>
<section id="homoscedasticity-testing">
<h4>Homoscedasticity testing<a class="headerlink" href="#homoscedasticity-testing" title="Link to this heading">#</a></h4>
<p>Another crucial assumption underlying the unpaired t-test is that the variances (or spreads) of the two groups being compared are approximately equal. This property is known as <strong>homoscedasticity</strong>. In this subsection, we’ll explore the importance of this assumption and introduce statistical tests, such as Levene’s test, that help us assess whether our data meets this criterion.</p>
<section id="f-test-of-equality-of-variances">
<h5>F-test of equality of variances<a class="headerlink" href="#f-test-of-equality-of-variances" title="Link to this heading">#</a></h5>
<p>The <strong>F-test</strong>, formally known as the <em>F-test of equality of variances</em>, is a statistical method used to compare the variances of two or more groups. In our context, it assesses whether the ‘old’ and ‘young’ groups have significantly different variances. The test calculates an F-statistic based on the <em>ratio of the group variances</em> and their respective <em>sample sizes</em>. This F-statistic is then compared to an <strong>F distribution</strong> to obtain a P value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate sample variances s (unbiased estimator)</span>
<span class="n">var_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">var_yng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the ratio of variances</span>
<span class="n">var_ratio</span> <span class="o">=</span> <span class="n">var_old</span> <span class="o">/</span> <span class="n">var_yng</span>

<span class="c1"># Sample sizes</span>
<span class="n">n_old</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="n">n_yng</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span>

<span class="c1"># Degrees of freedom</span>
<span class="n">df_old</span> <span class="o">=</span> <span class="n">n_old</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">df_yng</span> <span class="o">=</span> <span class="n">n_yng</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Calculate the F-statistic</span>
<span class="n">f_statistic</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">var_ratio</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">var_ratio</span><span class="p">)</span>  <span class="c1">#  ensures that the F-statistic &gt;= 1</span>

<span class="c1"># Calculate the p-value using the F-distribution (two-sided test)</span>
<span class="n">p_value_fstat</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">f_statistic</span><span class="p">,</span> <span class="n">df_old</span><span class="p">,</span> <span class="n">df_yng</span><span class="p">))</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance ratio (old/young) = </span><span class="si">{</span><span class="n">var_ratio</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F-statistic = </span><span class="si">{</span><span class="n">f_statistic</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for the F-test of equal variance (manual calculation) = </span><span class="si">{</span><span class="n">p_value_fstat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variance ratio (old/young) = 2.412
F-statistic = 2.412
P value for the F-test of equal variance (manual calculation) = 0.2631
</pre></div>
</div>
</div>
</div>
<p>Assuming the null hypothesis of equal variances is true, there is a 26.31% probability that we would observe a discrepancy between the sample standard deviations as large as (or larger than) the one we found, purely due to random sampling. Let’s visualize the F-statistic (<span class="math notranslate nohighlight">\(F\)</span>), critical F-value (<span class="math notranslate nohighlight">\(F^\ast\)</span>), and the area (<span class="math notranslate nohighlight">\(P\)</span> value) under the F distribution corresponding to our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Significance level (alpha)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Calculate critical value</span>
<span class="n">f_crit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">df_old</span><span class="p">,</span> <span class="n">df_yng</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">hx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_old</span><span class="p">,</span> <span class="n">df_yng</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="c1"># Plot the critical value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_crit</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$F^\ast$ (</span><span class="si">{</span><span class="n">f_crit</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the probability alpha</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\alpha$ (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Plot the observed F-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_statistic</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$F$ (</span><span class="si">{</span><span class="n">f_statistic</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the P value area</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">f_statistic</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">f_statistic</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$P$ (</span><span class="si">{</span><span class="n">p_value_fstat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$F$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;F-distribution (DFn=</span><span class="si">{</span><span class="n">df_old</span><span class="si">}</span><span class="s2">, DFd=</span><span class="si">{</span><span class="n">df_yng</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/989b5bfdffc8573bd4eb8a0b984a7c0a4f5e4a2d8c74b1f2e5777e96b959d0f7.png" src="_images/989b5bfdffc8573bd4eb8a0b984a7c0a4f5e4a2d8c74b1f2e5777e96b959d0f7.png" />
</div>
</div>
<p>In the context of homoscedasticity tests like Levene’s test or Bartlett’s test, the <em>null hypothesis states that the variances are equal</em>.</p>
<p>Therefore:</p>
<ul class="simple">
<li><p>High P value: we <em>fail to reject the null hypothesis</em>, meaning we do not have enough evidence to say the variances are different. This suggests that the <em>assumption of equal variances is reasonable</em>.</p></li>
<li><p>Low P value: we reject the null hypothesis, meaning we have evidence to suggest the <em>variances are not equal</em>. This indicates that the assumption of equal variances is violated.</p></li>
</ul>
</section>
<section id="levene-and-bartlett-tests">
<h5>Levene and Bartlett tests<a class="headerlink" href="#levene-and-bartlett-tests" title="Link to this heading">#</a></h5>
<p>We’ll now leverage the convenience and robustness of <strong>Levene</strong>’s and <strong>Bartlett</strong>’s tests to evaluate the assumption of equal variances. A deeper dive into the manual F-statistic calculation will come later when we cover ANOVA.</p>
<p>Levene’s test assesses the equality of variances across groups by analyzing the <em>spread of the absolute deviations from a central measure (typically the median)</em> within each group. The test statistic calculated in Levene’s test approximately follows an <em>F-distribution</em> under the null hypothesis of equal variances. This allows us to compute a P value to determine the statistical significance of any observed differences in variances.</p>
<p>Bartlett’s test also evaluates the homogeneity of variances across groups, but it operates under the assumption that the data within each group is <em>normally distributed</em>. The test statistic in Bartlett’s test approximately follows a <em>chi-squared distribution</em> with degrees of freedom equal to the number of groups minus one, again enabling us to obtain a P value for hypothesis testing.</p>
<p>While both tests serve the same purpose, Levene’s test is generally considered <em>more robust to deviations from normality</em> compared to Bartlett’s test. Therefore, if we suspect or have evidence that the data might not be perfectly normally distributed, Levene’s test is often the preferred choice. On the other hand, if we’re confident about the normality of the data, Bartlett’s test can be a suitable option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using scipy.stats</span>
<span class="c1"># Levene&#39;s test for equal variances</span>
<span class="n">levene_statistic</span><span class="p">,</span> <span class="n">levene_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">)</span>

<span class="c1"># Bartlett&#39;s test for equal variances</span>
<span class="n">bartlett_statistic</span><span class="p">,</span> <span class="n">bartlett_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">bartlett</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Levene&#39;s test statistic = </span><span class="si">{</span><span class="n">levene_statistic</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">P value = </span><span class="si">{</span><span class="n">levene_p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bartlett&#39;s test statistic = </span><span class="si">{</span><span class="n">bartlett_statistic</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">P value = </span><span class="si">{</span><span class="n">bartlett_p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levene&#39;s test statistic = 0.686, P value = 0.4204
Bartlett&#39;s test statistic = 1.290, P value = 0.2560
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using pingouin</span>
<span class="c1"># Levene&#39;s test for equal variances</span>
<span class="n">levene_results</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>

<span class="c1"># Bartlett&#39;s test for equal variances</span>
<span class="n">bartlett_results</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bartlett&#39;</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Levene and Bartlett&#39;s test results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">levene_results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bartlett_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levene and Bartlett&#39;s test results:
               W      pval  equal_var
levene  0.686405  0.420378       True
                 T      pval  equal_var
bartlett  1.290011  0.256046       True
</pre></div>
</div>
</div>
</div>
<p>A small P value, indicating a potential violation of the equal variances assumption, presents a nuanced situation. While some fields, including certain areas of biology, might tolerate minor deviations from homoscedasticity, it’s generally advisable to adopt a more conservative approach. Consider using <strong><a class="reference internal" href="#welch"><span class="std std-ref">Welch’s t-test</span></a></strong>, which is designed to handle unequal variances, or explore data transformations that might improve the homogeneity of variances. In cases of severe non-normality or highly unequal variances, especially with small sample sizes, consider using the <a class="reference internal" href="#nonparametric"><span class="std std-ref">non-parametric Mann-Whitney U test</span></a> as a robust alternative to Welch’s t-test, or a <a class="reference internal" href="#bootstrap"><span class="std std-ref">bootstrap approach</span></a>.</p>
</section>
</section>
</section>
</section>
<section id="assessing-the-significance-of-mean-differences-with-t-test">
<h2>Assessing the significance of mean differences with t-test<a class="headerlink" href="#assessing-the-significance-of-mean-differences-with-t-test" title="Link to this heading">#</a></h2>
<p>The central question in many research studies is whether an intervention, treatment, or characteristic leads to a meaningful difference between groups. In this section, we’ll explore how the <strong>unpaired t-test</strong> helps us answer this question by comparing the means of two independent samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean difference between old and young rats = </span><span class="si">{</span><span class="n">mean_diff</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean difference between old and young rats = 23.546
</pre></div>
</div>
</div>
</div>
<section id="the-t-ratio">
<h3>The t-ratio<a class="headerlink" href="#the-t-ratio" title="Link to this heading">#</a></h3>
<p>At the core of the unpaired t-test lies the <strong>t-ratio</strong> (also named <em>t-value</em>, or <em>t-score</em>), a pivotal statistic that quantifies the <em>disparity between the means of two groups relative to their combined variability</em>. The t-ratio used in the unpaired t-test shares a structural resemblance to the <em>t-statistic</em> we encountered earlier when <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/12%20-%20Confidence%20Interval%20of%20a%20Mean.html#the-t-statistic">constructing confidence intervals for a single mean</a>. Both involve a ratio of a difference to a measure of variability and follow a t-distribution. However, the t-ratio in the unpaired t-test focuses on comparing two sample means, while the t-statistic for confidence intervals is used to estimate a single population mean.</p>
<p>In this subsection, we’ll delve into the mathematical underpinnings of the t-ratio, exploring how it incorporates sample means, variances, and sample sizes to provide a standardized measure of the difference between groups. Understanding the t-ratio is crucial for interpreting the results of the unpaired t-test and drawing meaningful conclusions about the statistical significance of any observed differences.</p>
</section>
<section id="welch-s-t-test">
<span id="welch"></span><h3>Welch’s t-test<a class="headerlink" href="#welch-s-t-test" title="Link to this heading">#</a></h3>
<section id="manual-calculation-of-the-welch-s-t-ratio">
<h4>Manual calculation of the Welch’s t-ratio<a class="headerlink" href="#manual-calculation-of-the-welch-s-t-ratio" title="Link to this heading">#</a></h4>
<p>In the <em>general case</em>, where we do not assume equal variances, the t-ratio for the unpaired t-test is often referred to as <strong>Welch’s t-statistic</strong>. This test utilizes the following t-statistic:</p>
<div class="math notranslate nohighlight">
\[t = \frac{\bar x_1 - \bar x_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar x_1\)</span> and <span class="math notranslate nohighlight">\(\bar x_2\)</span> are the sample means, <span class="math notranslate nohighlight">\(s_1^2\)</span>  and <span class="math notranslate nohighlight">\(s_2^2\)</span> are the <strong>sample variances</strong> of the two groups, and <span class="math notranslate nohighlight">\(n_1\)</span> and <span class="math notranslate nohighlight">\(n_2\)</span> are the sample sizes. <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/09%20-%20Quantifying%20Scatter%20of%20Continuous%20Data.html#standard-error-of-the-mean-sem">Remember the relationships</a> between variance <span class="math notranslate nohighlight">\(s^2\)</span>, standard deviation <span class="math notranslate nohighlight">\(s\)</span>, and standard error <span class="math notranslate nohighlight">\(s_{\overline{x}} = s / \sqrt{n}\)</span>.</p>
<p>The standard error of the difference between the means with “unequal variances”, denoted by <span class="math notranslate nohighlight">\(s_{\bar x_1 - \bar x_2}\)</span>, is calculated as the square root of the sum of the estimated variances of the two sample means:</p>
<div class="math notranslate nohighlight">
\[s_{\bar x_1 - \bar x_2} = \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}\]</div>
<p>This standard error accounts for the variability within each group and is used in the denominator of Welch’s t-statistic:</p>
<div class="math notranslate nohighlight">
\[t = \frac{\bar x_1 - \bar x_2}{s_{\bar x_1 - \bar x_2}}\]</div>
<p>The degrees of freedom for this t-statistic are approximated using the <a class="reference external" href="https://en.wikipedia.org/wiki/Welch-Satterthwaite_equation">Welch-Satterthwaite equation</a>, which can be further simplified using standard errors:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\mathrm{DF} &amp;= \frac{\left( \frac{s_1^2}{n_1} + \frac{s_2^2}{n_2} \right)^2}{\frac{(s_1^2 / n_1)^2}{n_1 - 1} + \frac{(s_2^2 / n_2)^2}{n_2 - 1}} \\
&amp;= \frac{s_{\bar x_1 - \bar x_2}^4}{\frac{(s_1^2 / n_1)^2}{n_1 - 1} + \frac{(s_2^2 / n_2)^2}{n_2 - 1}} \\
&amp;= \frac{s_{\bar x_1 - \bar x_2}^4}{\frac{s_{\bar x_1}^4}{n_1 - 1} + \frac{s_{\bar x_2}^4}{n_2 - 1}}
\end{aligned}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the standard error for unequal variances (Welch&#39;s t-test)</span>
<span class="c1"># The variances were already calculated for the F-test</span>
<span class="n">se_unequal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_old</span> <span class="o">/</span> <span class="n">n_old</span> <span class="o">+</span> <span class="n">var_yng</span> <span class="o">/</span> <span class="n">n_yng</span><span class="p">)</span>

<span class="c1"># Calculate Welch&#39;s t-statistic</span>
<span class="n">t_statistic_welch</span> <span class="o">=</span> <span class="n">mean_diff</span> <span class="o">/</span> <span class="n">se_unequal</span>

<span class="c1"># Calculate the degrees of freedom using the Welch-Satterthwaite equation</span>
<span class="n">df_welch</span> <span class="o">=</span> <span class="n">se_unequal</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="p">((</span><span class="n">var_old</span><span class="o">/</span><span class="n">n_old</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n_old</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">var_yng</span><span class="o">/</span><span class="n">n_yng</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n_yng</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># se^2 = s/n --&gt; se^4 = (s/n)^2</span>
<span class="c1"># Or using the intermediate formula</span>
<span class="c1">#df_welch = se_unequal**4 / (((var_old/n_old)** 2)/(n_old-1) + ((var_yng/n_yng)** 2)/(n_yng-1))</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic (Welch&#39;s) = </span><span class="si">{</span><span class="n">t_statistic_welch</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">df_welch</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">degrees of freedom (Welch-Satterthwaite approximation)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t-statistic (Welch&#39;s) = 3.6242 with 13.778 degrees of freedom (Welch-Satterthwaite approximation)
</pre></div>
</div>
</div>
</div>
</section>
<section id="welch-s-p-value">
<h4>Welch’s P value<a class="headerlink" href="#welch-s-p-value" title="Link to this heading">#</a></h4>
<p>Now that we have our t-statistic and degrees of freedom, we can determine the <strong>P value</strong> associated with our test. The P value will quantify the probability of observing a t-statistic as extreme as (or more extreme than) the one we calculated, assuming the null hypothesis of no difference between the group means is true. We will utilize the cumulative distribution function (CDF) of the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/12%20-%20Confidence%20Interval%20of%20a%20Mean.html#the-t-distribution">t-distribution</a> to compute this probability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the P value using the t-distribution (two-sided test)</span>
<span class="n">p_value_welch</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_welch</span><span class="p">),</span> <span class="n">df_welch</span><span class="p">))</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for Welch&#39;s t-test = </span><span class="si">{</span><span class="n">p_value_welch</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value for Welch&#39;s t-test = 0.00283
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-welch-s-values">
<h4>Visualizing Welch’s values<a class="headerlink" href="#visualizing-welch-s-values" title="Link to this heading">#</a></h4>
<p>To gain a deeper understanding of the results of Welch’s t-test, let’s visualize the t-statistic, the critical t-values that define the rejection regions, and the areas under the t-distribution corresponding to the P value. This visual representation will help us grasp the statistical significance of the observed difference between the group means and the role of the degrees of freedom in shaping the t-distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Significance level (alpha)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Calculate critical t-values (two-tailed test)</span>
<span class="n">t_crit_lower_welch</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df_welch</span><span class="p">)</span>
<span class="n">t_crit_upper_welch</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df_welch</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">hx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_welch</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="c1"># Plot the critical t-values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_upper_welch</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$t^\ast$ (</span><span class="si">{</span><span class="n">t_crit_upper_welch</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_lower_welch</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,)</span>

<span class="c1"># Shade the rejection regions (alpha)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower_welch</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower_welch</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\alpha$ (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper_welch</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper_welch</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">)</span>

<span class="c1"># Plot the observed t-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_statistic_welch</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$t$ (</span><span class="si">{</span><span class="n">t_statistic_welch</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the P-value areas (two-tailed)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_welch</span><span class="p">)],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_welch</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$P$ (</span><span class="si">{</span><span class="n">p_value_welch</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_welch</span><span class="p">)],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_welch</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;t-distribution (DF=</span><span class="si">{</span><span class="n">df_welch</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) | Welch, two-tailed&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5bed4d67caa16377ff65c66ff94499559eaf3522e9e33be64bee8d1bf96e67f5.png" src="_images/5bed4d67caa16377ff65c66ff94499559eaf3522e9e33be64bee8d1bf96e67f5.png" />
</div>
</div>
<p>The red dashed lines in this diagram represent the critical t-values that define the <em>rejection regions</em> for a two-tailed t-test at a 5% significance level. The ‘tails’ of the curve outside these lines each represent 2.5% of the probability distribution under the null hypothesis (that the true population mean difference is zero).</p>
<p>The green dot-dashed line represents the observed t-statistic calculated from our sample data. The P value corresponds to the total probability of observing a t-statistic as extreme as (or more extreme than) the one we calculated, assuming the null hypothesis is true. In a two-tailed test like this, we consider <em>both tails of the distribution</em> because the true population mean difference could be either higher or lower than zero. <a class="reference internal" href="#one-sided"><span class="std std-ref">One-tailed tests (as shown later)</span></a> are used when we have a directional hypothesis, specifically testing if the difference is ‘less than zero’ or ‘greater than zero’.</p>
</section>
<section id="welch-s-confidence-interval">
<h4>Welch’s confidence interval<a class="headerlink" href="#welch-s-confidence-interval" title="Link to this heading">#</a></h4>
<p>A confidence interval provides a range of plausible values for the true difference in population means when comparing two unpaired groups using the Welch test. It gives us an idea of the <em>precision</em> of our estimate of this difference.</p>
<p>To calculate this confidence interval, we need to consider the variability within each group, acknowledging that these variances may not be equal. Here’s how it’s done:</p>
<ol class="arabic simple">
<li><p>Calculate the point estimate: this is the difference between the sample means of the two groups as <span class="math notranslate nohighlight">\(\bar X_1 - \bar X_2\)</span></p></li>
<li><p>Calculate the standard error: the standard error of the difference in means for the Welch test is calculated as <span class="math notranslate nohighlight">\(s_{\bar x_1 - \bar x_2} = \sqrt{s_1^2 / n_1 + s_2^2 / n_2}\)</span>, where <span class="math notranslate nohighlight">\(s_1\)</span> and <span class="math notranslate nohighlight">\(s_2\)</span> are the sample standard deviations of the two groups, and <span class="math notranslate nohighlight">\(n_1\)</span> and <span class="math notranslate nohighlight">\(n_2\)</span> are the respective sample sizes</p></li>
<li><p>Determine the degrees of freedom: the degrees of freedom for the Welch test are calculated using a rather complex formula (Welch-Satterthwaite equation) to account for the unequal variances</p></li>
<li><p>Find the critical t-value: using the desired confidence level (e.g., 95%) and the calculated degrees of freedom, find the corresponding critical t-value from the t-distribution table or using statistical software</p></li>
<li><p>Calculate the margin of error: multiply the standard error by the critical t-value <span class="math notranslate nohighlight">\(t^\ast\)</span></p></li>
<li><p>Construct the confidence interval: subtract and add the margin of error to the point estimate to obtain the lower and upper bounds of the confidence interval: <span class="math notranslate nohighlight">\((\bar X_1 - \bar X_2) \pm W\)</span>, where <span class="math notranslate nohighlight">\(W\)</span> is the margin of error</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the confidence interval (e.g., 95% confidence)</span>
<span class="n">confidence_level</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">margin_of_error_welch</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_welch</span><span class="p">))</span> <span class="o">*</span> <span class="n">se_unequal</span>
<span class="n">ci_welch</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_diff</span> <span class="o">-</span> <span class="n">margin_of_error_welch</span><span class="p">,</span> <span class="n">mean_diff</span> <span class="o">+</span> <span class="n">margin_of_error_welch</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean difference (young - old) = </span><span class="si">{</span><span class="n">mean_diff</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% confidence interval for the mean difference: </span><span class="se">\</span>
<span class="s2">[</span><span class="si">{</span><span class="n">ci_welch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ci_welch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean difference (young - old) = 23.546
95% confidence interval for the mean difference: [9.591, 37.501]
</pre></div>
</div>
</div>
</div>
</section>
<section id="performing-the-welch-s-t-test-in-python">
<h4>Performing the Welch’s t-test in Python<a class="headerlink" href="#performing-the-welch-s-t-test-in-python" title="Link to this heading">#</a></h4>
<p>Let’ts conduct Welch’s t-test using both the SciPy and Pingouin libraries in Python. We’ll compare their implementations and outputs, highlighting their respective advantages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Welch&#39;s t-test using SciPy</span>
<span class="n">t_statistic_scipy_welch</span><span class="p">,</span> <span class="n">p_value_scipy_welch</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Welch&#39;s t-test using Pingouin</span>
<span class="n">ttest_results_pingouin_welch</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Welch&#39;s t-test results (SciPy):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic = </span><span class="si">{</span><span class="n">t_statistic_scipy_welch</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">P value = </span><span class="si">{</span><span class="n">p_value_scipy_welch</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Welch&#39;s t-test results (Pingouin):&quot;</span><span class="p">)</span>
<span class="n">ttest_results_pingouin_welch</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welch&#39;s t-test results (SciPy):
t-statistic = 3.624, P value = 0.0028

Welch&#39;s t-test results (Pingouin):
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>CI95%</th>
      <th>cohen-d</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T-test</th>
      <td>3.624246</td>
      <td>13.777968</td>
      <td>two-sided</td>
      <td>0.002828</td>
      <td>[9.59, 37.5]</td>
      <td>1.715995</td>
      <td>14.51</td>
      <td>0.909532</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The Welch’s t-test yielded a t-statistic of 3.624 with an associated P value of 0.003. This P value is less than the commonly used significance level of 0.05, indicating <em>strong evidence to reject the null hypothesis of no difference between the means</em> of the old and young groups of rats. Therefore, we conclude that there is a statistically significant difference in the <span class="math notranslate nohighlight">\(\%\text{E}_\text{max}\)</span> between the two groups.</p>
<p>Furthermore, the 95% confidence interval for the mean difference (young - old) is [9.591, 37.501]. This suggests that we can be 95% confident that the true population mean difference lies within this range. The fact that this interval does not include zero further supports the conclusion that the two groups are significantly different.</p>
</section>
</section>
<section id="student-t-test">
<h3>Student t-test<a class="headerlink" href="#student-t-test" title="Link to this heading">#</a></h3>
<p>While Welch’s t-test offers a robust approach for comparing means when variances might be unequal, there are scenarios where we have reason to believe that the variances of the two groups are approximately the same. In such cases, we can employ the standard unpaired t-test, also known as <strong>Student’s t-test</strong>. This test relies on the <em>assumption of equal variances</em>, leading to a slightly simpler formula for the t-statistic and a different calculation for the degrees of freedom.</p>
<section id="student-s-t-ratio-formula">
<h4>Student’s t-ratio formula<a class="headerlink" href="#student-s-t-ratio-formula" title="Link to this heading">#</a></h4>
<p>Starting from the general formula of the t-ratio, and under the assumption of equal variance where <span class="math notranslate nohighlight">\(s_1^2 = s_2^2 = s_p^2\)</span>, the t-ratio for the unpaired t-test assuming equal variances is calculated as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
t &amp;= \frac{\bar x_1 - \bar x_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}} \\
&amp;= \frac{\bar x_1 - \bar x_2}{\sqrt{s_p^2 \left( \frac{1}{n_1} + \frac{1}{n_2} \right)}}
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar x_1\)</span> and <span class="math notranslate nohighlight">\(\bar x_2\)</span> are the sample means, <span class="math notranslate nohighlight">\(n_1\)</span> and <span class="math notranslate nohighlight">\(n_2\)</span> are the sample sizes, and <span class="math notranslate nohighlight">\(s_p^2\)</span> is <strong><a class="reference external" href="https://en.wikipedia.org/wiki/Pooled_variance">pooled sample variance</a></strong> <span class="math notranslate nohighlight">\(s_p^2\)</span> calculated as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
s_p^2 &amp;= \frac{\sum_{i=1}^{n_1}(x_i - \bar x_1)^2 + \sum_{j=1}^{n_2}(x_j - \bar x_2)^2}{n_1 + n_2 - 2} \\
&amp;= \frac{(n_1 - 1) s_1^2 + (n_2 - 1) s_2^2}{n_1 + n_2 - 2}
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(s_1^2\)</span>  and <span class="math notranslate nohighlight">\(s_2^2\)</span> are the <strong>sample variances</strong> of the two groups. Even if we assume equal variances, we still need to combine the information from both samples to get a more precise estimate of the common variance.</p>
<p>In the Student’s t-test, the standard error of the difference between the means is calculated using the pooled variance as:</p>
<div class="math notranslate nohighlight">
\[s_{\bar x_1 - \bar x_2} = \sqrt{s_p^2 \left( \frac{1}{n_1} + \frac{1}{n_2} \right)}\]</div>
<p>This standard error, which incorporates the pooled estimate of the common variance, is used in the denominator of the t-statistic for the Student’s t-test:</p>
<div class="math notranslate nohighlight">
\[t = \frac{\bar x_1 - \bar x_2}{s_{\bar x_1 - \bar x_2}}\]</div>
<p>The degrees of freedom for the Student’s t-test (assuming equal variances) are <span class="math notranslate nohighlight">\(\mathrm{DF} = n_1 + n_2 - 2\)</span>, which directly corresponds to the denominator in the pooled variance formula. This reflects the fact that the pooled variance estimate combines information from both samples, each contributing its degrees of freedom to the final estimate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degrees of freedom for equal variances t-test</span>
<span class="n">df_student</span> <span class="o">=</span> <span class="n">n_old</span> <span class="o">+</span> <span class="n">n_yng</span> <span class="o">-</span> <span class="mi">2</span>

<span class="c1"># Calculate pooled variance using the sample variances determined in the previous section</span>
<span class="n">pooled_var</span> <span class="o">=</span> <span class="p">((</span><span class="n">n_old</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">var_old</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_yng</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">var_yng</span><span class="p">)</span> <span class="o">/</span> <span class="n">df_student</span>

<span class="c1"># Calculate the pooled standard error</span>
<span class="n">se_pooled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pooled_var</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n_old</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">n_yng</span><span class="p">))</span>

<span class="c1"># Calculate the Student&#39;s t-statistic</span>
<span class="n">t_statistic_student</span> <span class="o">=</span> <span class="n">mean_diff</span> <span class="o">/</span> <span class="n">se_pooled</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic (Student) = </span><span class="si">{</span><span class="n">t_statistic_student</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> with </span><span class="se">\</span>
<span class="si">{</span><span class="n">df_student</span><span class="si">}</span><span class="s2"> degrees of freedom&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t-statistic (Student) = 3.5315 with 15 degrees of freedom
</pre></div>
</div>
</div>
</div>
</section>
<section id="special-case-of-equal-variances-and-sample-sizes">
<h4>Special case of equal variances and sample sizes<a class="headerlink" href="#special-case-of-equal-variances-and-sample-sizes" title="Link to this heading">#</a></h4>
<p>In the situation where <span class="math notranslate nohighlight">\(n_1 = n_2 = n\)</span>, and <span class="math notranslate nohighlight">\(s_1^2 = s_2^2 = s^2\)</span>, with <span class="math notranslate nohighlight">\(n\)</span> the <em>common sample size</em> and <span class="math notranslate nohighlight">\(s^2\)</span> the <em>common sample variance</em>:</p>
<div class="math notranslate nohighlight">
\[s_p^2 = \frac{(n-1)s^2 + (n-1)s^2}{n + n - 2} = \frac{\cancel{2(n-1)}s^2}{\cancel{2(n - 1)}} = s^2\]</div>
<p>Therefore</p>
<div class="math notranslate nohighlight">
\[t = \frac{\bar x_1 - \bar x_2}{s\sqrt{2/n}}\]</div>
<p>and <span class="math notranslate nohighlight">\(\mathrm{DF} = 2n -2\)</span>.</p>
</section>
<section id="student-s-p-value">
<h4>Student’s P value<a class="headerlink" href="#student-s-p-value" title="Link to this heading">#</a></h4>
<p>Having calculated the t-statistic and degrees of freedom, we can now determine the P value. Similar to <a class="reference internal" href="#welch"><span class="std std-ref">Welch’s t-test</span></a>, we’ll use the t-distribution’s CDF to compute the P value, which quantifies the probability of observing such an extreme t-statistic (or more extreme) if the null hypothesis were true.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the P value using the t-distribution (two-sided test)</span>
<span class="n">p_value_student</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_student</span><span class="p">),</span> <span class="n">df_student</span><span class="p">))</span>
<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for the Student&#39;s t-test = </span><span class="si">{</span><span class="n">p_value_student</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value for the Student&#39;s t-test = 0.00302
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-student-s-values">
<h4>Visualizing Student’s values<a class="headerlink" href="#visualizing-student-s-values" title="Link to this heading">#</a></h4>
<p>To better understand the results of the Student’s t-test, let’s visualize the t-statistic, critical t-values, and the P value areas under the t-distribution. This visual representation will aid in understanding the statistical significance of the observed mean difference and the impact of degrees of freedom on the t-distribution’s shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate critical t-values (two-tailed test)</span>
<span class="n">t_crit_lower_student</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df_student</span><span class="p">)</span>
<span class="n">t_crit_upper_student</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df_student</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">hx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_student</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="c1"># Plot the critical t-values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_lower_student</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_crit_upper_student</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$t^\ast$ (</span><span class="si">{</span><span class="n">t_crit_upper_student</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the rejection regions (alpha)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower_student</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">t_crit_lower_student</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\alpha$ (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper_student</span><span class="p">],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">t_crit_upper_student</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">)</span>

<span class="c1"># Plot the observed t-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_statistic_student</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$t$ (</span><span class="si">{</span><span class="n">t_statistic_student</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the P-value areas (two-tailed)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_student</span><span class="p">)],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_student</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;P (</span><span class="si">{</span><span class="n">p_value_student</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_student</span><span class="p">)],</span>
    <span class="n">hx</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_statistic_student</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;t-distribution (DF=</span><span class="si">{</span><span class="n">df_student</span><span class="si">}</span><span class="s2">) | Student, two-tailed&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e3364140d58394957e74a846a223a68cabd3f4ffb54c77fbcf58290b70a4e035.png" src="_images/e3364140d58394957e74a846a223a68cabd3f4ffb54c77fbcf58290b70a4e035.png" />
</div>
</div>
</section>
<section id="student-s-confidence-interval">
<h4>Student’s confidence interval<a class="headerlink" href="#student-s-confidence-interval" title="Link to this heading">#</a></h4>
<p>The confidence interval for the Student’s t-test follows a similar process as the Welch test, with a key difference in calculating the standard error and degrees of freedom.</p>
<p>Instead of using separate variances for each group, the Student’s t-test assumes equal variances and pools the variance from both groups to estimate a common variance. This pooled variance is then used to calculate the standard error of the difference in means.</p>
<p>Not to forget that the degrees of freedom for the Student’s t-test are simpler to calculate, as they are based on the total sample size of both groups minus 2.</p>
<p>With these adjustments to the standard error and degrees of freedom, the remaining steps to construct the confidence interval are the same as those described for the Welch test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the confidence interval (e.g., 95% confidence)</span>
<span class="n">margin_of_error_student</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_student</span><span class="p">))</span> <span class="o">*</span> <span class="n">se_pooled</span>
<span class="n">ci_student</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_diff</span> <span class="o">-</span> <span class="n">margin_of_error_student</span><span class="p">,</span> <span class="n">mean_diff</span> <span class="o">+</span> <span class="n">margin_of_error_student</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean difference (young - old) = </span><span class="si">{</span><span class="n">mean_diff</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% confidence interval for the mean difference: </span><span class="se">\</span>
<span class="s2">[</span><span class="si">{</span><span class="n">ci_student</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ci_student</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean difference (young - old) = 23.546
95% confidence interval for the mean difference: [9.335, 37.757]
</pre></div>
</div>
</div>
</div>
</section>
<section id="performing-the-student-s-t-test-in-python">
<h4>Performing the Student’s t-test in Python<a class="headerlink" href="#performing-the-student-s-t-test-in-python" title="Link to this heading">#</a></h4>
<p>We can readily perform the Student’s t-test using either <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> or Pingouin. The implementation is nearly identical to Welch’s t-test, with the key difference being that we change the <code class="docutils literal notranslate"><span class="pre">equal_var</span></code> (in SciPy) or <code class="docutils literal notranslate"><span class="pre">correction</span></code> (in Pingouin) parameter to explicitly indicate the assumption of equal variances.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Student&#39;s t-test using SciPy (assuming equal variances)</span>
<span class="n">t_statistic_scipy_student</span><span class="p">,</span> <span class="n">p_value_scipy_student</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Student&#39;s t-test using Pingouin (assuming equal variances)</span>
<span class="n">ttest_results_pingouin_student</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Student&#39;s t-test results (SciPy):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic = </span><span class="si">{</span><span class="n">t_statistic_scipy_student</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">P value = </span><span class="si">{</span><span class="n">p_value_scipy_student</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Student&#39;s t-test results (Pingouin):&quot;</span><span class="p">)</span>
<span class="n">ttest_results_pingouin_student</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Student&#39;s t-test results (SciPy):
t-statistic = 3.531, P value = 0.0030

Student&#39;s t-test results (Pingouin):
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>CI95%</th>
      <th>cohen-d</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T-test</th>
      <td>3.531488</td>
      <td>15</td>
      <td>two-sided</td>
      <td>0.003022</td>
      <td>[9.33, 37.76]</td>
      <td>1.715995</td>
      <td>12.56</td>
      <td>0.909532</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Similar to the Welch’s t-test, the Student’s t-test also revealed a statistically significant difference between the two groups. The calculated t-statistic was 3.531, with an associated P value of 0.003. This P value falls below the conventional significance level of 0.05, providing strong evidence to reject the null hypothesis of no difference in the mean <span class="math notranslate nohighlight">\(\%\text{E}_\text{max}\)</span> between the ‘old’ and ‘young’ groups.</p>
<p>The 95% confidence interval for the mean difference (young - old) is [9.335, 37.757]. This interval suggests we can be 95% confident that the true population mean difference in <span class="math notranslate nohighlight">\(\%\text{E}_\text{max}\)</span> lies within this range. The absence of zero within this interval further reinforces the conclusion of a significant difference between the two groups.</p>
</section>
</section>
<section id="effect-size">
<h3>Effect size<a class="headerlink" href="#effect-size" title="Link to this heading">#</a></h3>
<p>Cohen’s <span class="math notranslate nohighlight">\(d\)</span> is a widely used <strong>effect size</strong> measure for unpaired t-tests. It essentially standardizes the difference between the two group means by dividing it by a measure of variability:</p>
<div class="math notranslate nohighlight">
\[d = \frac{\bar X_1 - \bar X_2}{s}\]</div>
<p>However, since we’re dealing with two independent groups, the calculation of the standard deviation (<span class="math notranslate nohighlight">\(s\)</span>) used in the denominator differs slightly depending on whether we assume equal variances or not, as we saw in the Welch and Student t-tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the standard deviations from the standard errors</span>
<span class="n">sd_unequal</span> <span class="o">=</span> <span class="n">se_unequal</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n_yng</span> <span class="o">*</span> <span class="n">n_old</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_yng</span> <span class="o">+</span> <span class="n">n_old</span><span class="p">))</span>  <span class="c1"># For Welch&#39;s t-test</span>
<span class="n">sd_pooled</span> <span class="o">=</span> <span class="n">se_pooled</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_yng</span> <span class="o">+</span> <span class="n">n_old</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># For Student&#39;s t-test</span>

<span class="c1"># Calculate Cohen&#39;s d manually</span>
<span class="n">cohens_d_manual_welch</span> <span class="o">=</span> <span class="n">mean_diff</span> <span class="o">/</span> <span class="n">sd_unequal</span>
<span class="n">cohens_d_manual_student</span> <span class="o">=</span> <span class="n">mean_diff</span> <span class="o">/</span> <span class="n">sd_pooled</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cohen&#39;s d (manual, Welch&#39;s): </span><span class="si">{</span><span class="n">cohens_d_manual_welch</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cohen&#39;s d (manual, Student&#39;s): </span><span class="si">{</span><span class="n">cohens_d_manual_student</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cohen&#39;s d (manual, Welch&#39;s): 1.761
Cohen&#39;s d (manual, Student&#39;s): 0.912
</pre></div>
</div>
</div>
</div>
<p>To calculate effect size in various scenarios, including unpaired tests, we can utilize the <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.compute_effsize.html"><code class="docutils literal notranslate"><span class="pre">compute_effsize</span></code> function provided by the Pingouin library</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate unbiased Cohen&#39;s d using pingouin</span>
<span class="n">effect_size_pingouin</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">compute_effsize</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">eftype</span><span class="o">=</span><span class="s1">&#39;cohen&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unbiased Cohen&#39;s d (pingouin): </span><span class="si">{</span><span class="n">effect_size_pingouin</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unbiased Cohen&#39;s d (pingouin): 1.716
</pre></div>
</div>
</div>
</div>
<p>The interpretation guidelines for Cohen’s d in unpaired t-tests are generally the same as those for paired t-tests (discussed in the next chapter):</p>
<ul class="simple">
<li><p>Small effect:  <span class="math notranslate nohighlight">\(d \approx 0.2\)</span></p></li>
<li><p>Medium effect: <span class="math notranslate nohighlight">\(d \approx 0.5\)</span></p></li>
<li><p>Large effect:  <span class="math notranslate nohighlight">\(d \approx 0.8\)</span></p></li>
</ul>
<p>Effect size in unpaired t-tests helps understand the practical significance of the findings. A statistically significant result (small P value) doesn’t necessarily mean the effect is large or meaningful. Conversely, a non-significant result might still indicate a meaningful effect, especially if the study has low power due to a small sample size. By considering both the P value and the effect size, we can gain a more complete picture of your results and draw more informed conclusions.</p>
</section>
<section id="working-with-real-world-data">
<h3>Working with real world data<a class="headerlink" href="#working-with-real-world-data" title="Link to this heading">#</a></h3>
<section id="loading-the-data">
<h4>Loading the data<a class="headerlink" href="#loading-the-data" title="Link to this heading">#</a></h4>
<p>Let’s introduce the <a class="reference external" href="https://github.com/allisonhorst/palmerpenguins">Palmer penguins dataset</a> from the Pingouin library and demonstrate how to perform an unpaired t-test directly on its columns. We’ll also explore one-sided t-tests and investigate the relationship between overlapping error bars and the statistical significance of mean differences.</p>
<p><img alt="Meet the Palmer penguins" src="https://github.com/allisonhorst/palmerpenguins/raw/main/man/figures/lter_penguins.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># List all available datasets in pingouin (commented out)</span>
<span class="c1"># pg.list_dataset()</span>

<span class="c1"># Load the &#39;penguins&#39; dataset</span>
<span class="n">penguins</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;penguins&#39;</span><span class="p">)</span>

<span class="c1"># Display the first 5 rows of the dataset</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>37.8</td>
      <td>18.3</td>
      <td>174.0</td>
      <td>3400.0</td>
      <td>female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>37.7</td>
      <td>18.7</td>
      <td>180.0</td>
      <td>3600.0</td>
      <td>male</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>35.9</td>
      <td>19.2</td>
      <td>189.0</td>
      <td>3800.0</td>
      <td>female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>38.2</td>
      <td>18.1</td>
      <td>185.0</td>
      <td>3950.0</td>
      <td>male</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>38.8</td>
      <td>17.2</td>
      <td>180.0</td>
      <td>3800.0</td>
      <td>male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="understanding-the-data">
<h4>Understanding the data<a class="headerlink" href="#understanding-the-data" title="Link to this heading">#</a></h4>
<p>Let’s print some descriptive statistics for the different variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display descriptive statistics</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>344</td>
      <td>344</td>
      <td>342.000000</td>
      <td>342.000000</td>
      <td>342.000000</td>
      <td>342.000000</td>
      <td>333</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>3</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2</td>
    </tr>
    <tr>
      <th>top</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>male</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>152</td>
      <td>168</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>168</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>43.921930</td>
      <td>17.151170</td>
      <td>200.915205</td>
      <td>4201.754386</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.459584</td>
      <td>1.974793</td>
      <td>14.061714</td>
      <td>801.954536</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>min</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>32.100000</td>
      <td>13.100000</td>
      <td>172.000000</td>
      <td>2700.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>39.225000</td>
      <td>15.600000</td>
      <td>190.000000</td>
      <td>3550.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>44.450000</td>
      <td>17.300000</td>
      <td>197.000000</td>
      <td>4050.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>48.500000</td>
      <td>18.700000</td>
      <td>213.000000</td>
      <td>4750.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>max</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>59.600000</td>
      <td>21.500000</td>
      <td>231.000000</td>
      <td>6300.000000</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The culmen is the upper ridge of a bird’s bill. In the simplified <code class="docutils literal notranslate"><span class="pre">penguins</span></code> data, culmen length and depth are renamed as variables ‘bill_length_mm’ and ‘bill_depth_mm’ to be more intuitive.</p>
<p>For this penguin data, the culmen (bill) length and depth are measured as shown below:
<img alt="culmen length and depth" src="https://github.com/allisonhorst/palmerpenguins/raw/main/man/figures/culmen_depth.png" /></p>
<p>Let’s now create a grid of scatterplots that visualize the relationships between pairs of numerical variables in the <code class="docutils literal notranslate"><span class="pre">penguins</span></code> DataFrame. It also incorporates color-coded distinctions based on the ‘species’ column and customizes the diagonal plots to display histograms, providing insights into the individual distributions of each variable for each species.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="s2">&quot;hist&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e7fd3db17865ad113c1c0c7656f09f5421f9127c0989b012a578e67ed0f21e90.png" src="_images/e7fd3db17865ad113c1c0c7656f09f5421f9127c0989b012a578e67ed0f21e90.png" />
</div>
</div>
</section>
<section id="checking-assumptions">
<h4>Checking assumptions<a class="headerlink" href="#checking-assumptions" title="Link to this heading">#</a></h4>
<p>Flipper length appears to be a promising variable for distinguishing between penguin species. Let’s apply the t-test framework we’ve established to investigate this further. To illustrate the concepts clearly, we’ll focus on the two most populous species in the dataset: Adelie and Gentoo. However, it’s important to note that in a comprehensive analysis, we would ideally <em>include all groups and employ ANOVA</em> (which we’ll discuss in a later chapter) to account for potential differences among all species simultaneously.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistics for groups of species</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">)[</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Adelie</th>
      <td>151.0</td>
      <td>189.953642</td>
      <td>6.539457</td>
      <td>172.0</td>
      <td>186.0</td>
      <td>190.0</td>
      <td>195.0</td>
      <td>210.0</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <td>68.0</td>
      <td>195.823529</td>
      <td>7.131894</td>
      <td>178.0</td>
      <td>191.0</td>
      <td>196.0</td>
      <td>201.0</td>
      <td>212.0</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <td>123.0</td>
      <td>217.186992</td>
      <td>6.484976</td>
      <td>203.0</td>
      <td>212.0</td>
      <td>216.0</td>
      <td>221.0</td>
      <td>231.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the Chinstrap species</span>
<span class="c1"># Create a copy to avoid modifying the original DataFrame</span>
<span class="n">penguins_filtered</span> <span class="o">=</span> <span class="n">penguins</span><span class="p">[</span><span class="n">penguins</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Chinstrap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Box and swarm plots</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Species&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flipper length (mm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Box and swarm plots of flipper length (Adelie vs. Gentoo)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7fcb4cf686d8a8dc5e123fd733586b44e3da195bda720a45aa7c62b703c7c1af.png" src="_images/7fcb4cf686d8a8dc5e123fd733586b44e3da195bda720a45aa7c62b703c7c1af.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform tests using our own function (see normality testing)</span>
<span class="n">normality_tests</span><span class="p">(</span>
    <span class="n">adelie_flipper</span><span class="o">:=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Adelie&#39;</span><span class="p">,</span> <span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s2">&quot;Adelie penguins&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">normality_tests</span><span class="p">(</span>
    <span class="n">gentoo_flipper</span><span class="o">:=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s2">&quot;Gentoo penguins&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----Normality tests for Adelie penguins----
Test                 W      P value  normal
D&#39;Agostino-Pearson   1.08   0.582    True
Shapiro-Wilk         0.99   0.720    True
-------------------------------------------


----Normality tests for Gentoo penguins----
Test                 W      P value  normal
D&#39;Agostino-Pearson   6.12   0.047    False
Shapiro-Wilk         0.96   0.002    False
-------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting Q-Q plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Q-Q plot: Adelie&quot;</span><span class="p">,</span> <span class="s2">&quot;Q-Q plot: Gentoo&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">adelie_flipper</span><span class="p">,</span> <span class="n">gentoo_flipper</span><span class="p">],</span> <span class="n">titles</span><span class="p">)):</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ensures plots don&#39;t overlap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4166113fc4ef89fb604c4d3bca089d6f8018fc1a48df2ad89f97ce188d698352.png" src="_images/4166113fc4ef89fb604c4d3bca089d6f8018fc1a48df2ad89f97ce188d698352.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Levene&#39;s test for equal variances</span>
<span class="c1"># Note the difference with the method call on a DataFrame compared to arrays</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>W</th>
      <th>pval</th>
      <th>equal_var</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>levene</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="the-problem-of-missing-values">
<h4>The problem of missing values<a class="headerlink" href="#the-problem-of-missing-values" title="Link to this heading">#</a></h4>
<p>The Levene’s test returned <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values and <code class="docutils literal notranslate"><span class="pre">equal_var=False</span></code>. This discrepancy is unexpected, given the similar standard deviations and sample sizes observed in the descriptive statistics. It’s likely that missing values are causing Levene’s test to fail, as many statistical tests struggle to handle <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values. Let’s investigate whether the <code class="docutils literal notranslate"><span class="pre">adelie_flipper</span></code> or <code class="docutils literal notranslate"><span class="pre">gentoo_flipper</span></code> arrays contain any missing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 276 entries, 0 to 343
Data columns (total 7 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   species            276 non-null    object 
 1   island             276 non-null    object 
 2   bill_length_mm     274 non-null    float64
 3   bill_depth_mm      274 non-null    float64
 4   flipper_length_mm  274 non-null    float64
 5   body_mass_g        274 non-null    float64
 6   sex                265 non-null    object 
dtypes: float64(4), object(3)
memory usage: 17.2+ KB
</pre></div>
</div>
</div>
</div>
<p>As there are some missing non-null values in the dataset, and in the ‘flipper_length_mm’ columns in particular, we’ll need to decide how to handle them, e.g., remove rows with missing values, or impute missing values, before running the test again. Let’s drop the rows containing missing values in the ‘flipper_length_mm’ column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">penguins_filtered_clean</span> <span class="o">=</span> <span class="n">penguins_filtered</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered_clean</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>W</th>
      <th>pval</th>
      <th>equal_var</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>levene</th>
      <td>0.157042</td>
      <td>0.692205</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="performing-t-test">
<h4>Performing t-test<a class="headerlink" href="#performing-t-test" title="Link to this heading">#</a></h4>
<p>While the flipper length data for Adelie penguins appears to be normally distributed, the Gentoo flipper lengths show some deviation from normality, particularly at the extremes. However, given the relatively large sample sizes (n=151 for Adelie and n=123 for Gentoo), we can proceed with the <strong>Student’s t-test</strong> (assuming equal variances), acknowledging the potential limitations due to this minor departure from normality. Though, the most appropriate statistical test would be to compare all the groups using ANOVA (discussed in a future chapter).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Student t-test</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">adelie_flipper</span><span class="p">,</span>  <span class="c1"># the method removes missing values by default</span>
    <span class="n">y</span><span class="o">=</span><span class="n">gentoo_flipper</span><span class="p">,</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>CI95%</th>
      <th>cohen-d</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T-test</th>
      <td>-34.414958</td>
      <td>272</td>
      <td>two-sided</td>
      <td>4.211309e-101</td>
      <td>[-28.79, -25.68]</td>
      <td>4.18005</td>
      <td>1.128e+97</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The extremely small P value (4.211e-101) is far below the typical significance level of 0.05. This provides overwhelming evidence to reject the null hypothesis of no difference between the two group means.</p>
<p>The 95% confidence interval [-28.79, -25.68] provides a range of plausible values for the true difference between the population means. The fact that this interval doesn’t include zero further supports the conclusion of a significant difference.</p>
<p>Therefore, we can conclude that there is a statistically significant difference between the means of the two groups being compared.</p>
</section>
<section id="overlapping-distributions">
<h4>Overlapping distributions<a class="headerlink" href="#overlapping-distributions" title="Link to this heading">#</a></h4>
<p>In the previous example with flipper length, we observed that non-overlapping distributions generally corresponded to a statistically significant difference in means. However, it’s important to remember that <em>overlapping distributions do not necessarily imply the absence of a significant difference</em>. The statistical significance of the mean difference depends on various factors, including the degree of overlap, sample sizes, and the variability within each group.</p>
<p>Let’s examine the ‘bill_depth_mm’ variable for Adelie and Gentoo penguins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Box and swarm plots</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Species&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bill depth (mm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Box and swarm plots of bill depth (Adelie vs. Gentoo)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/853659ad4e76c98faa1d44c1f5b1792f0253d1c33ce4b706e28fe5e4ce85c1dc.png" src="_images/853659ad4e76c98faa1d44c1f5b1792f0253d1c33ce4b706e28fe5e4ce85c1dc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Student t-test</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Adelie&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>CI95%</th>
      <th>cohen-d</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T-test</th>
      <td>24.792495</td>
      <td>272</td>
      <td>two-sided</td>
      <td>9.311098e-72</td>
      <td>[3.1, 3.63]</td>
      <td>3.011303</td>
      <td>8.109e+67</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Furthermore, overlapping error bars do not necessarily imply that the means of the populations are not significantly different. The degree of overlap, the sample sizes, and the variability within each group all play a role in determining statistical significance. It’s always crucial to conduct formal hypothesis tests, like the t-test, to draw valid conclusions about differences between groups.</p>
<p>This observation is particularly relevant when dealing with distributions based on low sample sizes, as their error bars tend to be wider, leading to more overlap even when there might be a true difference in population means. It’s essential to rely on the P value from the t-test rather than solely on visual inspection of error bar overlap, especially when sample sizes are small.</p>
<p>We can use the following rules of thumbs:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type of error bar</p></th>
<th class="head"><p>Overlapping error bars</p></th>
<th class="head"><p>Non-overlapping error bars</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Standard deviation (SD)</p></td>
<td><p>No conclusion</p></td>
<td><p>No conclusion</p></td>
</tr>
<tr class="row-odd"><td><p>Standard error of the mean (SEM)</p></td>
<td><p>Likely P &gt; 0.05</p></td>
<td><p>No conclusion</p></td>
</tr>
<tr class="row-even"><td><p>95% confidence interval (CI)</p></td>
<td><p>No conclusion</p></td>
<td><p>Likely P &lt; 0.05</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="one-sided-t-test">
<span id="one-sided"></span><h4>One-sided t-test<a class="headerlink" href="#one-sided-t-test" title="Link to this heading">#</a></h4>
<p>In our penguin dataset scenario, we aim to determine if the bill depth of Adelie penguins, after subtracting 3 mm, is still significantly greater than the bill depth of Gentoo penguins. Mathematically, we want to test if: <span class="math notranslate nohighlight">\(\bar x_\text{Adelie} - 3 &gt; \bar x_\text{Gentoo}\)</span>. We can restate <span class="math notranslate nohighlight">\(\bar x_{\text{Adelie} - 3} &gt; \bar x_\text{Gentoo}\)</span>. This allows us to frame our hypotheses for a <strong>one-sided t-test</strong>:</p>
<ul class="simple">
<li><p>Null hypothesis (H0): the mean bill depth of Adelie penguins, minus 3 mm, is equal to or less than the mean bill depth of Gentoo penguins (<span class="math notranslate nohighlight">\(\bar x_\text{Adelie - 3} \le \bar x_\text{Gentoo}\)</span>).</p></li>
<li><p>Alternative hypothesis (H1): the mean bill depth of Adelie penguins, minus 3 mm, is greater than the mean bill depth of Gentoo penguins.</p></li>
</ul>
<p>Let’s conduct a one-sided t-test on our sample data to evaluate these hypotheses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform one-sided Student t-test with pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Adelie&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
    <span class="c1"># Missing values are automatically removed from the data in pingouin</span>
    <span class="n">y</span><span class="o">=</span><span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>CI95%</th>
      <th>cohen-d</th>
      <th>BF10</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T-test</th>
      <td>2.684262</td>
      <td>272</td>
      <td>greater</td>
      <td>0.003858</td>
      <td>[0.14, inf]</td>
      <td>0.326031</td>
      <td>7.951</td>
      <td>0.849133</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform one-sided Student t-test with scipy.stats</span>
<span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Adelie&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">penguins_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span>
    <span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span>  <span class="c1"># scipy doesn&#39;t remove missing values automatically</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TtestResult(statistic=2.684262207738359, pvalue=0.003857530781549446, df=272.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Finally statsmodels also offers a comprehensive t-test API</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="c1"># Perform Student&#39;s t-test</span>
<span class="n">ttest_results_sm</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">x1</span><span class="o">=</span><span class="n">penguins_filtered_clean</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Adelie&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="c1"># statsmodels doesn&#39;t support policy for missing values</span>
    <span class="n">x2</span><span class="o">=</span><span class="n">penguins_filtered_clean</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">penguins_filtered</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentoo&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">],</span>
    <span class="n">usevar</span><span class="o">=</span><span class="s1">&#39;pooled&#39;</span><span class="p">,</span>       <span class="c1"># Specify equal variances assumption</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;larger&#39;</span><span class="p">,</span>  <span class="c1"># Test if the Adelie bill depth mean (x1) is larger</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">3</span>                <span class="c1"># difference between the means (x1 - x2) under the null hypothesis</span>
<span class="p">)</span>

<span class="c1"># Extract and print the relevant statistics</span>
<span class="n">t_statistic_sm</span> <span class="o">=</span> <span class="n">ttest_results_sm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p_value_sm</span> <span class="o">=</span> <span class="n">ttest_results_sm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_sm</span> <span class="o">=</span> <span class="n">ttest_results_sm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Student&#39;s t-test results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-statistic = </span><span class="si">{</span><span class="n">t_statistic_sm</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, P value = </span><span class="si">{</span><span class="n">p_value_sm</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, DF= </span><span class="si">{</span><span class="n">df_sm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Student&#39;s t-test results:
t-statistic = 2.684, P value = 0.00386, DF= 272.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="non-parametric-methods">
<span id="nonparametric"></span><h2>Non-parametric methods<a class="headerlink" href="#non-parametric-methods" title="Link to this heading">#</a></h2>
<p>While biological data rarely perfectly adhere to a Gaussian (normal) distribution, many biological variables exhibit an approximately bell-shaped distribution. Parametric tests, such as the t-test and ANOVA, are often robust to minor deviations from normality, especially with large samples. Consequently, these tests are widely used across various scientific disciplines.</p>
<p><strong>Non-parametric</strong> methods offer a valuable set of tools for analyzing data when the assumptions of parametric tests, such as the t-test or ANOVA, are not met. Unlike parametric methods that assume the data are sampled from a Gaussian distribution, non-parametric methods do not rely on such strict distributional assumptions. Instead, many of these tests operate by <strong>ranking</strong> the data from low to high and analyzing these ranks, making them <em>less sensitive</em> (more <strong>robust</strong>) to outliers and deviations from normality. But when the data is truly Gaussian (normally distributed), non-parametric tests generally have lower statistical power compared to their parametric counterparts. This means they might be less likely to detect a true difference if one exists.</p>
<p>The choice between parametric and non-parametric tests can also be influenced by the sample size:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Distribution</p></th>
<th class="head text-left"><p>Test</p></th>
<th class="head text-left"><p>Small samples</p></th>
<th class="head text-left"><p>Large Samples</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Gaussian</p></td>
<td class="text-left"><p>Non-parametric</p></td>
<td class="text-left"><p>Misleading, low power</p></td>
<td class="text-left"><p>Nearly as powerful as parametric tests</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Non-Gaussian</p></td>
<td class="text-left"><p>Parametric</p></td>
<td class="text-left"><p>Misleading, not robust</p></td>
<td class="text-left"><p>Robust to mild deviations from normality</p></td>
</tr>
</tbody>
</table>
</div>
<p>Moreover, reporting confidence intervals for non-parametric tests can be more challenging, and they might not be as readily available or interpretable as those for parametric tests, and extending non-parametric tests to more complex models, such as regression models, can be less straightforward compared to parametric methods.</p>
<p>Below is a flowchart designed to help choosing which <a class="reference external" href="https://pingouin-stats.org/build/html/guidelines.html#non-parametric">functions of Pingouin are adequate for a non-parametric analysis</a>:</p>
<p><img alt="selection of the nonparamettric method" src="https://pingouin-stats.org/build/html/_images/flowchart_nonparametric.svg" /></p>
<p>Of note, computer-intensive methods like bootstrapping and permutation tests also fall under the non-parametric umbrella, as they don’t assume a specific distribution for the data. These methods provide robust alternatives for estimating P values and confidence intervals, especially when dealing with small sample sizes or non-normal data, and will be <a class="reference internal" href="#bootstrap"><span class="std std-ref">discussed in the next section</span></a>.</p>
<section id="performing-the-mann-whitney-u-test-manually">
<h3>Performing the Mann-Whitney U test manually<a class="headerlink" href="#performing-the-mann-whitney-u-test-manually" title="Link to this heading">#</a></h3>
<section id="exact-method">
<h4>Exact method<a class="headerlink" href="#exact-method" title="Link to this heading">#</a></h4>
<p>The <strong>Mann-Whitney U test</strong> (also known as the <strong>Wilcoxon rank-sum test</strong>) is a non-parametric method for comparing two unpaired groups. It assesses whether one group tends to have larger or smaller values than the other. Unlike the t-test, it doesn’t assume that the data follows a normal distribution.</p>
<p>If we have two groups with observations <span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_m\)</span> and <span class="math notranslate nohighlight">\(y_1, y_2, \dots, y_n\)</span> sampled from populations <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>, respectively, the Mann-Whitney U/Wilcoxon rank-sum test assesses the null hypothesis that the probability of a randomly selected observation from group <span class="math notranslate nohighlight">\(X\)</span> being greater than a randomly selected observation from group <span class="math notranslate nohighlight">\(Y\)</span> is <span class="math notranslate nohighlight">\(0.5\)</span>. Formally:</p>
<ul class="simple">
<li><p>Under the null hypothesis, <span class="math notranslate nohighlight">\(P(x_i &gt; y_j) = 0.5\)</span>, the probability that a randomly selected observation from one group is larger than a randomly selected observation from the other group is equal to 0.5. Essentially, this means the two groups have the same distribution.</p></li>
<li><p>Under the alternative hypothesis, <span class="math notranslate nohighlight">\(P(x_i &gt; y_j) \ne 0.5\)</span>, the probability that a randomly selected observation from one group is larger than a randomly selected observation from the other group is not equal to 0.5, implying that the two groups have different distributions.</p></li>
</ul>
<p>How do the test works concretely:</p>
<ol class="arabic">
<li><p>Combine and rank: combine the data from both groups and rank the values from lowest to highest, ignoring the group labels</p></li>
<li><p>Calculate rank sums: calculate the sum of the ranks for each group. We assign the median rank to tied values (<strong>mid-rank method</strong>)</p></li>
<li><p>Calculate <span class="math notranslate nohighlight">\(U\)</span> statistic: the U statistic is calculated for each group based on the rank sums, sample sizes, and a correction factor for ties (if any). Specifically, the formulas for the U statistics are:</p>
<p><span class="math notranslate nohighlight">\(U_x = mn + \frac{m(m+1)}{2} - R_x\)</span></p>
<p><span class="math notranslate nohighlight">\(U_y = mn + \frac{n(n+1)}{2} - R_y\)</span></p>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the number of samples drawn from population <span class="math notranslate nohighlight">\(X\)</span>, <span class="math notranslate nohighlight">\(n\)</span> is the number of samples drawn from population <span class="math notranslate nohighlight">\(Y\)</span>, and <span class="math notranslate nohighlight">\(R_x\)</span> and <span class="math notranslate nohighlight">\(R_y\)</span> are the sum of the ranks attributed to population <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>, respectively.</p>
<p>The final <span class="math notranslate nohighlight">\(U\)</span> statistic used for the test is the minimum of the two: <span class="math notranslate nohighlight">\(U = \min(U_x, U_y)\)</span></p>
</li>
<li><p>Determine significance: <span class="math notranslate nohighlight">\(U\)</span> is compared to a critical value from a <a class="reference external" href="https://sphweb.bumc.bu.edu/otlt/mph-modules/bs/bs704_nonparametric/Mann-Whitney-Table-CriticalValues.pdf">Mann-Whitney U table</a> (for the chosen significance level and sample sizes). If the calculated <span class="math notranslate nohighlight">\(U\)</span> value is less than or equal to the critical value (<span class="math notranslate nohighlight">\(U \leq U^\ast\)</span>), we reject the null hypothesis. Otherwise, we fail to reject the null hypothesis.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">rankdata</span>

<span class="c1"># Combine the data</span>
<span class="n">combined_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">))</span>

<span class="c1"># Rank the data</span>
<span class="n">ranks</span> <span class="o">=</span> <span class="n">rankdata</span><span class="p">(</span><span class="n">combined_data</span><span class="p">)</span>
<span class="c1"># &#39;average&#39; method used to assign ranks to tied elements by default</span>

<span class="c1"># Separate the ranks for each group</span>
<span class="n">old_ranks</span> <span class="o">=</span> <span class="n">ranks</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)]</span>
<span class="n">yng_ranks</span> <span class="o">=</span> <span class="n">ranks</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">):]</span>

<span class="c1"># Calculate the rank sums</span>
<span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">old_ranks</span><span class="p">)</span>
<span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yng_ranks</span><span class="p">)</span>

<span class="c1"># Calculate the U statistic for each group</span>
<span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
<span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">+</span> <span class="p">(</span><span class="n">n1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">R1</span>
<span class="n">U2</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">+</span> <span class="p">(</span><span class="n">n2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">R2</span>

<span class="c1"># Determine the U statistic</span>
<span class="n">U_statistic</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span> <span class="n">U2</span><span class="p">)</span>

<span class="c1"># Critical U value for n1=9 and n2=8 with alpha=0.05 from the table</span>
<span class="c1"># https://sphweb.bumc.bu.edu/otlt/mph-modules/bs/bs704_nonparametric/Mann-Whitney-Table-CriticalValues.pdf</span>
<span class="n">U_critical</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;U1 = </span><span class="si">{</span><span class="n">U1</span><span class="si">:</span><span class="s2">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;U2 = </span><span class="si">{</span><span class="n">U2</span><span class="si">:</span><span class="s2">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;U statistic = </span><span class="si">{</span><span class="n">U_statistic</span><span class="si">:</span><span class="s2">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;U critical (n=</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s2">, m=</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s2">, alpha=0.05) = </span><span class="si">{</span><span class="n">U_critical</span><span class="si">:</span><span class="s2">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compare U to the critical value and draw a conclusion</span>
<span class="k">if</span> <span class="n">U_statistic</span> <span class="o">&lt;=</span> <span class="n">U_critical</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reject the null hypothesis. There is a significant difference between the groups.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fail to reject the null hypothesis. There is no significant difference between the groups.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>U1 = 65
U2 = 7
U statistic = 7
U critical (n=9, m=8, alpha=0.05) = 15
Reject the null hypothesis. There is a significant difference between the groups.
</pre></div>
</div>
</div>
</div>
<p>The Mann-Whitney U test’s critical values table is generated from the probability distribution of the U statistic, as detailed in the <a class="reference external" href="https://projecteuclid.org/journals/annals-of-mathematical-statistics/volume-18/issue-1/On-a-Test-of-Whether-one-of-Two-Random-Variables/10.1214/aoms/1177730491.full">original paper by Mann and Whitney</a>. They used a recursion relation to define this distribution:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
p_{n,m}(U) = \begin{cases}
\mathbb 1(U = 0), &amp; n = 0 \text{ or } m = 0 \\
\displaystyle\frac{n p_{n-1,m}(U-m) + m p_{n,m-1}(U)}{n+m}, &amp; n, m &gt; 0,
\end{cases}
\end{split}\]</div>
<p>Python readily supports recursive functions, providing a concise and elegant way to implement algorithms that involve repeated self-reference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mann_whitney_u_prob</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability of a specific U value in the Mann-Whitney U distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        U: The U statistic value.</span>
<span class="sd">        n: The number of observations in the first group.</span>
<span class="sd">        m: The number of observations in the second group.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The probability of the U value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">U</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">mann_whitney_u_prob</span><span class="p">(</span><span class="n">U</span> <span class="o">-</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">mann_whitney_u_prob</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># Handle invalid input (negative n or m)</span>

<span class="c1"># Using the current data</span>
<span class="n">probability</span> <span class="o">=</span> <span class="n">mann_whitney_u_prob</span><span class="p">(</span><span class="n">U_statistic</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P(U=</span><span class="si">{</span><span class="n">U_statistic</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s2">, m=</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">probability</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P(U=7.0, n=9, m=8) = 0.0006
</pre></div>
</div>
</div>
</div>
<p>To gain a deeper understanding of the underlying probability distribution of the U statistic, let’s generate a table that illustrates the exact probabilities for various combinations of sample size <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(U\)</span> values, with <span class="math notranslate nohighlight">\(n\)</span> fixed. This table will provide insights into the behavior of the U statistic under different scenarios and help us appreciate the complexities involved in calculating the exact P values for the Mann-Whitney U test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the table for n = 9</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n1</span>
<span class="n">U_values</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>    <span class="c1"># U from 0 to 9</span>
<span class="n">m_values</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># m from 1 to 9</span>

<span class="n">table_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">m_values</span><span class="p">:</span>
    <span class="n">row_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">U</span> <span class="ow">in</span> <span class="n">U_values</span><span class="p">:</span>
        <span class="n">row_data</span><span class="p">[</span><span class="n">U</span><span class="p">]</span> <span class="o">=</span> <span class="n">mann_whitney_u_prob</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">table_data</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_data</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table_data</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;m&quot;</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;U&quot;</span>

<span class="c1"># Display the table</span>
<span class="n">pg</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s1">&#39;.6f&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       1         2         3         4         5         6         7         8         9
--------  --------  --------  --------  --------  --------  --------  --------  --------
0.100000  0.018182  0.004545  0.001399  0.000500  0.000200  0.000087  0.000041  0.000021
0.100000  0.018182  0.004545  0.001399  0.000500  0.000200  0.000087  0.000041  0.000021
0.100000  0.036364  0.009091  0.002797  0.000999  0.000400  0.000175  0.000082  0.000041
0.100000  0.036364  0.013636  0.004196  0.001499  0.000599  0.000262  0.000123  0.000062
0.100000  0.054545  0.018182  0.006993  0.002498  0.000999  0.000437  0.000206  0.000103
0.100000  0.054545  0.022727  0.008392  0.003497  0.001399  0.000612  0.000288  0.000144
0.100000  0.072727  0.031818  0.012587  0.004995  0.002198  0.000962  0.000452  0.000226
0.100000  0.072727  0.036364  0.015385  0.006494  0.002797  0.001311  0.000617  0.000309
0.100000  0.090909  0.045455  0.020979  0.008991  0.003996  0.001836  0.000905  0.000452
0.100000  0.090909  0.054545  0.025175  0.011489  0.005195  0.002448  0.001193  0.000617
</pre></div>
</div>
</div>
</div>
<p>The P value represents the probability of observing a U value <em>as extreme as, or more extreme than</em>, the one calculated from the data, assuming the null hypothesis is true. The <strong>cumulative distribution function (CDF)</strong> provides this information: by <em>summing the probabilities in all the rows above a cell in a given column</em> in the U table, we are effectively calculating the probability of obtaining a U value less than or equal to the value represented by that cell. This cumulative probability is then used to determine the P value for the test. Below is the cumulative distribution table derived from the previous table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the cumulative sum of probabilities along the rows (axis=0)</span>
<span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>m</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>U</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.1</td>
      <td>0.018182</td>
      <td>0.004545</td>
      <td>0.001399</td>
      <td>0.000500</td>
      <td>0.000200</td>
      <td>0.000087</td>
      <td>0.000041</td>
      <td>0.000021</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.2</td>
      <td>0.036364</td>
      <td>0.009091</td>
      <td>0.002797</td>
      <td>0.000999</td>
      <td>0.000400</td>
      <td>0.000175</td>
      <td>0.000082</td>
      <td>0.000041</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.3</td>
      <td>0.072727</td>
      <td>0.018182</td>
      <td>0.005594</td>
      <td>0.001998</td>
      <td>0.000799</td>
      <td>0.000350</td>
      <td>0.000165</td>
      <td>0.000082</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.4</td>
      <td>0.109091</td>
      <td>0.031818</td>
      <td>0.009790</td>
      <td>0.003497</td>
      <td>0.001399</td>
      <td>0.000612</td>
      <td>0.000288</td>
      <td>0.000144</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.5</td>
      <td>0.163636</td>
      <td>0.050000</td>
      <td>0.016783</td>
      <td>0.005994</td>
      <td>0.002398</td>
      <td>0.001049</td>
      <td>0.000494</td>
      <td>0.000247</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.6</td>
      <td>0.218182</td>
      <td>0.072727</td>
      <td>0.025175</td>
      <td>0.009491</td>
      <td>0.003796</td>
      <td>0.001661</td>
      <td>0.000782</td>
      <td>0.000391</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.7</td>
      <td>0.290909</td>
      <td>0.104545</td>
      <td>0.037762</td>
      <td>0.014486</td>
      <td>0.005994</td>
      <td>0.002622</td>
      <td>0.001234</td>
      <td>0.000617</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.8</td>
      <td>0.363636</td>
      <td>0.140909</td>
      <td>0.053147</td>
      <td>0.020979</td>
      <td>0.008791</td>
      <td>0.003934</td>
      <td>0.001851</td>
      <td>0.000926</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.9</td>
      <td>0.454545</td>
      <td>0.186364</td>
      <td>0.074126</td>
      <td>0.029970</td>
      <td>0.012787</td>
      <td>0.005769</td>
      <td>0.002756</td>
      <td>0.001378</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>0.545455</td>
      <td>0.240909</td>
      <td>0.099301</td>
      <td>0.041459</td>
      <td>0.017982</td>
      <td>0.008217</td>
      <td>0.003949</td>
      <td>0.001995</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For instance, if the calculated U statistic is 7, and the corresponding probability for n = 9 and m = 8 is 0.00185, which is less than 0.05/2 = 0.025 (for a two-sided test), we reject the null hypothesis. This indicates a significant difference in the medians of the two groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the cumulative probability for U=7 and m=8 (n=9)</span>
<span class="n">cumulative_prob</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="c1"># type: ignore</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cumulative_prob</span>  <span class="c1"># Multiply by 2 for two-tailed test</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cumulative probability for U=7 and m=8 (n=9): </span><span class="si">{</span><span class="n">cumulative_prob</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value (two-tailed): </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.7f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compare the p-value to 0.05</span>
<span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reject the null hypothesis. There is a significant difference between the groups.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fail to reject the null hypothesis. There is no significant difference between the groups.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cumulative probability for U=7 and m=8 (n=9): 0.00185
P value (two-tailed): 0.0037022
Reject the null hypothesis. There is a significant difference between the groups.
</pre></div>
</div>
</div>
</div>
<p>One practical advantage of non-parametric tests is their ability to handle data that contains values that are too high or too low to be precisely measured. In such cases, where exact quantification is impossible, we can assign <em>arbitrary very low or very high values</em> to these data points. Since non-parametric tests focus on the relative ranks of the data rather than their precise magnitudes, the test results won’t be affected by the lack of exact values for these extreme measurements.</p>
</section>
<section id="asymptotic-approach">
<h4>Asymptotic approach<a class="headerlink" href="#asymptotic-approach" title="Link to this heading">#</a></h4>
<p>While statistical packages offer accurate calculations for the Mann-Whitney U test, visualizing its exact distribution can be complex. As an alternative, we can explore the asymptotic distribution (normal approximation) for visualization purposes. Keep in mind that this approximation might not be ideal for small samples, but it effectively illustrates the distribution’s shape and how the P value is computed.</p>
<p>In fact, for larger sample sizes, the distribution of the U statistic under the null hypothesis can be approximated by a normal distribution. This approximation simplifies the calculation of P values and makes it easier to visualize the distribution.</p>
<p>To define this approximate normal distribution, we need to know its <em>mean</em> and <em>standard deviation</em>. These parameters are calculated based on the sample sizes of the two groups being compared. The mean of the normal approximation is used to center the distribution curve on the plot. This helps in visually comparing the observed U statistic to the expected distribution under the null hypothesis. The mean and standard deviation are also used in the calculation of the z-score, which is then used to determine the P value based on the standard normal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="c1"># Determine the meean and SD to approximate the distribution</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>  <span class="c1"># Based on the variance of rank sum</span>

<span class="c1"># Generate x values for plotting the normal distribution</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">normal_pdf</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">normal_pdf</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="c1"># Plot the critical U-values (two-tailed test)</span>
<span class="n">U_crit_lower</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>
<span class="n">U_crit_upper</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="c1"># Calculate the z-score</span>
<span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">U_statistic</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>

<span class="c1"># Calculate the p-value (two-tailed)</span>
<span class="n">p_value_U</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z_score</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">U_crit_lower</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">U_crit_upper</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$U^\ast$ (</span><span class="si">{</span><span class="n">U_crit_lower</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Shade the rejection regions (alpha)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">normal_pdf</span><span class="p">,</span>
    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">U_crit_lower</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">U_crit_upper</span><span class="p">),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\alpha$ (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Plot the observed U-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">U_statistic</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$U$ (</span><span class="si">{</span><span class="n">U_statistic</span><span class="si">:</span><span class="s1">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Shade the P-value areas (two-tailed)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">normal_pdf</span><span class="p">,</span>
    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">U_statistic</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="n">U_statistic</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$P$ (</span><span class="si">{</span><span class="n">p_value_U</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$U$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Normal approximation to U distribution ($n=$</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s2">, $m=$</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a94c71de0aedf57cb44355239d8795e2539946443a2396f2e12ba4978dab8163.png" src="_images/a94c71de0aedf57cb44355239d8795e2539946443a2396f2e12ba4978dab8163.png" />
</div>
</div>
</section>
</section>
<section id="python-tools-for-non-parametric-unpaired-t-test">
<h3>Python tools for non-parametric unpaired t-test<a class="headerlink" href="#python-tools-for-non-parametric-unpaired-t-test" title="Link to this heading">#</a></h3>
<p>Python offers convenient and powerful tools for performing the Mann-Whitney U test, simplifying the analysis and providing additional functionalities.</p>
<p>SciPy provides a comprehensive collection of statistical functions, including the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.mannwhitneyu.html"><code class="docutils literal notranslate"><span class="pre">mannwhitneyu</span></code> function</a> for performing the Mann-Whitney U test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span>

<span class="c1"># Perform Mann-Whitney U test with exact p-value calculation</span>
<span class="n">U_statistic_exact</span><span class="p">,</span> <span class="n">p_value_exact</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">)</span>

<span class="c1"># Perform Mann-Whitney U test with asymptotic (normal approximation) p-value calculation</span>
<span class="n">U_statistic_asymptotic</span><span class="p">,</span> <span class="n">p_value_asymptotic</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;asymptotic&#39;</span><span class="p">,</span> <span class="n">use_continuity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># method=&#39;auto&#39; choose between the &#39;asymptotic&#39; and &#39;exact&#39; based on the sample sizes and the presence of ties</span>
<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mann-Whitney U test results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exact P value: </span><span class="si">{</span><span class="n">p_value_exact</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asymptotic P value (similar to normal distribution method): </span><span class="si">{</span><span class="n">p_value_asymptotic</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mann-Whitney U test results:
Exact P value: 0.00370
Asymptotic P value (similar to normal distribution method): 0.00523
</pre></div>
</div>
</div>
</div>
<p>Pingouin’s <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.mwu.html"><code class="docutils literal notranslate"><span class="pre">mwu</span></code> function</a> provides a more comprehensive output, including additional statistics like the rank biserial correlation and the common language effect size. These statistics offer further insights into the magnitude and direction of the difference between the two groups, complementing the P value obtained from the test, but won’t be disscussed here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">mwu</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;asymptotic&#39;</span><span class="p">,</span> <span class="n">use_continuity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>U-val</th>
      <th>alternative</th>
      <th>p-val</th>
      <th>RBC</th>
      <th>CLES</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MWU</th>
      <td>7.0</td>
      <td>two-sided</td>
      <td>0.005234</td>
      <td>-0.805556</td>
      <td>0.097222</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>When the P value is less than 0.05 in a two-tailed Mann-Whitney U test, using both exact and asymptotic methods, we can conclude that there is a significant difference between the two groups being compared. This means that the probability of observing the data (or more extreme data) if the null hypothesis were true is less than 5%. Therefore, we reject the null hypothesis, and conclude that there is a difference in the distribution between the two groups.</p>
</section>
</section>
<section id="bootstrapping-and-permutation-tests">
<span id="bootstrap"></span><h2>Bootstrapping and permutation tests<a class="headerlink" href="#bootstrapping-and-permutation-tests" title="Link to this heading">#</a></h2>
<p><strong>Bootstrapping</strong> offers a powerful alternative for statistical inference, allowing us to <em>estimate parameters and confidence intervals</em> directly from the data itself, without relying on strong assumptions about the underlying population distribution. This approach, also known as <strong>non-parametric inference</strong>, was previously encountered in the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/12%20-%20Confidence%20Interval%20of%20a%20Mean.html#resampling">chapter on calculating the confidence interval of a mean (univariate)</a>.</p>
<p>While bootstrapping is primarily used for estimation, <strong>permutation tests</strong>, another resampling-based method, are specifically designed for <em>hypothesis testing</em>. They can be employed to test various hypotheses, such as the null hypothesis of exchangeability (where group labels are irrelevant) or the hypothesis of equal means after shifting the group means to a common value.</p>
<section id="the-essence-of-bootstrapping">
<h3>The essence of bootstrapping<a class="headerlink" href="#the-essence-of-bootstrapping" title="Link to this heading">#</a></h3>
<p>The core idea behind bootstrapping is to treat our observed sample as <em>miniature representation of the population</em>. We repeatedly resample from our original sample to create <em>multiple bootstrap samples</em>. Each replicate is generated by <strong>randomly sampling (with replacement)</strong> from the original data, creating a new dataset of the <strong>same size</strong>.</p>
<p>The power of bootstrapping lies in its ability to empirically estimate the sampling distribution of a statistic of interest, such as the <strong>difference between group means</strong>. By calculating this statistic for each bootstrap sample, we generate a <strong>bootstrap distribution</strong>. This distribution serves as an <em>approximation</em> of how the statistic would vary if we were to repeatedly sample from the population. It’s important to note that while the <strong>central limit theorem</strong> guarantees that the distribution of sample means approaches a normal distribution as the sample size increases, bootstrapping doesn’t rely on this assumption. It directly leverages the empirical distribution of the data to make inferences. Learn more on bootstrap and computer-intensive methods in <a class="reference external" href="https://link.springer.com/chapter/10.1007/978-1-4419-5525-8_6">Wilcox (2010)</a> and <a class="reference external" href="https://doi.org/10.1201/9780429329203">Manly and Navarro Alberto (2020)</a>.</p>
<p>For now, let’s return to the example of bladder muscle relaxation in old and young rats, where we have relatively small sample sizes. This scenario provides an excellent opportunity to showcase the power and utility of bootstrapping and permutation tests in handling such data limitations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Generate 10,000 bootstrap replicates of the mean for each group</span>
<span class="c1"># !Make sure to choose exactly N elements randomly **with replacement**</span>
<span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">bs_old_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">old</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">),</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">bs_yng_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">yng</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">yng</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Calculate the difference between the bootstrap means for each replicate</span>
<span class="c1"># (cast operation on numpy arrays)</span>
<span class="n">bs_mean_diff</span> <span class="o">=</span> <span class="n">bs_yng_means</span> <span class="o">-</span> <span class="n">bs_old_means</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bs_mean_diff</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># print the 10 first replicates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25.07916667 23.89166667 22.01944444 29.45277778 23.34027778 26.37083333
 22.95277778 19.46666667 27.01388889 27.89444444]
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimate-of-the-confidence-interval">
<h3>Estimate of the confidence interval<a class="headerlink" href="#estimate-of-the-confidence-interval" title="Link to this heading">#</a></h3>
<p>Once we have the bootstrap distribution, we can <a class="reference external" href="https://courses.washington.edu/matlab1/Bootstrap_examples.html">estimate the confidence interval</a> by finding the percentiles corresponding to the desired confidence level.</p>
<p>For a 95% confidence interval, we typically use the 2.5th and 97.5th percentiles of the bootstrap distribution. This means that 95% of the bootstrap estimates fall within this interval, providing a range of plausible values for the true population parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the 95% confidence interval using np.percentile</span>
<span class="n">bs_CI_mean_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bs_mean_diff</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap estimate of the mean difference  = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bs_mean_diff</span><span class="p">)</span><span class="si">:</span><span class="s2">5.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corresponding 95% CI estimate = </span><span class="si">{</span><span class="n">bs_CI_mean_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bootstrap estimate of the mean difference  = 23.44
Corresponding 95% CI estimate = [11.52 35.54]
</pre></div>
</div>
</div>
</div>
<p>It’s generally expected that the confidence interval obtained through bootstrapping, here [11.52, 35.54], will be reasonably similar to the confidence interval calculated using the t-distribution, i.e., [9.335, 37.76], especially when the sample size is sufficiently large, and the underlying assumptions of the t-test are met. Interestingly, the confidence interval obtained through bootstrapping is narrower than the one derived from the t-distribution, despite having lower sample sizes. This might seem counterintuitive, as we generally expect wider confidence intervals with smaller sample sizes due to increased uncertainty.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of the bootstrap distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">bs_mean_diff</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>  <span class="c1"># or use bins=int(n_replicates**.5)</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
    <span class="c1"># alpha=.75,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Resampled $\bar x - \bar y$&#39;</span><span class="p">)</span>

<span class="c1"># Annotate the observed mean difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">mean_diff</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;Observed $\bar x - \bar y$ (</span><span class="si">{</span><span class="n">mean_diff</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add lines for the confidence interval</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bs_CI_mean_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;2.5th (</span><span class="si">{</span><span class="n">bs_CI_mean_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bs_CI_mean_diff</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;97.5th (</span><span class="si">{</span><span class="n">bs_CI_mean_diff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\bar x - \bar y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap distribution of mean differences (B=</span><span class="si">{</span><span class="n">n_replicates</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/081ed41f73bf92ab4ca0ecfdb31983615fcb1b8decce26fa0454c2dabd0808fc.png" src="_images/081ed41f73bf92ab4ca0ecfdb31983615fcb1b8decce26fa0454c2dabd0808fc.png" />
</div>
</div>
<p>Bootstrapping relies entirely on the data in the original sample. If, by chance, the original samples have less variability or happen to be more representative of their respective populations, the bootstrap distribution might exhibit less spread, leading to a narrower confidence interval. And as bootstrapping involves random resampling, which introduces some inherent variability in the results, it’s possible that the particular set of bootstrap samples generated in this instance led to a slightly narrower confidence interval than the theoretical one based on the t-distribution. Moreover, the t-distribution-based confidence interval assumes that the data follows a normal distribution. If the actual data deviates from normality, especially in the tails, the t-distribution might overestimate the variability, resulting in a wider confidence interval than necessary.</p>
</section>
<section id="bootstrapping-with-pingouin">
<h3>Bootstrapping with pingouin<a class="headerlink" href="#bootstrapping-with-pingouin" title="Link to this heading">#</a></h3>
<p>The <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.compute_bootci.html"><code class="docutils literal notranslate"><span class="pre">compute_bootci</span></code></a> method from the Pingouin library proves to be a valuable asset in such scenarios, as it streamlines the process of generating confidence intervals using bootstrapping. It eliminates the need for manual creation of bootstrap samples, offering a variety of methods for confidence interval computation, including the normal approximation, percentile bootstrap, and bias-corrected percentile method. Additionally, it provides the flexibility to return the entire bootstrap distribution, enabling further exploration and visualization of the resampling results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate 95% percentile bootstrap confidence interval using pingouin</span>
<span class="n">bs_ci</span><span class="p">,</span> <span class="n">bt</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">compute_bootci</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">yng</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">old</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
    <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">111</span><span class="p">,</span>
    <span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_boot</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">return_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;95% percentile bootstrap confidence interval (pingouin): (</span><span class="si">{</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bs_ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">bt</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>95% percentile bootstrap confidence interval (pingouin): (11.349, 35.713)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([21.42361111, 21.01527778, 35.11944444, 34.98194444, 16.35555556,
       18.95555556, 29.72083333, 19.16944444, 22.78333333, 25.49027778])
</pre></div>
</div>
</div>
</div>
</section>
<section id="bootstrap-p-value">
<h3>Bootstrap P value<a class="headerlink" href="#bootstrap-p-value" title="Link to this heading">#</a></h3>
<p><strong>Bootstrapping and permutation</strong> tests offer remarkable flexibility in hypothesis testing, going beyond the traditional t-statistic used in t-tests. As we’ve seen, resampling techniques can generate data for constructing confidence intervals around various test statistics. But we can also strategically manipulate the data to simulate the null hypothesis, enabling us to compute P values that assess the likelihood of observing our data under the assumption of no effect.</p>
<p>The key is to choose a <strong>test statistic</strong> that is relevant to the hypothesis being tested and calculate it <em>consistently for both the original data and the resampled or permuted data</em>. For instance, when the primary goal is to compare the means of two groups, the <strong>mean difference</strong> or the <strong>t-statistic</strong> can serve as simple and effective test statistics. However, the flexibility of resampling methods allows us to explore other relevant statistics as well. We can examine the <em>median difference</em> when dealing with skewed data or outliers, the <em>ratio of means</em> for assessing relative differences, or even differences in specific <em>quantiles</em> to capture distributional characteristics. Furthermore, if the research question extends beyond comparing means and focuses on the overall difference in distributions, statistics like the <a class="reference external" href="https://sbwiecko.github.io/intuitive_biostatistics/24%20-%20Normality%20Tests%20and%20Outliers.html#kolmogorov-smirnov-test"><strong>Kolmogorov-Smirnov statistic</strong></a> can be employed within the bootstrapping or permutation framework.</p>
<p>Ultimately, the choice of test statistic should be guided by the specific hypotheses being tested and the nature of the data. The adaptability of bootstrapping and permutation tests empowers researchers to tailor their analyses precisely to the requirements of their study, providing a robust and versatile approach to statistical inference.</p>
<section id="bootstrapped-t-statistics-of-shifted-data">
<h4>Bootstrapped t-statistics of shifted data<a class="headerlink" href="#bootstrapped-t-statistics-of-shifted-data" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://academic.oup.com/biomet/article-abstract/68/3/589/218600?redirectedFrom=fulltext&amp;amp;login=false">Bradley Efron</a> proposes an elegant bootstrapping algorithm for comparing the means of two independent samples, even when their variances might differ. This approach involves shifting the data in each group to have a common mean, effectively simulating the null hypothesis of equal population means.</p>
<p>Specifically, we create two new datasets where the values are <strong>shifted</strong> as follows: <span class="math notranslate nohighlight">\(x_{1i}' = x_{1i} - \bar x_1 + \bar z\)</span>, and <span class="math notranslate nohighlight">\(x_{2i}' = x_{2i} - \bar x_2 + \bar z\)</span>, where <span class="math notranslate nohighlight">\(\bar z\)</span> is the mean of the <em>combined sample</em>. Next, we perform the following steps <span class="math notranslate nohighlight">\(B\)</span> times (e.g., <span class="math notranslate nohighlight">\(B = 10000\)</span>):</p>
<ol class="arabic simple">
<li><p>Draw a bootstrap sample <span class="math notranslate nohighlight">\(x_{1i}^*\)</span> of size <span class="math notranslate nohighlight">\(n_1\)</span> with replacement from <span class="math notranslate nohighlight">\(x_{1i}'\)</span></p></li>
<li><p>Draw another bootstrap sample <span class="math notranslate nohighlight">\(x_{2i}^*\)</span> of size <span class="math notranslate nohighlight">\(n_2\)</span> with replacement from <span class="math notranslate nohighlight">\(x_{2i}'\)</span></p></li>
<li><p>Calculate <a class="reference internal" href="#welch"><span class="std std-ref">Welch’s t-statistic</span></a> <span class="math notranslate nohighlight">\(t^*\)</span> using the bootstrap samples.</p></li>
</ol>
<p>Finally, we <a class="reference external" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)#Bootstrap_hypothesis_testing">estimate the P value</a> as the proportion of bootstrap t-statistics that are as extreme as or more extreme than the observed t-statistic <span class="math notranslate nohighlight">\(t\)</span> from our original data:</p>
<div class="math notranslate nohighlight">
\[p = \frac{\sum_{i=1}^B I\{t_i^* \ge t \}}{B} | t \gt 0\]</div>
<p>where <span class="math notranslate nohighlight">\(I\{\text{condition}\} = 1\)</span> if the <em>condition</em> is true and <span class="math notranslate nohighlight">\(0\)</span> otherwise. This P value represents the probability of observing a t-statistic as extreme as, or more extreme than, the one calculated from our original data, assuming the null hypothesis (H0) of equal population means is true.</p>
<p>Importantly, we’re not just interested in any difference, but a difference in a <em>specific direction</em>. A positive statistic suggests an effect in one direction, a negative statistic suggests an effect in the opposite direction. Therefore, if the observed test statistic is negative, the P value is the proportion of bootstrapped test statistics that <em>are less than or equal</em> to the observed test statistic:</p>
<div class="math notranslate nohighlight">
\[p = \frac{\sum_{i=1}^B I\{t_i^* \le t \}}{B} | t \lt 0\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Calculate the combined mean of both groups</span>
<span class="n">combined_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">]))</span>

<span class="c1"># Shift the data in each group to have the same mean (combined_mean)</span>
<span class="n">old_shifted</span> <span class="o">=</span> <span class="n">old</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">+</span> <span class="n">combined_mean</span>
<span class="n">yng_shifted</span> <span class="o">=</span> <span class="n">yng</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yng</span><span class="p">)</span> <span class="o">+</span> <span class="n">combined_mean</span>

<span class="c1"># Generate 10,000 bootstrap replicates for each shifted group</span>
<span class="n">bs_shifted_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">old_shifted</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)])</span>
<span class="n">bs_shifted_yng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">yng_shifted</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">yng</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)])</span>

<span class="c1"># Calculate sample means and variances for each bootstrap replicate</span>
<span class="c1"># !np.mean calculates the mean of the entire flattened array by default if no &#39;axis&#39; is provided</span>
<span class="n">bs_shifted_old_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bs_shifted_old</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Calculate mean along each row/replicate</span>
<span class="n">bs_shifted_yng_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bs_shifted_yng</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bs_shifted_old_vars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">bs_shifted_old</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Calculate variance along each row</span>
<span class="n">bs_shifted_yng_vars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">bs_shifted_yng</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the standard error for the difference means for each replicate using Welch&#39;s formula</span>
<span class="n">bs_se_unequal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bs_shifted_old_vars</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">+</span> <span class="n">bs_shifted_yng_vars</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">yng</span><span class="p">))</span>

<span class="c1"># Calculate Welch&#39;s t-statistic for each bootstrap replicate</span>
<span class="n">bs_t_statistic_welch</span> <span class="o">=</span> <span class="p">(</span><span class="n">bs_shifted_yng_means</span> <span class="o">-</span> <span class="n">bs_shifted_old_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">bs_se_unequal</span>

<span class="c1"># Print the first 15 t-statistics from the bootstrap replicates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span><span class="p">[:</span><span class="mi">15</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.3117061   0.04728963 -0.30521782  0.8322539  -0.03140883  0.49586349
 -0.0809322  -0.76470241  0.51108061  0.84035053 -2.5197374   0.16208369
 -2.19024079  0.38957005  2.06971633]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the P value using bootstrapping, considering the direction of the observed statistic</span>
<span class="k">if</span> <span class="n">t_statistic_welch</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span> <span class="o">&gt;=</span> <span class="n">t_statistic_welch</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span> <span class="o">&lt;=</span> <span class="n">t_statistic_welch</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span><span class="p">)</span>

<span class="c1"># Print the P value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value obtained using bootstrapped t-statistics = </span><span class="si">{</span><span class="n">p_value_bs_shifted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value obtained using bootstrapped t-statistics = 0.0026
</pre></div>
</div>
</div>
</div>
<p>We can visualize the P value by plotting the histogram of bootstrapped t-statistics (after shifting the data to a common mean). The P value corresponds to the area under the histogram where the t-statistic is greater than or equal to the observed t-statistic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="c1"># Plot the histogram of the bootstrap t-statistics</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">bs_t_statistic_welch</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n_replicates</span><span class="o">**</span><span class="mf">.5</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
    <span class="c1"># alpha=0.75,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Bootstrap $t$&#39;</span><span class="p">)</span>

<span class="c1"># Annotate the observed t-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">t_statistic_welch</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;Observed $t$ (</span><span class="si">{</span><span class="n">t_statistic_welch</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Determine the direction of the observed statistic and plot accordingly</span>
<span class="k">if</span> <span class="n">t_statistic_welch</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Plot the histogram of the bootstrap t-statistics &gt;= observed t-statistic</span>
    <span class="n">extreme_t_stats</span> <span class="o">=</span> <span class="n">bs_t_statistic_welch</span><span class="p">[</span><span class="n">bs_t_statistic_welch</span> <span class="o">&gt;=</span> <span class="n">t_statistic_welch</span><span class="p">]</span>
    <span class="c1"># Change the color of the bars based on the direction parameter</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&gt;=</span> <span class="n">extreme_t_stats</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Plot the histogram of the bootstrap t-statistics &lt;= observed t-statistic</span>
    <span class="n">extreme_t_stats</span> <span class="o">=</span> <span class="n">bs_t_statistic_welch</span><span class="p">[</span><span class="n">bs_t_statistic_welch</span> <span class="o">&lt;=</span> <span class="n">t_statistic_welch</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&lt;=</span> <span class="n">extreme_t_stats</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Bootstrap distribution of $t$ under H0 (B=</span><span class="si">{</span><span class="n">n_replicates</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Create a copy of the original patch for the legend</span>
<span class="n">original_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Bootstrap $t$&#39;</span><span class="p">)</span>
<span class="c1"># Create a patch for the legend</span>
<span class="n">p_value_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$P$ (</span><span class="si">{</span><span class="n">p_value_bs_shifted</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add the patches to the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">original_patch</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_value_patch</span><span class="p">]);</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2d7b5578db0267600bdc79323596bfc833f4ec9aa4f2c3cace177109db6c9e3b.png" src="_images/2d7b5578db0267600bdc79323596bfc833f4ec9aa4f2c3cace177109db6c9e3b.png" />
</div>
</div>
</section>
<section id="permutation">
<h4>Permutation<a class="headerlink" href="#permutation" title="Link to this heading">#</a></h4>
<p>The permutation/shuffle method involves combining all the data, <strong>shuffling</strong> the labels, and then reassigning them to create new “groups.” This is typically used when we want to test the <em>null hypothesis of identical distributions</em> between the two groups, not just equal means. It’s a more general approach that doesn’t assume any specific distributional form.</p>
<p>To facilitate the permutation test, we’ll define a function that shuffles the original arrays and returns permutation samples. This function will be instrumental in creating datasets where the group labels have been randomly reassigned, allowing us to simulate the null hypothesis of no difference between the groups. For further exploration of permutation and bootstrapping techniques, refer to the <a class="reference external" href="https://github.com/justinbois/dc_stat_think">dc_stat_think repository from Justin Bois</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">permutation_sample</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a permutation sample by combining and shuffling two datasets.</span>

<span class="sd">    This function concatenates `data1` and `data2`, randomly shuffles the</span>
<span class="sd">    combined array, and then splits it back into two arrays with the </span>
<span class="sd">    original sizes of `data1` and `data2`, respectively.</span>

<span class="sd">    Args:</span>
<span class="sd">        data1: A one-dimensional array-like object representing the first dataset.</span>
<span class="sd">        data2: A one-dimensional array-like object representing the second dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing two NumPy arrays:</span>
<span class="sd">            - permuted_data1: A shuffled version of `data1`.</span>
<span class="sd">            - permuted_data2: A shuffled version of `data2`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Combine the two datasets into a single array</span>
    <span class="n">combined_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">])</span>

    <span class="c1"># Shuffle the combined data in-place</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">combined_data</span><span class="p">)</span>

    <span class="c1"># Split the shuffled data back into two arrays with original sizes</span>
    <span class="n">permuted_data1</span> <span class="o">=</span> <span class="n">combined_data</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)]</span>
    <span class="n">permuted_data2</span> <span class="o">=</span> <span class="n">combined_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">):]</span>

    <span class="k">return</span> <span class="n">permuted_data1</span><span class="p">,</span> <span class="n">permuted_data2</span>
</pre></div>
</div>
</div>
</div>
<p>The core concept of the permutation test is to repeatedly shuffle the group labels of the original data, effectively simulating the null hypothesis where there’s no true difference between the groups. For each shuffled dataset, we calculate the mean difference (our <em>test statistic</em>) and create a distribution of these permuted mean differences. We then assess how often these permuted differences are as extreme as, or more extreme than, the observed mean difference in our original data. This proportion represents the P value, indicating the probability of observing such an extreme difference by chance if the null hypothesis were true.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># Generate 10,000 bootstrap replicates of the mean difference for each permutation samples</span>
<span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Initialize an empty array to store the bootstrap mean differences</span>
<span class="n">permuted_mean_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)</span>

<span class="c1"># Generate bootstrap replicates of the mean difference for each permutation sample</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">):</span>
    <span class="c1"># Generate a new permuted sample</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">permutation_sample</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">yng</span><span class="p">)</span>

    <span class="c1"># Calculate the mean difference for this permuted sample</span>
    <span class="n">permuted_mean_diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># We could also use a list comprehension instead of the loop</span>
<span class="c1"># bs_mean_diff_shuffled = np.array([</span>
<span class="c1">#     np.mean(x)-np.mean(y) for _ in range(n_replicates) for x,y in [permutation_sample(old, yng)]</span>
<span class="c1">#     ])</span>

<span class="c1"># Print the first 10 replicates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">permuted_mean_diffs</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ -5.45972222  -6.475       13.73611111  -4.79861111   7.3375
   7.40833333 -12.           4.71666667 -15.96666667  -5.50694444]
</pre></div>
</div>
</div>
</div>
<p>The core logic for calculating the P value remains consistent between the permutation test and the mean-shifting approach. In both cases, we estimate the P value as the proportion of replicates (permuted mean differences or bootstrapped t-statistics from shifted data) that are as extreme as, or more extreme than, the observed statistic (the original mean difference or t-statistic). The fundamental distinction lies in how the null hypothesis is simulated. The permutation test achieves this by shuffling group labels, while the mean-shifting approach shifts the data in each group to a common mean, effectively assuming no difference between the groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the P value using the permutation distribution of mean differences,</span>
<span class="c1"># considering the direction of the observed mean difference</span>
<span class="k">if</span> <span class="n">mean_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_mean_diffs</span> <span class="o">&gt;=</span> <span class="n">mean_diff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_mean_diffs</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">permuted_mean_diffs</span> <span class="o">&lt;=</span> <span class="n">mean_diff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">permuted_mean_diffs</span><span class="p">)</span>

<span class="c1"># Print the p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value obtained using permutation test (mean difference) = </span><span class="si">{</span><span class="n">p_value_permutation</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value obtained using permutation test (mean difference) = 0.0018
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of the shuffled mean differences</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">permuted_mean_diffs</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n_replicates</span><span class="o">**</span><span class="mf">.5</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
    <span class="c1"># alpha=0.75,</span>
<span class="p">)</span>

<span class="c1"># Annotate the observed mean difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">mean_diff</span><span class="p">,</span> <span class="c1"># type: ignore</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;Observed $\bar x - \bar y$ (</span><span class="si">{</span><span class="n">mean_diff</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Determine the direction of the observed difference and plot accordingly</span>
<span class="k">if</span> <span class="n">mean_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Plot the histogram of the mean differences &gt;= observed mean difference </span>
    <span class="n">extreme_diffs</span> <span class="o">=</span> <span class="n">permuted_mean_diffs</span><span class="p">[</span><span class="n">permuted_mean_diffs</span> <span class="o">&gt;=</span> <span class="n">mean_diff</span><span class="p">]</span>
    <span class="c1"># Change the color of the bars based on the direction parameter</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&gt;=</span> <span class="n">extreme_diffs</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Plot the histogram of the mean differences &lt;= observed mean difference</span>
    <span class="n">extreme_diffs</span> <span class="o">=</span> <span class="n">permuted_mean_diffs</span><span class="p">[</span><span class="n">permuted_mean_diffs</span> <span class="o">&lt;=</span> <span class="n">mean_diff</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bin_edge</span> <span class="o">&lt;=</span> <span class="n">extreme_diffs</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;lime&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\bar x - \bar y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution of permutated mean differences under H0 (B=</span><span class="si">{</span><span class="n">n_replicates</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Create a copy of the original patch for the legend</span>
<span class="n">original_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Permuted $\bar x - \bar y$&#39;</span><span class="p">)</span>
<span class="c1"># Create a patch for the legend</span>
<span class="n">p_value_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$P$ (</span><span class="si">{</span><span class="n">p_value_permutation</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Add the patches to the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">original_patch</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_value_patch</span><span class="p">]);</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8c4808261ff7e6a17e48398014da68ba4404839de2889a41d56f0d5aeb1fe0de.png" src="_images/8c4808261ff7e6a17e48398014da68ba4404839de2889a41d56f0d5aeb1fe0de.png" />
</div>
</div>
<p>All the P values are considerably smaller than the typical significance level of 0.05. This indicates strong evidence to <strong>reject the null hypothesis</strong> of no difference between the means of the “old” and “young” rat groups. Therefore, we can confidently conclude that there is a <strong>statistically significant difference</strong> between the means of the two groups. The data suggests that the “young” rats, on average, have a significantly different (likely higher, based on the previous context) outcome measurement compared to the “old” rats.</p>
<p>Note that the slightly smaller P values from the permutation test and bootstrapping might indicate that these non-parametric methods are slightly more sensitive in detecting the difference in means for this particular dataset. However, the overall conclusion remains the same across all tests.</p>
</section>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>In this chapter, we explored the <strong>unpaired t-test</strong>, a fundamental statistical tool for comparing the means of two independent groups. We started by emphasizing the importance of <em>descriptive statistics and visualization</em> in understanding the characteristics of the data before proceeding with hypothesis testing. We then delved into the assumptions underlying the t-test, particularly <strong>normality</strong> and <strong>equal variances</strong>, and discussed how to assess and address potential violations of these assumptions.</p>
<p>We examined both the <strong>Welch’s t-test</strong> (for unequal variances), and standard <strong>Student t-test</strong> (assuming equal variances), highlighting their formulas, calculations, and interpretations. We also demonstrated how to perform these tests in Python using both the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>, Pingouin and <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> libraries.</p>
<p>Furthermore, we explored the power of <strong>bootstrapping</strong> and <strong>permutation</strong> tests as <em>non-parametric alternatives</em> or complements to the traditional t-test. We illustrated how these resampling-based methods can be used to estimate P values and confidence intervals, providing valuable insights even when the underlying assumptions of the t-test might not be fully met.</p>
<p>Finally, we used the <code class="docutils literal notranslate"><span class="pre">penguins</span></code> dataset to demonstrate the practical application of t-tests and the importance of considering both statistical significance and the visual representation of data. We learned that overlapping distributions do not necessarily imply the absence of a significant difference, especially with small sample sizes.</p>
<p>By mastering the concepts and techniques presented in this chapter, we are now equipped to confidently apply the unpaired t-test in our research and data analysis endeavors, drawing meaningful conclusions about differences between groups and contributing to the advancement of knowledge in the field of life sciences. Remember that the choice between the standard t-test and Welch’s t-test should be guided by a careful assessment of the assumptions and the characteristics of the data. Additionally, consider leveraging the flexibility of bootstrapping and permutation tests when dealing with non-normal data or small sample sizes.</p>
</section>
<section id="cheat-sheet">
<h2>Cheat sheet<a class="headerlink" href="#cheat-sheet" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Descriptive statistics and visualization<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Descriptive statistics</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>

<span class="c1"># Box and swarm plots</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Assessing assumptions<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<section id="id3">
<h4>Normality testing<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using scipy.stats</span>
<span class="c1"># D&#39;Agostino-Pearson K² test</span>
<span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
<span class="c1"># Shapiro-Wilk</span>
<span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>

<span class="c1"># Using pingouin</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;normaltest&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;shapiro&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="q-q-plot">
<h4>Q-Q plot<a class="headerlink" href="#q-q-plot" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>Homoscedasticity testing<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Levene&#39;s test for equal variances</span>
<span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
<span class="c1"># Bartlett&#39;s test for equal variances</span>
<span class="n">stats</span><span class="o">.</span><span class="n">bartlett</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>

<span class="c1"># Using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bartlett&#39;</span><span class="p">)</span>

<span class="c1"># Homoscedasticity testing with DataFrame</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">dv</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;levene&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="t-test">
<h3>T-test<a class="headerlink" href="#t-test" title="Link to this heading">#</a></h3>
<section id="id5">
<h4>Welch’s t-test<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using scipy.stats</span>
<span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="student-s-t-test">
<h4>Student’s t-test<a class="headerlink" href="#student-s-t-test" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using scipy.stats</span>
<span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># One-sided t-test</span>
<span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span>
    <span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span>  <span class="c1"># scipy doesn&#39;t remove missing values automatically</span>
<span class="p">)</span>

<span class="c1"># Using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># T-test with a DataFrame</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>  <span class="c1"># the method removes missing values by default</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># One-sided t-test</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">)</span>

<span class="c1"># Using statsmodels API</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">x1</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="c1"># statsmodels doesn&#39;t support policy for missing values</span>
    <span class="n">x2</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">usevar</span><span class="o">=</span><span class="s1">&#39;pooled&#39;</span><span class="p">,</span>       <span class="c1"># Specify equal variances assumption</span>
    <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;larger&#39;</span><span class="p">,</span>  <span class="c1"># Test if the Adelie bill depth mean (x1) is larger</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">3</span>                <span class="c1"># difference between the means (x1 - x2) under the null hypothesis</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h3>Effect size<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">compute_effsize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eftype</span><span class="o">=</span><span class="s1">&#39;cohen&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="non-parametric-mann-whitney-u-test">
<h3>Non-parametric Mann-Whitney U test<a class="headerlink" href="#non-parametric-mann-whitney-u-test" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span>

<span class="c1"># Perform Mann-Whitney U test with exact p-value calculation</span>
<span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">)</span>

<span class="c1"># Perform Mann-Whitney U test with asymptotic (normal approximation) p-value calculation</span>
<span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;asymptotic&#39;</span><span class="p">,</span> <span class="n">use_continuity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform Mann-Whitney U test with Pingouin backend</span>
<span class="n">pg</span><span class="o">.</span><span class="n">mwu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;asymptotic&#39;</span><span class="p">,</span> <span class="n">use_continuity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3>Bootstrapping and permutation tests<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<section id="bootstrapping">
<h4>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate B bootstrap replicates of the mean for each group</span>
<span class="c1"># !Make sure to choose exactly N elements randomly **with replacement**</span>
<span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">bs_data1_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">data1</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">),</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)</span>
    <span class="p">])</span>
<span class="c1"># bs_data2_means = ...</span>

<span class="c1"># Calculate the statistic of interest `bs` for each replicate</span>

<span class="c1"># Confidence interval</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="id8">
<h4>Bootstrapping with pingouin<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bs_ci</span><span class="p">,</span> <span class="n">bt</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">compute_bootci</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">data1</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">data2</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data2</span><span class="p">),</span>
    <span class="n">return_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
</pre></div>
</div>
</section>
<section id="p-value">
<h4>P value<a class="headerlink" href="#p-value" title="Link to this heading">#</a></h4>
<section id="id9">
<h5>Bootstrapped t-statistics of shifted data<a class="headerlink" href="#id9" title="Link to this heading">#</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_replicates</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Calculate the combined mean of both groups</span>
<span class="n">combined_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">]))</span>

<span class="c1"># Shift the data in each group to have the same mean (combined_mean)</span>
<span class="n">data1_shifted</span> <span class="o">=</span> <span class="n">data1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span> <span class="o">+</span> <span class="n">combined_mean</span>
<span class="n">data2_shifted</span> <span class="o">=</span> <span class="n">data2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span> <span class="o">+</span> <span class="n">combined_mean</span>

<span class="c1"># Generate B bootstrap replicates for each shifted group</span>
<span class="n">bs_shifted_data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data1_shifted</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)])</span>
<span class="n">bs_shifted_data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data2_shifted</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data2</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)])</span>

<span class="c1"># Calculate sample means and variances for each bootstrap replicate</span>
<span class="c1"># !np.mean calculates the mean of the entire flattened array by default if no &#39;axis&#39; is provided</span>
<span class="n">bs_shifted_data1_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bs_shifted_data1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Calculate mean along each row</span>
<span class="n">bs_shifted_data2_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bs_shifted_data2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bs_shifted_data1_vars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">bs_shifted_data1</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Variance along each row</span>
<span class="n">bs_shifted_data2_vars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">bs_shifted_data2</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the standard error for the difference in means for each replicate (Welch&#39;s formula)</span>
<span class="n">bs_se_unequal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bs_shifted_data1_vars</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span> <span class="o">+</span> <span class="n">bs_shifted_data2_vars</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data2</span><span class="p">))</span>

<span class="c1"># Calculate Welch&#39;s t-statistic for each bootstrap replicate</span>
<span class="n">bs_t_statistic_welch</span> <span class="o">=</span> <span class="p">(</span><span class="n">bs_shifted_data2_means</span> <span class="o">-</span> <span class="n">bs_shifted_data1_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">bs_se_unequal</span>

<span class="c1"># Calculate the P value using bootstrapping, considering the direction of the observed statistic</span>
<span class="k">if</span> <span class="n">t_statistic_welch</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span> <span class="o">&gt;=</span> <span class="n">t_statistic_welch</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_bs_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span> <span class="o">&lt;=</span> <span class="n">t_statistic_welch</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_t_statistic_welch</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="id10">
<h5>Permutation<a class="headerlink" href="#id10" title="Link to this heading">#</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">permutation_sample</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">):</span>
    <span class="c1"># Combine the two datasets into a single array</span>
    <span class="n">combined_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">])</span>
    <span class="c1"># Shuffle the combined data in-place</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">combined_data</span><span class="p">)</span>
    <span class="c1"># Split the shuffled data back into two arrays with original sizes</span>
    <span class="n">permuted_data1</span> <span class="o">=</span> <span class="n">combined_data</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)]</span>
    <span class="n">permuted_data2</span> <span class="o">=</span> <span class="n">combined_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">):]</span>

    <span class="k">return</span> <span class="n">permuted_data1</span><span class="p">,</span> <span class="n">permuted_data2</span>

<span class="n">bs_mean_diff_shuffled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_replicates</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">permutation_sample</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)]</span>
    <span class="p">])</span>

<span class="c1"># Calculate the P value using the permutation distribution of mean differences,</span>
<span class="c1"># considering the direction of the observed mean difference</span>
<span class="k">if</span> <span class="n">mean_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_mean_diff_shuffled</span> <span class="o">&gt;=</span> <span class="n">mean_diff</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_mean_diff_shuffled</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p_value_permutation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bs_mean_diff_shuffled</span> <span class="o">&lt;=</span> <span class="n">mean_diff</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_mean_diff_shuffled</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="session-information">
<h2>Session Information<a class="headerlink" href="#session-information" title="Link to this heading">#</a></h2>
<p>The output below details all packages and version necessary to reproduce the results in this report.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>--version
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">importlib.metadata</span> <span class="kn">import</span> <span class="n">version</span>

<span class="c1"># List of packages we want to check the version</span>
<span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn&#39;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="s1">&#39;pingouin&#39;</span><span class="p">,</span> <span class="s1">&#39;statsmodels&#39;</span><span class="p">]</span>

<span class="c1"># Initialize an empty list to store the versions</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop over the packages</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the version of the package</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="c1"># Append the version to the list</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Use a more general exception for broader compatibility</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Not installed&#39;</span><span class="p">)</span>

<span class="c1"># Print the versions</span>
<span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.12.7
-------------
numpy: 1.26.4
pandas: 2.2.2
matplotlib: 3.9.2
seaborn: 0.13.2
scipy: 1.14.1
pingouin: 0.5.5
statsmodels: 0.14.2
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="29%20-%20Comparing%20survival%20curves.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comparing survival curves</p>
      </div>
    </a>
    <a class="right-next"
       href="31%20-%20Comparing%20paired%20data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Comparing paired data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-data-for-hypothesis-testing">Preparing data for hypothesis testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-and-visualization">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-assumptions">Assessing assumptions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality-testing">Normality testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-testing">Homoscedasticity testing</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#f-test-of-equality-of-variances">F-test of equality of variances</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#levene-and-bartlett-tests">Levene and Bartlett tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-the-significance-of-mean-differences-with-t-test">Assessing the significance of mean differences with t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-ratio">The t-ratio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-t-test">Welch’s t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-the-welch-s-t-ratio">Manual calculation of the Welch’s t-ratio</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-p-value">Welch’s P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-welch-s-values">Visualizing Welch’s values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-confidence-interval">Welch’s confidence interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-welch-s-t-test-in-python">Performing the Welch’s t-test in Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#student-t-test">Student t-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-t-ratio-formula">Student’s t-ratio formula</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#special-case-of-equal-variances-and-sample-sizes">Special case of equal variances and sample sizes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-p-value">Student’s P value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-student-s-values">Visualizing Student’s values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-confidence-interval">Student’s confidence interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-student-s-t-test-in-python">Performing the Student’s t-test in Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-real-world-data">Working with real world data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-data">Understanding the data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-assumptions">Checking assumptions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-missing-values">The problem of missing values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-t-test">Performing t-test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overlapping-distributions">Overlapping distributions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one-sided-t-test">One-sided t-test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-mann-whitney-u-test-manually">Performing the Mann-Whitney U test manually</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exact-method">Exact method</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#asymptotic-approach">Asymptotic approach</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-tools-for-non-parametric-unpaired-t-test">Python tools for non-parametric unpaired t-test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-and-permutation-tests">Bootstrapping and permutation tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-essence-of-bootstrapping">The essence of bootstrapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-of-the-confidence-interval">Estimate of the confidence interval</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping-with-pingouin">Bootstrapping with pingouin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-p-value">Bootstrap P value</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapped-t-statistics-of-shifted-data">Bootstrapped t-statistics of shifted data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permutation">Permutation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descriptive statistics and visualization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Assessing assumptions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Normality testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#q-q-plot">Q-Q plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Homoscedasticity testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-test">T-test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Welch’s t-test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#student-s-t-test">Student’s t-test</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Effect size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-mann-whitney-u-test">Non-parametric Mann-Whitney U test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Bootstrapping and permutation tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrapping">Bootstrapping</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Bootstrapping with pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Bootstrapped t-statistics of shifted data</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Permutation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session Information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sébastien Wieckowski
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>