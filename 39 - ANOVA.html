
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ANOVA &#8212; The Python Companion of Intuitive Biostatistics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QQY9FLLPJ8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '39 - ANOVA';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Logistic regression" href="38%20-%20Logistic%20regression.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="The Python Companion of Intuitive Biostatistics - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="The Python Companion of Intuitive Biostatistics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Python Companion Guide to “Intuitive Biostatistics”
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Continuous variables</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="09%20-%20Quantifying%20scatter%20of%20continuous%20data.html">Quantifying scatter of continuous data</a></li>
<li class="toctree-l1"><a class="reference internal" href="10%20-%20Gaussian%20distribution.html">The Gaussian distribution</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Confidence intervals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="12%20-%20Confidence%20interval%20of%20a%20mean.html">Confidence interval of a mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="04%20-%20Confidence%20interval%20of%20a%20proportion.html">Confidence interval of a proportion</a></li>
<li class="toctree-l1"><a class="reference internal" href="05%20-%20Confidence%20interval%20of%20survival%20data.html">Confidence interval of survival data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06%20-%20Confidence%20interval%20of%20counted%20data.html">Confidence interval of counted data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical significance and data assumptions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="15%20-%20Statistical%20significance.html">Statistical significance</a></li>
<li class="toctree-l1"><a class="reference internal" href="20%20-%20Statistical%20power%20and%20sample%20size.html">Statistical power and sample size</a></li>
<li class="toctree-l1"><a class="reference internal" href="24%20-%20Normality%20tests%20and%20outliers.html">Normality tests and outliers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical tests</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="27%20-%20Comparing%20proportions.html">Comparing proportions</a></li>
<li class="toctree-l1"><a class="reference internal" href="29%20-%20Comparing%20survival%20curves.html">Comparing survival curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="30%20-%20Comparing%20two%20unpaired%20means.html">Comparing two unpaired means</a></li>
<li class="toctree-l1"><a class="reference internal" href="31%20-%20Comparing%20paired%20data.html">Comparing paired data</a></li>
<li class="toctree-l1"><a class="reference internal" href="32%20-%20Correlation.html">Correlation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fitting models to data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="33%20-%20Simple%20linear%20regression.html">Simple linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="35%20-%20Comparing%20models.html">Comparing models</a></li>
<li class="toctree-l1"><a class="reference internal" href="36%20-%20Nonlinear%20regression.html">Nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="37%20-%20Multiple%20regression.html">Multiple regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="38%20-%20Logistic%20regression.html">Logistic regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The rest of statistics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ANOVA</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics/edit/master/39 - ANOVA.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/39 - ANOVA.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ANOVA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathematical-concepts">Mathematical concepts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variance">Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-sum-of-squares">Partitioning the sum of squares</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#f-statistic">F-statistic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eta-squared">Eta-squared</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#omega-squared">Omega-squared</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-anova-manually">Calculating ANOVA manually</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-the-anova-table">Manual calculation of the ANOVA table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anova-table">ANOVA table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anova-reconstruction-from-summary-data">ANOVA reconstruction from summary data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-ssb">Calculating SSB</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-ssw">Calculating SSW</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-f-distribution-and-critical-values">Visualizing the F-distribution and critical values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-application-with-python">Practical application with Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-with-pingouin">One-way ANOVA with Pingouin</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality-test">Normality test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity">Homoscedasticity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conducting-the-anova">Conducting the ANOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-with-scipy-stats">One-way ANOVA with scipy.stats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-using-statsmodels">One-way ANOVA using statsmodels</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova">Repeated measures ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-variance-in-rmanova">Partitioning variance in rmANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-f-statistic">Calculating the F-statistic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-rmanova">Advantages of rmANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-rmanova-manually">Calculating rmANOVA Manually</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova-using-python">Repeated measures ANOVA using Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rmanova-using-pingouin">rmANOVA using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova-using-statsmodels">Repeated measures ANOVA using statsmodels</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test">Kruskal-Wallis test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test-using-pingouin">Kruskal-Wallis test using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test-using-scipy">Kruskal-Wallis test using SciPy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test">Friedman’s test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test-using-pingouin">Friedman’s test using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test-using-scipy">Friedman’s test using SciPy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova">Two-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-of-two-way-anova">Example of two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-two-way-anova-works">How two-way ANOVA works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-two-way-anova">Manual calculation of two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-f-ratios-and-p-values-in-two-way-anova">Visualizing F-ratios and P values in two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-using-python">Two-way ANOVA using Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-with-pingouin">Two-way ANOVA with Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-with-statsmodels">Two-way ANOVA with statsmodels</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unbalanced-design-in-two-way-anova">Unbalanced design in two-way ANOVA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-designs">Special designs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mixed-design-anova">Mixed-design ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#n-way-anova">N-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-repeated-measures-anova">Two-way repeated measures ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-covariance-ancova">Analysis of covariance (ANCOVA)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-comparison-tests-after-anova">Multiple comparison tests after ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-s-hsd-test">Tukey’s HSD test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-confidence-intervals-for-mean-differences">Calculating confidence intervals for mean differences</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-studentized-range-distribution">The Studentized range distribution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-kramer-test-for-unequal-sample-sizes">Tukey-Kramer test for unequal sample sizes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-multiple-comparison-with-python">Tukey multiple comparison with Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dunnett-s-test">Dunnett’s test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-s-correction">Bonferroni’s correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-multiple-comparison-adjustments">Other multiple comparison adjustments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova">One-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Repeated measures ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-anova">Non-parametric ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Special designs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Mixed-design ANOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">N-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Two-way repeated measures ANOVA</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ancova">ANCOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-comparison-posthoc-analysis">Multiple comparison posthoc analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-hsd-and-tukey-kramer">Tukey HSD and Tukey-Kramer</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Dunnett’s test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Bonferroni’s correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Other multiple comparison adjustments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="anova">
<h1>ANOVA<a class="headerlink" href="#anova" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Analysis of Variance (ANOVA) is a powerful statistical technique used to compare the means of three or more groups. It’s a cornerstone of biostatistics, helping us understand how different factors influence biological phenomena. We use it to analyze everything from the effects of various drugs on patient outcomes to the impact of environmental changes on species populations.</p>
<p>The type of ANOVA we use depends on how our data is structured. One-way ANOVA is used when we have <em>one categorical factor</em> with at least three levels (e.g., comparing the effectiveness of three different fertilizers on plant growth). However, many biological studies involve more complex designs.</p>
<p>For instance, we might want to see how a treatment affects the same individuals over time. This calls for a <em>repeated-measures ANOVA</em>, which accounts for the correlation between measurements taken on the same subject.  Or, we might have a study with both between-subject factors (like genotype) and within-subject factors (like time). This is where <em>mixed-design ANOVA</em> comes in, allowing us to analyze the interplay of these different factors.</p>
<p><img alt="flowchart for selecting the right ANOVA function" src="https://pingouin-stats.org/build/html/_images/flowchart_one_way_ANOVA.svg" /></p>
<p>Regardless of the type of ANOVA, the fundamental principle remains the same: we partition the observed variance in the data to determine if the variation between groups is greater than the variation within groups. This helps us determine if the factor we’re interested in has a statistically significant effect.</p>
<p>In this chapter, we’ll explore the theory behind ANOVA, including the concepts of variance partitioning and the F-statistic. Then, we’ll dive into the practical application of ANOVA in Python, using powerful libraries like Pingouin and statsmodels. We’ll cover one-way and two-way ANOVA, repeated-measures ANOVA, and mixed-design ANOVA, providing us with the tools and knowledge to analyze a wide range of biological datasets.</p>
</section>
<section id="mathematical-concepts">
<h2>Mathematical concepts<a class="headerlink" href="#mathematical-concepts" title="Link to this heading">#</a></h2>
<section id="variance">
<h3>Variance<a class="headerlink" href="#variance" title="Link to this heading">#</a></h3>
<p>At its heart, ANOVA is all about analyzing variance. Remind from the earliest chapters about quantifying scatter of continuous data, <strong>variance</strong> is a statistical measure that quantifies the spread or dispersion of data points around the mean. In simpler terms, it tells us how much the individual data points deviate from the average. A high variance indicates that the data points are spread out over a wide range of values, while a low variance indicates that the data points are clustered closely around the mean.</p>
<p>ANOVA utilizes variance to make inferences about the means of different groups. The core idea is to compare the variance <em>between</em> the groups to the variance <em>within</em> the groups:</p>
<ul class="simple">
<li><p><em>Variance between groups</em>: this reflects the differences between the means of the groups. If the means are very different, the between-group variance will be high.</p></li>
<li><p><em>Variance within groups:</em> this reflects the variability of the data points within each group. Even if the group means are different, there will still be some variation among the individuals within each group.</p></li>
</ul>
<p>By comparing these two sources of variance, ANOVA can determine if the differences between the group means are statistically significant or simply due to random chance. If the between-group variance is significantly larger than the within-group variance, it suggests that the groups are truly different from each other.</p>
<p>To calculate the variance of a dataset, we follow these steps:</p>
<ol class="arabic simple">
<li><p>Calculate the mean: sum all the data points and divide by the number of data points.</p></li>
<li><p>Calculate the deviations: subtract the mean from each data point.</p></li>
<li><p>Square the deviations: square each of the differences calculated in step 2.</p></li>
<li><p>Sum the squared deviations: add up all the squared deviations.</p></li>
<li><p>Divide by the degrees of freedom: divide the sum of squared deviations by the number of data points minus 1 (this is the degrees of freedom).</p></li>
</ol>
<p>The formula for (sample) variance is:</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{\sum_{i=1}^{n}(x_i - \bar{x})^2}{n - 1}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_i\)</span> = each individual data point</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar{x}\)</span> = the mean of the data set</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> = the number of data points</p></li>
</ul>
</section>
<section id="partitioning-the-sum-of-squares">
<h3>Partitioning the sum of squares<a class="headerlink" href="#partitioning-the-sum-of-squares" title="Link to this heading">#</a></h3>
<p>ANOVA takes the total variability in our data and divides it into different parts, like slicing a pie. This “slicing” is called <em>partitioning the sum of squares</em>. Each slice of the pie represents a source of variation. In one-way ANOVA, we have two main slices:</p>
<ol class="arabic simple">
<li><p><em>Between-group variability:</em> this represents how much the group means vary from the overall mean of the data. In essence, it captures the differences <em>between</em> our groups.</p></li>
<li><p><em>Within-group variability:</em> this represents how much the individual data points within each group vary from their respective group means. It captures the inherent variation <em>within</em> each group.</p></li>
</ol>
<p>Now, here’s where the variance formula becomes crucial. To quantify these two types of variability, we use a slightly modified version of the variance formula. Instead of dividing by (n-1), we’ll focus on the <em>sum of squared deviations</em>, i.e., the numerator in the variance formula:</p>
<ul class="simple">
<li><p><em>Sum of squares total (SST):</em> this represents the <em>total</em> variability in the data. We calculate it by finding the squared difference between each data point and the overall mean of the data, then summing those squared differences. This is represented as  <span class="math notranslate nohighlight">\(\text{SS}_\text{total}\)</span>.</p></li>
<li><p><em>Sum of squares between (SSB):</em> this represents the variability <em>between</em> the groups. We calculate it by finding the squared difference between each group mean and the overall mean, weighting it by the number of observations in each group, and then summing those weighted squared differences. This is sometimes referred to as the “<em>effect</em>” and is represented as <span class="math notranslate nohighlight">\(\text{SS}_\text{effect}\)</span>.</p></li>
<li><p><em>Sum of squares within (SSW):</em> this represents the variability <em>within</em> each group. We calculate it by finding the squared difference between each data point and its group mean, then summing all those squared differences across all groups. This is also known as the “<em>error</em>” and is represented as <span class="math notranslate nohighlight">\(\text{SS}_\text{error}\)</span>.</p></li>
</ul>
<p>More formally, we can express these sums of squares using the following equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\text{SST} = \text{SS}_\text{total} = \sum_i \sum_j (x_{ij} - \overline{x})^2 \\
\text{SSB} = \text{SS}_\text{effect} = \sum_i n_i (\overline{x_i} - \overline{x})^2 \\
\text{SSW} = \text{SS}_\text{error} = \sum_i \sum_j (x_{ij} - \overline{x}_i)^2
\end{split}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(i=1,\dots,r\)</span> represents the groups (from 1 to <em>r</em> total groups)</p></li>
<li><p><span class="math notranslate nohighlight">\(j=1,\dots,n_i\)</span> represents the observations within each group</p></li>
<li><p><span class="math notranslate nohighlight">\(r \)</span> is the total number of groups</p></li>
<li><p><span class="math notranslate nohighlight">\(n_i\)</span> is the number of observations in the <span class="math notranslate nohighlight">\(i\)</span> th group</p></li>
<li><p><span class="math notranslate nohighlight">\(x_{ij}\)</span> is the jth observation in the ith group</p></li>
<li><p><span class="math notranslate nohighlight">\(\overline{x_i}\)</span> is the mean of the ith group, or “group mean”</p></li>
<li><p><span class="math notranslate nohighlight">\(\overline{x}\)</span> is the overall mean of the data, or “grand mean”</p></li>
</ul>
<p>These equations provide a precise way to calculate the different components of variance. SST captures the total variability around the grand mean, SSB captures the variability of group means around the grand mean, and SSW captures the variability of individual data points around their group means.</p>
<p>The beauty of this partitioning is that the total variability is equal to the sum of the between-group variability and the within-group variability:</p>
<div class="math notranslate nohighlight">
\[\text{SST} = \text{SSB} + \text{SSW}\]</div>
<p>In fact:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\text{SST} &amp;= \sum_i \sum_j (x_{ij} - \overline{x})^2 \\
&amp;= \sum_i \sum_j (x_{ij} - \overline{x}_i + \overline{x}_i - \overline{x})^2 \\
&amp;= \sum_i \sum_j [(x_{ij} - \overline{x}_i)^2 + 2(x_{ij} - \overline{x}_i)(\overline{x}_i - \overline{x}) + (\overline{x}_i - \overline{x})^2] \\
&amp;= \sum_i \sum_j (x_{ij} - \overline{x}_i)^2 + 2 \sum_i \sum_j (x_{ij} - \overline{x}_i)(\overline{x}_i - \overline{x}) + \sum_i \sum_j (\overline{x}_i - \overline{x})^2
\end{aligned}
\end{split}\]</div>
<p>The middle term simplifies to zero, since for each group <em>i</em>, the term <span class="math notranslate nohighlight">\(\sum_j (x_{ij} - \overline{x}_i)\)</span> sums the deviations of the data points from the group mean. This sum is always zero by the definition of the mean, i.e., <span class="math notranslate nohighlight">\(\overline{x}_i = \sum_j (x_{ij})\)</span>, and since this sum is zero for each group, the entire middle term becomes zero.</p>
<p>The last term can be simplified by recognizing that <span class="math notranslate nohighlight">\((\overline{x}_i - \overline{x})\)</span> is <em>constant</em> for all data points within group <em>i</em>, i.e., with ragards to <span class="math notranslate nohighlight">\(j\)</span>. Therefore, we can move it outside the inner summation. Finally, <span class="math notranslate nohighlight">\(\sum_j 1 = n_i\)</span> because it’s simply counting the number of data points in group <em>i</em>. Therefore:</p>
<div class="math notranslate nohighlight">
\[
\sum_i \sum_j (\overline{x}_i - \overline{x})^2 = \sum_i (\overline{x}_i - \overline{x})^2 \sum_j 1 = \sum_i (\overline{x}_i - \overline{x})^2 n_i
\]</div>
<p>Putting it all together, we have:</p>
<div class="math notranslate nohighlight">
\[
\text{SST} = \sum_i \sum_j (x_{ij} - \overline{x})^2 = \sum_i \sum_j (x_{ij} - \overline{x}_i)^2 + \sum_i n_i (\overline{x}_i - \overline{x})^2 = \text{SSW} + \text{SSB}
\]</div>
<p>By breaking down the total variability, we can assess the <em>relative contributions</em> of between-group and within-group variation. If the between-group variability (SSB) is a large proportion of the total variability (SST), it suggests that the group means are quite different, and the factor we’re investigating has a strong effect.</p>
<p>This partitioning of the sum of squares is directly related to comparing different models to explain the data, as discussed in an ealier chapter. In one-way ANOVA, we’re essentially comparing two models: a <em>null model</em> that assumes no difference between group means (like a single horizontal line) and an <em>alternative model</em> that allows for differences between group means. SST represents the total variability under the null model. SSW represents the variability remaining after fitting the alternative model, and SSR represents the reduction in variability achieved by using the alternative model. This connects to the concept of R-squared, which is the proportion of total variation explained by the alternative model (SSR/SST).</p>
</section>
<section id="f-statistic">
<h3>F-statistic<a class="headerlink" href="#f-statistic" title="Link to this heading">#</a></h3>
<p>Recall from our earlier exploration of the comparison of models that we used the F-statistic to assess the significance of a regression model. The F-statistic isn’t unique to ANOVA; it’s a general tool for comparing models and assessing the amount of variation explained by a particular model.</p>
<p>In the context of ANOVA, we’re essentially comparing two models: a null model that assumes no difference between group means and an alternative model that allows for differences. The F-statistic helps us determine if the alternative model (with group differences) provides a significantly better fit to the data than the null model.</p>
<p>Recall that in the context of comparing models, we calculated the F-statistic as:</p>
<div class="math notranslate nohighlight">
\[F = \frac{\text{MSR}}{\text{MSE}} = \frac{\text{SST} - \text{SSE}}{\text{SSE}/(n - 2)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p>MSR is the mean square regression</p></li>
<li><p>MSE is the mean square error</p></li>
<li><p>SST is the total sum of squares</p></li>
<li><p>SSE is the sum of squares error</p></li>
</ul>
<p>In ANOVA, we use slightly different terminology, but the underlying concept is the same. We calculate the F-statistic as:</p>
<div class="math notranslate nohighlight">
\[F = \frac{\text{MS}_{\text{effect}}}{\text{MS}_{\text{error}}} = \frac{\text{SS}_{\text{effect}} / (r - 1)}{\text{SS}_{\text{error}} / (N - r)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{MS}_{\text{effect}}\)</span> is the mean square effect (analogous to MSR)</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{MS}_{\text{error}}\)</span> is the mean square error (analogous to MSE)</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{SS}_{\text{effect}}\)</span> is the sum of squares effect (analogous to SSR)</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{SS}_{\text{error}}\)</span> is the sum of squares error (analogous to SSE)</p></li>
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the number of groups</p></li>
<li><p><span class="math notranslate nohighlight">\(N\)</span> is the total number of observations</p></li>
</ul>
<p>Essentially, the “effect” in ANOVA corresponds to the “regression” in the regression context. Both represent the improvement in explaining the data achieved by the more complex model.</p>
</section>
<section id="p-value">
<h3>P value<a class="headerlink" href="#p-value" title="Link to this heading">#</a></h3>
<p>The F-statistic itself doesn’t directly tell us whether the observed differences between group means are statistically significant. To make that determination, we need the <em>P value</em>.</p>
<p>The P value is the probability of obtaining an F-statistic as extreme as the one we calculated, assuming that the null hypothesis is true, i.e., assuming there are no real differences between the group means: <span class="math notranslate nohighlight">\(\overline{x_1} = \overline{x_2} = \dots = \overline{x_i}\)</span>.</p>
<p>To find the P value, we use the <strong>F-distribution</strong>. This is a probability distribution that describes the behavior of F-statistics under the <em>null hypothesis</em>. The shape of the F-distribution depends on the degrees of freedom associated with the between-group and within-group variances.</p>
<p>In one-way ANOVA, the F-distribution has:</p>
<ul class="simple">
<li><p>Degrees of freedom for the numerator:  <span class="math notranslate nohighlight">\(r - 1\)</span> (where <span class="math notranslate nohighlight">\(r\)</span> is the number of groups)</p></li>
<li><p>Degrees of freedom for the denominator: <span class="math notranslate nohighlight">\(N - r\)</span> (where <span class="math notranslate nohighlight">\(N\)</span> is the total number of observations)</p></li>
</ul>
<p>Using these degrees of freedom, we can look up the P value corresponding to our calculated F-statistic in a statistical table or use software to calculate it directly (as we’ll see in the Python examples).</p>
<p>A small P value (typically less than 0.05) indicates that it’s unlikely to observe such an extreme F-statistic if the null hypothesis were true. This provides evidence against the null hypothesis, leading us to reject it and conclude that there’s a statistically significant difference between at least one pair of group means.</p>
<p>On the other hand, a large P value (greater than 0.05) suggests that the observed F-statistic is not unusual under the null hypothesis. In this case, we fail to reject the null hypothesis and conclude that there’s not enough evidence to suggest a difference between the group means.</p>
</section>
<section id="effect-size">
<h3>Effect size<a class="headerlink" href="#effect-size" title="Link to this heading">#</a></h3>
<section id="eta-squared">
<h4>Eta-squared<a class="headerlink" href="#eta-squared" title="Link to this heading">#</a></h4>
<p>While the F-statistic and P value tell us whether there’s a statistically significant difference between group means, they don’t tell us how large that difference is. To quantify the magnitude of the effect, we use a measure called <strong>eta-squared</strong> (<span class="math notranslate nohighlight">\(\eta^2\)</span>).</p>
<p>Eta-squared represents the proportion of total variability in the data that is accounted for by the differences between groups. It’s calculated as:</p>
<div class="math notranslate nohighlight">
\[\eta^2 = \frac{\text{SS}_{\text{effect}}}{\text{SS}_{\text{total}}}\]</div>
<p>Eta-squared can be interpreted similarly to R-squared in regression. For example, an <span class="math notranslate nohighlight">\(\eta^2\)</span> of 0.10 means that 10% of the total variability in the data is explained by the differences between the groups.</p>
<p>In one-way ANOVA, eta-squared is equivalent to <em>partial eta-squared</em> (<span class="math notranslate nohighlight">\(\eta_p^2\)</span>), which is a more general measure of effect size used in other ANOVA designs. Partial eta-squared is calculated as:</p>
<div class="math notranslate nohighlight">
\[\eta_p^2 = \frac{\text{SS}_{\text{effect}}}{\text{SS}_{\text{effect}} + \text{SS}_{\text{error}}}\]</div>
<p>Eta-squared provides valuable information about the practical significance of our findings. A larger eta-squared indicates a stronger effect, meaning that the group differences account for a greater proportion of the overall variability in the data.</p>
<p>While there are no strict cutoffs, general guidelines suggest that:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\eta^2\)</span> = 0.01 indicates a small effect</p></li>
<li><p><span class="math notranslate nohighlight">\(\eta^2\)</span> = 0.06 indicates a medium effect</p></li>
<li><p><span class="math notranslate nohighlight">\(\eta^2\)</span> = 0.14 indicates a large effect</p></li>
</ul>
</section>
<section id="omega-squared">
<h4>Omega-squared<a class="headerlink" href="#omega-squared" title="Link to this heading">#</a></h4>
<p>While eta-squared (<span class="math notranslate nohighlight">\(\eta^2\)</span>) is a commonly used effect size measure in ANOVA, it tends to <em>overestimate</em> the population effect size, especially when the sample size is small. This bias arises because eta-squared is calculated based on the sample sums of squares, which are inherently influenced by sampling variability. To address this bias, we can use <strong>omega squared</strong> (<span class="math notranslate nohighlight">\(\omega^2\)</span>), which provides a less biased estimate of the population effect size. Omega squared adjusts for the degrees of freedom and the within-group variance, resulting in a more accurate estimate, particularly for smaller samples:</p>
<div class="math notranslate nohighlight">
\[\omega^2 = \frac{\text{SS}_{\text{effect}} - (r - 1) \text{MS}_{\text{error}}}{\text{SS}_{\text{total}} + \text{MS}_{\text{error}}}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{SS}_{\text{effect}}\)</span> is the sum of squares between groups</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{MS}_{\text{error}}\)</span> is the mean square error (within groups)</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{SS}_{\text{total}}\)</span> is the total sum of squares</p></li>
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the number of groups</p></li>
</ul>
<p>Omega squared, like eta-squared, represents the proportion of variance in the dependent variable that is accounted for by the independent variable (or factor). However, it provides a more accurate estimate, especially when sample sizes are small. It will generally be <em>smaller</em> than eta-squared, reflecting its less biased nature. The difference between the two measures becomes less pronounced as the sample size increases.</p>
<p>While <span class="math notranslate nohighlight">\(\eta^2\)</span> is often reported due to its simplicity and familiarity, it’s generally recommended to use <span class="math notranslate nohighlight">\(\omega^2\)</span> as a more accurate measure of effect size in ANOVA, particularly when dealing with smaller samples.</p>
<p>By considering both the statistical significance (P value) and the effect size (<span class="math notranslate nohighlight">\(\eta^2\)</span> or <span class="math notranslate nohighlight">\(\omega^2\)</span>), we can gain a more complete understanding of the results of our ANOVA analysis.</p>
</section>
</section>
</section>
<section id="calculating-anova-manually">
<h2>Calculating ANOVA manually<a class="headerlink" href="#calculating-anova-manually" title="Link to this heading">#</a></h2>
<p>Before diving into using dedicated Python libraries for ANOVA, let’s solidify our understanding by manually calculating an ANOVA table and visualizing the F-distribution. This will give us a deeper appreciation for the underlying calculations and how to interpret the results.</p>
<section id="manual-calculation-of-the-anova-table">
<h3>Manual calculation of the ANOVA table<a class="headerlink" href="#manual-calculation-of-the-anova-table" title="Link to this heading">#</a></h3>
<p>An ANOVA table provides a structured summary of the key calculations involved in ANOVA. Here’s how we can construct it step-by-step:</p>
<ol class="arabic simple">
<li><p>Organize the data</p></li>
<li><p>Calculate the degrees of freedom</p></li>
<li><p>Calculate the sums of squares:</p>
<ul class="simple">
<li><p>Calculate SST / SS<sub>total</sub> (total sum of squares)</p></li>
<li><p>Calculate SSB / SS<sub>effect</sub> (sum of squares between groups)</p></li>
<li><p>Calculate SSW / SS<sub>error</sub> (sum of squares within groups)</p></li>
</ul>
</li>
<li><p>Calculate the mean squares</p></li>
<li><p>Calculate the F-statistic</p></li>
<li><p>Determine the P value using the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> module</p></li>
<li><p>Construct the ANOVA table</p></li>
</ol>
<p>To solidify our understanding of the calculations behind ANOVA, let’s manually compute the sums of squares for the effect (SSB) and error (SSW). We’ll use the <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.list_dataset.html"><code class="docutils literal notranslate"><span class="pre">anova</span></code> dataset from the Pingouin library</a> as an example. This dataset provides pain threshold scores for individuals with different hair colors (light blond, dark blond, light brunette, and dark brunette). The original study aimed to investigate whether hair color is related to pain tolerance, as studied by <a class="reference external" href="http://www.statsci.org/data/oz/blonds.html">McClave and Dietrich (1991)</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pingouin</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pg</span>

<span class="c1"># Load the &#39;anova&#39; dataset from pingouin</span>
<span class="n">data_anova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;anova&#39;</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">data_anova</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Subject</th>
      <th>Hair color</th>
      <th>Pain threshold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Light Blond</td>
      <td>62</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Light Blond</td>
      <td>60</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Light Blond</td>
      <td>71</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Light Blond</td>
      <td>55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Light Blond</td>
      <td>48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Overlay the stripplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Add plot labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of pain threshold by hair color&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ec0938d01a81810b84cf4f519aaf488dfed049532a16dc6c96137732c6e3f30.png" src="_images/0ec0938d01a81810b84cf4f519aaf488dfed049532a16dc6c96137732c6e3f30.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters of the analysis</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="c1"># Number of groups/conditions</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_anova</span><span class="p">)</span>                    <span class="c1"># Number of total values</span>
<span class="n">DF_between</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span>       <span class="c1"># Degrees of freedom for MSeffect</span>
<span class="n">DF_within</span>  <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">r</span>       <span class="c1"># Degrees of freedom for MSerror</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> different conditions and </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2"> total values&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;This leads to </span><span class="si">{</span><span class="n">DF_between</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">DF_within</span><span class="si">}</span><span class="s2"> degrees of freedom for the effect (SSB) and error (SSW) mean squares respectively&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 4 different conditions and 19 total values
This leads to 3 and 15 degrees of freedom for the effect (SSB) and error (SSW) mean squares respectively
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the overall mean of &#39;Pain threshold&#39;</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grand mean = </span><span class="si">{</span><span class="n">grand_mean</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Sums of squares</span>
<span class="c1"># $\text{SST} = \sum_i \sum_j (x_{ij} - \overline{x})^2$</span>
<span class="n">SST</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># $\text{SSW} = \sum_i \sum_j (x_{ij} - \overline{x}_i)^2$</span>
<span class="n">SSW</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">SSB</span> <span class="o">=</span> <span class="n">SST</span> <span class="o">-</span> <span class="n">SSW</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;With SST = </span><span class="si">{</span><span class="n">SST</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> and SSW = </span><span class="si">{</span><span class="n">SSW</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, we obtain SSB = </span><span class="si">{</span><span class="n">SSB</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compute SSB from scratch for verification</span>
<span class="n">SSB_scratch</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSB computed from scratch = </span><span class="si">{</span><span class="n">SSB_scratch</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grand mean = 47.84
With SST = 2362.5 and SSW = 1001.8, we obtain SSB = 1360.7
SSB computed from scratch = 1360.7
</pre></div>
</div>
</div>
</div>
<p>We can view comparing three or more means with one-way ANOVA as comparing how well two different models fit the data:</p>
<ul class="simple">
<li><p>Null model: this model assumes that all populations have the same mean, which is equivalent to the grand mean of the combined data. In essence, this model suggests that there are no real differences between the groups, and any observed differences are due to random chance.</p></li>
<li><p>Alternative model: this model allows for the possibility that the population means are not all equal. This means that at least one group has a mean that is different from the others, suggesting that there are genuine differences between the groups.</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Hypothesis</p></th>
<th class="head text-left"><p>Scatter from</p></th>
<th class="head text-left"><p>Sum of squares</p></th>
<th class="head text-left"><p>Percentage of variation</p></th>
<th class="head text-left"><p>R²</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Null</p></td>
<td class="text-left"><p>Grand mean</p></td>
<td class="text-left"><p>2362.5</p></td>
<td class="text-left"><p>100</p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Alternative</p></td>
<td class="text-left"><p>Group means</p></td>
<td class="text-left"><p>1001.8</p></td>
<td class="text-left"><p>42.4</p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Difference</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>1360.7</p></td>
<td class="text-left"><p>57.6</p></td>
<td class="text-left"><p>0.576</p></td>
</tr>
</tbody>
</table>
</div>
<p>This table summarizes the partitioning of variance in our ANOVA analysis, comparing the variability explained by the grand mean (null hypothesis) to the variability explained by the group means (alternative hypothesis).</p>
<ul class="simple">
<li><p>The first row represents the null hypothesis, where we assume all data points are scattered around the grand mean. This accounts for 100% of the total variation.</p></li>
<li><p>The second row represents the alternative hypothesis, where we consider the variability of data points around their respective group means. This accounts for 42.4% of the total variation.</p></li>
<li><p>The third row shows the difference between the two models, representing the variability explained by the differences between group means. This accounts for 57.6% of the total variation and corresponds to an R² of 0.576.</p></li>
</ul>
<p>In essence, this table illustrates how ANOVA partitions the total variability and assesses the proportion of variability explained by the grouping factor. By comparing these two models, ANOVA helps us determine which model provides a better explanation of the observed data. If the alternative model fits the data significantly better than the null model, we have evidence to reject the null hypothesis and conclude that there are significant differences between the group means.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MS</span>
<span class="n">MS_between</span> <span class="o">=</span> <span class="n">SSB</span> <span class="o">/</span> <span class="n">DF_between</span>
<span class="n">MS_within</span>  <span class="o">=</span> <span class="n">SSW</span> <span class="o">/</span> <span class="n">DF_within</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS for SSB = </span><span class="si">{</span><span class="n">MS_between</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> and for SSW = </span><span class="si">{</span><span class="n">MS_within</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MS for SSB = 453.6 and for SSW = 66.8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">f</span>

<span class="c1"># F ratio and associated P value</span>
<span class="n">f_ratio</span> <span class="o">=</span> <span class="n">MS_between</span> <span class="o">/</span> <span class="n">MS_within</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">f_ratio</span><span class="p">,</span> <span class="n">DF_between</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>  <span class="c1"># Using the survival function (1 - cdf)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally, with an F ratio = </span><span class="si">{</span><span class="n">f_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, the associated P value = </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finally, with an F ratio = 6.7914, the associated P value = 0.00411
</pre></div>
</div>
</div>
</div>
</section>
<section id="anova-table">
<h3>ANOVA table<a class="headerlink" href="#anova-table" title="Link to this heading">#</a></h3>
<p>We’ve explored the key components of analysis of variance: sums of squares (SST, SSB, SSW), degrees of freedom, and mean squares (MS<sub>effect</sub>, MS<sub>error</sub>). These elements come together in a structured way within the <strong>ANOVA table</strong>. This table provides a framework for comparing a model that assumes no difference between group means (our null hypothesis) to a model that allows for differences between group means.</p>
<p>Here’s the ANOVA table we constructed for our example analyzing the effect of hair color on pain threshold:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Source of variation</p></th>
<th class="head"><p>Sum of squares</p></th>
<th class="head"><p>DF</p></th>
<th class="head"><p>MS</p></th>
<th class="head"><p>F-ratio</p></th>
<th class="head"><p>P value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Between Groups</p></td>
<td><p>1360.7</p></td>
<td><p>3</p></td>
<td><p>453.6</p></td>
<td><p>6.791</p></td>
<td><p>0.0041</p></td>
</tr>
<tr class="row-odd"><td><p>Within Groups</p></td>
<td><p>1001.8</p></td>
<td><p>15</p></td>
<td><p>66.8</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>Total</p></td>
<td><p>2362.5</p></td>
<td><p>18</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>The table partitions the total variation (SST) into the variation explained by differences between the groups (SSB) and the unexplained variation within groups (SSW). The degrees of freedom (DF) are shown for each source of variation. The mean squares (MS) are calculated by dividing the sum of squares by the corresponding degrees of freedom. The F-ratio, calculated as MS<sub>between</sub> / MS<sub>within</sub>, compares the explained and unexplained variation, adjusted for their degrees of freedom. Fianlly, the P value helps us determine the statistical significance of the F-ratio.</p>
<p>If the null hypothesis were true (i.e., if there were no differences between the means of the hair color groups), we would expect the two MS values (MS<sub>between</sub> and MS<sub>within</sub>) to be similar, resulting in an F-ratio close to 1.0. However, in our example, the F-ratio is 6.791, suggesting that the differences between groups explain significantly more variation than would be expected by chance. This small P value (0.0041) provides strong evidence against the null hypothesis, leading us to conclude that there are significant differences in pain threshold between at least two of the hair color groups.</p>
</section>
<section id="anova-reconstruction-from-summary-data">
<h3>ANOVA reconstruction from summary data<a class="headerlink" href="#anova-reconstruction-from-summary-data" title="Link to this heading">#</a></h3>
<p>One-way ANOVA can be computed <em>without raw data</em>, so long as we know the mean, sample size, and standard deviation (or standard error) of each group. This is particularly useful in situations where we only have access to aggregated data or when the original dataset is too large to store.</p>
<p>To reconstruct the ANOVA table from summary statistics, we can use the following formulas:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{SS}_\text{total} = \text{SS}_\text{effect} + \text{SS}_\text{error}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\text{SS}_\text{effect} = \sum n_i (\overline{x_i} - \overline{x})^2\)</span>, where <span class="math notranslate nohighlight">\(n_i\)</span> is the sample size of group <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(\overline{x_i}\)</span> is the mean of group <span class="math notranslate nohighlight">\(i\)</span>, and <span class="math notranslate nohighlight">\(\overline{x}\)</span> is the overall mean</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{SS}_\text{error} = \sum (n_i - 1) s_i^2\)</span>, where <span class="math notranslate nohighlight">\(s_i^2\)</span> is the variance of group <span class="math notranslate nohighlight">\(i\)</span></p></li>
</ul>
<p>To find the last formula, we  start with the basic definition of SSW: <span class="math notranslate nohighlight">\(\text{SS}_\text{error} = \sum_i \sum_j (x_{ij} - \overline{x}_i)^2\)</span>. Recall the formula for the variance of a sample from the very early chapters, where <span class="math notranslate nohighlight">\(s^2 = \frac{\sum_{j}(x_j - \bar{x})^2}{n - 1}\)</span>. Notice the similarity between the numerator of the variance formula and the formula for SSW.</p>
<p>If we rearrange the variance formula to isolate the sum of squares, we get <span class="math notranslate nohighlight">\(\sum_{j}(x_j - \bar{x})^2 = (n - 1) s^2\)</span>. Then, we apply this to each group <span class="math notranslate nohighlight">\(i\)</span> in the ANOVA to get <span class="math notranslate nohighlight">\(\sum_{j=1}^{n_i}(x_{ij} - \overline{x}_i)^2 = (n_i - 1) s_i^2\)</span>.</p>
<p>Finally, we sum the sum of squares for each group <span class="math notranslate nohighlight">\(\text{SSW} = \text{SS}_\text{error} = \sum_i \sum_{j=1}^{n_i}(x_{ij} - \overline{x}_i)^2 = \sum_i (n_i - 1) s_i^2\)</span>.</p>
<p>Once we have the sums of squares, we can calculate the mean squares (MS) by dividing the sum of squares by the corresponding degrees of freedom. The F-statistic is then computed as the ratio of the mean squares (MS<sub>effect</sub> / MS<sub>error</sub>), and the P value can be obtained using the F-distribution.</p>
<p>Consider the ‘Pain threshold’ variable from the <code class="docutils literal notranslate"><span class="pre">ANOVA</span></code> dataset and the following group summary statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Hair color</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dark Blond</th>
      <td>51.2</td>
      <td>9.284396</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Dark Brunette</th>
      <td>37.4</td>
      <td>8.324662</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Light Blond</th>
      <td>59.2</td>
      <td>8.526429</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Light Brunette</th>
      <td>42.5</td>
      <td>5.446712</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="calculating-ssb">
<h4>Calculating SSB<a class="headerlink" href="#calculating-ssb" title="Link to this heading">#</a></h4>
<p>The SSB or SS<sub>effect</sub> quantifies the variability between the group means and the overall mean. It’s calculated as the sum of the squared differences between each group mean (<span class="math notranslate nohighlight">\(\overline{x}_i\)</span>) and the grand mean (<span class="math notranslate nohighlight">\(\overline{x}\)</span>), weighted by the number of data points in each group (<span class="math notranslate nohighlight">\(n_i\)</span>).</p>
<p>In this example, the grand mean (<span class="math notranslate nohighlight">\(\overline{x}\)</span>) is 47.842, as calculated previously.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Group</p></th>
<th class="head text-left"><p>Mean</p></th>
<th class="head text-left"><p>Grand mean</p></th>
<th class="head text-left"><p>Count</p></th>
<th class="head text-left"><p>Calculation of SSB</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Dark Blond</p></td>
<td class="text-left"><p>51.2</p></td>
<td class="text-left"><p>47.842</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>5 * (51.2 - 47.842)**2 = 56.38</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Dark Brunette</p></td>
<td class="text-left"><p>37.4</p></td>
<td class="text-left"><p>47.842</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>5 * (37.4 - 47.842)**2 = 545.18</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Light Blond</p></td>
<td class="text-left"><p>59.2</p></td>
<td class="text-left"><p>47.842</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>5 * (59.2 - 47.842)**2 = 645.02</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Light Brunette</p></td>
<td class="text-left"><p>42.5</p></td>
<td class="text-left"><p>47.842</p></td>
<td class="text-left"><p>4</p></td>
<td class="text-left"><p>4 * (42.5 - 47.842)**2 = 114.15</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><em>Sum</em></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p><strong>SSB =  1360.725</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p>We calculate the squared difference between each group mean and the grand mean, multiply it by the group size, and sum these values across all groups to obtain SSB = 1360.725.</p>
</section>
<section id="calculating-ssw">
<h4>Calculating SSW<a class="headerlink" href="#calculating-ssw" title="Link to this heading">#</a></h4>
<p>SSW or SS<sub>error</sub>, measures the variability within each group. It’s calculated as the sum of the squared differences between each data point and its group mean. When we don’t have access to the individual data points, we can still calculate SSW using the standard deviation of each group.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Group</p></th>
<th class="head text-left"><p>Standard deviation</p></th>
<th class="head text-left"><p>Count</p></th>
<th class="head text-left"><p>Calculation of SSW</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Dark Blond</p></td>
<td class="text-left"><p>9.284</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>(5 - 1) * 9.284**2 = 344.77</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Dark Brunette</p></td>
<td class="text-left"><p>8.325</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>(5 - 1) * 8.325**2 = 277.22</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Light Blond</p></td>
<td class="text-left"><p>8.526</p></td>
<td class="text-left"><p>5</p></td>
<td class="text-left"><p>(5 - 1) * 8.526**2 = 290.77</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Light Brunette</p></td>
<td class="text-left"><p>5.447</p></td>
<td class="text-left"><p>4</p></td>
<td class="text-left"><p>(4 - 1) * 5.447**2 = 89.01</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><em>Sum</em></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p><strong>SSW =  1001.77</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p>We calculate the SSW for each group using the formula <span class="math notranslate nohighlight">\((n_i - 1) s_i^2\)</span> and then sum these values to obtain the total SSW, which, in this case, is 1001.77. This matches the SSB and SSW values we calculated previously using the raw data, to the decimal approximation, confirming the accuracy of our approach. We can automatize this approach using Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the overall mean of &#39;Pain threshold&#39;</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grand mean = </span><span class="si">{</span><span class="n">grand_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Group by &#39;Hair color&#39; and calculate relevant statistics</span>
<span class="n">calc_table</span> <span class="o">=</span> <span class="n">data_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>

<span class="c1"># Calculate SSeffect and SSerror</span>
<span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;SSB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;SSW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">calc_table</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Add a sum row</span>
<span class="n">calc_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_table</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Display the table</span>
<span class="n">pg</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">calc_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s1">&#39;.4f&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The values to be used in the ANOVA table are: &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;SSB = </span><span class="si">{</span><span class="n">calc_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span><span class="s1">&#39;SSB&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, and &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;SSW = </span><span class="si">{</span><span class="n">calc_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span><span class="s1">&#39;SSW&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grand mean = 47.8421
Hair color        count      mean      std        SSB        SSW
--------------  -------  --------  -------  ---------  ---------
Dark Blond       5.0000   51.2000   9.2844    56.3773   344.8000
Dark Brunette    5.0000   37.4000   8.3247   545.1878   277.2000
Light Blond      5.0000   59.2000   8.5264   645.0089   290.8000
Light Brunette   4.0000   42.5000   5.4467   114.1524    89.0000
sum             19.0000  190.3000  31.5822  1360.7263  1001.8000

The values to be used in the ANOVA table are: SSB = 1360.7, and SSW = 1001.8
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualizing-the-f-distribution-and-critical-values">
<h3>Visualizing the F-distribution and critical values<a class="headerlink" href="#visualizing-the-f-distribution-and-critical-values" title="Link to this heading">#</a></h3>
<p>Visualizing the F-distribution can help us understand the meaning of the F-statistic and the P value. It also allows us to see how the critical F-value relates to our calculated F-statistic and the significance level (<span class="math notranslate nohighlight">\(\alpha\)</span>).</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> module in Python to plot the F-distribution and shade the areas corresponding to the P value and the <span class="math notranslate nohighlight">\(\alpha\)</span> level, as we did in earlier chapters on comparing models and in nonlinear regression. This visualization provides a clear picture of:</p>
<ul class="simple">
<li><p>The shape of the F-distribution for our specific degrees of freedom.</p></li>
<li><p>How extreme our observed F-statistic is under the null hypothesis.</p></li>
<li><p>The location of the critical F-value and its relationship to alpha.</p></li>
<li><p>The relationship between the p-value and the area under the curve beyond the F-statistic.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Significance level (alpha)</span>
<span class="n">α</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Calculate critical F-value</span>
<span class="n">f_crit</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">dfn</span><span class="o">=</span><span class="n">DF_between</span><span class="p">,</span> <span class="n">dfd</span><span class="o">=</span><span class="n">DF_within</span><span class="p">)</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>  <span class="c1"># Adjusted range for better visualization</span>
<span class="n">hx_f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">DF_between</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">hx_f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Critical value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_crit</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F* (</span><span class="si">{</span><span class="n">f_crit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Alpha area</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;α (</span><span class="si">{</span><span class="n">α</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># F-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_ratio</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F (</span><span class="si">{</span><span class="n">f_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># P value area</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span>
    <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P (</span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F-distribution (DFn=</span><span class="si">{</span><span class="n">DF_between</span><span class="si">}</span><span class="s2">, DFd=</span><span class="si">{</span><span class="n">DF_within</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4a24b673b0724499c31ef611812ff65ba579a80b6eb2eca1b119e5ae3f53c75.png" src="_images/a4a24b673b0724499c31ef611812ff65ba579a80b6eb2eca1b119e5ae3f53c75.png" />
</div>
</div>
</section>
</section>
<section id="practical-application-with-python">
<h2>Practical application with Python<a class="headerlink" href="#practical-application-with-python" title="Link to this heading">#</a></h2>
<p>Now that we’ve established the core mathematical concepts behind ANOVA, let’s move on to the practical application. In this section, we’ll explore how to perform ANOVA using Python, leveraging powerful libraries like Pingouin and statsmodels. We’ll start with one-way ANOVA and then delve into more complex designs.</p>
<section id="one-way-anova-with-pingouin">
<h3>One-way ANOVA with Pingouin<a class="headerlink" href="#one-way-anova-with-pingouin" title="Link to this heading">#</a></h3>
<p>As we have seen at multiple occasions in the previous chapters, the Pingouin library is a powerful and user-friendly Python package specifically designed for statistical analysis. It also provides a wide range of functions for conducting ANOVA, including <a class="reference external" href="https://pingouin-stats.org/build/html/guidelines.html#anova">one-way ANOVA, repeated-measures ANOVA, and mixed-design ANOVA</a>.</p>
<p>Let’s perform <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.anova.html">one-way ANOVA using Pingouin</a>.</p>
<p>Having loaded the <code class="docutils literal notranslate"><span class="pre">anova</span></code> dataset for the manual calculations, we are now ready to use it for one-way ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data_anova = pg.read_dataset(&#39;anova&#39;)</span>
<span class="c1"># data_anova.head()</span>
</pre></div>
</div>
</div>
</div>
<section id="normality-test">
<h4>Normality test<a class="headerlink" href="#normality-test" title="Link to this heading">#</a></h4>
<p>Before conducting ANOVA, it’s essential to check if the data within each group follows a normal distribution. This <em>normality assumption</em> is crucial because ANOVA is based on the assumption that the data are normally distributed within each group.</p>
<p>To test for normality, we can use various statistical tests and graphical methods, as discussed extensively throughout this book. One common approach is the Shapiro-Wilk test, which assesses whether the data deviates significantly from a normal distribution. Additionally, visual tools like histograms and Q-Q plots can provide insights into the data’s distribution and help identify potential departures from normality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                       W      pval  normal
Hair color                                
Light Blond     0.991032  0.983181    True
Dark Blond      0.939790  0.664457    True
Light Brunette  0.930607  0.597974    True
Dark Brunette   0.883214  0.324129    True
</pre></div>
</div>
</div>
</div>
<p>Here, it is satisfied for all groups. However, if normality were violated in other cases, transformations (e.g., logarithmic or square root) could be applied to attempt to normalize the data before performing ANOVA. If normalization is not possible, the Kruskal-Wallis test provides a non-parametric alternative.</p>
</section>
<section id="homoscedasticity">
<h4>Homoscedasticity<a class="headerlink" href="#homoscedasticity" title="Link to this heading">#</a></h4>
<p>Another crucial assumption of ANOVA is homogeneity of variances, also known as <em>homoscedasticity</em>. This assumption states that the variances of the groups being compared should be roughly equal.</p>
<p>To test for homogeneity of variances, we can use Levene’s test or Bartlett’s test, discussed previously. These tests assess whether there are significant differences in the variances of the groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               W      pval  equal_var
levene  0.392743  0.760016       True
</pre></div>
</div>
</div>
</div>
<p>Here, this assumption is also met. If, however, variances were unequal in other analyses, Welch’s ANOVA (discussed later in the chapter) which does not assume equal variances, would be employed. Transformations could also be considered in an attempt to achieve homoscedasticity.</p>
</section>
<section id="conducting-the-anova">
<h4>Conducting the ANOVA<a class="headerlink" href="#conducting-the-anova" title="Link to this heading">#</a></h4>
<p>Since the data meet the assumptions of normality and homoscedasticity, we can proceed with standard ANOVA. The <code class="docutils literal notranslate"><span class="pre">anova</span></code> function in Pingouin provides a convenient way to perform this analysis.</p>
<p>By setting the <code class="docutils literal notranslate"><span class="pre">detailed=True</span></code> argument, we can obtain a more comprehensive output that includes additional information beyond the basic ANOVA results. This detailed output can provide valuable insights into the data and the effects of the independent variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aov</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aov</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># Round the output to 3 decimal places for better readability</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       Source        SS  DF       MS      F  p-unc    np2
0  Hair color  1360.726   3  453.575  6.791  0.004  0.576
1      Within  1001.800  15   66.787    NaN    NaN    NaN
</pre></div>
</div>
</div>
</div>
<p>The output is a DataFrame containing the sums of squares (between groups = 1360.726, within groups = 1001.8), along with the corresponding degrees of freedom and mean squares. The F-statistic and its associated P value are also provided. These values are consistent with the manual calculations performed earlier. Notably, the DataFrame also includes effect size measures.</p>
<p>While Pingouin’s <code class="docutils literal notranslate"><span class="pre">anova</span></code> function can be used independently (<code class="docutils literal notranslate"><span class="pre">pg.anova</span></code>), it’s often more convenient to call it directly on a pandas DataFrame (<code class="docutils literal notranslate"><span class="pre">df.anova()</span></code>) when the data is already in that format.  or a more compact output, set <code class="docutils literal notranslate"><span class="pre">detailed=False</span></code>. The <code class="docutils literal notranslate"><span class="pre">effsize</span></code> argument controls the effect size measure; by default, partial eta-squared is reported, but setting <code class="docutils literal notranslate"><span class="pre">effsize='n2'</span></code> will return standard eta-squared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">effsize</span><span class="o">=</span><span class="s1">&#39;n2&#39;</span>
    <span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       Source  ddof1  ddof2         F     p-unc        n2
0  Hair color      3     15  6.791407  0.004114  0.575962
</pre></div>
</div>
</div>
</div>
<p>Calculating <span class="math notranslate nohighlight">\(\omega^2\)</span> requires manual application of the relevant formula (derived from the definition given previously).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formulas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">SSB</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">MS_within</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SST</span> <span class="o">+</span> <span class="n">MS_within</span><span class="p">),</span>  <span class="c1"># original formula defined in the introduction</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">DF_between</span> <span class="o">*</span> <span class="p">(</span><span class="n">MS_between</span> <span class="o">-</span> <span class="n">MS_within</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SST</span> <span class="o">+</span> <span class="n">MS_within</span><span class="p">),</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_ratio</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_ratio</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">N</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">formula</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">formulas</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ω² (formula </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">formula</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ω² (formula 1) = 0.47765205
ω² (formula 2) = 0.47765205
ω² (formula 3) = 0.47765205
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="one-way-anova-with-scipy-stats">
<h3>One-way ANOVA with scipy.stats<a class="headerlink" href="#one-way-anova-with-scipy-stats" title="Link to this heading">#</a></h3>
<p>While libraries like Pingouin offer convenient functions for conducting ANOVA, it’s also beneficial to understand how to perform ANOVA using the core statistical functions available in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>. The <a class="reference external" href="https://www.google.com/url?sa=E&amp;amp;source=gmail&amp;amp;q=%5Bhttps://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.f_oneway.html%5D(https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.f_oneway.html)"><code class="docutils literal notranslate"><span class="pre">f_oneway</span></code> function</a> in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> provides a straightforward way to conduct one-way ANOVA. The function takes one parameter, which is a list of sample groups. Each sample group represents the measurements for a particular group or condition in the experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">f_oneway</span>

<span class="c1"># Perform one-way ANOVA using scipy.stats</span>
<span class="n">hair_colors</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">color</span><span class="p">]</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">hair_colors</span><span class="p">]</span>
<span class="n">F_scipy</span><span class="p">,</span> <span class="n">p_scipy</span> <span class="o">=</span> <span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">)</span>

<span class="c1"># similar to </span>
<span class="c1"># F, p = f_oneway(</span>
<span class="c1">#     data[data[&#39;Hair color&#39;] == &#39;Dark Blond&#39;][&#39;Pain threshold&#39;],</span>
<span class="c1">#     data[data[&#39;Hair color&#39;] == &#39;Dark Brunette&#39;][&#39;Pain threshold&#39;],</span>
<span class="c1">#     data[data[&#39;Hair color&#39;] == &#39;Light Blond&#39;][&#39;Pain threshold&#39;],</span>
<span class="c1">#     data[data[&#39;Hair color&#39;] == &#39;Light Brunette&#39;][&#39;Pain threshold&#39;],</span>
<span class="c1"># )</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F statistic = </span><span class="si">{</span><span class="n">F_scipy</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> with P value from the F distribution = </span><span class="si">{</span><span class="n">p_scipy</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F statistic = 6.791 with P value from the F distribution = 0.00411
</pre></div>
</div>
</div>
</div>
</section>
<section id="one-way-anova-using-statsmodels">
<h3>One-way ANOVA using statsmodels<a class="headerlink" href="#one-way-anova-using-statsmodels" title="Link to this heading">#</a></h3>
<p>We can also perform ANOVA using the statsmodels library. It provides a comprehensive set of tools for statistical modeling, including a <a class="reference external" href="https://www.statsmodels.org/stable/anova.html">robust framework for ANOVA</a>. While Pingouin focuses on ease of use and <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> offers core statistical functions, statsmodels gives us more flexibility in specifying and fitting different ANOVA models.</p>
<p>One of the key advantages of statsmodels is its explicit link to regression analysis. As we discussed in previous chapters, ANOVA can be viewed as a special case of linear regression where the predictor variables are categorical. statsmodels allows us to leverage this connection by formulating ANOVA models using its formula API, which utilizes the Patsy library for formula parsing.</p>
<p>When using the statsmodels formula API, we need to ensure that variable names adhere to standard Python conventions. This means avoiding special characters like periods (<code class="docutils literal notranslate"><span class="pre">.</span></code>) or hyphens (<code class="docutils literal notranslate"><span class="pre">-</span></code>). If our dataset contains such characters in variable names, we can use Patsy’s <code class="docutils literal notranslate"><span class="pre">Q()</span></code> function to quote these names, ensuring they are interpreted correctly.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">C()</span></code> function in statsmodels is essential for specifying <em>categorical variables</em>, as it handles the grouping structure correctly. However, in our case, since the ‘Hair color’ variable already contains string values, statsmodels will automatically treat it as a categorical variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ols</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;Q(&#39;Pain threshold&#39;) ~ Q(&#39;Hair color&#39;)&quot;</span>

<span class="c1"># Prepare the one-way ANOVA model using statsmodels</span>
<span class="n">model_anova_statsmodels</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">results_anova_statsmodels</span> <span class="o">=</span> <span class="n">model_anova_statsmodels</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the model summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_anova_statsmodels</span><span class="o">.</span><span class="n">summary2</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                          Results: Ordinary least squares
===================================================================================
Model:                   OLS                      Adj. R-squared:          0.491   
Dependent Variable:      Q(&#39;Pain threshold&#39;)      AIC:                     137.2568
Date:                    2025-02-18 09:28         BIC:                     141.0346
No. Observations:        19                       Log-Likelihood:          -64.628 
Df Model:                3                        F-statistic:             6.791   
Df Residuals:            15                       Prob (F-statistic):      0.00411 
R-squared:               0.576                    Scale:                   66.787  
-----------------------------------------------------------------------------------
                                   Coef.   Std.Err.    t    P&gt;|t|   [0.025   0.975]
-----------------------------------------------------------------------------------
Intercept                          51.2000   3.6548 14.0091 0.0000  43.4100 58.9900
Q(&#39;Hair color&#39;)[T.Dark Brunette]  -13.8000   5.1686 -2.6700 0.0175 -24.8167 -2.7833
Q(&#39;Hair color&#39;)[T.Light Blond]      8.0000   5.1686  1.5478 0.1425  -3.0167 19.0167
Q(&#39;Hair color&#39;)[T.Light Brunette]  -8.7000   5.4822 -1.5870 0.1334 -20.3849  2.9849
-----------------------------------------------------------------------------------
Omnibus:                    1.137              Durbin-Watson:                 2.021
Prob(Omnibus):              0.566              Jarque-Bera (JB):              0.979
Skew:                       0.358              Prob(JB):                      0.613
Kurtosis:                   2.150              Condition No.:                 5    
===================================================================================
Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly
specified.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Sébastien\Documents\data_science\biostatistics\intuitive_biostatistics\.env\Lib\site-packages\scipy\stats\_axis_nan_policy.py:418: UserWarning: `kurtosistest` p-value may be inaccurate with fewer than 20 observations; only n=19 observations were given.
  return hypotest_fun_in(*args, **kwds)
</pre></div>
</div>
</div>
</div>
<p>Since our primary focus is on the ANOVA results and not the detailed OLS regression output, although we can determine the degrees of freedom, the F-statistics and the associated P value.</p>
<p>We can use the <a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.stats.anova.anova_lm.html"><code class="docutils literal notranslate"><span class="pre">anova_lm</span></code> function in statsmodels to directly obtain the ANOVA table</a>. This function takes the fitted OLS model as an argument and returns the ANOVA table, which summarizes the key information about the sources of variation, degrees of freedom, sums of squares, mean squares, F-statistic, and P value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.anova</span><span class="w"> </span><span class="kn">import</span> <span class="n">anova_lm</span>

<span class="c1"># Obtain the ANOVA table</span>
<span class="n">anova_table_statsmodels</span> <span class="o">=</span> <span class="n">anova_lm</span><span class="p">(</span><span class="n">results_anova_statsmodels</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_table_statsmodels</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># Print the rounded ANOVA table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                   df    sum_sq  mean_sq      F  PR(&gt;F)
Q(&#39;Hair color&#39;)   3.0  1360.726  453.575  6.791   0.004
Residual         15.0  1001.800   66.787    NaN     NaN
</pre></div>
</div>
</div>
</div>
<p>While we obtained similar results using Pingouin and <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>, statsmodels offers greater flexibility for more complex ANOVA designs, such as factorial ANOVA and ANCOVA, and allows us to specify models using R-like formulas. Additionally, statsmodels provides a deeper connection to regression analysis, enabling us to explore the relationships between variables in more detail.</p>
</section>
</section>
<section id="repeated-measures-anova">
<h2>Repeated measures ANOVA<a class="headerlink" href="#repeated-measures-anova" title="Link to this heading">#</a></h2>
<p>Repeated measures ANOVA (<strong>rmANOVA</strong>) is used when we have measurements that are repeatedly taken on the same subjects or entities. This design is common in many research fields, including biology, where we might track the growth of plants over time, measure the response of patients to a drug at multiple intervals, or observe the behavior of animals under different conditions.</p>
<p>Here are some scenarios where rmANOVA is appropriate:</p>
<ul class="simple">
<li><p>Measurements made repeatedly for each subject: we might measure the blood pressure of patients before, during, and after treatment.</p></li>
<li><p>Subjects recruited as matched sets: we might recruit pairs of twins and assign one twin to a treatment group and the other to a control group.</p></li>
<li><p>Experiment run several times: we might conduct an experiment multiple times, each time with different subjects, but under the same conditions.</p></li>
</ul>
<p>More generally, we should use a repeated measures test whenever we expect the measurements within a subject (or <em>matched set</em>) to be more similar to each other than to measurements from other subjects.</p>
<p><em>One-way rmANOVA</em> can be viewed as an extension of the paired-samples t-test, but for comparing the means of three or more levels of a within-subjects variable. rmANOVA designs can be more complex, for example, two-way rmANOVA is used to evaluate simultaneously the effect of two within-subject factors on a continuous outcome variable. In this section, we focus on one-way rmANOVA.</p>
<section id="partitioning-variance-in-rmanova">
<h3>Partitioning variance in rmANOVA<a class="headerlink" href="#partitioning-variance-in-rmanova" title="Link to this heading">#</a></h3>
<p>In one-way repeated measures ANOVA, the total variance is partitioned into three components:</p>
<ul>
<li><p><em>Sum of squares between (SSB) or SS<sub>effect</sub></em>: this is the variance explained by the factor of interest (e.g., time or treatment)</p></li>
<li><p><em>Sum of squares subjects (SSS) or SS<sub>subjects</sub></em>; this is the variance attributed to <em>individual differences</em> between subjects. This is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{SSS} = \text{SS}_\text{subjects} = r \sum_s (\overline{x}_s - \overline{x})^2\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the number of repeated measurements, <span class="math notranslate nohighlight">\(\overline{x}_s\)</span> is the mean for subject <em>s</em> <strong>across all measurements</strong>, and <span class="math notranslate nohighlight">\(\overline{x}\)</span> is the grand mean.</p>
</li>
<li><p><em>Sum of suares within (SSW) or SS<sub>error</sub></em>: this is the unexplained or residual variance, after accounting for the effect of the within-subjects factor and the individual differences between subjects.</p></li>
</ul>
<p>While the concept of partitioning variance is similar to standard ANOVA, the formulas for SS<sub>effect</sub> and SS<sub>error</sub> in repeated measures ANOVA are more complex and need to account for the within-subject correlations. We won’t delve into the exact formulas here, as they involve matrix operations.</p>
<p>However, we can still compute the total <em>sum of squares (SST)</em> using the universal formula <span class="math notranslate nohighlight">\(\text{SST} = \text{SS}_\text{total} = \sum_i \sum_j (x_{ij} - \overline{x})^2\)</span>. The sum of squares for the effect (SSB or SS<sub>effect</sub>) is determined on a group basis similar to standard ANOVA. We know that the total variation is partitioned as follows:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{total} = \text{SS}_\text{effect} + \text{SS}_\text{subjects} + \text{SS}_\text{error}
\]</div>
<p>or, using abbreviations <span class="math notranslate nohighlight">\(\text{SST} = \text{SSB} + \text{SSS} + \text{SSW}\)</span>. This partitioning allows us to calculate the remaining sum of squares (SSW or SS<sub>error</sub>) by subtracting SSS and SSB from SST, as we demonstrated in the previous calculations.</p>
</section>
<section id="calculating-the-f-statistic">
<h3>Calculating the F-statistic<a class="headerlink" href="#calculating-the-f-statistic" title="Link to this heading">#</a></h3>
<p>The F-statistic in rmANOVA is calculated as:</p>
<div class="math notranslate nohighlight">
\[
F = \frac{\text{MS}_\text{effect}}{\text{MS}_\text{error}} 
= \frac{\text{SS}_{\text{effect}} / (r - 1)}{\text{SS}_{\text{error}} / [(n - 1)(r - 1)]}
\]</div>
<p>Here, <em>r</em> is the number of repeated measurements (or levels of the factor) and <em>n</em> is the number of subjects.</p>
<p>The key difference lies in the denominator of the F-ratio. In standard ANOVA, the error degrees of freedom are calculated as <span class="math notranslate nohighlight">\(N - r\)</span>, while in rmANOVA, they are calculated as <span class="math notranslate nohighlight">\((n - 1)(r - 1)\)</span>. This difference reflects the fact that in rmANOVA, we are accounting for the individual differences between subjects, which <em>reduces</em> the error variance and can lead to increased power in detecting significant effects.</p>
<p>The P value can then be calculated using an F-distribution with <span class="math notranslate nohighlight">\((r - 1)\)</span> and <span class="math notranslate nohighlight">\((n - 1)(r - 1)\)</span> degrees of freedom.</p>
</section>
<section id="advantages-of-rmanova">
<h3>Advantages of rmANOVA<a class="headerlink" href="#advantages-of-rmanova" title="Link to this heading">#</a></h3>
<p>Repeated measures ANOVA offers several advantages over traditional one-way ANOVA:</p>
<ul class="simple">
<li><p><em>Increased power:</em> by accounting for individual differences between subjects, rmANOVA can be more powerful in detecting significant effects.</p></li>
<li><p><em>Reduced error variance:</em> the SS<sub>subjects</sub> term captures some of the variability that would otherwise be included in the error term, leading to a smaller error variance and increased power.</p></li>
<li><p><em>Efficiency:</em> fewer subjects are needed compared to an independent groups design to achieve the same level of power.</p></li>
</ul>
</section>
<section id="calculating-rmanova-manually">
<h3>Calculating rmANOVA Manually<a class="headerlink" href="#calculating-rmanova-manually" title="Link to this heading">#</a></h3>
<p>As we did for one-way ANOVA, we’ll now manually calculate the steps involved in repeated measures ANOVA. Let’s create a dataset where we measure the blood pressure of 15 patients before, during, and after treatment. This will allow us to assess how blood pressure changes over the course of the treatment using rmANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the DataFrame</span>
<span class="n">data_rmanova</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;before&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">165</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span>
    <span class="s1">&#39;during&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">145</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">137</span><span class="p">],</span>
    <span class="s1">&#39;after&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">140</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">133</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Add the case number as index</span>
<span class="n">data_rmanova</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span>

<span class="c1"># Display the DataFrame</span>
<span class="n">data_rmanova</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>before</th>
      <th>during</th>
      <th>after</th>
    </tr>
    <tr>
      <th>case</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>165</td>
      <td>145</td>
      <td>140</td>
    </tr>
    <tr>
      <th>1</th>
      <td>155</td>
      <td>139</td>
      <td>133</td>
    </tr>
    <tr>
      <th>2</th>
      <td>138</td>
      <td>141</td>
      <td>140</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150</td>
      <td>145</td>
      <td>145</td>
    </tr>
    <tr>
      <th>4</th>
      <td>149</td>
      <td>155</td>
      <td>149</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>When working with complex datasets for repeated measures ANOVA, it’s important to be mindful of potential issues like missing values and duplicated data. Different statistical software and packages might handle these issues differently, so it’s crucial to understand their specific data handling procedures.</p>
<p>For this demonstration, we’ll use a simplified dataset to focus on the core concepts of rmANOVA and the manual calculation of the sums of squares. However, we need to transform the dataset into a “long” format, where each row represents a single observation with a corresponding time point and blood pressure value. This format is often more suitable for certain types of analyses or visualizations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melt the DataFrame into long format</span>
<span class="c1"># after converting the index (&#39;Case&#39; numbers) into a regular column</span>
<span class="n">data_rmanova_long</span> <span class="o">=</span> <span class="n">data_rmanova</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>               <span class="c1"># Keep &#39;Case&#39; as identifier</span>
    <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>              <span class="c1"># Name of the new column for time points</span>
    <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>  <span class="c1"># Name of the new column for blood pressure values</span>
<span class="p">)</span>

<span class="n">data_rmanova_long</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>case</th>
      <th>time</th>
      <th>blood_pressure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>before</td>
      <td>165</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>before</td>
      <td>155</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>before</td>
      <td>138</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>before</td>
      <td>150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>before</td>
      <td>149</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;future.no_silent_downcasting&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Create the paired plot</span>
<span class="n">pg</span><span class="o">.</span><span class="n">plot_paired</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>
    <span class="n">boxplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
    <span class="c1"># boxplot_in_front=False,  # fix submitted via a PR</span>
    <span class="n">boxplot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>  <span class="c1"># not default in Pingouin anymore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ee726eca5c2b29fb98d256141510fd7bc6c1a8bdefdbfb88364f096e35c2a7e3.png" src="_images/ee726eca5c2b29fb98d256141510fd7bc6c1a8bdefdbfb88364f096e35c2a7e3.png" />
</div>
</div>
<p>The following table provides a structured overview of the calculations and components involved in rmANOVA, making it easier to understand and interpret the results:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Source of Variation</p></th>
<th class="head text-left"><p>Degrees of freedom</p></th>
<th class="head text-left"><p>Sum of squares</p></th>
<th class="head"><p>Mean square</p></th>
<th class="head"><p>F-ratio</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Treatment/Time point</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{B} = r - 1\)</span></p></td>
<td class="text-left"><p>SSB</p></td>
<td><p>MS<sub>effect</sub> = SSB / DF<sub>B</sub></p></td>
<td><p>MS<sub>effect</sub> / MS<sub>error</sub></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Subjects</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{S} = n - 1\)</span></p></td>
<td class="text-left"><p>SSS</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Residuals (error)</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{W} = (n-1)(r-1)\)</span></p></td>
<td class="text-left"><p>SSW</p></td>
<td><p>MS<sub>error</sub> = SSW / DF<sub>W</sub></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{T} = nr - 1\)</span></p></td>
<td class="text-left"><p>SST</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>By manually calculating these values, we gain a deeper understanding of the underlying calculations and how the ANOVA table is constructed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters of the analysis</span>
<span class="n">r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_rmanova_long</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Number of repeated measurements (time points)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_rmanova_long</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Number of subjects</span>
<span class="n">DF_effect</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span>             <span class="c1"># Degrees of freedom for the effect</span>
<span class="n">DF_subjects</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>           <span class="c1"># Degrees of freedom for subjects</span>
<span class="n">DF_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Degrees of freedom for error</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> repeated measurements and </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> subjects&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This leads to </span><span class="si">{</span><span class="n">DF_effect</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">DF_subjects</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">DF_error</span><span class="si">}</span><span class="s2"> degrees of freedom for the effect, subjects, and error, respectively&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 3 repeated measurements and 15 subjects
This leads to 2, 14, and 28 degrees of freedom for the effect, subjects, and error, respectively
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the overall mean of &#39;blood_pressure&#39;</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="n">data_rmanova_long</span><span class="p">[</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grand mean = </span><span class="si">{</span><span class="n">grand_mean</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Sums of squares</span>
<span class="c1"># SST (total sum of squares)</span>
<span class="n">SST</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_rmanova_long</span><span class="p">[</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># SSS (sum of squares for subjects)</span>
<span class="n">SSS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_rmanova_long</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">)[</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">]</span>
  <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># SSB (sum of squares between groups)</span>
<span class="n">SSB</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_rmanova_long</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">])[</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Calculate the mean for each Subject-Time combination</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>  <span class="c1"># Group by Time and calculate SSB</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># SSW (sum of squares within subjects)</span>
<span class="n">SSW</span> <span class="o">=</span> <span class="n">SST</span> <span class="o">-</span> <span class="n">SSS</span> <span class="o">-</span> <span class="n">SSB</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;With SST = </span><span class="si">{</span><span class="n">SST</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, SSW = </span><span class="si">{</span><span class="n">SSW</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, and SSB = </span><span class="si">{</span><span class="n">SSB</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, we obtain SSS = </span><span class="si">{</span><span class="n">SSS</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grand mean = 145.00
With SST = 4452.000, SSW = 1351.733, and SSB = 524.933, we obtain SSS = 2575.3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate Mean Squares</span>
<span class="n">MS_effect</span> <span class="o">=</span> <span class="n">SSB</span> <span class="o">/</span> <span class="n">DF_effect</span>
<span class="n">MS_error</span> <span class="o">=</span> <span class="n">SSW</span> <span class="o">/</span> <span class="n">DF_error</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS for effect = </span><span class="si">{</span><span class="n">MS_effect</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, and for error = </span><span class="si">{</span><span class="n">MS_error</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MS for effect = 262.4667, and for error = 48.2762
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate F-ratio and associated p-value</span>
<span class="n">f_ratio</span> <span class="o">=</span> <span class="n">MS_effect</span> <span class="o">/</span> <span class="n">MS_error</span>  <span class="c1"># Use the appropriate mean squares</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">f_ratio</span><span class="p">,</span> <span class="n">DF_effect</span><span class="p">,</span> <span class="n">DF_error</span><span class="p">)</span>  <span class="c1"># Use the correct degrees of freedom</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally, with an F ratio = </span><span class="si">{</span><span class="n">f_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, the associated P value = </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finally, with an F ratio = 5.4368, the associated P value = 0.01012
</pre></div>
</div>
</div>
</div>
<p>We’ve explored the key components of repeated measures analysis of variance: sums of squares (SST, SSB, SSS, SSW), degrees of freedom, and mean squares (MS<sub>effect</sub>, MS<sub>subjects</sub>, MS<sub>error</sub>). These elements come together in a structured way within the rmANOVA table. This table provides a framework for comparing a model that assumes no difference between the repeated measurements (our null hypothesis) to a model that allows for differences.</p>
<p>Here’s the rmANOVA table we constructed for our example analyzing the effect of time on blood pressure:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Source of variation</p></th>
<th class="head"><p>Sum of squares</p></th>
<th class="head"><p>DF</p></th>
<th class="head"><p>MS</p></th>
<th class="head"><p>F-ratio</p></th>
<th class="head"><p>P value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Effect/Time</p></td>
<td><p>524.93</p></td>
<td><p>2</p></td>
<td><p>262.47</p></td>
<td><p>5.4368</p></td>
<td><p>0.01012</p></td>
</tr>
<tr class="row-odd"><td><p>Subjects</p></td>
<td><p>2575.3</p></td>
<td><p>14</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>Error</p></td>
<td><p>1351.73</p></td>
<td><p>28</p></td>
<td><p>48.276</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>4452</p></td>
<td><p>44</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>The table partitions the total variation (SST) into the variation explained by differences between the time points (SSB or SS<sub>effect</sub>), the variation between subjects (SSS or SS<sub>subjects</sub>), and the unexplained variation within subjects (SSW or SS<sub>error</sub>). The degrees of freedom (DF) are shown for each source of variation. The mean squares (MS) are calculated by dividing the sum of squares by the corresponding degrees of freedom. The F-ratio, calculated as MS<sub>effect</sub> / MS<sub>error</sub>, compares the explained and unexplained variation, adjusted for their degrees of freedom. Finally, the P value helps us determine the statistical significance of the F-ratio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Significance level (alpha)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Calculate critical F-value</span>
<span class="n">f_crit</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">dfn</span><span class="o">=</span><span class="n">DF_effect</span><span class="p">,</span> <span class="n">dfd</span><span class="o">=</span><span class="n">DF_error</span><span class="p">)</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>

<span class="c1"># Generate x values for plotting</span>
<span class="n">x_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>  <span class="c1"># Adjusted range for better visualization</span>
<span class="n">hx_f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">DF_effect</span><span class="p">,</span> <span class="n">DF_error</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">hx_f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Critical value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_crit</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F* (</span><span class="si">{</span><span class="n">f_crit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Alpha area</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;α (</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># F-statistic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f_ratio</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F (</span><span class="si">{</span><span class="n">f_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># P value area</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span>
    <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P (</span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F-distribution (DFn=</span><span class="si">{</span><span class="n">DF_effect</span><span class="si">}</span><span class="s2">, DFd=</span><span class="si">{</span><span class="n">DF_error</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/99121afacaadb6bcd46ce720fd07c8089cb059a013e3461f21263bc5122ed11d.png" src="_images/99121afacaadb6bcd46ce720fd07c8089cb059a013e3461f21263bc5122ed11d.png" />
</div>
</div>
<p>If the null hypothesis were true (i.e., if there were no differences between the means of the blood pressure measurements at different time points), we would expect the MS<sub>effect</sub> and MS<sub>error</sub> values to be similar, resulting in an F-ratio close to 1.0. However, in our example, the F-ratio is 5.437, suggesting that the differences between time points explain significantly more variation than would be expected by chance. This small P value (0.010) provides strong evidence against the null hypothesis, leading us to conclude that there are significant differences in blood pressure between at least two of the time points.</p>
</section>
<section id="repeated-measures-anova-using-python">
<h3>Repeated measures ANOVA using Python<a class="headerlink" href="#repeated-measures-anova-using-python" title="Link to this heading">#</a></h3>
<p>Now that we have a better understanding of the underlying principles of rmANOVA, we’ll explore how to conduct this analysis using Python. We’ll leverage two powerful libraries, Pingouin and statsmodels, to perform the calculations and interpret the results.</p>
<p>We’ll use the <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.rm_anova.html"><code class="docutils literal notranslate"><span class="pre">rm_anova</span></code> function in Pingouin</a> and the <a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.stats.anova.AnovaRM.html"><code class="docutils literal notranslate"><span class="pre">AnovaRM</span></code> function in statsmodels</a> to streamline the analysis.</p>
<section id="rmanova-using-pingouin">
<h4>rmANOVA using Pingouin<a class="headerlink" href="#rmanova-using-pingouin" title="Link to this heading">#</a></h4>
<p>Before we start the rmANOVA analysis, we should check some important assumptions:</p>
<ul class="simple">
<li><p>Normality: rmANOVA assumes that the residuals (the differences between the observed values and the predicted values) are normally distributed.</p></li>
<li><p>Homoscedasticity: rmANOVA assumes that the variances of the differences between all pairs of within-subjects conditions are equal.</p></li>
</ul>
<p>We’ve discussed these assumptions in the context of standard ANOVA, and they apply to rmANOVA as well.</p>
<p>Another important assumption in rmANOVA is <strong>sphericity</strong>. This assumption states that the variances of the differences between all possible pairs of within-subjects conditions are equal. We can test this assumption using Mauchly’s test of sphericity.</p>
<p>Violation of the sphericity assumption can lead to an inflated Type I error rate (false positives) and an invalid F-value. If the P value from Mauchly’s test exceeds 0.05, we can conclude that the data meets the assumption of sphericity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test for sphericity</span>
<span class="n">spher_results</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">sphericity</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span>
<span class="p">)</span>

<span class="c1"># Print the sphericity test results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spher_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SpherResults(spher=True, W=0.8533042981018584, chi2=2.0623077334263207, dof=2, pval=0.35659525969062833)
</pre></div>
</div>
</div>
</div>
<p>In our example, the sphericity assumption is met, as indicated by a Mauchly’s W value of 0.853, a χ² statistic of 2.06, and a P value of 0.357, which is significantly greater than 0.05. This means we can proceed with the rmANOVA analysis without concerns about violating the sphericity assumption.</p>
<p>However, it’s worth noting that in situations where the sphericity assumption is violated, corrections like the Greenhouse-Geisser or Huynh-Feldt correction can be applied. These corrections adjust the degrees of freedom to account for the violation of sphericity and provide a more accurate p-value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform rmANOVA with automatic sphericity correction</span>
<span class="n">aov_rm</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span><span class="p">,</span>
    <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">effsize</span><span class="o">=</span><span class="s2">&quot;ng2&quot;</span><span class="p">,</span>  <span class="c1"># Use generalized eta-squared as effect size</span>
    <span class="n">correction</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>  <span class="c1"># Automatically apply sphericity correction if needed</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aov_rm</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Source         SS  DF        MS       F   p-unc     ng2     eps
0   time   524.9333   2  262.4667  5.4368  0.0101  0.1179  0.8721
1  Error  1351.7333  28   48.2762     NaN     NaN     NaN     NaN
</pre></div>
</div>
</div>
</div>
<p>The results indicate a statistically significant effect of ‘time’ on ‘blood_pressure’ with <span class="math notranslate nohighlight">\(F(2, 28) = 5.4368\)</span>, <span class="math notranslate nohighlight">\(P = 0.0101\)</span>, and <span class="math notranslate nohighlight">\(\eta^2_g = 0.1179\)</span>. This means that there is a significant difference in the ‘blood_pressure’ ratings across the different ‘time’ points. The generalized eta-squared value of 0.1179 suggests that approximately 11.8% of the variance in ‘blood_pressure’ is explained by the ‘time’ factor.</p>
</section>
<section id="repeated-measures-anova-using-statsmodels">
<h4>Repeated measures ANOVA using statsmodels<a class="headerlink" href="#repeated-measures-anova-using-statsmodels" title="Link to this heading">#</a></h4>
<p>We can also perform repeated measures ANOVA (rmANOVA) using the statsmodels library, which offers more flexibility for specifying and fitting different ANOVA models, especially for complex designs.</p>
<p>We cannot directly use OLS for rmANOVA because it doesn’t account for the within-subject correlations that are inherent in repeated measures designs. Using <code class="docutils literal notranslate"><span class="pre">ols</span></code> would be like treating the repeated measurements as independent observations, which would violate the assumptions of the model and lead to inaccurate results. Therefore, for rmANOVA, it’s more appropriate to use specialized functions or classes like <code class="docutils literal notranslate"><span class="pre">AnovaRM</span></code> in statsmodels or <code class="docutils literal notranslate"><span class="pre">rm_anova</span></code> in Pingouin. These functions are specifically designed to handle the within-subject correlations and provide accurate results for repeated measures designs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.anova</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnovaRM</span>

<span class="c1"># Perform rmANOVA using AnovaRM</span>
<span class="n">model_anova_rm_statsmodels</span> <span class="o">=</span> <span class="n">AnovaRM</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span><span class="p">,</span>
    <span class="n">depvar</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># results_anova_rm_statsmodels = model_anova_rm_statsmodels.fit()</span>

<span class="c1"># # Print the ANOVA table</span>
<span class="c1"># print(results_anova_rm_statsmodels.anova_table)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_anova_rm_statsmodels</span><span class="o">.</span><span class="n">fit</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Anova
==================================
     F Value Num DF  Den DF Pr &gt; F
----------------------------------
time  5.4368 2.0000 28.0000 0.0101
==================================
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="non-parametric-methods">
<h2>Non-parametric methods<a class="headerlink" href="#non-parametric-methods" title="Link to this heading">#</a></h2>
<p>In previous chapters, we explored non-parametric alternatives to t-tests and correlation analysis. Similarly, when the assumptions of ANOVA (or rmANOVA) are not met, such as normality or homogeneity of variances, we can turn to <strong>non-parametric methods</strong>. These methods offer more flexibility and are less sensitive to the underlying distribution of the data.</p>
<p>We’ll focus on how to perform these tests in Python using the SciPy and Pingouin libraries and interpret the results. While we won’t delve into the mathematical details of these tests to keep the chapter concise, we’ll highlight their key advantages and limitations.</p>
<section id="kruskal-wallis-test">
<h3>Kruskal-Wallis test<a class="headerlink" href="#kruskal-wallis-test" title="Link to this heading">#</a></h3>
<p>The Kruskal-Wallis test is a non-parametric alternative to the <em>one-way ANOVA</em>. It is used to compare the <strong>medians</strong> of three or more groups when the assumptions of ANOVA, such as normality and homogeneity of variances, are not met.</p>
<p>Here’s how the Kruskal-Wallis test works:</p>
<ol class="arabic simple">
<li><p><em>Rank the data</em>: all the data points from all groups are combined and ranked from lowest to highest, regardless of their group membership.</p></li>
<li><p><em>Calculate the rank sum for each group</em>: the ranks of the data points within each group are summed to obtain the rank sum for that group.</p></li>
<li><p><em>Calculate the test statistic (H)</em>: the H statistic is calculated based on the rank sums and the sample sizes of the groups. It measures the variability between the rank sums, indicating how different the group medians are.</p></li>
<li><p><em>Determine the P value</em>: the P value is calculated using the chi-squared distribution with degrees of freedom equal to the number of groups minus 1. It represents the probability of obtaining an H statistic as extreme as the one calculated, assuming that the null hypothesis is true (i.e., all group medians are equal).</p></li>
</ol>
<section id="kruskal-wallis-test-using-pingouin">
<h4>Kruskal-Wallis test using Pingouin<a class="headerlink" href="#kruskal-wallis-test-using-pingouin" title="Link to this heading">#</a></h4>
<p>We can perform the Kruskal-Wallis test using the Pingouin library, which offers a <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.kruskal.html">dedicated function called <code class="docutils literal notranslate"><span class="pre">kruskal</span></code></a>. This function provides a more user-friendly interface and returns a comprehensive output that includes the test statistic, P value, and degrees of freedom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform the Kruskal-Wallis test using Pingouin</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>             Source  ddof1         H     p-unc
Kruskal  Hair color      3  10.58863  0.014172
</pre></div>
</div>
</div>
</div>
<p>The Kruskal-Wallis H statistic measures the overall difference between the group medians. A larger H statistic indicates a greater difference between the groups. In this case, H = 10.58863. Since the P value (0.014172) is less than the conventional significance level of 0.05, we reject the null hypothesis. This means that there is a statistically significant difference between the medians of at least two of the hair color groups in terms of their pain thresholds.</p>
<p>The Kruskal-Wallis test does not rely on the assumption of normality or homogeneity of variances, making it more robust for data that does not meet these assumptions. It can be used for <em>ordinal data</em>, where the data points represent ranks or ordered categories. But it can also be used with <em>small sample sizes</em>, like in the current example, where the normality assumption is generally difficult to assess.</p>
<p>However, it may be less powerful than ANOVA when the normality and homoscedasticity assumptions are met. It only tests for differences between medians, not means, and while it doesn’t assume normality, it still assumes that the groups have <em>similar shapes of distributions</em>.</p>
</section>
<section id="kruskal-wallis-test-using-scipy">
<h4>Kruskal-Wallis test using SciPy<a class="headerlink" href="#kruskal-wallis-test-using-scipy" title="Link to this heading">#</a></h4>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> module to easily compute the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kruskal.html">Kruskal-Wallis test statistic and its associated P value</a>. This function is easy to use and provides a straightforward way to perform the test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">kruskal</span>

<span class="c1"># Perform one-way ANOVA using scipy.stats</span>
<span class="n">hair_colors</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">color</span><span class="p">]</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">hair_colors</span>
<span class="p">]</span>

<span class="c1"># Perform the Kruskal-Wallis test</span>
<span class="n">kruskal</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KruskalResult(statistic=10.588630377524153, pvalue=0.014171563303136805)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="friedman-s-test">
<h3>Friedman’s test<a class="headerlink" href="#friedman-s-test" title="Link to this heading">#</a></h3>
<p>Friedman’s test is a non-parametric alternative to repeated measures one-way ANOVA. It is used to compare the medians of three or more repeated measurements within subjects when the assumptions of rmANOVA, such as normality and sphericity, are not met. Here is how Friedman’s test works:</p>
<ol class="arabic simple">
<li><p><em>Rank the data</em>: for each subject, the repeated measurements are ranked from lowest to highest.</p></li>
<li><p><em>Calculate the rank sum for each group</em>: the ranks for each within-subject condition (e.g., time point, treatment) are summed across all subjects.</p></li>
<li><p><em>Calculate the test statistic (Q)</em>: the Q statistic is calculated based on the rank sums and the sample sizes. It measures the variability between the rank sums, indicating how different the group medians are.</p></li>
<li><p><em>Determine the P value</em>: the P value is calculated using the chi-squared distribution with degrees of freedom equal to the number of within-subject conditions minus 1. It represents the probability of obtaining a Q statistic as extreme as the one calculated, assuming that the null hypothesis is true (i.e., all group medians are equal).</p></li>
</ol>
<p>Like the Kruskal-Wallis test, Friedman’s test does not rely on the assumption of normality or sphericity, making it more robust for data that does not meet these assumptions. It can be also used for <em>ordinal data</em>, where the data points represent ranks or ordered categories, and it can be used with <em>small sample sizes</em>, where the normality assumption is difficult to assess.</p>
<p>Just like the Kruskal-Wallis test, the Friedman’s test has some limitations. It may be less powerful than rmANOVA when the normality and sphericity assumptions are met. Furtheremoire, it only tests for differences between medians, not means. And while it doesn’t assume normality, it still assumes that the distributions of the within-subject conditions have similar shapes.</p>
<section id="friedman-s-test-using-pingouin">
<h4>Friedman’s test using Pingouin<a class="headerlink" href="#friedman-s-test-using-pingouin" title="Link to this heading">#</a></h4>
<p>We can also perform Friedman’s test using <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.friedman.html">Pingouin’s <code class="docutils literal notranslate"><span class="pre">friedman</span></code> function</a>, just as easily as we did for the Kruskal-Wallis test, rmANOVA, and standard ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Friedman&#39;s test</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">friedman</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span><span class="p">,</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         Source         W  ddof1         Q     p-unc
Friedman   time  0.330994      2  9.929825  0.006979
</pre></div>
</div>
</div>
</div>
<p>The Friedman test typically uses a Q statistic, which asymptotically follows a chi-squared distribution, for hypothesis testing. However, the chi-squared test can be overly conservative for small sample sizes and repeated measures. As an alternative, we can use an F test, which has better properties for smaller samples and behaves like a permutation test with lower computational cost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Friedman&#39;s test with F-test</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">friedman</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_rmanova_long</span><span class="p">,</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;blood_pressure&#39;</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;case&#39;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;f&#39;</span>  <span class="c1"># Use the F-test</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         Source         W     ddof1      ddof2         F     p-unc
Friedman   time  0.330994  1.866667  26.133333  6.926573  0.004503
</pre></div>
</div>
</div>
</div>
<p>Using both the chi-squared and F-test methods in the Friedman test, we find that the P value is far below 0.01. This confirms that there is a statistically significant difference between the medians of at least two of the repeated measurements.</p>
</section>
<section id="friedman-s-test-using-scipy">
<h4>Friedman’s test using SciPy<a class="headerlink" href="#friedman-s-test-using-scipy" title="Link to this heading">#</a></h4>
<p>Finally, we can use the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> module to obtain the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.friedmanchisquare.html">results and P value from Friedman’s test</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">friedmanchisquare</span>

<span class="c1"># Extract the data for each time point</span>
<span class="n">before</span> <span class="o">=</span> <span class="n">data_rmanova</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">]</span>
<span class="n">during</span> <span class="o">=</span> <span class="n">data_rmanova</span><span class="p">[</span><span class="s1">&#39;during&#39;</span><span class="p">]</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">data_rmanova</span><span class="p">[</span><span class="s1">&#39;after&#39;</span><span class="p">]</span>

<span class="c1"># Perform Friedman&#39;s test</span>
<span class="n">friedmanchisquare</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">during</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FriedmanchisquareResult(statistic=9.929824561403514, pvalue=0.00697856283688688)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="two-way-anova">
<h2>Two-way ANOVA<a class="headerlink" href="#two-way-anova" title="Link to this heading">#</a></h2>
<section id="example-of-two-way-anova">
<h3>Example of two-way ANOVA<a class="headerlink" href="#example-of-two-way-anova" title="Link to this heading">#</a></h3>
<p><strong>Two-way ANOVA</strong> is a statistical technique used to analyze the effects of two independent variables on a dependent variable. It’s also known as two-factor ANOVA.</p>
<p>In a two-way ANOVA, the data are divided into two ways because each data point is classified according to two factors. For example, imagine a study where participants are randomly assigned to two different treatment groups (active or inactive) and then measured at two different time points (short duration or long duration). In this case, each data point would be categorized by both the treatment group and the time point.</p>
<p>Two-way ANOVA simultaneously tests three null hypotheses:</p>
<ol class="arabic simple">
<li><p><em>No interaction between the two factors</em>: this means that the effect of one factor (e.g., treatment) is the same across all levels of the other factor (e.g., duration). In other words, there is no interaction between treatment and duration.</p></li>
<li><p><em>No main effect of the first factor</em>: this means that the population means are identical across all levels of the first factor (e.g., treatment), regardless of the level of the second factor (e.g., duration).</p></li>
<li><p><em>No main effect of the second factor</em>: this means that the population means are identical across all levels of the second factor (e.g., duration), regardless of the level of the first factor (e.g., treatment).</p></li>
</ol>
<p>In this section, we’ll delve into the manual calculation of two-way ANOVA using another Pingouin’s dataset, exploring the impact of different fertilizer formulations on crop yields. <a class="reference external" href="https://real-statistics.com/two-way-anova/two-factor-anova-with-replication/">As detailed elsewhere</a>, the study investigates a new fertilizer designed to increase crop yields. The makers of the fertilizer want to identify the most effective formulation (‘Blend’) for various ‘Crop’, including wheat, corn, soybeans, and rice. They test two different blends on a sample of five plots for each of the four crop types.</p>
<p>Our goal is to manually calculate the two-way ANOVA to understand the effects of the fertilizer blend and crop type on the yield, as well as their potential interaction. This hands-on approach will provide a deeper understanding of the underlying calculations and principles of two-way ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the &#39;anova2&#39; dataset</span>
<span class="n">data_two_way_anova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;anova2&#39;</span><span class="p">)</span>

<span class="c1"># Display a sample of the DataFrame</span>
<span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ss</th>
      <th>Blend</th>
      <th>Crop</th>
      <th>Yield</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>Blend Y</td>
      <td>Wheat</td>
      <td>135</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>Blend X</td>
      <td>Soy</td>
      <td>166</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>Blend X</td>
      <td>Corn</td>
      <td>174</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>Blend Y</td>
      <td>Wheat</td>
      <td>176</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>Blend Y</td>
      <td>Soy</td>
      <td>159</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>Blend Y</td>
      <td>Corn</td>
      <td>132</td>
    </tr>
    <tr>
      <th>21</th>
      <td>22</td>
      <td>Blend Y</td>
      <td>Soy</td>
      <td>145</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The data is currently in long format, but we can also represent it in a different way using <code class="docutils literal notranslate"><span class="pre">unstack</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="s1">&#39;Blend&#39;</span><span class="p">,</span> <span class="s1">&#39;Ss&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">## &#39;Ss&#39; is the unique identifier</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="3" halign="left">Yield</th>
    </tr>
    <tr>
      <th></th>
      <th>Crop</th>
      <th>Corn</th>
      <th>Soy</th>
      <th>Wheat</th>
    </tr>
    <tr>
      <th>Blend</th>
      <th>Ss</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="12" valign="top">Blend X</th>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>123.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>156.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>112.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>128.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>150.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>174.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>116.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>166.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>178.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NaN</td>
      <td>187.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>NaN</td>
      <td>153.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="12" valign="top">Blend Y</th>
      <th>13</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>135.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>130.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>176.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>120.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>175.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18</th>
      <td>132.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>19</th>
      <td>120.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>20</th>
      <td>187.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>21</th>
      <td>NaN</td>
      <td>140.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>22</th>
      <td>NaN</td>
      <td>145.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>23</th>
      <td>NaN</td>
      <td>159.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>NaN</td>
      <td>131.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Yield&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_two_way_anova</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Blend&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Overlay the stripplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Yield&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_two_way_anova</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Blend&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Separate points for each &#39;Blend&#39; within &#39;Crop&#39;</span>
    <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;dark:black&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Interaction plot between Crop and Blend&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/321961be3144b857dbbaeec30203d97130b9ae77d6818690e2ecc0a248a8c31d.png" src="_images/321961be3144b857dbbaeec30203d97130b9ae77d6818690e2ecc0a248a8c31d.png" />
</div>
</div>
</section>
<section id="how-two-way-anova-works">
<h3>How two-way ANOVA works<a class="headerlink" href="#how-two-way-anova-works" title="Link to this heading">#</a></h3>
<p>Two-way ANOVA involves partitioning the total variation in the dependent variable into four components:</p>
<ol class="arabic simple">
<li><p><strong>Interaction effect <span class="math notranslate nohighlight">\(\text{SS}_\text{AXB}\)</span>:</strong> this component measures the extent to which the effect of one factor depends on the level of the other factor.</p></li>
<li><p><strong>Between-rows variation <span class="math notranslate nohighlight">\(\text{SS}_\text{A}\)</span>:</strong> this component measures the variation between the different levels of the <em>first factor</em> (e.g., the difference between the mean scores of the active and inactive treatment groups).</p></li>
<li><p><strong>Between-columns variation <span class="math notranslate nohighlight">\(\text{SS}_\text{B}\)</span>:</strong> this component measures the variation between the different levels of the <em>second factor</em> (e.g., the difference between the mean scores for the short and long duration groups).</p></li>
<li><p><strong>Residuals or within-cells variation SSW or <span class="math notranslate nohighlight">\(\text{SS}_\text{within}\)</span>:</strong> this component measures the variation within each cell of the design (i.e., within each combination of the two factors).</p></li>
</ol>
<p>The total variation <strong>SST</strong> or SS<subs>total</sub> is calculated as the sum of these four components:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{total} = \text{SS}_\text{A} + \text{SS}_\text{B} + \text{SS}_{\text{A} \times \text{B}} + \text{SS}_\text{within}
\]</div>
<p>Similar to repeated measures ANOVA, the formulas for SSA, SSB, SSAB, and SSW in two-way ANOVA are more complex than in standard one-way ANOVA. They need to account for the effects of both factors and their interaction. We won’t delve into the exact formulas here, as they can be quite involved.</p>
<p>However, we can still compute the total sum of squares (SST) using the universal formula:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{total} = \sum_k \sum_j \sum_i (x_{ijk} - \overline{x})^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_{ijk}\)</span> is the individual data point for the <span class="math notranslate nohighlight">\(k\)</span> th observation in the <span class="math notranslate nohighlight">\(j\)</span> th level of Factor B and the <span class="math notranslate nohighlight">\(i\)</span> th level of Factor A.</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar{x}\)</span> is the grand mean of all the data.</p></li>
</ul>
<p>Then, the sum of squares for the first factor / factor A can be writen as:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{A} =  m \times c \sum_i (\overline{x}_{i} - \overline{x})^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m\)</span> is the number of observations per cell (assuming equal cell sizes).</p></li>
<li><p><span class="math notranslate nohighlight">\(c\)</span> is the number of levels of Factor B, or <em>columns</em> in a <span class="math notranslate nohighlight">\(r \times c\)</span> structure table.</p></li>
<li><p><span class="math notranslate nohighlight">\(\overline{x}_{i}\)</span> is the mean of the <span class="math notranslate nohighlight">\(i\)</span> th level of Factor A, across all levels of Factor B, i.e., the mean of <span class="math notranslate nohighlight">\(\{x_{ijk}: 1 \le j \le c, 1 \le k \le m\}\)</span>.</p></li>
</ul>
<p><em>Important note - If the sample sizes <span class="math notranslate nohighlight">\(m\)</span> for the different combinations of factors (cells) are unequal, we have an <strong>unbalanced design</strong>. In such cases, the traditional approach for calculating sums of squares might not be appropriate. Instead, we can use a regression-based approach, e.g., using statsmodels, to perform the two-way ANOVA, as <a class="reference external" href="https://real-statistics.com/multiple-regression/anova-using-regression/">described elsewhere</a>. This approach is more flexible and can handle unbalanced designs effectively. Pingouin can take care of unbalanced designs and will automatically analyze the data via statsmodels (discussed later in the chapter).</em></p>
<p>Similarly, the sum of squares for the second factor / factor B equals:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{B} = m \times r \sum_j (\overline{x}_{j} - \overline{x})^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the number of levels of Factor A, or <em>rows</em> in a <span class="math notranslate nohighlight">\(r \times c\)</span> structure table.</p></li>
<li><p><span class="math notranslate nohighlight">\(\overline{x}_{j}\)</span> is the mean of the <span class="math notranslate nohighlight">\(j\)</span> th level of Factor B, across all levels of Factor A, i.e., the mean of <span class="math notranslate nohighlight">\(\{x_{ijk}: 1 \le j \le r, 1 \le k \le m\}\)</span>.</p></li>
</ul>
<p>Finally, the sum of squares for the <em>interaction</em> equals:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{AxB} = m \sum_j \sum_i (\overline{x}_{ij} - \overline{x}_{i} - \overline{x}_{j} + \overline{x})^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\overline{x}_{ij}\)</span> is the mean of the cell corresponding to the <span class="math notranslate nohighlight">\(i\)</span> th level of Factor A and the <span class="math notranslate nohighlight">\(j\)</span> th level of Factor B.</p></li>
</ul>
<p>The formula of the sum of squares error (SSW, SS<sub>within</sub> or SS<sub>error</sub>) is:</p>
<div class="math notranslate nohighlight">
\[
\text{SS}_\text{W} = \sum_k \sum_j \sum_i (x_{ijk} - \overline{x}_{ij})^2
\]</div>
<p>This partitioning allows us to calculate it by subtracting all the effect sums of squares from SST, as we demonstrated in the previous calculations.</p>
</section>
<section id="manual-calculation-of-two-way-anova">
<h3>Manual calculation of two-way ANOVA<a class="headerlink" href="#manual-calculation-of-two-way-anova" title="Link to this heading">#</a></h3>
<p>To test the null hypotheses, we calculate the F-ratio for each effect by dividing the mean square (SS divided by degrees of freedom) for the <em>effect</em> by the mean square for the <em>within-cells</em> variation. The F-ratio represents the ratio of the explained variance to the unexplained variance. The associated P value indicates the probability of obtaining an F-ratio as extreme or more extreme than the one observed, assuming the null hypothesis is true.</p>
<p>The table below outlines the partitioning of variance in a two-way ANOVA, including the main effects of each factor, their interaction, and the within-cell error. It also shows the corresponding degrees of freedom, mean squares, and F-ratios used to test the significance of each effect.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Source of variation</p></th>
<th class="head text-left"><p>Sum of squares</p></th>
<th class="head text-left"><p>Degrees of freedom</p></th>
<th class="head text-left"><p>Mean square</p></th>
<th class="head text-left"><p>F-ratio</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Factor A (e.g., Crop)</p></td>
<td class="text-left"><p>SS<sub>A</sub></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{A} = r - 1\)</span></p></td>
<td class="text-left"><p>MS<sub>A</sub> = SS<sub>A</sub> / DF<sub>A</sub></p></td>
<td class="text-left"><p>MS<sub>A</sub> / MS<sub>W</sub></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Factor B (e.g., Blend)</p></td>
<td class="text-left"><p>SS<sub>B</sub></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{B} = c - 1\)</span></p></td>
<td class="text-left"><p>MS<sub>B</sub> = SS<sub>B</sub> / DF<sub>B</sub></p></td>
<td class="text-left"><p>MS<sub>B</sub> / MS<sub>W</sub></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Interaction (AxB)</p></td>
<td class="text-left"><p>SS<sub>AxB</sub></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{AxB} = (r-1)(c-1)\)</span></p></td>
<td class="text-left"><p>MS<sub>AxB</sub> = SS<sub>AxB</sub> / DF<sub>AxB</sub></p></td>
<td class="text-left"><p>MS<sub>AxB</sub> / MS<sub>W</sub></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Within (Error)</p></td>
<td class="text-left"><p>SSW</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{W} = n - rc\)</span></p></td>
<td class="text-left"><p>MS<sub>W</sub> = SSW / DF<sub>W</sub></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p>SST</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\text{DF}_\text{T} = n - 1\)</span></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Where:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the number of levels of Factor A</p></li>
<li><p><span class="math notranslate nohighlight">\(c\)</span> is the number of levels of Factor B</p></li>
<li><p><span class="math notranslate nohighlight">\(m\)</span> is the number of observations per cell (assuming equal cell sizes)</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the total number of observations, i.e., <span class="math notranslate nohighlight">\(n = m \times r \times c\)</span></p></li>
</ul>
<p>To calculate the sums of squares for the two-way ANOVA, we first need to compute some key components:</p>
<ul class="simple">
<li><p>The grand mean of the ‘Yield’ variable.</p></li>
<li><p>The mean ‘Yield’ for each level of the ‘Crop’ factor (across all levels of ‘Blend’).</p></li>
<li><p>The mean ‘Yield’ for each level of the ‘Blend’ factor (across all levels of ‘Crop’).</p></li>
<li><p>The mean ‘Yield’ for each combination of ‘Crop’ and ‘Blend’ (i.e., each cell in the design).</p></li>
<li><p>The number of observations per cell.</p></li>
<li><p>The number of levels of the ‘Crop’ factor.</p></li>
<li><p>The number of levels of the ‘Blend’ factor.</p></li>
</ul>
<p>We can easily calculate these components directly from the DataFrame using pandas functions, i.e., through the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the grand mean of &#39;Yield&#39;</span>
<span class="n">grand_mean_two_way_anova</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grand mean for the two-way ANOVA = </span><span class="si">{</span><span class="n">grand_mean_two_way_anova</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the number of observations per cell using pivot_table</span>
<span class="n">n_cell</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Blend&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Yield&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of observations per cell:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_cell</span><span class="p">)</span>

<span class="c1"># Store the number of observations per cell</span>
<span class="n">n_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_cell</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="c1"># type: ignore</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of observations per cell: m = </span><span class="si">{</span><span class="n">n_cells</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grand mean for the two-way ANOVA = 145.54

Number of observations per cell:
Blend  Blend X  Blend Y
Crop                   
Corn         4        4
Soy          4        4
Wheat        4        4

Number of observations per cell: m = 4
</pre></div>
</div>
</div>
</div>
<p>To calculate the sum of squares for the ‘Crop’ factor SS<sub>A</sub>, we’ll use the formula for the main effect of Factor A in two-way ANOVA. This formula calculates the <em>weighted sum</em> of squared deviations of each <em>crop’s mean</em> ‘Yield’ from the <em>grand mean</em>, where the weights are the number of observations for each crop, as determined in the previous snippet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean and count of Yield for each Crop</span>
<span class="n">data_two_way_anova_crop</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Crop&#39;</span><span class="p">)[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary statistics for Yield by Crop:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_two_way_anova_crop</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Calculate SSB for Crop</span>
<span class="n">n_crop</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Crop&#39;</span><span class="p">)[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Mean count per crop</span>
<span class="n">SS_crop</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean</span> <span class="o">-</span> <span class="n">grand_mean_two_way_anova</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">mean</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">data_two_way_anova_crop</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># SS_crop = 8 * (147.75 - 145.54)**2 + 8 * (157.375 - 145.54)**2 + 8 * (131.5 - 145.54)**2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SS for Crop: SSA = </span><span class="si">{</span><span class="n">SS_crop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Number of levels and degrees of freedom for Crop factor</span>
<span class="n">n_levels_crop</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Crop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">DF_crop</span> <span class="o">=</span> <span class="n">n_levels_crop</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of levels for Crop factor: r = </span><span class="si">{</span><span class="n">n_levels_crop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of freedom for Crop factor: DFA = </span><span class="si">{</span><span class="n">DF_crop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary statistics for Yield by Crop:
         mean  count
Crop                
Corn   147.75      8
Soy    157.38      8
Wheat  131.50      8

SS for Crop: SSA = 2736.583

Number of levels for Crop factor: r = 3
Degrees of freedom for Crop factor: DFA = 2
</pre></div>
</div>
</div>
</div>
<p>Similarly, to calculate the sum of squares for the ‘Blend’ factor SS<sub>B</sub>, we’ll use the formula for the main effect of Factor B in two-way ANOVA. This formula is similar to the one for SS<sub>A</sub>, but it calculates the <em>weighted sum</em> of squared deviations of each <em>blend’s mean</em> ‘Yield’ from the grand mean, where the weights are the number of observations for each blend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean and count of Yield for each Blend</span>
<span class="n">data_two_way_anova_blend</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Blend&#39;</span><span class="p">)[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Summary statistics for Yield by Blend:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_two_way_anova_blend</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Calculate SSB for Blend</span>
<span class="n">n_blend</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Blend&#39;</span><span class="p">)[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Mean count per blend</span>
<span class="n">SS_blend</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean</span> <span class="o">-</span> <span class="n">grand_mean_two_way_anova</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">mean</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">data_two_way_anova_blend</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># SS_blend = 12 * (145.25 - 145.54)**2 + 12 * (145.83 - 145.54)**2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SS for Blend: SSB = </span><span class="si">{</span><span class="n">SS_blend</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Number of levels and degrees of freedom for Blend factor</span>
<span class="n">n_levels_blend</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Blend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">DF_blend</span> <span class="o">=</span> <span class="n">n_levels_blend</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of levels for Blend factor: c = </span><span class="si">{</span><span class="n">n_levels_blend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of freedom for Blend factor: DFB = </span><span class="si">{</span><span class="n">DF_blend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary statistics for Yield by Blend:
           mean  count
Blend                 
Blend X  145.25     12
Blend Y  145.83     12

SS for Blend: SSB = 2.042

Number of levels for Blend factor: c = 2
Degrees of freedom for Blend factor: DFB = 1
</pre></div>
</div>
</div>
</div>
<p>Finally, to calculate the sum of squares for the interaction between ‘Crop’ and ‘Blend’ SS<sub>AxB</sub>, we’ll use the formula for the interaction effect in two-way ANOVA. This formula calculates the <em>weighted sum</em> of squared deviations of <em>each cell’s mean</em> ‘Yield’ from what would be expected if there were no interaction between the two factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the mean &#39;Yield&#39; for each combination of &#39;Crop&#39; and &#39;Blend&#39;</span>
<span class="n">cell_means</span> <span class="o">=</span> <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="s1">&#39;Blend&#39;</span><span class="p">])[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Calculate the sum of squares for the interaction (SSAB)</span>
<span class="c1"># Initialize the sum of squares for the interaction (SSAB)</span>
<span class="n">SS_interaction</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Loop through each unique value of &#39;Crop&#39;</span>
<span class="k">for</span> <span class="n">crop</span> <span class="ow">in</span> <span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Crop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="c1"># Loop through each unique value of &#39;Blend&#39;</span>
    <span class="k">for</span> <span class="n">blend</span> <span class="ow">in</span> <span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Blend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="c1"># Get the mean &#39;Yield&#39; for the current combination of &#39;Crop&#39; and &#39;Blend&#39;</span>
        <span class="n">mean_crop_blend</span> <span class="o">=</span> <span class="n">cell_means</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">crop</span><span class="p">,</span> <span class="n">blend</span><span class="p">)]</span>
        <span class="c1"># Get the mean &#39;Yield&#39; for the current &#39;Crop&#39;</span>
        <span class="n">mean_crop</span> <span class="o">=</span> <span class="n">data_two_way_anova_crop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">crop</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
        <span class="c1"># Get the mean &#39;Yield&#39; for the current &#39;Blend&#39;</span>
        <span class="n">mean_blend</span> <span class="o">=</span> <span class="n">data_two_way_anova_blend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">blend</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
        <span class="c1"># Add the weighted squared deviation to SS_interaction</span>
        <span class="n">SS_interaction</span> <span class="o">+=</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_crop_blend</span> <span class="o">-</span> <span class="n">mean_crop</span> <span class="o">-</span> <span class="n">mean_blend</span> <span class="o">+</span> <span class="n">grand_mean_two_way_anova</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SS for interaction: SSAxB = </span><span class="si">{</span><span class="n">SS_interaction</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Degrees of freedom for interaction</span>
<span class="n">DF_interaction</span> <span class="o">=</span> <span class="n">DF_crop</span> <span class="o">*</span><span class="n">DF_blend</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Degrees of freedom for interaction: DFAxB = </span><span class="si">{</span><span class="n">DF_interaction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SS for interaction: SSAxB = 2360.083

Degrees of freedom for interaction: DFAxB = 2
</pre></div>
</div>
</div>
</div>
<p>To calculate the total sum of squares (SST), we’ll use the same universal formula that applies to one-way ANOVA and repeated measures ANOVA. This formula calculates the sum of squared deviations of <em>each data point</em> from the <em>grand mean</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SST (total sum of squares)</span>
<span class="n">SST_anova2</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_two_way_anova</span><span class="p">[</span><span class="s1">&#39;Yield&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">grand_mean_two_way_anova</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SST = </span><span class="si">{</span><span class="n">SST_anova2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Total number of samples and degrees of freedom for total variation</span>
<span class="n">n_total_anova2</span> <span class="o">=</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="n">n_levels_crop</span> <span class="o">*</span> <span class="n">n_levels_blend</span>
<span class="c1"># n_total = len(data_two_way_anova)</span>
<span class="n">DF_total_anova2</span> <span class="o">=</span> <span class="n">n_total_anova2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total number of samples: n = </span><span class="si">{</span><span class="n">n_total_anova2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of freedom for total variation: DFT = </span><span class="si">{</span><span class="n">DF_total_anova2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SST = 14851.958

Total number of samples: n = 24
Degrees of freedom for total variation: DFT = 23
</pre></div>
</div>
</div>
</div>
<p>We can calculate SSE by summing the squared differences between each data point and its corresponding <em>cell mean</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate SSE from scratch</span>
<span class="n">SSE_anova2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_two_way_anova</span>                   <span class="c1"># Start with the DataFrame</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="s1">&#39;Blend&#39;</span><span class="p">])</span>          <span class="c1"># Group the data by &#39;Crop&#39; and &#39;Blend&#39;</span>
    <span class="o">.</span><span class="n">Yield</span>                               <span class="c1"># Select the &#39;Yield&#39; column, equivalent to `[&#39;Yield]`</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Calculate squared deviations from the group mean</span>
    <span class="o">.</span><span class="n">sum</span><span class="p">()</span>                               <span class="c1"># Sum the squared deviations to get SSE</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSE calculated from scratch = </span><span class="si">{</span><span class="n">SSE_anova2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Degrees of freedom for error/residuals</span>
<span class="n">DF_within_anova2</span> <span class="o">=</span> <span class="n">n_total_anova2</span> <span class="o">-</span> <span class="n">n_levels_crop</span> <span class="o">*</span> <span class="n">n_levels_blend</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Degrees of freedom for error/residuals: DFW = </span><span class="si">{</span><span class="n">DF_within_anova2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SSE calculated from scratch = 9753.250

Degrees of freedom for error/residuals: DFW = 18
</pre></div>
</div>
</div>
</div>
<p>We can also calculate SSE by subtracting the sum of squares for the other factors (SSA, SSB, and SSAxB) from the total sum of squares (SST).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate SSE by subtracting other SS from SST</span>
<span class="n">SSE_substraction_anova2</span> <span class="o">=</span> <span class="n">SST_anova2</span> <span class="o">-</span> <span class="n">SS_crop</span> <span class="o">-</span> <span class="n">SS_blend</span> <span class="o">-</span> <span class="n">SS_interaction</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSE calculated by subtraction = </span><span class="si">{</span><span class="n">SSE_substraction_anova2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Degrees of freedom for error from substraction</span>
<span class="n">DF_within_substraction_anova2</span> <span class="o">=</span> <span class="n">DF_total_anova2</span> <span class="o">-</span> <span class="n">DF_blend</span> <span class="o">-</span> <span class="n">DF_crop</span> <span class="o">-</span> <span class="n">DF_interaction</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Degrees of freedom for error (from substraction): DFW = </span><span class="si">{</span><span class="n">DF_within_substraction_anova2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SSE calculated by subtraction = 9753.250

Degrees of freedom for error (from substraction): DFW = 18
</pre></div>
</div>
</div>
</div>
<p>We now have all the values necessary to calculate the mean squares and F-ratios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean squares</span>
<span class="n">MS_crop</span> <span class="o">=</span> <span class="n">SS_crop</span> <span class="o">/</span> <span class="n">DF_crop</span>
<span class="n">MS_blend</span> <span class="o">=</span> <span class="n">SS_blend</span> <span class="o">/</span> <span class="n">DF_blend</span>
<span class="n">MS_interaction</span> <span class="o">=</span> <span class="n">SS_interaction</span> <span class="o">/</span> <span class="n">DF_interaction</span>
<span class="n">MS_within_anova2</span> <span class="o">=</span> <span class="n">SSE_anova2</span> <span class="o">/</span> <span class="n">DF_within_anova2</span>

<span class="c1"># Calculate F-ratios</span>
<span class="n">F_crop</span> <span class="o">=</span> <span class="n">MS_crop</span> <span class="o">/</span> <span class="n">MS_within_anova2</span>
<span class="n">F_blend</span> <span class="o">=</span> <span class="n">MS_blend</span> <span class="o">/</span> <span class="n">MS_within_anova2</span>
<span class="n">F_interaction</span> <span class="o">=</span> <span class="n">MS_interaction</span> <span class="o">/</span> <span class="n">MS_within_anova2</span>

<span class="c1"># Print the mean squares</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS for Crop = </span><span class="si">{</span><span class="n">MS_crop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS for Blend = </span><span class="si">{</span><span class="n">MS_blend</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS for Interaction = </span><span class="si">{</span><span class="n">MS_interaction</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MS error/within = </span><span class="si">{</span><span class="n">MS_within_anova2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print the F-ratios</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">F-ratio for Crop = </span><span class="si">{</span><span class="n">F_crop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F-ratio for Blend = </span><span class="si">{</span><span class="n">F_blend</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F-ratio for interaction = </span><span class="si">{</span><span class="n">F_interaction</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MS for Crop = 1368.292
MS for Blend = 2.042
MS for Interaction = 1180.042
MS error/within = 541.847

F-ratio for Crop = 2.525
F-ratio for Blend = 0.004
F-ratio for interaction = 2.178
</pre></div>
</div>
</div>
</div>
<p>We determine the P values for each factor and the interaction using the F-distribution, just as we did in one-way ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate P values</span>
<span class="n">p_value_crop</span>        <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">F_crop</span><span class="p">,</span> <span class="n">DF_crop</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>
<span class="n">p_value_blend</span>       <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">F_blend</span><span class="p">,</span> <span class="n">DF_blend</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>
<span class="n">p_value_interaction</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">F_interaction</span><span class="p">,</span> <span class="n">DF_interaction</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>

<span class="c1"># Print the P values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for Crop: </span><span class="si">{</span><span class="n">p_value_crop</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for Blend: </span><span class="si">{</span><span class="n">p_value_blend</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P value for interaction: </span><span class="si">{</span><span class="n">p_value_interaction</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P value for Crop: 0.1134
P value for Blend: 0.9519
P value for interaction: 0.1478
</pre></div>
</div>
</div>
</div>
<p>We can now fill the ANOVA table as follows:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Source of variation</p></th>
<th class="head text-left"><p>SS</p></th>
<th class="head text-left"><p>DF</p></th>
<th class="head text-left"><p>MS</p></th>
<th class="head text-left"><p>F-ratio</p></th>
<th class="head text-left"><p>P values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Factor A - Crop</p></td>
<td class="text-left"><p>2736.583</p></td>
<td class="text-left"><p>2</p></td>
<td class="text-left"><p>1368.292</p></td>
<td class="text-left"><p>2.525</p></td>
<td class="text-left"><p>0.1080</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Factor B - Blend</p></td>
<td class="text-left"><p>2.042</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>2.042</p></td>
<td class="text-left"><p>0.004</p></td>
<td class="text-left"><p>0.9517</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Interaction</p></td>
<td class="text-left"><p>2360.083</p></td>
<td class="text-left"><p>2</p></td>
<td class="text-left"><p>1180.042</p></td>
<td class="text-left"><p>2.178</p></td>
<td class="text-left"><p>0.1422</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Error/Within</p></td>
<td class="text-left"><p>9753.250</p></td>
<td class="text-left"><p>18</p></td>
<td class="text-left"><p>541.847</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p>14851.958</p></td>
<td class="text-left"><p>23</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>To interpret the results of a two-way ANOVA, we focus on the P values. If a P value is less than our significance level (typically 0.05), we reject the null hypothesis and conclude that there is a significant effect for the corresponding source of variation.</p>
<p>In this table, none of the P values are less than 0.05. This indicates that there are no statistically significant main effects of ‘Crop’ or ‘Blend’, nor a significant interaction effect between them. In other words, neither the type of crop nor the type of blend, nor their combination, has a significant impact on the yield.</p>
<p>In the case of an effective interaction between the two parameters, we would have observed non-parallel lines on the previous plot, indicating that the effect of one factor depends on the level of the other factor. This is because parallel lines suggest that the effect of one factor (e.g., ‘Blend’) is the same across all levels of the other factor (e.g., ‘Crop’), implying <em>no interaction</em>. On the other hand, non-parallel lines, or lines that cross or diverge, suggest the presence of an interaction effect. This means that the effect of one factor depends on the level of the other factor.</p>
<p>While we calculated the sums of squares and mean squares, these values are not as informative in this case since the effects are not significant. However, it’s worth noting that the largest sum of squares is associated with the ‘Crop’ factor, suggesting that there might be some differences between crops, although these differences are not statistically significant.</p>
<p>Overall, based on this two-way ANOVA analysis, we can conclude that neither the type of crop nor the type of blend, nor their interaction, has a significant effect on the yield.</p>
</section>
<section id="visualizing-f-ratios-and-p-values-in-two-way-anova">
<h3>Visualizing F-ratios and P values in two-way ANOVA<a class="headerlink" href="#visualizing-f-ratios-and-p-values-in-two-way-anova" title="Link to this heading">#</a></h3>
<p>We can gain a deeper understanding of the two-way ANOVA results by visualizing the F-distributions, critical values, F-ratios, and P values for each source of variation. This visualization will provide a clear picture of the statistical significance of each effect and the overall relationships between the factors and the dependent variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Significance level (alpha)</span>
<span class="n">α</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Function to plot F-distribution with critical values and p-value</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_f_distribution</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">f_ratio</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">f_crit</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">dfn</span><span class="o">=</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="o">=</span><span class="n">DF_within</span><span class="p">)</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>  <span class="c1"># dfd is always DF_within</span>
    <span class="n">x_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">hx_f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">DF_within</span><span class="p">)</span>  <span class="c1"># dfd is always DF_within</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_f</span><span class="p">,</span> <span class="n">hx_f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_crit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orangered&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F* (</span><span class="si">{</span><span class="n">f_crit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span> <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_crit</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;α (</span><span class="si">{</span><span class="n">α</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_ratio</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;limegreen&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;F (</span><span class="si">{</span><span class="n">f_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span> <span class="n">hx_f</span><span class="p">[</span><span class="n">x_f</span> <span class="o">&gt;=</span> <span class="n">f_ratio</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P (</span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> (DFn=</span><span class="si">{</span><span class="n">dfn</span><span class="si">}</span><span class="s2">, DFd=</span><span class="si">{</span><span class="n">DF_within</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># List of parameters</span>
<span class="n">F_plot_crop</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Crop&quot;</span><span class="p">,</span> <span class="n">DF_crop</span><span class="p">,</span> <span class="n">F_crop</span><span class="p">,</span> <span class="n">p_value_crop</span><span class="p">)</span>
<span class="n">F_plot_blend</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Blend&quot;</span><span class="p">,</span> <span class="n">DF_blend</span><span class="p">,</span> <span class="n">F_blend</span><span class="p">,</span> <span class="n">p_value_blend</span><span class="p">)</span>
<span class="n">F_plot_interaction</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;interaction&quot;</span><span class="p">,</span> <span class="n">DF_interaction</span><span class="p">,</span> <span class="n">F_interaction</span><span class="p">,</span> <span class="n">p_value_interaction</span><span class="p">)</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Loop through sources of variation and plot F-distributions</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">f_ratio</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">F_plot_crop</span><span class="p">,</span> <span class="n">F_plot_blend</span><span class="p">,</span> <span class="n">F_plot_interaction</span><span class="p">)):</span>
    <span class="n">plot_f_distribution</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">f_ratio</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b2beebe8e3b4df3c88164847fbfaa025b9067d0c96b78668f61bae0bd9504dd6.png" src="_images/b2beebe8e3b4df3c88164847fbfaa025b9067d0c96b78668f61bae0bd9504dd6.png" />
</div>
</div>
</section>
<section id="two-way-anova-using-python">
<h3>Two-way ANOVA using Python<a class="headerlink" href="#two-way-anova-using-python" title="Link to this heading">#</a></h3>
<p>Now that we’ve manually calculated the sums of squares and other components of the two-way ANOVA, let’s explore how to perform this analysis more efficiently using Python libraries. We’ll use the same dataset and variables as in the previous section, but we’ll leverage the Pingouin and statsmodels libraries to streamline the process. We’ll avoid the complexities of manual calculations and leverage the efficiency of these libraries, while concentrating on interpreting the results and drawing meaningful conclusions from the data.</p>
<section id="two-way-anova-with-pingouin">
<h4>Two-way ANOVA with Pingouin<a class="headerlink" href="#two-way-anova-with-pingouin" title="Link to this heading">#</a></h4>
<p>We can use the same <code class="docutils literal notranslate"><span class="pre">anova</span></code> function in Pingouin for two-way ANOVA, as it allows us to compute the sums of squares for multiple between-subject factors by specifying a list of column names instead of a single string to the <code class="docutils literal notranslate"><span class="pre">between</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform two-way ANOVA using Pingouin</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">data_two_way_anova</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Yield&#39;</span><span class="p">,</span>
        <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Crop&#39;</span><span class="p">,</span> <span class="s1">&#39;Blend&#39;</span><span class="p">],</span>
        <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         Source        SS  DF        MS      F  p-unc    np2
0          Crop  2736.583   2  1368.292  2.525  0.108  0.219
1         Blend     2.042   1     2.042  0.004  0.952  0.000
2  Crop * Blend  2360.083   2  1180.042  2.178  0.142  0.195
3      Residual  9753.250  18   541.847    NaN    NaN    NaN
</pre></div>
</div>
</div>
</div>
</section>
<section id="two-way-anova-with-statsmodels">
<h4>Two-way ANOVA with statsmodels<a class="headerlink" href="#two-way-anova-with-statsmodels" title="Link to this heading">#</a></h4>
<p>We can use the same method as in one-way ANOVA with statsmodels, this time specifying both ‘Crop’ and ‘Blend’ as categorical variables, as well as their interaction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;Yield ~ C(Crop)*C(Blend)&quot;</span>
<span class="c1"># formula = &quot;Yield ~ C(Crop) + C(Blend) + C(Crop):C(Blend)&quot;  # equivalent to the formula above</span>

<span class="c1"># Prepare the one-way ANOVA model using statsmodels</span>
<span class="n">model_two_way_anova_statsmodels</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_two_way_anova</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">results_two_way_anova_statsmodels</span> <span class="o">=</span> <span class="n">model_two_way_anova_statsmodels</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the ANOVA table</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_two_way_anova_statsmodels</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                    df       sum_sq      mean_sq         F    PR(&gt;F)
C(Crop)            2.0  2736.583333  1368.291667  2.525235  0.107978
C(Blend)           1.0     2.041667     2.041667  0.003768  0.951730
C(Crop):C(Blend)   2.0  2360.083333  1180.041667  2.177813  0.142223
Residual          18.0  9753.250000   541.847222       NaN       NaN
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="unbalanced-design-in-two-way-anova">
<h3>Unbalanced design in two-way ANOVA<a class="headerlink" href="#unbalanced-design-in-two-way-anova" title="Link to this heading">#</a></h3>
<p>In a balanced two-way ANOVA, all cells (combinations of factors) have the same number of samples. However, in an unbalanced design, the sample sizes may vary across different cells. When dealing with unbalanced designs, the traditional formulas for calculating sums of squares and F-statistics in two-way ANOVA may not be appropriate. This is because these formulas assume equal cell sizes.</p>
<p>To handle unbalanced designs in two-way ANOVA, we can use a more general approach based on regression. This approach involves fitting a linear model that includes the factors, their interactions, and any covariates, and then extracting the relevant statistics from the model. Although the model fitting and interpretation can be slightly more complex in some cases, it can handle unbalanced designs, missing data, and more complex factor structures.</p>
<p>In Pingouin, unbalanced designs are automatically recognized, and the program analyzes the data using a regression-based approach with statsmodels. Let’s analyze the data from <a class="reference external" href="https://onlinestatbook.com/2/analysis_of_variance/unequal.html">Diet and exercise impact as presented elsewhere</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the &#39;anova2_unbalanced&#39; dataset</span>
<span class="n">data_unbalanced</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;anova2_unbalanced&#39;</span><span class="p">)</span>
<span class="n">data_unbalanced</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ss</th>
      <th>Diet</th>
      <th>Exercise</th>
      <th>Scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Low</td>
      <td>Moderate</td>
      <td>-20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Low</td>
      <td>Moderate</td>
      <td>-25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>Low</td>
      <td>Moderate</td>
      <td>-30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>Low</td>
      <td>Moderate</td>
      <td>-35</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6</td>
      <td>Low</td>
      <td>High</td>
      <td>-20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the number of observations per cell using pivot_table</span>
<span class="n">data_unbalanced</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Diet&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Exercise&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Exercise</th>
      <th>High</th>
      <th>Moderate</th>
    </tr>
    <tr>
      <th>Diet</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>High</th>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Diet&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_unbalanced</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Exercise&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Overlay the stripplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Diet&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_unbalanced</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Exercise&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;dark:black&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Interaction plot between Diet and Exercise&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/04650b3a2280a5952d79dd725999892ff1abbab8c71266a205756af74591c97d.png" src="_images/04650b3a2280a5952d79dd725999892ff1abbab8c71266a205756af74591c97d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform two-way ANOVA</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">data_unbalanced</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
        <span class="n">dv</span><span class="o">=</span><span class="s2">&quot;Scores&quot;</span><span class="p">,</span>
        <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Diet&quot;</span><span class="p">,</span> <span class="s2">&quot;Exercise&quot;</span><span class="p">],</span>
        <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># default True for N-way ANOVA</span>
        <span class="n">ss_type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># default</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            Source       SS   DF       MS      F  p-unc    np2
0             Diet  390.625  1.0  390.625  7.423  0.034  0.553
1         Exercise  180.625  1.0  180.625  3.432  0.113  0.364
2  Diet * Exercise   15.625  1.0   15.625  0.297  0.605  0.047
3         Residual  315.750  6.0   52.625    NaN    NaN    NaN
</pre></div>
</div>
</div>
</div>
<p>When dealing with unbalanced ANOVA designs, the choice between Type I, Type II, and Type III sums of squares (SS) can significantly impact the interpretation of results:</p>
<ol class="arabic simple">
<li><p><strong>Type I SS (Sequential)</strong> are calculated sequentially, meaning the SS for each factor is calculated after accounting for the effects of any previously entered factors in the model. The SS for a factor represents the unique contribution of that factor <em>after</em> accounting for the effects of prior factors. Type I SS is generally appropriate when there is a clear order of priority among the factors, and we want to test the effects of each factor after controlling for the effects of previous factors.</p></li>
<li><p><strong>Type II SS (Hierarchical)</strong> are calculated hierarchically, meaning the SS for each factor is calculated after accounting for the effects of all other factors at the same or lower level in the model hierarchy. The SS for a factor represents the contribution of that factor <em>above and beyond</em> the effects of other factors at the same or lower level. Type II SS is suitable when there is a meaningful hierarchy among the factors, and we want to test the effects of each factor within its level in the hierarchy.</p></li>
<li><p><strong>Type III SS (Marginal)</strong> are calculated marginally, meaning the SS for each factor is calculated after accounting for the effects of all other factors in the model, regardless of their order or hierarchy. The SS for a factor represents the contribution of that factor <em>ignoring</em> the effects of all other factors. Type III SS is appropriate when there is no clear order or hierarchy among the factors, and we want to test the effects of each factor independently of the others.</p></li>
</ol>
<p>The choice of SS type depends on the specific research question and the nature of the factors. For example, if there is a clear order or priority among the factors, Type I SS might be appropriate. Otherwise, ff there is a meaningful hierarchy among the factors, Type II SS might be suitable. Finally, if there is no clear order or hierarchy, and we want to test the effects of each factor independently, Type III SS might be the best choice.</p>
<p>Different statistical software packages may have different default SS types. The Pingouin library uses Type II sums of squares by default for ANOVA calculations. This choice is automatically made when we use the <code class="docutils literal notranslate"><span class="pre">anova</span></code> function without specifying the <code class="docutils literal notranslate"><span class="pre">ss_type</span></code> argument. In balanced designs, where all cells have equal sample sizes, the different types of sums of squares (Type I, II, and III) yield the same results, so the default choice of Type II has no impact. It’s essential to be aware of the default and choose the appropriate type based on your research question. The interpretation of the results should always be based on the chosen SS type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_unbalanced_anova_statsmodels</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;Scores ~ Diet*Exercise&quot;</span><span class="p">,</span>  <span class="c1"># Notice that Diet and Exercise are of type string ~ readily categories</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_unbalanced</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the ANOVA table with type I SS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_unbalanced_anova_statsmodels</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                df    sum_sq   mean_sq          F    PR(&gt;F)
Diet           1.0  1210.000  1210.000  22.992874  0.003016
Exercise       1.0   180.625   180.625   3.432304  0.113373
Diet:Exercise  1.0    15.625    15.625   0.296912  0.605470
Residual       6.0   315.750    52.625        NaN       NaN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the ANOVA table with type II SS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_unbalanced_anova_statsmodels</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                sum_sq   df         F    PR(&gt;F)
Diet           390.625  1.0  7.422803  0.034437
Exercise       180.625  1.0  3.432304  0.113373
Diet:Exercise   15.625  1.0  0.296912  0.605470
Residual       315.750  6.0       NaN       NaN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the ANOVA table with type III SS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_unbalanced_anova_statsmodels</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                sum_sq   df         F    PR(&gt;F)
Intercept        6.250  1.0  0.118765  0.742136
Diet           281.250  1.0  5.344418  0.060120
Exercise       151.250  1.0  2.874109  0.140947
Diet:Exercise   15.625  1.0  0.296912  0.605470
Residual       315.750  6.0       NaN       NaN
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="special-designs">
<h2>Special designs<a class="headerlink" href="#special-designs" title="Link to this heading">#</a></h2>
<p>We’ve explored the fundamental concepts and applications of one-way ANOVA, repeated measures ANOVA, their non-parametric counterparts, and two-way ANOVA. Now, let’s delve into some special designs that extend these basic principles to address more complex research questions. These designs offer powerful tools for analyzing a wide range of research scenarios, allowing us to gain deeper insights into complex relationships between variables. We’ll focus on the practical aspects of obtaining and interpreting the results, without delving too deeply into the underlying mathematical details.</p>
<section id="mixed-design-anova">
<h3>Mixed-design ANOVA<a class="headerlink" href="#mixed-design-anova" title="Link to this heading">#</a></h3>
<p>Mixed-design ANOVA is a powerful statistical technique used to analyze data that <em>combines elements of between-subjects and within-subjects designs</em>. In simpler terms, it allows us to examine the effects of both independent variables that vary between subjects (e.g., different treatment groups) and independent variables that vary within subjects (e.g., repeated measurements over time).</p>
<p>This type of design is frequently employed in research where we want to assess the effects of an intervention or treatment while also considering individual differences between subjects. For example, we might be interested in studying the effects of a new drug on blood pressure, but we also want to account for variations in blood pressure due to factors like age, gender, or pre-existing conditions.</p>
<p>In a mixed-design ANOVA, one factor is a between-subjects variable, and another factor is a within-subjects variable. This allows us to examine both the main effects of each factor and the interaction between the two factors. The interaction effect is particularly important as it tells us whether the effect of one factor depends on the level of the other factor.</p>
<p>We’ll use a toy dataset of memory scores collected from two groups at three time points. This dataset, available in the Pingouin library, will allow us to demonstrate the application of mixed-design ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the &#39;mixed_anova&#39; dataset</span>
<span class="n">data_mixed</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;mixed_anova&#39;</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">data_mixed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scores</th>
      <th>Time</th>
      <th>Group</th>
      <th>Subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.971435</td>
      <td>August</td>
      <td>Control</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.309024</td>
      <td>August</td>
      <td>Control</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6.932707</td>
      <td>August</td>
      <td>Control</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.187348</td>
      <td>August</td>
      <td>Control</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.779411</td>
      <td>August</td>
      <td>Control</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In a mixed ANOVA design, we analyze the same subjects over time under different conditions <em>or</em> at different time points, while also considering the effect of a between-subjects factor, such as ‘Group’. Each subject receives <em>only one level of the between-subjects treatment</em> (e.g., is assigned to only one ‘Group’), but is measured repeatedly across the within-subjects conditions or time points. This allows us to track changes within individuals across the various conditions or time points, and also to compare the responses between different groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_mixed</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Subject == 0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scores</th>
      <th>Time</th>
      <th>Group</th>
      <th>Subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.971435</td>
      <td>August</td>
      <td>Control</td>
      <td>0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>5.102160</td>
      <td>January</td>
      <td>Control</td>
      <td>0</td>
    </tr>
    <tr>
      <th>60</th>
      <td>4.525764</td>
      <td>June</td>
      <td>Control</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can’t directly combine a Seaborn plot with a Pingouin paired plot in a single figure. This is because they are generated using different underlying libraries (seaborn uses Matplotlib, while Pingouin uses Seaborn, which in turn uses Matplotlib).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_mixed</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">gap</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add plot labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Scores by Time and Group&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f3743e0c4a642216bdf629e20b373d02bcc700db9c0d6b48332ce436fa1a846b.png" src="_images/f3743e0c4a642216bdf629e20b373d02bcc700db9c0d6b48332ce436fa1a846b.png" />
</div>
</div>
<p>However, we can create two separate plots to show the paired plot in each ‘Group’ for the mixed-design ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get unique values of &#39;Group&#39;</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">data_mixed</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_groups</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">n_groups</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Loop through groups and create paired plots</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">plot_paired</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_mixed</span><span class="p">[</span><span class="n">data_mixed</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">],</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
        <span class="n">boxplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="c1"># Assign plot to the correct subplot</span>
        <span class="n">boxplot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d52037d487a9a3c0990c0a0708c4f9e2d6af6f061aa929684d236741096a4e83.png" src="_images/d52037d487a9a3c0990c0a0708c4f9e2d6af6f061aa929684d236741096a4e83.png" />
</div>
</div>
<p>We can use the <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.mixed_anova.html"><code class="docutils literal notranslate"><span class="pre">pg.mixed_anova</span></code> function in Pingouin to perform mixed-design ANOVA</a>. This function combines elements from both <code class="docutils literal notranslate"><span class="pre">pg.anova</span></code> (for between-subjects designs) and <code class="docutils literal notranslate"><span class="pre">pg.rm_anova</span></code> (for within-subjects designs) to analyze data with both between-subjects and within-subjects factors.</p>
<p>The main difference between <code class="docutils literal notranslate"><span class="pre">pg.mixed_anova</span></code> and the other two functions is that it allows us to specify both a <em>‘between’</em> factor and a <em>‘within’</em> factor. This enables us to analyze the main effects of each factor as well as the interaction between them. In contrast, <code class="docutils literal notranslate"><span class="pre">pg.anova</span></code> only handles between-subjects factors, while <code class="docutils literal notranslate"><span class="pre">pg.rm_anova</span></code> only handles within-subjects factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform mixed-design ANOVA</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">mixed_anova</span><span class="p">(</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
        <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_mixed</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        Source     SS  DF1  DF2     MS      F  p-unc    np2    eps
0        Group  5.460    1   58  5.460  5.052  0.028  0.080    NaN
1         Time  7.628    2  116  3.814  4.027  0.020  0.065  0.999
2  Interaction  5.167    2  116  2.584  2.728  0.070  0.045    NaN
</pre></div>
</div>
</div>
</div>
<p>To interpret the results, we focus on the F-statistics and their associated P values. If the P value for a factor or interaction is less than our significance level (typically 0.05), we reject the null hypothesis and conclude that there is a statistically significant effect. We can then examine the effect size (η²<sub>p</sub>) to assess the magnitude of the effect.</p>
<p>In this case, the P value for the between-subjects factor ‘Group’ is 0.028, which is less than 0.05. This indicates a statistically significant difference between the groups in terms of their overall scores. The P value for the within-subjects factor ‘Time’ is also less than 0.05, indicating a significant difference in scores across the different time points. However, the P value for the ‘Interaction’ effect is higher than 0.05, suggesting that the effect of ‘Time’ on ‘Scores’ is not different between the two groups.</p>
<p>By examining the effect sizes, we can see that both the ‘Group’ factor and the ‘Time’ factor have small effects (η²<sub>p</sub> = 0.08 and η²<sub>p</sub> = 0.065, respectively). The ‘Interaction’ effect also has a small effect size (η²<sub>p</sub> = 0.045), but it’s not statistically significant.</p>
<p>Overall, the results suggest that both the ‘Group’ and ‘Time’ factors have significant, albeit small, effects on ‘Scores’. However, the effect of ‘Time’ does not differ significantly between the two groups.</p>
<p><em>Notes - It seems that the <code class="docutils literal notranslate"><span class="pre">between</span></code> argument in <code class="docutils literal notranslate"><span class="pre">statsmodels.stats.anova.AnovaRM</span></code> is not yet fully implemented, and using <code class="docutils literal notranslate"><span class="pre">mixedlm</span></code> doesn’t directly provide the classic ANOVA table format with F-statistics and P values. Therefore, we’ll focus on using Pingouin for mixed-design ANOVA for the time being.</em></p>
</section>
<section id="n-way-anova">
<h3>N-way ANOVA<a class="headerlink" href="#n-way-anova" title="Link to this heading">#</a></h3>
<p>N-way ANOVA, also known as multi-way ANOVA, extends the principles of ANOVA to analyze the effects of three or more independent variables (factors) on a dependent variable simultaneously. This allows us to examine complex relationships between multiple factors and gain a more comprehensive understanding of their combined influence on the outcome variable.</p>
<p>In N-way ANOVA, we can analyze:</p>
<ul class="simple">
<li><p><em>Main effects:</em> the individual effects of each factor on the dependent variable, independent of the other factors.</p></li>
<li><p><em>Interaction effects:</em> the combined effects of two or more factors, where the effect of one factor depends on the level of another factor.</p></li>
<li><p><em>Higher-order interactions:</em> the interactions between three or more factors, indicating more complex relationships between the variables.</p></li>
</ul>
<p>We can use the same tools and techniques for N-way ANOVA as we did for one-way and two-way ANOVA. For example, we can use a <strong>three-way ANOVA</strong> to analyze cholesterol levels, considering factors such as age, gender, and treatment type simultaneously.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the &#39;anova3&#39; dataset</span>
<span class="n">data_three_way_anova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;anova3&#39;</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">data_three_way_anova</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sex</th>
      <th>Risk</th>
      <th>Drug</th>
      <th>Cholesterol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>Low</td>
      <td>A</td>
      <td>4.868845</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>Low</td>
      <td>A</td>
      <td>6.862204</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M</td>
      <td>Low</td>
      <td>A</td>
      <td>4.602797</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>Low</td>
      <td>A</td>
      <td>3.576900</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>Low</td>
      <td>A</td>
      <td>5.739727</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can use <a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.catplot.html">seaborn’s <code class="docutils literal notranslate"><span class="pre">catplot()</span></code> function</a> to create a plot with one variable as a panel separation. This will allow us to visualize the relationships between the variables in the 3-way ANOVA design.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the catplot with &#39;Drug&#39; as the panel separation</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Drug&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cholesterol&#39;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Sex&#39;</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Risk&#39;</span><span class="p">,</span>  <span class="c1"># Separate panels by &#39;Risk&#39;</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_three_way_anova</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
    <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Separate points for different &#39;Dosage&#39; levels</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add plot title</span>
<span class="n">g</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Three-way ANOVA: Cholesterol by Drug, Sex, and Risk&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0bbe6a53c28ccd59471c7929fa00c28604e3fc0f56150e71a733d2701dde4ee0.png" src="_images/0bbe6a53c28ccd59471c7929fa00c28604e3fc0f56150e71a733d2701dde4ee0.png" />
</div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> method to verify that the design is balanced, with 5 samples for each combination of factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_three_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Drug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Risk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>Cholesterol</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>count</th>
    </tr>
    <tr>
      <th>Drug</th>
      <th>Sex</th>
      <th>Risk</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">A</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">B</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">C</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform three-way ANOVA with Pingouin</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">data_three_way_anova</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Cholesterol&#39;</span><span class="p">,</span>
        <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Drug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Risk&#39;</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Source      SS    DF      MS       F  p-unc    np2
0               Drug   0.816   2.0   0.408   0.484  0.619  0.020
1                Sex   2.075   1.0   2.075   2.462  0.123  0.049
2               Risk  11.332   1.0  11.332  13.449  0.001  0.219
3         Drug * Sex   2.564   2.0   1.282   1.522  0.229  0.060
4        Drug * Risk   2.438   2.0   1.219   1.446  0.245  0.057
5         Sex * Risk   0.117   1.0   0.117   0.139  0.711  0.003
6  Drug * Sex * Risk   1.844   2.0   0.922   1.094  0.343  0.044
7           Residual  40.445  48.0   0.843     NaN    NaN    NaN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform three-way ANOVA with statsmodels</span>
<span class="n">results_three_way_anova_statsmodels</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;Cholesterol ~ Drug * Sex * Risk&quot;</span><span class="p">,</span>  <span class="c1"># Notice that Drug, Sex, and Risk are of type string ~ readily categories</span>
    <span class="c1"># formula=&quot;&quot;&quot;</span>
    <span class="c1"># Cholesterol ~ Drug + Sex + Risk +</span>
    <span class="c1"># Drug:Sex + Drug:Risk + Sex:Risk +</span>
    <span class="c1"># Drug:Sex:Risk</span>
    <span class="c1"># &quot;&quot;&quot;,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_three_way_anova</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the ANOVA table with type I SS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_three_way_anova_statsmodels</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 df     sum_sq    mean_sq          F    PR(&gt;F)
Drug            2.0   0.815743   0.407872   0.484066  0.619249
Sex             1.0   2.074568   2.074568   2.462115  0.123191
Risk            1.0  11.332130  11.332130  13.449071  0.000613
Drug:Sex        2.0   2.564162   1.282081   1.521585  0.228711
Drug:Risk       2.0   2.437511   1.218755   1.446430  0.245485
Sex:Risk        1.0   0.117441   0.117441   0.139381  0.710541
Drug:Sex:Risk   2.0   1.843788   0.921894   1.094112  0.343041
Residual       48.0  40.444597   0.842596        NaN       NaN
</pre></div>
</div>
</div>
</div>
<p>Pingouin can also handle unbalanced designs in N-way ANOVA by using statsmodels internally, just like it does for two-way ANOVA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_unbalanced_three_way_anova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;anova3_unbalanced&#39;</span><span class="p">)</span>

<span class="n">data_unbalanced_three_way_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Drug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Risk&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>Cholesterol</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>count</th>
    </tr>
    <tr>
      <th>Drug</th>
      <th>Sex</th>
      <th>Risk</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">A</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>7</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>6</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">B</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>6</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>7</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>6</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">C</th>
      <th rowspan="2" valign="top">F</th>
      <th>High</th>
      <td>6</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>6</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">M</th>
      <th>High</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unbalanced 3-way ANOVA with Pingouin</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">data_unbalanced_three_way_anova</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Cholesterol&#39;</span><span class="p">,</span>
        <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Drug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Risk&#39;</span><span class="p">],</span>
        <span class="n">ss_type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Source      SS    DF      MS       F  p-unc    np2
0               Drug   0.694   2.0   0.347   0.429  0.653  0.015
1                Sex   3.042   1.0   3.042   3.759  0.057  0.062
2               Risk  12.276   1.0  12.276  15.169  0.000  0.210
3         Drug * Sex   1.196   2.0   0.598   0.739  0.482  0.025
4        Drug * Risk   1.894   2.0   0.947   1.170  0.318  0.039
5         Sex * Risk   0.080   1.0   0.080   0.099  0.754  0.002
6  Drug * Sex * Risk   0.817   2.0   0.409   0.505  0.606  0.017
7           Residual  46.128  57.0   0.809     NaN    NaN    NaN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unbalanced 3-way ANOVA with statsmodels</span>
<span class="n">results_unbalanced_anova_statsmodels</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;Cholesterol ~ Drug * Sex * Risk&quot;</span><span class="p">,</span>  <span class="c1"># Notice that Diet and Exercise are of type string ~ readily categories</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_unbalanced_three_way_anova</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the ANOVA table with type II SS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">anova_lm</span><span class="p">(</span><span class="n">results_unbalanced_anova_statsmodels</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  sum_sq    df          F    PR(&gt;F)
Drug            0.694293   2.0   0.428968  0.653266
Sex             3.042246   1.0   3.759293  0.057471
Risk           12.275772   1.0  15.169127  0.000261
Drug:Sex        1.195612   2.0   0.738707  0.482249
Drug:Risk       1.894341   2.0   1.170415  0.317582
Sex:Risk        0.080249   1.0   0.099163  0.753986
Drug:Sex:Risk   0.817440   2.0   0.505054  0.606148
Residual       46.127837  57.0        NaN       NaN
</pre></div>
</div>
</div>
</div>
</section>
<section id="two-way-repeated-measures-anova">
<h3>Two-way repeated measures ANOVA<a class="headerlink" href="#two-way-repeated-measures-anova" title="Link to this heading">#</a></h3>
<p>Two-way repeated measures ANOVA (two-way rmANOVA) extends the concept of rmANOVA to analyze the effects of two within-subjects factors on a continuous dependent variable. This design is useful when we have repeated measurements on the same subjects under different conditions or at different time points, and we want to examine the effects of two factors simultaneously.</p>
<p>In two-way repeated measures ANOVA, there are two within-subjects factors (treatments or time) to study. For example, let’s imagine a study design where:</p>
<ul class="simple">
<li><p>The same animals were first given inactive treatment and the response measured; then they were given the active treatment and the response measured again.</p></li>
<li><p>The same animals are first measured for a response after a short duration and then later after a long duration.</p></li>
<li><p>Each animal was first given the inactive treatment and measured for a short and then a long duration; then the same animal was given the active treatment and measured for a short and then a long duration. This is a repeated measures in both factors design.</p></li>
</ul>
<p>This design allows us to study the effects of both the treatment and the time on the response, as well as the interaction between the two factors.</p>
<p>In the example below, the <a class="reference external" href="https://real-statistics.com/anova-repeated-measures/two-within-subjects-factors/">dataset originates from a company that wants to evaluate the effectiveness of a new training program for its customer service staff</a>. They collected performance data on 10 employees before and after the training program in three different areas: ‘Product’ knowledge, ‘Client’ interaction, and ‘Action’ taken.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the &#39;rm_anova2&#39; dataset</span>
<span class="n">data_two_way_rmanova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;rm_anova2&#39;</span><span class="p">)</span>

<span class="c1"># Display a few rows of the table</span>
<span class="n">data_two_way_rmanova</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Subject</th>
      <th>Time</th>
      <th>Metric</th>
      <th>Performance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Pre</td>
      <td>Product</td>
      <td>13</td>
    </tr>
    <tr>
      <th>46</th>
      <td>7</td>
      <td>Post</td>
      <td>Client</td>
      <td>36</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>Pre</td>
      <td>Product</td>
      <td>17</td>
    </tr>
    <tr>
      <th>35</th>
      <td>6</td>
      <td>Post</td>
      <td>Product</td>
      <td>6</td>
    </tr>
    <tr>
      <th>44</th>
      <td>5</td>
      <td>Post</td>
      <td>Client</td>
      <td>28</td>
    </tr>
    <tr>
      <th>28</th>
      <td>9</td>
      <td>Pre</td>
      <td>Action</td>
      <td>24</td>
    </tr>
    <tr>
      <th>33</th>
      <td>4</td>
      <td>Post</td>
      <td>Product</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Pre</td>
      <td>Product</td>
      <td>17</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4</td>
      <td>Pre</td>
      <td>Client</td>
      <td>25</td>
    </tr>
    <tr>
      <th>56</th>
      <td>7</td>
      <td>Post</td>
      <td>Action</td>
      <td>38</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the number of unique Subjects</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">data_two_way_rmanova</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2"> unique Subjects&quot;</span><span class="p">)</span>

<span class="c1"># Pivot to the mean of the Performance values calculated for each combination of Time and Metric</span>
<span class="n">data_two_way_rmanova</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Metric&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Performance&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 10 unique Subjects
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">count</th>
    </tr>
    <tr>
      <th>Metric</th>
      <th>Action</th>
      <th>Client</th>
      <th>Product</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Post</th>
      <td>10</td>
      <td>10</td>
      <td>10</td>
    </tr>
    <tr>
      <th>Pre</th>
      <td>10</td>
      <td>10</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This table below shows the performance data for ‘Subject’ number 1:</p>
<ul class="simple">
<li><p>The ‘Subject’ column identifies the participant in the study. Here we show only ‘Subject’ number 1.</p></li>
<li><p>The ‘Time’ column shows the time point at which the measurement was taken. There are two levels: “Pre” and “Post”.</p></li>
<li><p>The ‘Metric’ column indicates the specific performance metric being measured. There are three levels: “Product”, “Client”, and “Action”.</p></li>
<li><p>The ‘Performance’ column contains the actual performance scores under each combination of ‘Time’ and ‘Metric’.</p></li>
</ul>
<p>Overall, it appears that the intervention generally led to improved performance for Subject #1 across most metrics. However, this is just a single subject, and we need to analyze the data from all subjects to draw any definitive conclusions about the effects of the intervention.</p>
<p>Further analysis with rmANOVA will help to determine whether there is a significant overall difference in performance between the “Pre” and “Post” time points across all metrics, whether there is a significant overall difference in performance between the different metrics (“Product”, “Client”, “Action”) across all time points, and whether the effect of the intervention on performance varies depending on the specific metric being considered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the data for Subject #1</span>
<span class="n">data_two_way_rmanova</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Subject == 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Subject</th>
      <th>Time</th>
      <th>Metric</th>
      <th>Performance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Pre</td>
      <td>Product</td>
      <td>13</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>Pre</td>
      <td>Client</td>
      <td>12</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1</td>
      <td>Pre</td>
      <td>Action</td>
      <td>17</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1</td>
      <td>Post</td>
      <td>Product</td>
      <td>18</td>
    </tr>
    <tr>
      <th>40</th>
      <td>1</td>
      <td>Post</td>
      <td>Client</td>
      <td>30</td>
    </tr>
    <tr>
      <th>50</th>
      <td>1</td>
      <td>Post</td>
      <td>Action</td>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To visualize how performance changes from pre-treatment to post-treatment for each metric, we create separate subplots for each metric. Within each subplot, we use paired plots to display the individual data points for both treatments, enabling us to track changes within individuals and compare the effects of the treatments across different metrics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create subplots - one for each metric</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">data_two_way_rmanova</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">n_metrics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_metrics</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n_metrics</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Loop through metrics and create paired plots</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
    <span class="n">pg</span><span class="o">.</span><span class="n">plot_paired</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_two_way_rmanova</span><span class="p">[</span><span class="n">data_two_way_rmanova</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">],</span>
        <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Performance&#39;</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pre&#39;</span><span class="p">,</span> <span class="s1">&#39;Post&#39;</span><span class="p">],</span>  <span class="c1"># We better see the effect of the treatment</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
        <span class="n">boxplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">boxplot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0aa983f96aa16cc209d1d728be0a56a3d23cfa703121572f68b9d28291325631.png" src="_images/0aa983f96aa16cc209d1d728be0a56a3d23cfa703121572f68b9d28291325631.png" />
</div>
</div>
<p>Performing a two-way repeated measures ANOVA is similar to a standard repeated measures ANOVA. We provide a list of within-subjects factors to Pingouin’s <code class="docutils literal notranslate"><span class="pre">rm_anova</span></code> function, instead of just one.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">pg.plot_paired</span></code> is used to visualize paired data for a <em>single within-subjects factor</em>, while <code class="docutils literal notranslate"><span class="pre">pg.rm_anova</span></code> performs the statistical analysis considering all within-subjects factors simultaneously.</p>
<p>In a two-way repeated measures ANOVA design, we analyze the <em>same subjects</em> under different conditions or at different time points <em>for multiple dependent variables</em>:</p>
<ol class="arabic simple">
<li><p>Each subject undergoes both ‘Pre’ and ‘Post’ treatments, i.e., before and after the training program.</p></li>
<li><p>Their ‘Performance’ is measured repeatedly for <em>different</em> ‘Metrics’, i.e., ‘Product’, ‘Client’, and ‘Action’.</p></li>
</ol>
<p>This allows us to track changes within individuals across the treatments and the different ‘Metrics’. We can then analyze the main effects of ‘Time’ and ‘Metric’, as well as their interaction, to understand how performance changes across both factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># Two-way repeated measures ANOVA with Pingouin</span>
<span class="n">data_two_way_rmanova</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Performance&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">],</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>ddof1</th>
      <th>ddof2</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>p-GG-corr</th>
      <th>ng2</th>
      <th>eps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Metric</td>
      <td>1365.233333</td>
      <td>2</td>
      <td>18</td>
      <td>682.616667</td>
      <td>26.95919</td>
      <td>0.000004</td>
      <td>0.000005</td>
      <td>0.359335</td>
      <td>0.969103</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Time</td>
      <td>828.816667</td>
      <td>1</td>
      <td>9</td>
      <td>828.816667</td>
      <td>33.85228</td>
      <td>0.000254</td>
      <td>0.000254</td>
      <td>0.254011</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Metric * Time</td>
      <td>224.433333</td>
      <td>2</td>
      <td>18</td>
      <td>112.216667</td>
      <td>12.63227</td>
      <td>0.000373</td>
      <td>0.001708</td>
      <td>0.084420</td>
      <td>0.727166</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AnovaRM</span></code> function in statsmodels can also handle multiple within-subjects factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform rmANOVA using AnovaRM</span>
<span class="n">model_two_way_anova_rm_statsmodels</span> <span class="o">=</span> <span class="n">AnovaRM</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_two_way_rmanova</span><span class="p">,</span>
    <span class="n">depvar</span><span class="o">=</span><span class="s1">&#39;Performance&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># results_two_way_anova_rm_statsmodels = model_two_way_anova_rm_statsmodels.fit()</span>

<span class="c1"># # Print the ANOVA table</span>
<span class="c1"># print(results_two_way_anova_rm_statsmodels.anova_table)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_two_way_anova_rm_statsmodels</span><span class="o">.</span><span class="n">fit</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  Anova
=========================================
            F Value Num DF  Den DF Pr &gt; F
-----------------------------------------
Metric      26.9592 2.0000 18.0000 0.0000
Time        33.8523 1.0000  9.0000 0.0003
Metric:Time 12.6323 2.0000 18.0000 0.0004
=========================================
</pre></div>
</div>
</div>
</div>
<p>The main effect of ‘Metric’ is statistically significant (F(2, 18) = 26.9592, P &lt; 0.0001). This suggests that there are significant differences in the dependent variable across the different levels of the ‘Metric’ factor. The main effect of ‘Time’ is also statistically significant (F(1, 9) = 33.8523, P = 0.0003). This suggests that there are significant differences in the dependent variable across the different levels of the ‘Time’ factor. Finally, the interaction effect between ‘Metric’ and ‘Time’ is statistically significant (F(2, 18) = 12.6323, P = 0.0004). This suggests that the effect of one factor depends on the level of the other factor.</p>
<p>Overall, the results indicate that both within-subjects factors, ‘Metric’ and ‘Time’, have significant main effects on the dependent variable, and there is also a significant interaction between them.</p>
</section>
<section id="analysis-of-covariance-ancova">
<h3>Analysis of covariance (ANCOVA)<a class="headerlink" href="#analysis-of-covariance-ancova" title="Link to this heading">#</a></h3>
<p>ANCOVA is a statistical technique that combines elements of ANOVA and <em>regression analysis</em>. It allows us to examine the effects of one or more independent variables on a dependent variable while controlling for the influence of one or more continuous variables called covariates.</p>
<p>The main difference between ANOVA and ANCOVA is the inclusion of covariates. ANOVA only analyzes the effects of categorical independent variables, while ANCOVA incorporates both categorical and continuous independent variables (covariates) in the model:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Feature</p></th>
<th class="head text-left"><p>ANOVA</p></th>
<th class="head text-left"><p>ANCOVA</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Independent variables</p></td>
<td class="text-left"><p>Categorical only</p></td>
<td class="text-left"><p>Categorical and continuous</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Covariates</p></td>
<td class="text-left"><p>Not included</p></td>
<td class="text-left"><p>Included</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Purpose</p></td>
<td class="text-left"><p>Examine group differences</p></td>
<td class="text-left"><p>Examine group differences while controlling for covariates</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Statistical power</p></td>
<td class="text-left"><p>May be lower</p></td>
<td class="text-left"><p>May be higher</p></td>
</tr>
</tbody>
</table>
</div>
<p>ANCOVA is appropriate when we want to:</p>
<ul class="simple">
<li><p>Control for the effects of confounding variables: <strong>covariates</strong> are variables that are not of primary interest but may affect the relationship between the independent and dependent variables. By including covariates in the model, ANCOVA can control for their potential confounding effects and provide a more accurate assessment of the true effects of the independent variables.</p></li>
<li><p>Increase the statistical power of the analysis: ANCOVA can increase the statistical power of the analysis by reducing the error variance. This is because the covariates explain some of the variability in the dependent variable that would otherwise be attributed to error.</p></li>
<li><p>Adjust for pre-existing differences between groups: ANCOVA can be used to adjust for pre-existing differences between groups on the dependent variable. This is particularly useful in non-randomized studies where groups may not be equivalent at baseline.</p></li>
</ul>
<p>In the following example, a <a class="reference external" href="https://real-statistics.com/analysis-of-covariance-ancova/basic-concepts-ancova/">school system is comparing four reading teaching methods to determine which is most effective</a>. They randomly assigned 40 children to four groups, each receiving a different teaching method. A researcher believes family income may influence reading test scores, suggesting that children from higher-income families might perform better regardless of the teaching method. The study aims to determine if there is a significant difference between the teaching methods after accounting for family income.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_ancova</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">(</span><span class="s1">&#39;ancova&#39;</span><span class="p">)</span>
<span class="n">data_ancova</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scores</th>
      <th>Income</th>
      <th>BMI</th>
      <th>Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12</td>
      <td>17.5</td>
      <td>20</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>39</td>
      <td>104.6</td>
      <td>20</td>
      <td>A</td>
    </tr>
    <tr>
      <th>2</th>
      <td>36</td>
      <td>64.7</td>
      <td>24</td>
      <td>A</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17</td>
      <td>47.0</td>
      <td>19</td>
      <td>A</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25</td>
      <td>22.0</td>
      <td>21</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The same assumptions as for ANOVA (normality, homogeneity of variance, and random independent samples) are required for ANCOVA, For each level of the independent variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               W      pval  normal
Method                            
A       0.933315  0.546721    True
B       0.920344  0.432663    True
C       0.937504  0.525585    True
D       0.936559  0.515399    True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               W      pval  equal_var
levene  0.925541  0.439635       True
</pre></div>
</div>
</div>
</div>
<p>ANCOVA also has some additional assumptions that need to be checked before conducting the analysis. These assumptions include:</p>
<ul class="simple">
<li><p><em>Linearity:</em> there should be a linear relationship between the dependent variable and the covariate for each level of the independent variable.</p></li>
<li><p><em>Homogeneity of regression slopes:</em> the slopes of the regression lines representing the relationship between the dependent variable and the covariate should be parallel across all levels of the independent variable. This means that the effect of the covariate on the dependent variable is the same across all groups.</p></li>
<li><p><em>Independence of covariate and treatment effects:</em> the covariate should be independent of the treatment effects, meaning there is no interaction between the covariate and the independent variable.</p></li>
</ul>
<p>To assess these assumptions, we can create scatter plots of the dependent variable against the covariate for each level of the independent variable. This will help us visualize the relationship between the variables and check for linearity and homogeneity of regression slopes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the line plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Income&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
    <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Remove confidence intervals for clearer visualization</span>
    <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>  <span class="c1"># Adjust point size and transparency</span>
<span class="p">)</span>

<span class="c1"># Add plot title and labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scatter plot of Scores vs. Income by Method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Income&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Scores&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0a5ab2c211b8972ca16585fc9290e83687de1bfcf64f69ff4062a20a2d0091cd.png" src="_images/0a5ab2c211b8972ca16585fc9290e83687de1bfcf64f69ff4062a20a2d0091cd.png" />
</div>
</div>
<p>While the four lines are not perfectly parallel, their slopes are quite similar, suggesting that the assumption of homogeneity of regression slopes is reasonably met.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform ANCOVA using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ancova</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
    <span class="n">covar</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Income&#39;</span><span class="p">],</span>  <span class="c1"># This can be a list of covariates</span>
    <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Method</td>
      <td>571.029883</td>
      <td>3</td>
      <td>3.336482</td>
      <td>0.031940</td>
      <td>0.244077</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Income</td>
      <td>1678.352687</td>
      <td>1</td>
      <td>29.419438</td>
      <td>0.000006</td>
      <td>0.486920</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Residual</td>
      <td>1768.522313</td>
      <td>31</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To interpret the results, we focus on the F-statistics and their associated P values. If the P value for a factor or covariate is less than our significance level (typically 0.05), we reject the null hypothesis and conclude that there is a statistically significant effect. We can then examine the effect size (η²<sub>p</sub>) to assess the magnitude of the effect.</p>
<p>In this case, the P value for the ‘Method’ factor is 0.032, which is less than 0.05. This indicates a statistically significant difference between the teaching methods in terms of their effect on ‘Scores’, even after controlling for ‘Income’. The P value for the ‘Income’ covariate is also less than 0.05, indicating that ‘Income’ has a significant effect on ‘Scores’.</p>
<p>By examining the effect sizes, we can see that ‘Income’ has a larger effect size (η²<sub>p</sub> = 0.487) than ‘Method’ (η²<sub>p</sub> = 0.244). This suggests that ‘Income’ explains a greater proportion of the variance in ‘Scores’ compared to ‘Method’.</p>
<p>Overall, the results suggest that both the teaching ‘Method’ and family ‘Income’ have significant effects on ‘Scores’. However, ‘Income’ appears to have a stronger influence on ‘Scores’ than the teaching ‘Method’.</p>
<p><a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.rm_corr.html">Repeated measures correlation (rmcorr)</a> is a statistical technique for determining the common within-individual association for paired measures assessed on two or more occasions for multiple individuals. It provides the best linear fit for each participant using parallel regression lines, representing the strength of the linear association between two variables with a coefficient ranging from -1 to 1, similar to a Pearson correlation coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">rm_corr</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>r</th>
      <th>dof</th>
      <th>pval</th>
      <th>CI95%</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>rm_corr</th>
      <td>0.697797</td>
      <td>31</td>
      <td>0.000006</td>
      <td>[0.47, 0.84]</td>
      <td>0.997618</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can visualize the relationship between the covariate (‘Income’) and the dependent variable (‘Scores’) using a <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.plot_rm_corr.html">repeated measures correlation plot</a>. This plot, where parallel lines are fitted to each subject’s data, will show the correlation between ‘Income’ and ‘Scores’, helping us assess the consistency of the relationship over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the repeated measures correlation plot</span>
<span class="n">pg</span><span class="o">.</span><span class="n">plot_rm_corr</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_ancova</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Income&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Scores&#39;</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f821a9583e5081d724a1e8e29aaddf64f906e890ecdedebdd25b69aef0da422e.png" src="_images/f821a9583e5081d724a1e8e29aaddf64f906e890ecdedebdd25b69aef0da422e.png" />
</div>
</div>
<p>While ANCOVA is used to test the significance of the effect of an independent variable on a dependent variable while controlling for the effect of a covariate, rmcorr is used to assess the strength of the linear association between two variables.</p>
</section>
</section>
<section id="multiple-comparison-tests-after-anova">
<h2>Multiple comparison tests after ANOVA<a class="headerlink" href="#multiple-comparison-tests-after-anova" title="Link to this heading">#</a></h2>
<p>When we conduct an ANOVA and obtain a statistically significant result, it indicates that there are differences between at least two of the group means. However, ANOVA doesn’t tell us <em>which</em> specific groups are different. This is where multiple comparison tests come in.</p>
<p>Multiple comparison tests, also known as <strong>post-hoc analysis</strong>, allow us to make pairwise comparisons between all the groups and determine which ones are significantly different from each other. This provides more detailed and specific insights into the group differences, helping us understand the patterns in the data more comprehensively.</p>
<p>For instance, imagine we’re comparing the effectiveness of three different fertilizers on plant growth. ANOVA might tell us that there’s a significant difference between the fertilizers, but it won’t tell us if fertilizer A is different from fertilizer B, if fertilizer B is different from fertilizer C, or if all three are different from each other. Multiple comparison tests allow us to answer these specific questions.</p>
<p>However, it’s important to note that conducting multiple comparisons increases the risk of Type I error (false positives). This is because each pairwise comparison has a chance of producing a statistically significant result by chance, even if there is no true difference between the groups, as discussed in the chapter on statistical significance. To control for this inflated error rate, multiple comparison tests use adjusted p-values or critical values to maintain the overall significance level.</p>
<p>Therefore, multiple comparison tests are a crucial step after ANOVA when we want to pinpoint the specific group differences and gain a more nuanced understanding of the data. Several multiple comparison tests are available, each with its own advantages and disadvantages. Some common options include:</p>
<ul class="simple">
<li><p><strong>Tukey’s HSD:</strong> this test is considered one of the most powerful and robust methods. It controls the family-wise error rate, meaning it protects against the overall probability of making Type I errors (falsely rejecting a true null hypothesis).</p></li>
<li><p><strong>Dunnett’s Test:</strong> this test is specifically designed for comparing each group to a control group.</p></li>
<li><p><strong>Bonferroni:</strong> this test is very conservative, meaning it has a lower chance of making a Type I error but may have less power to detect real differences.</p></li>
<li><p><strong>Scheffé:</strong> this test is less conservative than Bonferroni and can be used for a wider range of comparisons, including pairwise comparisons and comparisons of groups to linear combinations of other groups.</p></li>
</ul>
<p>Choosing the appropriate multiple comparison test depends on several factors, including:</p>
<ul class="simple">
<li><p><em>Specific comparisons:</em> which specific comparisons are of interest?</p></li>
<li><p><em>Group sizes:</em> are the group sizes equal or unequal?</p></li>
<li><p><em>Type II error:</em> how important is it to avoid Type II errors (falsely failing to reject a false null hypothesis)?</p></li>
</ul>
<p>However, conducting multiple comparisons increases the overall chance of making a Type I error. To control this risk, multiple comparison tests adjust the significance level accordingly. Some multiple comparison tests are more powerful than others, meaning they are more likely to detect true differences between groups.</p>
<p>Some multiple comparison tests assume equal variances across groups, while others are more robust to unequal variances.</p>
<p>It’s crucial to choose an appropriate multiple comparison test based on the specific research question, the characteristics of the data, and the desired level of power and control for Type I errors.</p>
<p>Python libraries like Statsmodels and Pingouin provide functions to perform various multiple comparison tests. These functions typically take the ANOVA results as input and perform the appropriate tests, adjusting for multiple comparisons as needed.</p>
<section id="tukey-s-hsd-test">
<h3>Tukey’s HSD test<a class="headerlink" href="#tukey-s-hsd-test" title="Link to this heading">#</a></h3>
<p>The <em>Tukey HSD (honestly significant difference)</em> test is a common post-hoc test used for making pairwise comparisons between means after conducting an ANOVA. It is specifically designed to control the family-wise error rate when performing multiple pairwise comparisons. This means it adjusts the significance level to account for the increased risk of Type I errors (false positives) that arise when conducting multiple tests.</p>
<section id="calculating-confidence-intervals-for-mean-differences">
<h4>Calculating confidence intervals for mean differences<a class="headerlink" href="#calculating-confidence-intervals-for-mean-differences" title="Link to this heading">#</a></h4>
<p>When computing most multiple comparisons tests, we leverage the assumption of <em>equal variances across groups</em>, which is often made in ANOVA. This allows us to use the <em>pooled SD</em> of all the groups to estimate the standard deviation (SD) for the difference between two means, rather than relying solely on the SDs of those two groups.</p>
<p>The pooled variance <span class="math notranslate nohighlight">\(s_p^2\)</span>, or MS<sub>error</sub>, which represents the average variance across all groups, is calculated as:</p>
<div class="math notranslate nohighlight">
\[s_p^2 = \frac{\mathrm{SSE}}{n - k}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathrm{SSE}\)</span> is the sum of squares error from the ANOVA table.</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the total number of observations.</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> is the number of groups.</p></li>
</ul>
<p>The Studentized range statistic (<span class="math notranslate nohighlight">\(q\)</span>) for the difference between two means is calculated as:</p>
<div class="math notranslate nohighlight">
\[q = \frac{|\bar x_i - \bar x_j|}{\sqrt{s_p^2 / m}}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\bar x_i\)</span> and <span class="math notranslate nohighlight">\(\bar x_j\)</span> are the means of groups <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, respectively.</p></li>
<li><p><span class="math notranslate nohighlight">\(m\)</span> is the number of observations per group or sample size (assuming equal group sizes).</p></li>
</ul>
<p>The P values are then approximated using the Studentized range distribution <span class="math notranslate nohighlight">\(Q(\sqrt 2|q_i|, k, n - k)\)</span> where <span class="math notranslate nohighlight">\(k\)</span> is the total number of groups and <span class="math notranslate nohighlight">\(n\)</span> is the total sample size.</p>
<p>The margin of error for the confidence interval (CI) of the difference between two means is calculated by multiplying the standard error (SE) of the difference by a <em>critical value</em>. This critical value depends on the chosen test, the degrees of freedom, the desired confidence level, and the number of comparisons.</p>
<p>The formula for the confidence interval is:</p>
<div class="math notranslate nohighlight">
\[\bar x_i - \bar x_j \pm q^\ast \sqrt{s_p^2 / m}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(q^\ast\)</span> is the critical value from the Studentized range distribution.</p></li>
</ul>
</section>
<section id="the-studentized-range-distribution">
<h4>The Studentized range distribution<a class="headerlink" href="#the-studentized-range-distribution" title="Link to this heading">#</a></h4>
<p>The <em>Studentized range distribution</em> is a statistical distribution that is used in various hypothesis tests, including the <a class="reference external" href="https://en.wikipedia.org/wiki/Tukey%27s_range_test#The_studentized_range_(q)_distribution">Tukey HSD test and the Tukey-Kramer test</a> (discussed below). It is used to compare multiple means and determine which pairs of means are significantly different from each other.</p>
<p>The Studentized range distribution is a modification of the t-distribution that takes into account the number of groups being compared and the degrees of freedom for the error term. It is used to calculate a critical value that is then compared to the calculated test statistic to determine statistical significance.</p>
</section>
<section id="tukey-kramer-test-for-unequal-sample-sizes">
<h4>Tukey-Kramer test for unequal sample sizes<a class="headerlink" href="#tukey-kramer-test-for-unequal-sample-sizes" title="Link to this heading">#</a></h4>
<p>The Tukey-Kramer test is a modification of the Tukey HSD test that’s used when we have unequal sample sizes. The Tukey-Kramer test adjusts the critical value of <span class="math notranslate nohighlight">\(q\)</span> based on the specific sample sizes of the groups being compared. This adjustment ensures that the family-wise error rate is controlled even when the sample sizes are unequal.</p>
<p>The adjusted critical value for the Tukey-Kramer test is calculated as:</p>
<div class="math notranslate nohighlight">
\[q^\ast = q_{1 - \alpha, k, \infty} \sqrt{\frac{1}{2} \left( \frac{1}{m_i} + \frac{1}{m_j} \right)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(q_{1 - \alpha, k, \infty}\)</span> is the upper <span class="math notranslate nohighlight">\(\alpha\)</span> quantile of the Studentized range distribution with <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(\infty\)</span> degrees of freedom.</p></li>
<li><p><span class="math notranslate nohighlight">\(m_i\)</span> and <span class="math notranslate nohighlight">\(m_j\)</span> are the sample sizes of groups <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, respectively.</p></li>
</ul>
<p>This adjusted critical value is then used in the confidence interval formula:</p>
<div class="math notranslate nohighlight">
\[\bar x_i - \bar x_j \pm q^\ast \sqrt{s_p^2 \left( \frac{1}{m_i} + \frac{1}{m_j} \right)}\]</div>
</section>
<section id="tukey-multiple-comparison-with-python">
<h4>Tukey multiple comparison with Python<a class="headerlink" href="#tukey-multiple-comparison-with-python" title="Link to this heading">#</a></h4>
<p>We can use the Statsmodels and Pingouin libraries to perform the Tukey test without manually calculating the q-statistics or looking at the Studentized range distribution. The <code class="docutils literal notranslate"><span class="pre">pairwise_tukeyhsd</span></code> function in Statsmodels provide a convenient way to conduct the Tukey test and obtain P values and confidence intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_tukeyhsd</span>

<span class="c1"># Perform Tukey&#39;s HSD post-hoc test</span>
<span class="c1"># This test compares all pairs of &#39;Hair color&#39; groups</span>
<span class="c1"># to determine which pairs have significantly different means.</span>
<span class="n">tukeyhsd</span> <span class="o">=</span> <span class="n">pairwise_tukeyhsd</span><span class="p">(</span>
    <span class="n">endog</span><span class="o">=</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">],</span>  <span class="c1"># Dependent variable</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">],</span>     <span class="c1"># Grouping variable</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>                           <span class="c1"># Significance level</span>
<span class="p">)</span>

<span class="c1"># Print the results of the Tukey HSD test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukeyhsd</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1"># The following works similarly</span>
<span class="c1"># from statsmodels.stats.multicomp import MultiComparison</span>

<span class="c1"># mult_comp = MultiComparison(data_anova[&#39;Pain threshold&#39;], data_anova[&#39;Hair color&#39;])</span>
<span class="c1"># results_tukeyhsd = mult_comp.tukeyhsd()</span>
<span class="c1"># print(results_tukeyhsd.summary())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        Multiple Comparison of Means - Tukey HSD, FWER=0.05         
====================================================================
    group1        group2     meandiff p-adj   lower    upper  reject
--------------------------------------------------------------------
   Dark Blond  Dark Brunette    -13.8 0.0741 -28.6967  1.0967  False
   Dark Blond    Light Blond      8.0 0.4356  -6.8967 22.8967  False
   Dark Blond Light Brunette     -8.7 0.4147 -24.5004  7.1004  False
Dark Brunette    Light Blond     21.8 0.0037   6.9033 36.6967   True
Dark Brunette Light Brunette      5.1 0.7893 -10.7004 20.9004  False
  Light Blond Light Brunette    -16.7 0.0366 -32.5004 -0.8996   True
--------------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access the critical value of the Studentized range statistic</span>
<span class="c1"># This value is used to determine the significance of the pairwise comparisons.</span>
<span class="n">q_crit</span> <span class="o">=</span> <span class="n">tukeyhsd</span><span class="o">.</span><span class="n">q_crit</span>  <span class="c1"># Store the critical value in a variable</span>

<span class="c1"># Print the critical value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical value of the Studentized range statistic: </span><span class="si">{</span><span class="n">q_crit</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical value of the Studentized range statistic: 4.076
</pre></div>
</div>
</div>
</div>
<p>The key takeaway from the Tukey HSD test is that the 95% confidence level applies to the <em>entire family of comparisons</em>, not just to individual intervals. This means there’s a 5% chance that one or more of the intervals might not contain the true population value.</p>
<p>When interpreting the results, we should focus on the <em>set of differences deemed statistically significant</em>, rather than on individual comparisons. For instance, in the previous table, the differences between ‘Light Blond’ and ‘Dark Brunette’, as well as between ‘Light Blond’ and ‘Light Brunette’, are statistically significant because their confidence intervals do not include zero.</p>
<p>The complementary <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.sandbox.stats.multicomp.TukeyHSDResults.plot_simultaneous.html#statsmodels.sandbox.stats.multicomp.TukeyHSDResults.plot_simultaneous"><code class="docutils literal notranslate"><span class="pre">plot_simultaneous</span></code> function</a> provides a visual representation of the results of a Tukey HSD post-hoc test. It generates a plot that displays the confidence intervals for the differences between the means of a specified group and all other groups. This allows us to easily identify which groups have significantly different means (in red) compared to the reference group (in blue).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the results of the Tukey HSD test</span>
<span class="c1"># This plot shows the confidence intervals for the differences between the mean</span>
<span class="c1"># &#39;Pain threshold&#39; of the &#39;Light Blond&#39; group and the means of all other &#39;Hair color&#39; groups.</span>
<span class="n">tukeyhsd</span><span class="o">.</span><span class="n">plot_simultaneous</span><span class="p">(</span>
    <span class="n">comparison_name</span><span class="o">=</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span>  <span class="c1"># The group to compare against</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1"># plt.title(&quot;Multiple comparisons to &#39;Light Blond&#39;&quot;);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a8989b435ab7af7382f9c5fbef2cf5a20f2b415d3f048a03151c0b679b9846ae.png" src="_images/a8989b435ab7af7382f9c5fbef2cf5a20f2b415d3f048a03151c0b679b9846ae.png" />
</div>
</div>
<p>Pingouin offers a user-friendly approach to multiple comparisons, and its <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.pairwise_tukey.html"><code class="docutils literal notranslate"><span class="pre">pairwise_tukey</span></code> function</a> automatically handles unbalanced designs, making it suitable for a wider range of scenarios, such as when the sample sizes are not equal among the groups, as in the current example where we have <span class="math notranslate nohighlight">\(n=4\)</span> in the ‘Light Brunette’ group. However, it doesn’t provide the confidence intervals for the pairwise differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Tukey&#39;s HSD test using Pingouin</span>
<span class="n">tukey_results_pingouin</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">pairwise_tukey</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">tukey_results_pingouin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>mean(A)</th>
      <th>mean(B)</th>
      <th>diff</th>
      <th>se</th>
      <th>T</th>
      <th>p-tukey</th>
      <th>hedges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dark Blond</td>
      <td>Dark Brunette</td>
      <td>51.2</td>
      <td>37.4</td>
      <td>13.8</td>
      <td>5.169</td>
      <td>2.670</td>
      <td>0.074</td>
      <td>1.414</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Dark Blond</td>
      <td>Light Blond</td>
      <td>51.2</td>
      <td>59.2</td>
      <td>-8.0</td>
      <td>5.169</td>
      <td>-1.548</td>
      <td>0.436</td>
      <td>-0.811</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dark Blond</td>
      <td>Light Brunette</td>
      <td>51.2</td>
      <td>42.5</td>
      <td>8.7</td>
      <td>5.482</td>
      <td>1.587</td>
      <td>0.415</td>
      <td>0.982</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Dark Brunette</td>
      <td>Light Blond</td>
      <td>37.4</td>
      <td>59.2</td>
      <td>-21.8</td>
      <td>5.169</td>
      <td>-4.218</td>
      <td>0.004</td>
      <td>-2.337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Dark Brunette</td>
      <td>Light Brunette</td>
      <td>37.4</td>
      <td>42.5</td>
      <td>-5.1</td>
      <td>5.482</td>
      <td>-0.930</td>
      <td>0.789</td>
      <td>-0.627</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Light Blond</td>
      <td>Light Brunette</td>
      <td>59.2</td>
      <td>42.5</td>
      <td>16.7</td>
      <td>5.482</td>
      <td>3.046</td>
      <td>0.037</td>
      <td>2.015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also use <a class="reference external" href="https://scikit-posthocs.readthedocs.io/en/latest/index.html">the <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> package to perform post-hoc tests</a>, including the Tukey HSD test. This package provides a variety of post-hoc tests that can be used after ANOVA to assess pairwise differences between groups.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> package offers several advantages:</p>
<ul class="simple">
<li><p><em>Flexibility</em>: it provides a wide range of post-hoc tests, including the Tukey HSD test, the Bonferroni correction, the Holm-Bonferroni correction, and the Benjamini-Hochberg FDR correction, among others.</p></li>
<li><p><em>Ease of use</em>: the functions in <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> are straightforward to use and provide clear and concise output, including table of P values, table of significance, diagrams and plot.</p></li>
<li><p><em>Integration with other libraries</em>: <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> integrates well with other scientific computing libraries in Python, such as NumPy and pandas.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scikit_posthocs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ph</span>

<span class="c1"># Perform Tukey HSD test</span>
<span class="n">tukey_hsd_sp_results</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_tukey_hsd</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukey_hsd_sp_results</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Dark Blond  Dark Brunette  Light Blond  Light Brunette
Dark Blond           1.000          0.074        0.436           0.415
Dark Brunette        0.074          1.000        0.004           0.789
Light Blond          0.436          0.004        1.000           0.037
Light Brunette       0.415          0.789        0.037           1.000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a significance table from the Tukey HSD results</span>
<span class="c1"># This table provides a compact and visually clear representation of</span>
<span class="c1"># the significant pairwise comparisons between the groups.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">sign_table</span><span class="p">(</span><span class="n">tukey_hsd_sp_results</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Dark Blond Dark Brunette Light Blond Light Brunette
Dark Blond              -            NS          NS             NS
Dark Brunette          NS             -          **             NS
Light Blond            NS            **           -              *
Light Brunette         NS            NS           *              -
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a significance plot from the Tukey HSD results</span>
<span class="c1"># This plot provides a visual representation of the significant pairwise</span>
<span class="c1"># comparisons between the groups, using colors to indicate significance levels.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">ph</span><span class="o">.</span><span class="n">sign_plot</span><span class="p">(</span>
    <span class="n">tukey_hsd_sp_results</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;#fb6a4a&#39;</span><span class="p">,</span> <span class="s1">&#39;#08306b&#39;</span><span class="p">,</span> <span class="s1">&#39;#4292c6&#39;</span><span class="p">,</span> <span class="s1">&#39;#c6dbef&#39;</span><span class="p">],</span>  <span class="c1"># Custom colormap</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>                        <span class="c1"># Adjust linewidths</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>                         <span class="c1"># Line color</span>
    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                         <span class="c1"># Prevent clipping</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                           <span class="c1"># Make cells square</span>
    <span class="n">cbar_ax_bbox</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="c1"># Colorbar position</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>

<span class="c1"># Add plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Significance plot of Tukey HSD post-hoc test&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3155c76717ac2584abac21c400487abe7439ab5b4b22f8b6bdd8e137c991e3f9.png" src="_images/3155c76717ac2584abac21c400487abe7439ab5b4b22f8b6bdd8e137c991e3f9.png" />
</div>
</div>
</section>
</section>
<section id="dunnett-s-test">
<h3>Dunnett’s test<a class="headerlink" href="#dunnett-s-test" title="Link to this heading">#</a></h3>
<p>Dunnett’s test is a multiple comparison procedure used to compare the mean of each treatment group to the mean of a control group. It’s a valuable tool when we have a specific control group that we want to use as <em>a reference for comparison</em>.</p>
<p>Dunnett’s test focuses specifically on comparisons to the control group, making it <em>more powerful</em> than other multiple comparison tests (like Tukey’s HSD) when our primary interest is in those comparisons. Like Tukey’s HSD, Dunnett’s test also controls the family-wise error rate, ensuring that the overall probability of making a Type I error (false positive) remains at the desired significance level. But because Dunnett’s test makes fewer comparisons than Tukey’s HSD, it generally has more power to detect differences between the treatment groups and the control group.</p>
<p>The formula for the confidence interval in Dunnett’s test is similar to that of the Tukey test, but it uses a different critical value based on the Dunnett’s t-distribution:</p>
<div class="math notranslate nohighlight">
\[\bar x_i - \bar x_0 \pm t_D^\ast \sqrt{s_p^2 \left( \frac{1}{m_i} + \frac{1}{m_0} \right)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\bar{x}_i\)</span> is the mean of treatment group <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar{x}_c\)</span> is the mean of the control group.</p></li>
<li><p><span class="math notranslate nohighlight">\(t_D^\ast\)</span> is the critical value from the Dunnett’s t-distribution.</p></li>
<li><p><span class="math notranslate nohighlight">\(s_p^2\)</span> is the pooled variance (MSE or MS<sub>W</sub>).</p></li>
<li><p><span class="math notranslate nohighlight">\(m_i\)</span> is the sample size of treatment group <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(m_0\)</span> is the sample size of the control group.</p></li>
</ul>
<p>The critical value <span class="math notranslate nohighlight">\(t_D^\ast\)</span> depends on the number of treatment groups, the degrees of freedom for the error term, and the desired significance level. We can find the critical value for a two-sided test with <span class="math notranslate nohighlight">\(\mathrm{DF_W} = 15\)</span>, <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span>, and <span class="math notranslate nohighlight">\(k = 4\)</span> groups (including the control/reference group) in <a class="reference external" href="https://www.statology.org/dunnetts-table/">precalculated Dunnett’s tables</a>: <span class="math notranslate nohighlight">\(t_D^\ast = 2.610\)</span>.</p>
<p>While Dunnett’s critical values are based on the assumption of <em>equal group sizes</em>, the formula is still reasonably accurate if the group sizes are not too different. However, for larger discrepancies in group sizes, it’s recommended to use more accurate methods that explicitly account for unequal variances, such as the Games-Howell test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the means and sample sizes for each &#39;Hair color&#39; group</span>
<span class="n">group_summary</span> <span class="o">=</span> <span class="n">data_anova</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Hair color&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Pain threshold&#39;</span><span class="p">]</span>

<span class="c1"># Critical value and degrees of freedom (from previous calculations)</span>
<span class="n">t_dunnett</span> <span class="o">=</span> <span class="mf">2.610</span>

<span class="c1"># Print the critical t value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical D value (α=0.05, DF_within=</span><span class="si">{</span><span class="n">DF_within</span><span class="si">}</span><span class="s2">, k=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_summary</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">t_dunnett</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compare each group to &#39;Light Blond&#39; and print significance</span>
<span class="n">control_mean</span> <span class="o">=</span> <span class="n">group_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">control_count</span> <span class="o">=</span> <span class="n">group_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dunnett&#39;s test results:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_summary</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">group</span><span class="o">!=</span> <span class="s1">&#39;Light Blond&#39;</span><span class="p">:</span>
        <span class="n">group_mean</span> <span class="o">=</span> <span class="n">group_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">group</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
        <span class="n">group_count</span> <span class="o">=</span> <span class="n">group_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">group</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">t_dunnett</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MS_within</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">group_count</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">control_count</span><span class="p">))</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">group_mean</span> <span class="o">-</span> <span class="n">control_mean</span><span class="p">)</span>
        <span class="n">significant</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">D</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comparison of &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; vs. &#39;Light Blond&#39;:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Critical D: </span><span class="si">{</span><span class="n">D</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Print critical D for each group</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Abosulte mean difference: </span><span class="si">{</span><span class="n">diff</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Significant: </span><span class="si">{</span><span class="n">significant</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical D value (α=0.05, DF_within=15, k=4): 2.610

Dunnett&#39;s test results:
Comparison of &#39;Dark Blond&#39; vs. &#39;Light Blond&#39;:
  - Critical D: 13.490
  - Abosulte mean difference: 8.000
  - Significant: False
Comparison of &#39;Dark Brunette&#39; vs. &#39;Light Blond&#39;:
  - Critical D: 13.490
  - Abosulte mean difference: 21.800
  - Significant: True
Comparison of &#39;Light Brunette&#39; vs. &#39;Light Blond&#39;:
  - Critical D: 14.308
  - Abosulte mean difference: 16.700
  - Significant: True
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/tutorial/stats/hypothesis_dunnett.html#hypothesis-dunnett">SciPy has implemented a Dunnett’s test</a>, which facilitates multiple comparisons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">dunnett</span>

<span class="c1"># Extract the data for each hair color group</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">color</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Dark Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Dark Brunette&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Brunette&#39;</span><span class="p">]</span>  <span class="c1"># Exclude &#39;Light Blond&#39; as it&#39;s the control</span>
<span class="p">]</span>
<span class="n">control</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Light Blond&#39;</span><span class="p">]</span>

<span class="c1"># Perform Dunnett&#39;s test</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">dunnett</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dunnett&#39;s test results:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Dark Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Dark Brunette&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Brunette&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2"> vs. Light Blond: Statistic = </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">statistic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">; P value = </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pvalue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dunnett&#39;s test results:
  - Dark Blond vs. Light Blond: Statistic = -1.55; P value = 0.3180
  - Dark Brunette vs. Light Blond: Statistic = -4.22; P value = 0.0021
  - Light Brunette vs. Light Blond: Statistic = -3.05; P value = 0.0217
</pre></div>
</div>
</div>
</div>
<p>Finally, we can perform Dunnett’s test in Python using the <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> library. This library provides a <a class="reference external" href="https://scikit-posthocs.readthedocs.io/en/latest/generated/scikit_posthocs.posthoc_dunnett.html#scikit_posthocs.posthoc_dunnett">function called <code class="docutils literal notranslate"><span class="pre">posthoc_dunnett</span></code> that performs Dunnett’s test</a> and returns the P values for each comparison, in one single command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform Dunnett&#39;s test</span>
<span class="n">dunnett_results</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_dunnett</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">control</span><span class="o">=</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span>
    <span class="n">to_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># We don&#39;t need a full matrix of P values</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dunnett_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Light Blond  Dark Blond        0.318017
             Dark Brunette     0.001998
             Light Brunette    0.021562
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a significance table from the Dunnett&#39;s test results</span>
<span class="c1"># This table provides a compact and visually clear representation of</span>
<span class="c1"># the significant pairwise comparisons between the groups.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">sign_table</span><span class="p">(</span><span class="n">dunnett_results</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                             0
Light Blond Dark Blond       -
            Dark Brunette   **
            Light Brunette   *
</pre></div>
</div>
</div>
</div>
</section>
<section id="bonferroni-s-correction">
<h3>Bonferroni’s correction<a class="headerlink" href="#bonferroni-s-correction" title="Link to this heading">#</a></h3>
<p>We already discussed the Bonferroni correction in the chapter about statistical significance. It involves dividing the desired overall significance level (α) by the number of comparisons. This ensures that if all the null hypotheses are true, the probability of observing at least one false positive among all comparisons is at most α. However, this correction can be overly conservative and may reduce the power to detect true effects.</p>
<p>We can use <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.sandbox.stats.multicomp.MultiComparison.html#statsmodels.sandbox.stats.multicomp.MultiComparison">the <code class="docutils literal notranslate"><span class="pre">MultiComparison</span></code> class</a> and <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.sandbox.stats.multicomp.MultiComparison.allpairtest.html#statsmodels.sandbox.stats.multicomp.MultiComparison.allpairtest">the <code class="docutils literal notranslate"><span class="pre">allpairtest</span></code> method in Statsmodels</a> to perform all pairwise comparisons and automatically apply the Bonferroni correction (or other corrections). This method utilizes the <code class="docutils literal notranslate"><span class="pre">ttest_ind</span></code> function from SciPy to conduct the t-tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiComparison</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="c1"># Create a MultiComparison object</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">MultiComparison</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">],</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">],</span>
    <span class="n">group_order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Dark Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Brunette&#39;</span><span class="p">,</span> <span class="s1">&#39;Dark Brunette&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Perform the t-tests with Bonferroni correction</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">testfunc</span><span class="o">=</span><span class="n">ttest_ind</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;class &#39;statsmodels.iolib.table.SimpleTable&#39;&gt;,
 (array([[1.41910013e+00, 1.93635267e-01],
         [3.37972803e+00, 1.17630597e-02],
         [4.09069711e+00, 3.48223555e-03],
         [1.64746896e+00, 1.43453719e-01],
         [2.47456515e+00, 3.84359203e-02],
         [1.05112356e+00, 3.28129133e-01]]),
  array([False, False,  True, False, False, False]),
  array([1.        , 0.07057836, 0.02089341, 0.86072231, 0.23061552,
         1.        ]),
  0.008512444610847103,
  0.008333333333333333),
 array([(&#39;Light Blond&#39;, &#39;Dark Blond&#39;, 1.4191, 0.1936, 1.    , False),
        (&#39;Light Blond&#39;, &#39;Light Brunette&#39;, 3.3797, 0.0118, 0.0706, False),
        (&#39;Light Blond&#39;, &#39;Dark Brunette&#39;, 4.0907, 0.0035, 0.0209,  True),
        (&#39;Dark Blond&#39;, &#39;Light Brunette&#39;, 1.6475, 0.1435, 0.8607, False),
        (&#39;Dark Blond&#39;, &#39;Dark Brunette&#39;, 2.4746, 0.0384, 0.2306, False),
        (&#39;Light Brunette&#39;, &#39;Dark Brunette&#39;, 1.0511, 0.3281, 1.    , False)],
       dtype=[(&#39;group1&#39;, &#39;O&#39;), (&#39;group2&#39;, &#39;O&#39;), (&#39;stat&#39;, &#39;&lt;f8&#39;), (&#39;pval&#39;, &#39;&lt;f8&#39;), (&#39;pval_corr&#39;, &#39;&lt;f8&#39;), (&#39;reject&#39;, &#39;?&#39;)]))
</pre></div>
</div>
</div>
</div>
<p>We can also use Pingouin to perform multiple comparison corrections for t-tests, including Bonferroni and other methods. These post-hoc corrections can be applied to one-way ANOVA as well as <em>other ANOVA designs</em>, providing flexibility in analyzing different experimental setups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">post_hocs_pingouin</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">pairwise_tests</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_anova</span><span class="p">,</span>
    <span class="n">padjust</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">post_hocs_pingouin</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Contrast</th>
      <th>A</th>
      <th>B</th>
      <th>Paired</th>
      <th>Parametric</th>
      <th>T</th>
      <th>dof</th>
      <th>alternative</th>
      <th>p-unc</th>
      <th>p-corr</th>
      <th>p-adjust</th>
      <th>BF10</th>
      <th>hedges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hair color</td>
      <td>Dark Blond</td>
      <td>Dark Brunette</td>
      <td>False</td>
      <td>True</td>
      <td>2.475</td>
      <td>8.000</td>
      <td>two-sided</td>
      <td>0.038</td>
      <td>0.231</td>
      <td>bonf</td>
      <td>2.183</td>
      <td>1.414</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hair color</td>
      <td>Dark Blond</td>
      <td>Light Blond</td>
      <td>False</td>
      <td>True</td>
      <td>-1.419</td>
      <td>8.000</td>
      <td>two-sided</td>
      <td>0.194</td>
      <td>1.000</td>
      <td>bonf</td>
      <td>0.875</td>
      <td>-0.811</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Hair color</td>
      <td>Dark Blond</td>
      <td>Light Brunette</td>
      <td>False</td>
      <td>True</td>
      <td>1.752</td>
      <td>6.563</td>
      <td>two-sided</td>
      <td>0.126</td>
      <td>0.756</td>
      <td>bonf</td>
      <td>1.133</td>
      <td>0.982</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Hair color</td>
      <td>Dark Brunette</td>
      <td>Light Blond</td>
      <td>False</td>
      <td>True</td>
      <td>-4.091</td>
      <td>8.000</td>
      <td>two-sided</td>
      <td>0.003</td>
      <td>0.021</td>
      <td>bonf</td>
      <td>10.877</td>
      <td>-2.337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Hair color</td>
      <td>Dark Brunette</td>
      <td>Light Brunette</td>
      <td>False</td>
      <td>True</td>
      <td>-1.106</td>
      <td>6.822</td>
      <td>two-sided</td>
      <td>0.306</td>
      <td>1.000</td>
      <td>bonf</td>
      <td>0.723</td>
      <td>-0.627</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Hair color</td>
      <td>Light Blond</td>
      <td>Light Brunette</td>
      <td>False</td>
      <td>True</td>
      <td>3.564</td>
      <td>6.772</td>
      <td>two-sided</td>
      <td>0.010</td>
      <td>0.058</td>
      <td>bonf</td>
      <td>5.498</td>
      <td>2.015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can use <a class="reference external" href="https://scikit-posthocs.readthedocs.io/en/latest/generated/scikit_posthocs.posthoc_ttest.html">the <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> library to perform various post-hoc tests</a>, including the Bonferroni correction, and the Holm-Bonferroni correction. This library offers similar functionality to <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and <code class="docutils literal notranslate"><span class="pre">pingouin</span></code>, but with some additional features. One notable advantage of <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code> is that it allows us to select the <em>pooled standard deviation (SD)</em> that should be used for the calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform t-tests with Bonferroni correction</span>
<span class="n">bonferroni_results</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_ttest</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
    <span class="n">pool_sd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">p_adjust</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bonferroni_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Light Blond  Dark Blond  Light Brunette  Dark Brunette
Light Blond        1.000000    1.000000        0.070578       0.020893
Dark Blond         1.000000    1.000000        0.860722       0.230616
Light Brunette     0.070578    0.860722        1.000000       1.000000
Dark Brunette      0.020893    0.230616        1.000000       1.000000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">sign_table</span><span class="p">(</span><span class="n">bonferroni_results</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Light Blond Dark Blond Light Brunette Dark Brunette
Light Blond              -         NS             NS             *
Dark Blond                          -             NS            NS
Light Brunette                                     -            NS
Dark Brunette                                                    -
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">ph</span><span class="o">.</span><span class="n">sign_plot</span><span class="p">(</span>
    <span class="n">bonferroni_results</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;#fb6a4a&#39;</span><span class="p">,</span> <span class="s1">&#39;#08306b&#39;</span><span class="p">,</span> <span class="s1">&#39;#4292c6&#39;</span><span class="p">,</span> <span class="s1">&#39;#c6dbef&#39;</span><span class="p">],</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cbar_ax_bbox</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>

<span class="c1"># Add plot title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Significance plot of t-tests with Bonferroni correction&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a907bcd488b42065fc53cd6ed1bbbb58ee9631bd90e1bea9d64e0b421208040c.png" src="_images/a907bcd488b42065fc53cd6ed1bbbb58ee9631bd90e1bea9d64e0b421208040c.png" />
</div>
</div>
<p>While the Bonferroni correction can be used to compare all pairs of means, it’s generally not the preferred method for that purpose. Tukey’s test offers more power for all pairwise comparisons, and Dunnett’s test is more powerful for comparing each group to a control.</p>
<p>However, the Bonferroni correction is valuable when we only need to compare a limited set of specific pairs of means. By focusing on a smaller number of comparisons, we can obtain narrower confidence intervals and increase the statistical power to detect differences. We can leverage <a class="reference external" href="https://pingouin-stats.org/build/html/generated/pingouin.multicomp.html">Pingouin’s <code class="docutils literal notranslate"><span class="pre">multicomp</span></code></a> to apply the Bonferroni correction. This function takes a list of P values and returns adjusted P values based on the chosen correction method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the pairs we&#39;re interested in</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Dark Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Blond&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Dark Brunette&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Brunette&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Light Blond&#39;</span><span class="p">,</span> <span class="s1">&#39;Light Brunette&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Loop over the pairs, perform t-tests, and collect P values</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="n">group1</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">group2</span> <span class="o">=</span> <span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">][</span><span class="n">data_anova</span><span class="p">[</span><span class="s1">&#39;Hair color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">t_statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">)</span>
    <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>

<span class="c1"># Apply Bonferroni correction using pingouin.multicomp</span>
<span class="n">_</span><span class="p">,</span> <span class="n">adjusted_p_values_bonf</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">multicomp</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">)</span>

<span class="c1"># Print the adjusted P values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted P values (Bonferroni) for selected pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">adjusted_p_values_bonf</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adjusted P values (Bonferroni) for selected pairs:
  - (&#39;Dark Blond&#39;, &#39;Light Blond&#39;): 0.581
  - (&#39;Dark Brunette&#39;, &#39;Light Brunette&#39;): 0.984
  - (&#39;Light Blond&#39;, &#39;Light Brunette&#39;): 0.035
</pre></div>
</div>
</div>
</div>
<p>Remind that the Bonferroni correction controls the family-wise error rate (FWER) by dividing the significance level (α) by the number of comparisons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjust P values using Bonferroni correction</span>
<span class="n">n_comparisons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_values</span><span class="p">)</span>  <span class="c1"># Number of comparisons</span>
<span class="n">adjusted_p_values_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_values</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_comparisons</span>  <span class="c1"># Multiply each P value by the number of comparisons</span>

<span class="c1"># Print the adjusted P values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted P values (Bonferroni):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">adjusted_p_values_manual</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adjusted P values (Bonferroni):
(&#39;Dark Blond&#39;, &#39;Light Blond&#39;): 0.581
(&#39;Dark Brunette&#39;, &#39;Light Brunette&#39;): 0.984
(&#39;Light Blond&#39;, &#39;Light Brunette&#39;): 0.035
</pre></div>
</div>
</div>
</div>
</section>
<section id="other-multiple-comparison-adjustments">
<h3>Other multiple comparison adjustments<a class="headerlink" href="#other-multiple-comparison-adjustments" title="Link to this heading">#</a></h3>
<p>Beyond the Tukey and Dunnett tests, and Bonferroni correction, several other methods can be used to adjust P values for multiple comparisons. These methods offer different ways to control the family-wise error rate or the false discovery rate, depending on the specific needs of the analysis.</p>
<ul class="simple">
<li><p><em>Holm’s test</em>: the Holm multiple comparisons test is a powerful and versatile method that can be used to compare all pairs of means, compare each group mean to a control mean, or compare preselected pairs of means. It determines which P values are low enough for the corresponding comparison to be declared statistically significant, adjusting the significance threshold based on the rank of the P values. The threshold for the smallest P value is much smaller than the threshold for the largest P value. Holm’s test is generally considered superior to the Bonferroni adjustment due to its increased power while still controlling the family-wise error rate. However, it cannot compute confidence intervals.</p></li>
<li><p><em>Holm-Sidak test</em>: the Holm-Sidak test is a modified version of Holm’s test that is slightly more powerful, especially when there are many comparisons.</p></li>
<li><p><em>Benjamini-Hochberg FDR (FDR BH) correction</em>: a philosophically different and more powerful adjustment method is the Benjamini-Hochberg procedure. This method controls the false discovery rate (FDR), which is the expected proportion of false positives among all positives that rejected the null hypothesis. In other words, FDR is the expected proportion of false positives among all the rejected null hypotheses, not among all the tests undertaken. We explained in details the concept of BH correction in the chapter on statistical significance.</p></li>
</ul>
<p>We can leverage functions like <code class="docutils literal notranslate"><span class="pre">statsmodels.stats.multitest.multipletests</span></code> to apply these post-hoc corrections. Like Pingouin’s <code class="docutils literal notranslate"><span class="pre">multicomp</span></code>, this function takes a list of P values and returns adjusted P values based on the chosen correction method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">multipletests</span>

<span class="c1"># Apply Holm correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">_</span><span class="p">,</span> <span class="n">adjusted_p_values_holm</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">)</span>

<span class="c1"># Print the adjusted P values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted P values (Holm) for selected pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">adjusted_p_values_holm</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adjusted P values (Holm) for selected pairs:
  - (&#39;Dark Blond&#39;, &#39;Light Blond&#39;): 0.387
  - (&#39;Dark Brunette&#39;, &#39;Light Brunette&#39;): 0.387
  - (&#39;Light Blond&#39;, &#39;Light Brunette&#39;): 0.035
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply Holm-Sidak correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">_</span><span class="p">,</span> <span class="n">adjusted_p_values_holm_sidak</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm-sidak&#39;</span><span class="p">)</span>

<span class="c1"># Print the adjusted P values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted P values (Holm-Sidak) for selected pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">adjusted_p_values_holm_sidak</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adjusted P values (Holm-Sidak) for selected pairs:
  - (&#39;Dark Blond&#39;, &#39;Light Blond&#39;): 0.350
  - (&#39;Dark Brunette&#39;, &#39;Light Brunette&#39;): 0.350
  - (&#39;Light Blond&#39;, &#39;Light Brunette&#39;): 0.035
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply FDR BH correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">_</span><span class="p">,</span> <span class="n">adjusted_p_values_bh</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">)</span>

<span class="c1"># Print the adjusted P values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted P values (FDR BH) for selected pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">p_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">adjusted_p_values_bh</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adjusted P values (FDR BH) for selected pairs:
  - (&#39;Dark Blond&#39;, &#39;Light Blond&#39;): 0.290
  - (&#39;Dark Brunette&#39;, &#39;Light Brunette&#39;): 0.328
  - (&#39;Light Blond&#39;, &#39;Light Brunette&#39;): 0.035
</pre></div>
</div>
</div>
</div>
<p>The Scheffé method is a versatile multiple comparisons test that can be used to compare all possible pairs of means, as well as any other subsets of means of interest. Unlike some other tests, the Scheffé method does not require specifying the specific comparisons beforehand. However, this flexibility comes at a cost: the confidence intervals generated by Scheffé’s method are wider than those generated by other methods, such as Tukey’s HSD test. This means that the Scheffé test has less statistical power to detect differences between groups.</p>
<p>The Scheffé method can be implemented using <a class="reference external" href="https://scikit-posthocs.readthedocs.io/en/latest/generated/scikit_posthocs.posthoc_scheffe.html">the <code class="docutils literal notranslate"><span class="pre">posthoc_scheffe</span></code> function from the scikit-posthocs library</a>. This function takes the data and the grouping variable as input and returns the results of the Scheffé test, including the confidence intervals for all pairwise comparisons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform t-tests with Scheffé correction</span>
<span class="n">scheffe_results</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_scheffe</span><span class="p">(</span>
    <span class="n">data_anova</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="s1">&#39;Pain threshold&#39;</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="s1">&#39;Hair color&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scheffe_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Light Blond  Dark Blond  Light Brunette  Dark Brunette
Light Blond        1.000000    0.513716        0.058896       0.007094
Dark Blond         0.513716    1.000000        0.493151       0.110869
Light Brunette     0.058896    0.493151        1.000000       0.833008
Dark Brunette      0.007094    0.110869        0.833008       1.000000
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>In this chapter, we’ve explored the key concepts of ANOVA, a powerful statistical method for comparing means across different groups. We’ve seen how ANOVA can be applied to various research questions in biostatistics, helping us understand the effects of different factors on biological phenomena.</p>
<p>We’ve learned that choosing the appropriate ANOVA test is crucial, as the choice depends on the research design and the assumptions about the data. We discussed one-way ANOVA, repeated measures ANOVA, mixed-design ANOVA, and N-way ANOVA, each suitable for different experimental setups and research questions.</p>
<p>We also highlighted that one-way ANOVA can be seen as a regression model with a single categorical predictor, providing a connection between ANOVA and regression analysis.</p>
<p>Throughout the chapter, we’ve emphasized the advantages of using Python for performing ANOVA analysis. Python’s libraries, such as Pingouin, Statsmodels, SciPy, and <code class="docutils literal notranslate"><span class="pre">scikit-posthocs</span></code>, a library dedicated to posthoc analysis, offer a versatile and user-friendly toolkit for conducting various ANOVA designs and post-hoc tests.</p>
<p>By combining the theoretical understanding of ANOVA with the practical tools available in Python, we’ve gained a comprehensive understanding of how to analyze complex datasets and draw meaningful conclusions from our research.</p>
<p>With the knowledge and skills we’ve acquired in this chapter, we’re well-equipped to tackle a wide range of research questions and unlock the secrets hidden within our data.</p>
</section>
<section id="cheat-sheet">
<h2>Cheat sheet<a class="headerlink" href="#cheat-sheet" title="Link to this heading">#</a></h2>
<section id="one-way-anova">
<h3>One-way ANOVA<a class="headerlink" href="#one-way-anova" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Overlay the stripplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span>
<span class="p">)</span>

<span class="c1"># Normality test</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pingouin</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pg</span>

<span class="n">pg</span><span class="o">.</span><span class="n">normality</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Homoscedasticity</span>
<span class="n">pg</span><span class="o">.</span><span class="n">homoscedasticity</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># ANOVA using Pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># ANOVA using Statsmodels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ols</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;y ~ C(x)&quot;</span>

<span class="c1"># Prepare the one-way ANOVA model using statsmodels</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the model summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary2</span><span class="p">())</span>

<span class="c1"># Print the associated ANOVA table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.anova</span><span class="w"> </span><span class="kn">import</span> <span class="n">anova_lm</span>

<span class="n">anova_lm</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3>Repeated measures ANOVA<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare a long-format dataframe</span>
<span class="n">data_long</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
    <span class="n">var_name</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">value_name</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Create the paired plot</span>
<span class="n">pg</span><span class="o">.</span><span class="n">plot_paired</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="n">y</span><span class="p">),</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Test for sphericity</span>
<span class="n">pg</span><span class="o">.</span><span class="n">sphericity</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span>

<span class="c1"># rmANOVA using Pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span>

<span class="c1"># rmANOVA using Statsmodels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.anova</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnovaRM</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">AnovaRM</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">,</span>
    <span class="n">depvar</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Print the ANOVA table</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="non-parametric-anova">
<h3>Non-parametric ANOVA<a class="headerlink" href="#non-parametric-anova" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform the Kruskal-Wallis test using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Perform Friedman&#39;s test</span>
<span class="n">pg</span><span class="o">.</span><span class="n">friedman</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">c</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Two-way ANOVA<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>

<span class="c1"># Overlay the stripplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Perform two-way ANOVA using Pingouin</span>
<span class="n">data</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">],</span>
    <span class="c1">#ss_type=2,  # For unbalanced designs</span>
<span class="p">)</span>

<span class="c1"># Perform two-way ANOVA using Statsmodels</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;y ~ C(x)*C(g)&quot;</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">anova_lm</span><span class="p">(</span>
    <span class="n">results</span><span class="p">,</span>
    <span class="c1">#typ=2,  # For unbalanced designs</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Special designs<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<section id="id4">
<h4>Mixed-design ANOVA<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform mixed-design ANOVA using Pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">mixed_anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="n">g</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id5">
<h3>N-way ANOVA<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the catplot with &#39;Drug&#39; as the panel separation</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
    <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Perform three-way ANOVA with Pingouin</span>
<span class="n">data</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
    <span class="c1">#ss_type=2,  # For unbalanced designs</span>
<span class="p">)</span>

<span class="c1"># Perform three-way ANOVA with statsmodels</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s2">&quot;y ~ x * a * b&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">anova_lm</span><span class="p">(</span>
    <span class="n">results</span><span class="p">,</span>
    <span class="c1">#typ=2,  # For unbalanced designs</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="id6">
<h4>Two-way repeated measures ANOVA<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Two-way repeated measures ANOVA with Pingouin</span>
<span class="n">data</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Perform rmANOVA using AnovaRM</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AnovaRM</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">depvar</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
    <span class="n">within</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="ancova">
<h4>ANCOVA<a class="headerlink" href="#ancova" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform ANCOVA using pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">ancova</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">covar</span><span class="o">=</span><span class="p">[</span><span class="n">g</span><span class="p">],</span>
    <span class="n">between</span><span class="o">=</span><span class="n">x</span>
<span class="p">)</span>

<span class="c1"># Repeated measures correlation</span>
<span class="n">pg</span><span class="o">.</span><span class="n">rm_corr</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>

<span class="c1"># Create the repeated measures correlation plot</span>
<span class="n">pg</span><span class="o">.</span><span class="n">plot_rm_corr</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="multiple-comparison-posthoc-analysis">
<h3>Multiple comparison posthoc analysis<a class="headerlink" href="#multiple-comparison-posthoc-analysis" title="Link to this heading">#</a></h3>
<section id="tukey-hsd-and-tukey-kramer">
<h4>Tukey HSD and Tukey-Kramer<a class="headerlink" href="#tukey-hsd-and-tukey-kramer" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tukey multiple comparison using Statsmodels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_tukeyhsd</span>

<span class="n">tukeyhsd</span> <span class="o">=</span> <span class="n">pairwise_tukeyhsd</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukeyhsd</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="n">q_crit</span> <span class="o">=</span> <span class="n">tukeyhsd</span><span class="o">.</span><span class="n">q_crit</span>  <span class="c1">#Critical value</span>

<span class="c1"># Plot the results of the Tukey HSD test</span>
<span class="n">tukeyhsd</span><span class="o">.</span><span class="n">plot_simultaneous</span><span class="p">(</span><span class="n">comparison_name</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>


<span class="c1"># Perform Tukey&#39;s tests using Pingouin</span>
<span class="c1"># Unbalanced design (Tukey-Kramer) automatically handled</span>
<span class="n">pg</span><span class="o">.</span><span class="n">pairwise_tukey</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># Tukey&#39;s HSD test using scikit_posthocs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scikit_posthocs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ph</span>

<span class="n">tukey_hsd</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_tukey_hsd</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukey_hsd</span><span class="p">)</span>

<span class="c1"># Create a significance table from the Tukey HSD results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">sign_table</span><span class="p">(</span><span class="n">tukey_hsd</span><span class="p">))</span>

<span class="c1"># Create a significance plot from the Tukey HSD results</span>
<span class="n">ph</span><span class="o">.</span><span class="n">sign_plot</span><span class="p">(</span><span class="n">tukey_hsd</span><span class="p">,)</span>
</pre></div>
</div>
</section>
<section id="id7">
<h4>Dunnett’s test<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dunnett&#39;s test using SciPy (new)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">dunnett</span>

<span class="c1"># Extract the data for each group</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">,</span> <span class="n">group3</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">control</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">reference</span><span class="p">]</span>

<span class="c1"># Perform Dunnett&#39;s test</span>
<span class="n">dunnett</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>

<span class="c1"># Perform Dunnett&#39;s test with scikit-posthocs</span>
<span class="n">ph</span><span class="o">.</span><span class="n">posthoc_dunnett</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">control</span><span class="o">=</span><span class="n">reference</span><span class="p">,</span>
    <span class="n">to_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id8">
<h4>Bonferroni’s correction<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bonferroni&#39;s correction using SciPy and Statsmodels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiComparison</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="c1"># Create a MultiComparison object</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">MultiComparison</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">],</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Perform the t-tests with Bonferroni correction</span>
<span class="n">mod</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">testfunc</span><span class="o">=</span><span class="n">ttest_ind</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">)</span>

<span class="c1"># Bonferroni&#39;s correction using Pingouin</span>
<span class="n">pg</span><span class="o">.</span><span class="n">pairwise_tests</span><span class="p">(</span>
    <span class="n">dv</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">between</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">padjust</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Perform t-tests with Bonferroni correction in scikit-posthocs</span>
<span class="n">bonferroni_results</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">posthoc_ttest</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">val_col</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
    <span class="n">group_col</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">pool_sd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">p_adjust</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bonferroni_results</span><span class="p">)</span>

<span class="c1"># Significance table</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">sign_table</span><span class="p">(</span><span class="n">bonferroni_results</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Significance plot</span>
<span class="n">ph</span><span class="o">.</span><span class="n">sign_plot</span><span class="p">(</span><span class="n">bonferroni_results</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id9">
<h4>Other multiple comparison adjustments<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multicomp</span>
<span class="c1"># Specify the pairs we&#39;re interested in</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Loop over the pairs, perform t-tests, and collect P values</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="n">group1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">group2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">t_statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">)</span>
    <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>

<span class="c1"># Apply Bonferroni correction using pingouin.multicomp</span>
<span class="n">pg</span><span class="o">.</span><span class="n">multicomp</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonf&#39;</span><span class="p">)</span>

<span class="c1"># Multiple comparison adjustments using Statsmodels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">multipletests</span>

<span class="c1"># Apply Holm correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">)</span>

<span class="c1"># Apply Holm-Sidak correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm-sidak&#39;</span><span class="p">)</span>

<span class="c1"># Apply FDR BH correction on the previous list of P values using statsmodels multipletests</span>
<span class="n">multipletests</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">)</span>

<span class="c1"># Perform t-tests with Scheffé correction in scikit-posthocs</span>
<span class="n">ph</span><span class="o">.</span><span class="n">posthoc_scheffe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val_col</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="session-information">
<h2>Session information<a class="headerlink" href="#session-information" title="Link to this heading">#</a></h2>
<p>The output below details all packages and version necessary to reproduce the results in this report.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>--version
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="c1"># List of packages we want to check the version</span>
<span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="s1">&#39;statsmodels&#39;</span><span class="p">,</span> <span class="s1">&#39;pingouin&#39;</span><span class="p">,</span> <span class="s1">&#39;scikit_posthocs&#39;</span><span class="p">,</span> <span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn&#39;</span><span class="p">]</span>

<span class="c1"># Initialize an empty list to store the versions</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop over the packages</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the version of the package</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="c1"># Append the version to the list</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Use a more general exception for broader compatibility</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Not installed&#39;</span><span class="p">)</span>

<span class="c1"># Print the versions</span>
<span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.12.9
-------------
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy: 1.26.4
pandas: 2.2.2
scipy: 1.14.1
statsmodels: 0.14.2
pingouin: 0.5.5
scikit_posthocs: 0.11.2
matplotlib: 3.9.2
seaborn: 0.13.2
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="38%20-%20Logistic%20regression.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Logistic regression</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathematical-concepts">Mathematical concepts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variance">Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-sum-of-squares">Partitioning the sum of squares</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#f-statistic">F-statistic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#p-value">P value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-size">Effect size</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eta-squared">Eta-squared</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#omega-squared">Omega-squared</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-anova-manually">Calculating ANOVA manually</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-the-anova-table">Manual calculation of the ANOVA table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anova-table">ANOVA table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anova-reconstruction-from-summary-data">ANOVA reconstruction from summary data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-ssb">Calculating SSB</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-ssw">Calculating SSW</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-f-distribution-and-critical-values">Visualizing the F-distribution and critical values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-application-with-python">Practical application with Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-with-pingouin">One-way ANOVA with Pingouin</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality-test">Normality test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity">Homoscedasticity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conducting-the-anova">Conducting the ANOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-with-scipy-stats">One-way ANOVA with scipy.stats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova-using-statsmodels">One-way ANOVA using statsmodels</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova">Repeated measures ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-variance-in-rmanova">Partitioning variance in rmANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-f-statistic">Calculating the F-statistic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-rmanova">Advantages of rmANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-rmanova-manually">Calculating rmANOVA Manually</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova-using-python">Repeated measures ANOVA using Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rmanova-using-pingouin">rmANOVA using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repeated-measures-anova-using-statsmodels">Repeated measures ANOVA using statsmodels</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-methods">Non-parametric methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test">Kruskal-Wallis test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test-using-pingouin">Kruskal-Wallis test using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kruskal-wallis-test-using-scipy">Kruskal-Wallis test using SciPy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test">Friedman’s test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test-using-pingouin">Friedman’s test using Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#friedman-s-test-using-scipy">Friedman’s test using SciPy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova">Two-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-of-two-way-anova">Example of two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-two-way-anova-works">How two-way ANOVA works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-calculation-of-two-way-anova">Manual calculation of two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-f-ratios-and-p-values-in-two-way-anova">Visualizing F-ratios and P values in two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-using-python">Two-way ANOVA using Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-with-pingouin">Two-way ANOVA with Pingouin</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-anova-with-statsmodels">Two-way ANOVA with statsmodels</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unbalanced-design-in-two-way-anova">Unbalanced design in two-way ANOVA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-designs">Special designs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mixed-design-anova">Mixed-design ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#n-way-anova">N-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-repeated-measures-anova">Two-way repeated measures ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-covariance-ancova">Analysis of covariance (ANCOVA)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-comparison-tests-after-anova">Multiple comparison tests after ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-s-hsd-test">Tukey’s HSD test</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-confidence-intervals-for-mean-differences">Calculating confidence intervals for mean differences</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-studentized-range-distribution">The Studentized range distribution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-kramer-test-for-unequal-sample-sizes">Tukey-Kramer test for unequal sample sizes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-multiple-comparison-with-python">Tukey multiple comparison with Python</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dunnett-s-test">Dunnett’s test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-s-correction">Bonferroni’s correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-multiple-comparison-adjustments">Other multiple comparison adjustments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-anova">One-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Repeated measures ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-anova">Non-parametric ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Two-way ANOVA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Special designs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Mixed-design ANOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">N-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Two-way repeated measures ANOVA</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ancova">ANCOVA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-comparison-posthoc-analysis">Multiple comparison posthoc analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-hsd-and-tukey-kramer">Tukey HSD and Tukey-Kramer</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Dunnett’s test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Bonferroni’s correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Other multiple comparison adjustments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sébastien Wieckowski
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>