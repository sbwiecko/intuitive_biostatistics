
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Comparing survival curves &#8212; The Python Companion of Intuitive Biostatistics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QQY9FLLPJ8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QQY9FLLPJ8');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '29 - Comparing survival curves';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Comparing two unpaired means" href="30%20-%20Comparing%20two%20unpaired%20means.html" />
    <link rel="prev" title="Comparing proportions" href="27%20-%20Comparing%20proportions.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="The Python Companion of Intuitive Biostatistics - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="The Python Companion of Intuitive Biostatistics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Python Companion Guide to “Intuitive Biostatistics”
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Continuous variables</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="09%20-%20Quantifying%20scatter%20of%20continuous%20data.html">Quantifying scatter of continuous data</a></li>
<li class="toctree-l1"><a class="reference internal" href="10%20-%20Gaussian%20distribution.html">The Gaussian distribution</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Confidence intervals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="12%20-%20Confidence%20interval%20of%20a%20mean.html">Confidence interval of a mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="04%20-%20Confidence%20interval%20of%20a%20proportion.html">Confidence interval of a proportion</a></li>
<li class="toctree-l1"><a class="reference internal" href="05%20-%20Confidence%20interval%20of%20survival%20data.html">Confidence interval of survival data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06%20-%20Confidence%20interval%20of%20counted%20data.html">Confidence interval of counted data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical significance and data assumptions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="15%20-%20Statistical%20significance.html">Statistical significance</a></li>
<li class="toctree-l1"><a class="reference internal" href="20%20-%20Statistical%20power%20and%20sample%20size.html">Statistical power and sample size</a></li>
<li class="toctree-l1"><a class="reference internal" href="24%20-%20Normality%20tests%20and%20outliers.html">Normality tests and outliers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical tests</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="27%20-%20Comparing%20proportions.html">Comparing proportions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Comparing survival curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="30%20-%20Comparing%20two%20unpaired%20means.html">Comparing two unpaired means</a></li>
<li class="toctree-l1"><a class="reference internal" href="31%20-%20Comparing%20paired%20data.html">Comparing paired data</a></li>
<li class="toctree-l1"><a class="reference internal" href="32%20-%20Correlation.html">Correlation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fitting models to data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="33%20-%20Simple%20linear%20regression.html">Simple linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="35%20-%20Comparing%20models.html">Comparing models</a></li>
<li class="toctree-l1"><a class="reference internal" href="36%20-%20Nonlinear%20regression.html">Nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="37%20-%20Multiple%20regression.html">Multiple regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="38%20-%20Logistic%20regression.html">Logistic regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The rest of statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="39%20-%20ANOVA.html">ANOVA</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sbwiecko/intuitive_biostatistics/edit/master/29 - Comparing survival curves.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/29 - Comparing survival curves.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Comparing survival curves</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prednisolone-case-study">Prednisolone case study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-dates-in-survival-analysis">Handling dates in survival analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kaplan-meier-analysis">Kaplan-Meier analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-the-curves">Beyond the curves</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#median-survival">Median survival</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-predictions">Survival predictions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-function">Survival function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-log-rank-test">Non-parametric log-rank test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-little-bit-of-theory">A little bit of theory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-log-rank-test-in-python">Using log-rank test in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantel-haenszel-method">Mantel-Haenszel method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gehan-breslow-wilcoxon-method">Gehan-Breslow-Wilcoxon method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-ratio-for-quantifying-relative-risk">Hazard ratio for quantifying relative risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unveiling-hazards-with-the-nelson-aalen-estimator">Unveiling hazards with the Nelson-Aalen estimator</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mathematics-behind-the-model">The mathematics behind the model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-nelsonaalenfitter">Using the <code class="docutils literal notranslate"><span class="pre">NelsonAalenFitter</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connection-to-kaplan-meier-survival">Connection to Kaplan-Meier survival</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-link-with-hazard-ratio">The link with hazard ratio</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cox-proportional-hazards-model">Cox proportional hazards model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-cox-ph-model">Interpreting the Cox PH model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-the-proportional-hazards-assumption">Assessing the proportional hazards assumption</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-impact-of-covariate-on-survival">Visualizing the impact of covariate on survival</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-weibull-parametric-model">The Weibull parametric model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-to-the-prednisolone-data">Application to the prednisolone data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit">Goodness-of-fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-estimates">Parameters estimates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weibull-regression">Weibull regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-and-prediction-with-weibull-model">Visualization and prediction with Weibull model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-parametric-models">Alternative parametric models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kaplan-meier">Kaplan-Meier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-log-rank">Non-parametric log-rank</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nelson-aalen-cumulative-hazard">Nelson-Aalen cumulative hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-parametric-cox-ph">Semi-parametric Cox PH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametric-weibull">Parametric Weibull</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-and-visualization">Fitting and visualization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit-qq-plot">Goodness-of-fit (QQ plot)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aft-regression">AFT regression</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Alternative parametric models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="comparing-survival-curves">
<h1>Comparing survival curves<a class="headerlink" href="#comparing-survival-curves" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Survival analysis is more than just tracking mortality; it’s about understanding the time until any defined event occurs, be it disease progression, mechanical failure, or even customer churn. In this chapter we delve into the powerful tools and techniques used to compare survival experiences, empowering us to discern crucial patterns and differences in time-to-event data.</p>
<p>From creating insightful visualizations of survival patterns with Kaplan-Meier curves to rigorously testing for differences using the log-rank test, and further exploring the complexities of survival data through both semi-parametric Cox PH models and parametric Weibull regression, the <a class="reference external" href="https://lifelines.readthedocs.io/en/stable/index.html">lifelines library in Python</a> provides an accessible and powerful platform for conducting comprehensive survival analyses.</p>
</section>
<section id="prednisolone-case-study">
<h2>Prednisolone case study<a class="headerlink" href="#prednisolone-case-study" title="Link to this heading">#</a></h2>
<p>We’ll apply the Kaplan-Meier method to a real-world dataset. Inspired by an example from <a class="reference external" href="https://global.oup.com/ushe/product/intuitive-biostatistics-9780190643560">Intuitive Biostatistics 4th Edition book by Harvey Motulsky</a>, we reanalyze the data from a prospective controlled trial of prednisolone therapy in hepatitis B surface antigen negative chronic active hepatitis, as discussed by <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1113717/">Altman and Bland</a>. These patients were randomized into two distinct groups; one received treatment with <em>prednisolone</em> and the other received a placebo.</p>
<p>This example will serve as the bedrock for our exploration of advanced survival analysis techniques, including hazard ratio estimation and more.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lifelines</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lifelines version:&#39;</span><span class="p">,</span> <span class="n">lifelines</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lifelines version: 0.29.0
</pre></div>
</div>
</div>
</div>
<p>We first prepare the data by ensuring durations and censoring indicators are in the correct format. We simply enter the table from the original article manually into a DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Time in months</span>
        <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span>           <span class="c1"># control</span>
        <span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">131</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">148</span><span class="p">,</span><span class="mi">162</span><span class="p">,</span><span class="mi">168</span><span class="p">,</span><span class="mi">173</span><span class="p">,</span><span class="mi">181</span><span class="p">,</span>  <span class="c1"># PRED</span>
    <span class="p">],</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>   <span class="c1"># 1:death</span>
        <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>   <span class="c1"># 0:censored</span>
    <span class="p">],</span>
    <span class="s1">&#39;PRED&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="mi">22</span> <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="mi">22</span><span class="p">,</span>  <span class="c1"># encode the treatment group as True or False</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T</th>
      <th>E</th>
      <th>PRED</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>1</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="handling-dates-in-survival-analysis">
<h3>Handling dates in survival analysis<a class="headerlink" href="#handling-dates-in-survival-analysis" title="Link to this heading">#</a></h3>
<p>In real-world scenarios, survival data often involves dates rather than numeric durations. To accommodate this, we’ll demonstrate how to convert dates into a format compatible with lifelines.</p>
<p>First, we ensure our dataset includes a censoring indicator. Here, we assume that non-null values in the ‘Death’ column represent events (deaths), while nulls indicate censoring:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Censored&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we calculate durations in days from a reference date (‘D0’) for both events and censored observations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Censored&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Death&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;D0&#39;</span><span class="p">],</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;D0&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>For scenarios where we start with pure date strings, lifelines offers a convenient helper function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetimes_to_durations</span>

<span class="n">start_date</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2013-10-10 0:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-10-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-10-10&#39;</span><span class="p">]</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2013-10-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-10-10&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">T</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">datetimes_to_durations</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">,</span> 
    <span class="n">fill_date</span><span class="o">=</span><span class="s1">&#39;2013-10-15&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</section>
<section id="kaplan-meier-analysis">
<h3>Kaplan-Meier analysis<a class="headerlink" href="#kaplan-meier-analysis" title="Link to this heading">#</a></h3>
<p>In the following code, we’re performing a Kaplan-Meier survival analysis to visualize and compare the survival experiences of the two patient groups. We use the <code class="docutils literal notranslate"><span class="pre">KaplanMeierFitter</span></code> from the lifelines library to fit survival curves for each group and plot them on the same graph. We also customize the plot’s appearance for clarity and visual appeal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeierFitter</span>

<span class="n">kmf_ctrl</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;placebo (KM)&#39;</span><span class="p">)</span>
<span class="n">kmf_pred</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone (KM)&#39;</span><span class="p">)</span>

<span class="c1"># Define censor styles once for reuse</span>
<span class="n">censor_styles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>

<span class="c1"># Filter data directly within the .fit() call</span>
<span class="c1"># Fit and plot for prednisolone group</span>
<span class="n">kmf_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">durations</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="c1"># label=&#39;prednisolone (KM)&#39;,</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span>
    <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ci_alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
    <span class="n">censor_styles</span><span class="o">=</span><span class="n">censor_styles</span><span class="p">)</span>

<span class="c1"># Extract median survival times of the prednisolone group</span>
<span class="n">median_survival_pred</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">median_survival_time_</span>


<span class="c1"># Fit and plot for control placebo group on the same axes</span>
<span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
<span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ci_alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
    <span class="n">censor_styles</span><span class="o">=</span><span class="n">censor_styles</span><span class="p">)</span>

<span class="c1"># Extract median survival times of the placebo group</span>
<span class="n">median_survival_ctrl</span> <span class="o">=</span> <span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">median_survival_time_</span>

<span class="c1"># Customize plot appearance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Months of follow-up&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion survival&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;Kaplan-Meier analysis&#39;</span><span class="p">,</span>
    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
<span class="c1"># plt.savefig(&#39;survival.svg&#39;);</span>
<span class="c1"># It&#39;s also possible to generate a Plotly plot using the .mpl_to_plotly()</span>
<span class="c1"># method, see https://plot.ly/ipython-notebooks/survival-analysis-r-vs-python/</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a3375d799fa4a50af9df71377c309429d3945f1a6b350d7a5f502a20bc22c2c0.png" src="_images/a3375d799fa4a50af9df71377c309429d3945f1a6b350d7a5f502a20bc22c2c0.png" />
</div>
</div>
<p>The Kaplan-Meier curves visually depict the survival experiences of the two groups. Both curves initially start at 100%, indicating that all patients are alive at the beginning of the study. However, they diverge notably over time. The separation between the curves, particularly during the initial months, strongly suggests that the treatment had a positive impact on survival.</p>
</section>
<section id="beyond-the-curves">
<h3>Beyond the curves<a class="headerlink" href="#beyond-the-curves" title="Link to this heading">#</a></h3>
<p>The Kaplan-Meier curves paint a visual story, but the <code class="docutils literal notranslate"><span class="pre">KaplanMeierFitter</span></code> object holds a treasure trove of insights beyond the plot. Let’s delve deeper into its capabilities, extracting key metrics and making predictions to enhance our understanding of the survival patterns.</p>
<section id="median-survival">
<h4>Median survival<a class="headerlink" href="#median-survival" title="Link to this heading">#</a></h4>
<p>The median survival time, the point at which 50% of the subjects have experienced the event (in this case, death), is a commonly used summary statistic in survival analysis. We can calculate the ratio of median survival times between the two groups to quantify the treatment’s effect. Additionally, under the assumption of proportional hazards, we can estimate a 95% confidence interval for this ratio, providing a measure of uncertainty around our estimate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median survival time for prednisolone group: </span><span class="si">{</span><span class="n">median_survival_pred</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median survival time for control group: </span><span class="si">{</span><span class="n">median_survival_ctrl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Median survival time for prednisolone group: 146.0
Median survival time for control group: 40.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="survival-predictions">
<h4>Survival predictions<a class="headerlink" href="#survival-predictions" title="Link to this heading">#</a></h4>
<p>While median survival time is valuable, other statistics like mean time until death or five-year survival might not always be as informative in survival analysis. This is because these statistics can be heavily influenced by censoring, where some patients are lost to follow-up or the study ends before they experience the event.</p>
<p>Nevertheless, we can easily predict the survival probability at specific time points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">month</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">12</span>  <span class="c1"># 5-year survival</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Survival prediction at month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">_label</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="si">{</span><span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">kmf_pred</span><span class="o">.</span><span class="n">_label</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">kmf_pred</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Survival prediction at month 60:
Group placebo (KM):	0.4
Group prednisolone (KM):0.8
</pre></div>
</div>
</div>
</div>
</section>
<section id="survival-function">
<h4>Survival function<a class="headerlink" href="#survival-function" title="Link to this heading">#</a></h4>
<p>Provides the estimated probability of surviving beyond any given time point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">kmf_pred</span><span class="o">.</span><span class="n">survival_function_</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># Series returned</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          prednisolone (KM)
timeline                   
0.0                1.000000
2.0                0.954545
6.0                0.909091
12.0               0.863636
54.0               0.818182
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="non-parametric-log-rank-test">
<h2>Non-parametric log-rank test<a class="headerlink" href="#non-parametric-log-rank-test" title="Link to this heading">#</a></h2>
<section id="a-little-bit-of-theory">
<h3>A little bit of theory<a class="headerlink" href="#a-little-bit-of-theory" title="Link to this heading">#</a></h3>
<p>In survival analysis, <strong>non-parametric</strong> tests shine when we make no assumptions about the underlying shape of the survival curves. They offer flexibility, especially when the data doesn’t neatly fit into predefined distributions. In contrast, <strong>parametric</strong> tests rely on specific distributional assumptions (e.g., Weibull, exponential) to model the survival data.</p>
<p>The log-rank test, also known as the <strong>Mantel-Cox test</strong>, evaluates the null hypothesis that there’s <em>no difference in survival between two or more groups</em>: <span class="math notranslate nohighlight">\(S_A(t) = S_B(t) = \dots \)</span>. It essentially compares the observed number of events (e.g., deaths) in each group at each distinct event time to the number of events we would expect if there were no difference in survival between the groups. It then combines these comparisons across all event times to assess the overall evidence against the null hypothesis of equal survival. It’s step-by-step breakdown can be summarized as follows:</p>
<ol class="arabic">
<li><p>Pooling the data: the log-rank test starts by pooling all the event times from all groups, creating a combined timeline of events.</p></li>
<li><p>Calculating expected events: at each event time on this combined timeline, the test calculates the expected number of events for each group. This is done under the null hypothesis that the survival curves are the same for all groups. The expected number of events for a group at a particular time point is based on:</p>
<ul class="simple">
<li><p>The total number of individuals at risk (i.e., still alive and uncensored) at that time point across all groups.</p></li>
<li><p>The proportion of individuals at risk in that specific group at that time point.</p></li>
<li><p>The total number of events observed at that time point across all groups.</p></li>
</ul>
</li>
<li><p>Comparing observed and expected: the test then compares the observed number of events in each group at each event time to the expected number of events. It quantifies the discrepancies between observed and expected events across all time points using a test statistic (often a <strong>chi-squared statistic</strong>).</p></li>
<li><p>Calculating the P value: the test statistic is used to calculate a P value, which represents the probability of observing a difference in survival as extreme as (or more extreme than) the one actually observed, if the null hypothesis were true (i.e., if there were no real difference in survival between the groups).</p></li>
<li><p>Interpreting the P value. The P value answers this question:</p>
<blockquote>
<div><p>If the null hypothesis is true (i.e., there’s no real difference in survival between the groups), what is the probability of observing a difference in survival as extreme as (or more extreme than) the one we actually observed, just by random chance?</p>
</div></blockquote>
<ul class="simple">
<li><p>A small P value (typically &lt; 0.05) suggests that the observed difference in survival is unlikely to have occurred by chance alone, leading to the rejection of the null hypothesis. We conclude that there’s a statistically significant difference in survival between the groups.</p></li>
<li><p>A large P value suggests that the observed difference could be due to chance, and we fail to reject the null hypothesis. We don’t have enough evidence to conclude a significant difference in survival.</p></li>
</ul>
</li>
</ol>
</section>
<section id="using-log-rank-test-in-python">
<h3>Using log-rank test in Python<a class="headerlink" href="#using-log-rank-test-in-python" title="Link to this heading">#</a></h3>
<p>With lifelines, performing the log-rank test is straightforward using <code class="docutils literal notranslate"><span class="pre">logrank_test</span></code>. For multiple groups, consider <code class="docutils literal notranslate"><span class="pre">pairwise_logrank_test()</span></code> to perform all pairwise comparisons between groups, or <code class="docutils literal notranslate"><span class="pre">multivariate_logrank_test()</span></code> to test the overall hypothesis that all groups have the same survival.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.statistics</span><span class="w"> </span><span class="kn">import</span> <span class="n">logrank_test</span>

<span class="c1"># Perform the log-rank test</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">logrank_test</span><span class="p">(</span>
    <span class="n">durations_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">durations_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">event_observed_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">.95</span><span class="p">)</span>

<span class="c1"># Print the summary of the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

<span class="c1"># results.print_summary()</span>
<span class="c1"># results.p_value</span>
<span class="c1"># results.test_statistic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   test_statistic         p  -log2(p)
0        4.659901  0.030875  5.017419
</pre></div>
</div>
</div>
</div>
<p>In the current example, the two-tailed P value calculated using the log-rank test is 0.031. This means that if the treatment were truly ineffective, there’s only a 3.1% chance that we would have randomly selected patients whose survival experiences differed as much (or more) as they did in this study.</p>
</section>
<section id="mantel-haenszel-method">
<h3>Mantel-Haenszel method<a class="headerlink" href="#mantel-haenszel-method" title="Link to this heading">#</a></h3>
<p>Both log-rank (Mantel-Cox) and Manter-Haenszel are non-parametric methods used to compare survival curves between groups. They are very similar in their approach and often yield similar results. <a class="reference external" href="https://www.graphpad.com/support/faq/how-do-the-three-methods-compare-to-survival-curves-log-rank-mantel-haenszel-gehan-wilcoxon-differ/">The main difference lies in how they handle ties</a> (multiple events occurring at the same time point). The Mantel-Haenszel test makes a slight adjustment for ties, while the log-rank test doesn’t. In practice, the difference between the two tests is often negligible, especially with large sample sizes or few ties.</p>
</section>
<section id="gehan-breslow-wilcoxon-method">
<h3>Gehan-Breslow-Wilcoxon method<a class="headerlink" href="#gehan-breslow-wilcoxon-method" title="Link to this heading">#</a></h3>
<p>The <a class="reference external" href="https://www.graphpad.com/guides/prism/latest/statistics/stat_analysis_choices_for_survival.htm">Gehan-Breslow-Wilcoxon test</a> emphasizes differences in survival occurring early in the study, which can be insightful in certain scenarios. However, this emphasis can be misleading if a large proportion of patients are censored early on (i.e., lost to follow-up or the study ends before their event occurs).</p>
<p>In contrast, the log-rank test treats all time points equally, making it more statistically powerful when the assumption of proportional hazards holds true. If the Kaplan-Meier curves for the two groups cross, this suggests non-proportional hazards, indicating that the relative risk changes over time. In such cases, alternative tests like the <a class="reference external" href="https://lifelines.readthedocs.io/en/latest/lifelines.statistics.html">Peto-Peto Prentice, Tarone-Ware, or Fleming-Harrington tests</a> might be more appropriate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the Gehan-Breslow-Wilcoxon method</span>
<span class="n">results_wilcoxon</span> <span class="o">=</span> <span class="n">logrank_test</span><span class="p">(</span>
    <span class="n">durations_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">durations_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">event_observed_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">.95</span><span class="p">,</span>
    <span class="n">weightings</span><span class="o">=</span><span class="s1">&#39;wilcoxon&#39;</span><span class="p">)</span>

<span class="n">results_wilcoxon</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>t_0</th>
      <td>-1</td>
    </tr>
    <tr>
      <th>null_distribution</th>
      <td>chi squared</td>
    </tr>
    <tr>
      <th>degrees_of_freedom</th>
      <td>1</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.95</td>
    </tr>
    <tr>
      <th>test_name</th>
      <td>Wilcoxon_test</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>test_statistic</th>
      <th>p</th>
      <th>-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6.54</td>
      <td>0.01</td>
      <td>6.57</td>
    </tr>
  </tbody>
</table></div></div>
</div>
</section>
</section>
<section id="hazard-ratio-for-quantifying-relative-risk">
<h2>Hazard ratio for quantifying relative risk<a class="headerlink" href="#hazard-ratio-for-quantifying-relative-risk" title="Link to this heading">#</a></h2>
<p>While Kaplan-Meier curves offer a powerful visual representation of survival experiences, they don’t directly reveal the underlying dynamics of risk over time. To gain insights into the instantaneous risk of an event at any given moment, we turn to the <strong>hazard function</strong>, denoted by h(t).</p>
<p>In survival analysis, the <strong>hazard</strong> represents the instantaneous <strong>risk</strong> of experiencing the event of interest (e.g., death) at a given time, given that the individual has survived up to that point. Think of it as the “slope” of the survival curve - a steeper slope indicates a higher hazard, meaning events are occurring more rapidly.</p>
<p>The <strong>hazard ratio (HR)</strong> compares the hazards of two groups, providing a measure of relative risk. If the HR is 2.0, it signifies that the rate of events in one group is twice the rate in the other group at any given time point. In simpler terms, individuals in the first group are experiencing the event at twice the speed of those in the second group.</p>
<p>The interpretation of the hazard ratio hinges on the <strong>assumption of proportional hazards</strong>. This assumption states that the <em>hazard ratio remains constant over time</em>, regardless of their covariate values. Mathematically: <span class="math notranslate nohighlight">\(h_A(t) / h_B(t) = c\)</span>, where <span class="math notranslate nohighlight">\(h_A(t)\)</span> and <span class="math notranslate nohighlight">\(h_B(t)\)</span> are the hazard functions of the treatment groups, and <span class="math notranslate nohighlight">\(c\)</span> is a constant.</p>
<p>In other words, the relative risk between the two groups stays the same throughout the follow-up period. If this assumption holds, we can confidently say that, for example, patients in one treatment group are consistently experiencing the event at half the rate of patients in the other group, regardless of how much time has passed.</p>
<p>However, the proportional hazards assumption isn’t always met in real-world scenarios. Consider the comparison between surgery and medical therapy. Surgery often carries a higher initial risk, but the risk may decrease over time as patients recover. In contrast, medical therapy might have a lower initial risk, but the risk could increase as the disease progresses. In such cases, the hazard ratio wouldn’t be constant, violating the proportional hazards assumption.</p>
<section id="unveiling-hazards-with-the-nelson-aalen-estimator">
<h3>Unveiling hazards with the Nelson-Aalen estimator<a class="headerlink" href="#unveiling-hazards-with-the-nelson-aalen-estimator" title="Link to this heading">#</a></h3>
<section id="the-mathematics-behind-the-model">
<h4>The mathematics behind the model<a class="headerlink" href="#the-mathematics-behind-the-model" title="Link to this heading">#</a></h4>
<p>We can’t simply transform the Kaplan-Meier estimate to obtain the hazard function because statistical intricacies prevent such a straightforward conversion. But we have a robust <em>non-parametric</em> tool at our disposal: the Nelson-Aalen estimator. This estimator allows us to estimate the <strong>cumulative hazard function</strong>, H(t), which represents the total accumulated risk of experiencing the event up to time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Mathematically, the cumulative hazard is defined as the integral of the hazard function: <span class="math notranslate nohighlight">\(H(t) = \int_{0}^t \lambda(z)dz\)</span>, where <span class="math notranslate nohighlight">\(\lambda(z)\)</span> represents the hazard function at time <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>The Nelson-Aalen estimator provides a practical way to estimate <span class="math notranslate nohighlight">\(H(t)\)</span> from observed data: <span class="math notranslate nohighlight">\(\hat{H}(t) = \sum_{t_i \le t} \frac{d_i}{n_i}\)</span>. In this formula:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{H}(t)\)</span> is the estimated cumulative hazard at time <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
<li><p>The summation is over all event times (<span class="math notranslate nohighlight">\(t_i\)</span>) that are less than or equal to <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(d_i\)</span> is the number of events (e.g., deaths) observed at time <span class="math notranslate nohighlight">\(t_i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(n_i\)</span> is the number of individuals at risk (i.e., still alive and uncensored) just before time <span class="math notranslate nohighlight">\(t_i\)</span></p></li>
</ul>
</section>
<section id="using-the-nelsonaalenfitter">
<h4>Using the <code class="docutils literal notranslate"><span class="pre">NelsonAalenFitter</span></code><a class="headerlink" href="#using-the-nelsonaalenfitter" title="Link to this heading">#</a></h4>
<p>Let’s generate a plot showing the cumulative hazard estimates for both the treatment ‘PRED’ and control groups, allowing us to visualize and compare the accumulation of risk over time between the two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">NelsonAalenFitter</span>

<span class="n">naf_pred</span> <span class="o">=</span> <span class="n">NelsonAalenFitter</span><span class="p">()</span>
<span class="n">naf_ctrl</span> <span class="o">=</span> <span class="n">NelsonAalenFitter</span><span class="p">()</span>

<span class="c1"># Fit Nelson-Aalen estimators for each group</span>
<span class="n">naf_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone&#39;</span><span class="p">)</span>
<span class="n">naf_ctrl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;placebo&#39;</span><span class="p">)</span>

<span class="c1"># Plot cumulative hazard functions</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">naf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">naf_ctrl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Customize plot appearance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (months)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative hazard&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Nelson-Aalen cumulative hazard estimates&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2bb2c17366ab72f908e7ac7b49dd6220f5fb07cdafbaee07ae4d79a1d90133af.png" src="_images/2bb2c17366ab72f908e7ac7b49dd6220f5fb07cdafbaee07ae4d79a1d90133af.png" />
</div>
</div>
<p>We can also access the cumulative hazard data through the <code class="docutils literal notranslate"><span class="pre">cumulative_hazard_</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">NelsonAalenFitter</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print cumulative hazard data (top 5) for PRED group</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cumulative Hazard Data for PRED group:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">naf_pred</span><span class="o">.</span><span class="n">cumulative_hazard_</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cumulative Hazard Data for PRED group:

          prednisolone
timeline              
0.0           0.000000
2.0           0.045455
6.0           0.093074
12.0          0.143074
54.0          0.195705
</pre></div>
</div>
</div>
</div>
</section>
<section id="connection-to-kaplan-meier-survival">
<h4>Connection to Kaplan-Meier survival<a class="headerlink" href="#connection-to-kaplan-meier-survival" title="Link to this heading">#</a></h4>
<p>There is a fundamental mathematical relationship between Kaplan-Meier survival curves and Nelson-Aalen cumulative hazard estimates, which can be thought of as a form of symmetry or duality: <span class="math notranslate nohighlight">\(S(t) = \exp[-H(t)]\)</span>, where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S(t)\)</span> is the survival function at time <span class="math notranslate nohighlight">\(t\)</span> (estimated by the Kaplan-Meier method)</p></li>
<li><p><span class="math notranslate nohighlight">\(H(t)\)</span> is the cumulative hazard function at time <span class="math notranslate nohighlight">\(t\)</span> (estimated by the Nelson-Aalen method)</p></li>
</ul>
<p>This equation shows that the survival probability at any time point is directly related to the cumulative hazard up to that point. This relationship has other implications:</p>
<ul class="simple">
<li><p>Complementary information: the Kaplan-Meier curve and the Nelson-Aalen plot provide complementary perspectives on the same underlying survival data.</p></li>
<li><p>Shape correspondence:</p>
<ul>
<li><p>A decreasing Kaplan-Meier curve (indicating decreasing survival probability) corresponds to an increasing Nelson-Aalen curve (indicating accumulating hazard).</p></li>
<li><p>The steeper the drop in the Kaplan-Meier curve, the steeper the rise in the Nelson-Aalen curve, reflecting a higher hazard rate at that time.</p></li>
</ul>
</li>
<li><p>Transformation: we can mathematically transform one into the other. If we have the Kaplan-Meier estimate, we can calculate the cumulative hazard as <span class="math notranslate nohighlight">\(H(t) = -\log[S(t)]\)</span>. Conversely, if we have the Nelson-Aalen estimate, we can calculate the survival function as <span class="math notranslate nohighlight">\(S(t) = \exp[-H(t)]\)</span>.</p></li>
<li><p>If we plot the Kaplan-Meier curve and the Nelson-Aalen curve on the same graph (with appropriate scaling of the y-axes), we’ll often observe a <em>visual symmetry</em> or mirror-image relationship between the two. This visual correspondence reflects the underlying mathematical connection between survival probability and cumulative hazard.</p></li>
</ul>
</section>
<section id="the-link-with-hazard-ratio">
<h4>The link with hazard ratio<a class="headerlink" href="#the-link-with-hazard-ratio" title="Link to this heading">#</a></h4>
<p>While the Nelson-Aalen estimator directly estimates the cumulative hazard function, it doesn’t provide a <em>hazard ratio</em> in the same way that a Cox proportional hazards model does. However, it’s still connected to the concept of hazard ratios in a few key ways:</p>
<ol class="arabic simple">
<li><p>Visual assessment of proportional hazards</p>
<ul class="simple">
<li><p>The Nelson-Aalen plots for two or more groups can visually suggest whether the proportional hazards assumption might hold. If the curves are <em>roughly parallel</em> (i.e., maintain a relatively constant vertical distance), it hints at proportional hazards. Conversely, if the curves cross or diverge significantly, it suggests non-proportional hazards.</p></li>
<li><p>This visual assessment can guide us in deciding whether a Cox model (which assumes proportional hazards) is appropriate for further analysis.</p></li>
</ul>
</li>
<li><p>Estimating hazard ratios (with caution)</p>
<ul class="simple">
<li><p>Although not directly, we can crudely estimate hazard ratios from Nelson-Aalen plots by comparing the slopes of the cumulative hazard curves at different time points. A steeper slope indicates a higher hazard rate.</p></li>
<li><p>However, this approach is less precise and less reliable than the hazard ratios obtained from a Cox model, especially when the proportional hazards assumption is violated.</p></li>
</ul>
</li>
<li><p>Basis for Cox model diagnostics</p>
<ul class="simple">
<li><p>The Nelson-Aalen estimator plays a crucial role in diagnosing the proportional hazards assumption in Cox models.</p></li>
<li><p>One common diagnostic plot involves plotting the log of the Nelson-Aalen cumulative hazard estimates against the log of survival time for each group. If the proportional hazards assumption holds, these plots should be roughly parallel.</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="cox-proportional-hazards-model">
<h3>Cox proportional hazards model<a class="headerlink" href="#cox-proportional-hazards-model" title="Link to this heading">#</a></h3>
<p>While the Weibull model (as discussed later) is a popular parametric choice for survival analysis, sometimes its distributional assumptions might not be met or are difficult to verify. In such cases, researchers often turn to the <strong>Cox proportional hazards (Cox PH) model</strong>, a <em>semi-parametric approach</em> that offers flexibility while still allowing for the inclusion of <strong>covariates</strong>.</p>
<p>The Cox model expresses the hazard function as <span class="math notranslate nohighlight">\(h(t|x) = h_0(t) * \exp[(x - \overline{x})' \beta]\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(h(t|x)\)</span> is the hazard at time <span class="math notranslate nohighlight">\(t\)</span> for an individual with covariate values <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(h_0(t)\)</span> is the baseline hazard, representing the hazard when all covariates are at their average values (<span class="math notranslate nohighlight">\(\overline{x}\)</span>).</p></li>
<li><p><span class="math notranslate nohighlight">\(x\)</span> is the vector of covariate values for the individual.</p></li>
<li><p><span class="math notranslate nohighlight">\((x - \overline{x})'\)</span> is the transpose (row vector) of <span class="math notranslate nohighlight">\((x - \overline{x})\)</span>, which explicitly shows the deviation of the individual’s covariate values from the average values, and then multiplies this deviation with the coefficient vector.</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> is the vector of coefficients, quantifying the impact of each covariate on the hazard.</p></li>
</ul>
<p>The hazard function, <span class="math notranslate nohighlight">\(h(t)\)</span>, describes the instantaneous risk of the event occurring at time <span class="math notranslate nohighlight">\(t\)</span>, given that the individual has survived up to that point. Mathematically, it’s related to the survival function, <span class="math notranslate nohighlight">\(S(t)\)</span>, as follows <span class="math notranslate nohighlight">\(h(t) = - \frac{d}{dt} \log S(t)\)</span>.</p>
<p>A simplified representation of the Cox model is: <span class="math notranslate nohighlight">\(h(t)=h_0(t) \times \exp(b_1 x_1 + b_2 x_2 + ... + b_p x_p)\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(t\)</span> represents the survival time</p></li>
<li><p><span class="math notranslate nohighlight">\(h(t)\)</span> is the hazard function. <em>The <span class="math notranslate nohighlight">\(t\)</span> in <span class="math notranslate nohighlight">\(h(t)\)</span> reminds us that the hazard may vary over time.</em></p></li>
<li><p><span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_p\)</span> are the covariates.</p></li>
<li><p><span class="math notranslate nohighlight">\(b_1, b_2, \dots, b_p\)</span> are the coefficients representing the effect of each covariate on the hazard.</p></li>
<li><p><span class="math notranslate nohighlight">\(h_0\)</span> is called the <em>baseline hazard</em>. It corresponds to the value of the hazard if all the <span class="math notranslate nohighlight">\(x_i\)</span> are equal to zero, with <span class="math notranslate nohighlight">\(\exp(0) = 1\)</span>.</p></li>
</ul>
<p>The coefficients (<span class="math notranslate nohighlight">\(b_i\)</span>) indicate how each covariate influences the hazard, e.g., a positive coefficient implies that an increase in the covariate value is associated with an increased hazard (and thus a decreased survival probability).</p>
<p>We can therefore appreciate the advantages of the Cox Model:</p>
<ul class="simple">
<li><p>Semi-parametric: it doesn’t require assumptions about the shape of the baseline hazard function.</p></li>
<li><p>Handles covariates: it allows for the inclusion of multiple covariates (both categorical and continuous) to adjust for their effects on survival.</p></li>
<li><p>Provides hazard ratios: it directly estimates hazard ratios, which are easily interpretable measures of relative risk.</p></li>
</ul>
<p>The expression <span class="math notranslate nohighlight">\(h(t|x) = b_0(t) \exp[\sum_{i=1}^n (b_i * x_i)]\)</span> is another way to represent the Cox proportional hazards model, although it has a few subtle differences and potential points of confusion compared to the more standard notation. It uses <span class="math notranslate nohighlight">\(\sum_{i=1}^n (b_i * x_i)\)</span> which directly calculates the linear combination of covariates and their coefficients without explicitly showing the deviation from the average.</p>
<section id="interpreting-the-cox-ph-model">
<h4>Interpreting the Cox PH model<a class="headerlink" href="#interpreting-the-cox-ph-model" title="Link to this heading">#</a></h4>
<p>The summary of the Cox proportional hazards model typically includes the following key components for each covariate:</p>
<ul class="simple">
<li><p><strong>coef</strong>: this represents the estimated coefficient (<span class="math notranslate nohighlight">\(\beta\)</span>) for the covariate in the Cox model.</p></li>
<li><p><strong>exp(coef)</strong>: this is the exponentiated coefficient, which represents the <strong>hazard ratio</strong> associated with a one-unit increase in the covariate, holding all other covariates constant.</p>
<ul>
<li><p>If ‘exp(coef)’ &gt; 1: a one-unit increase in the covariate is associated with an increased hazard (i.e., a higher risk of the event occurring) by a factor of ‘exp(coef)’ compared to the baseline hazard.</p></li>
<li><p>If ‘exp(coef)’ &lt; 1: a one-unit increase in the covariate is associated with a decreased hazard (i.e., a lower risk of the event occurring) by a factor of ‘1/exp(coef)’ compared to the baseline hazard.</p></li>
</ul>
</li>
<li><p><strong>p-value</strong>: this indicates the statistical significance of the covariate’s effect on the hazard. A small P value (typically &lt; 0.05) suggests that the covariate is a significant predictor of survival.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoxPHFitter</span>

<span class="c1"># Fit the CoxPHFitter</span>
<span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span>
<span class="n">cph</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">duration_col</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">event_col</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;PRED&#39;</span><span class="p">)</span>

<span class="c1"># Print the summary to see the coefficient and its significance</span>
<span class="n">cph</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>model</th>
      <td>lifelines.CoxPHFitter</td>
    </tr>
    <tr>
      <th>duration col</th>
      <td>'T'</td>
    </tr>
    <tr>
      <th>event col</th>
      <td>'E'</td>
    </tr>
    <tr>
      <th>baseline estimation</th>
      <td>breslow</td>
    </tr>
    <tr>
      <th>number of observations</th>
      <td>44</td>
    </tr>
    <tr>
      <th>number of events observed</th>
      <td>27</td>
    </tr>
    <tr>
      <th>partial log-likelihood</th>
      <td>-86.620</td>
    </tr>
    <tr>
      <th>time fit was run</th>
      <td>2024-11-17 15:38:33 UTC</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;">coef</th>
      <th style="min-width: 12px;">exp(coef)</th>
      <th style="min-width: 12px;">se(coef)</th>
      <th style="min-width: 12px;">coef lower 95%</th>
      <th style="min-width: 12px;">coef upper 95%</th>
      <th style="min-width: 12px;">exp(coef) lower 95%</th>
      <th style="min-width: 12px;">exp(coef) upper 95%</th>
      <th style="min-width: 12px;">cmp to</th>
      <th style="min-width: 12px;">z</th>
      <th style="min-width: 12px;">p</th>
      <th style="min-width: 12px;">-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PRED</th>
      <td>-0.831</td>
      <td>0.436</td>
      <td>0.397</td>
      <td>-1.609</td>
      <td>-0.052</td>
      <td>0.200</td>
      <td>0.949</td>
      <td>0.000</td>
      <td>-2.091</td>
      <td>0.037</td>
      <td>4.773</td>
    </tr>
  </tbody>
</table><br><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>Concordance</th>
      <td>0.633</td>
    </tr>
    <tr>
      <th>Partial AIC</th>
      <td>175.239</td>
    </tr>
    <tr>
      <th>log-likelihood ratio test</th>
      <td>4.471 on 1 df</td>
    </tr>
    <tr>
      <th>-log2(p) of ll-ratio test</th>
      <td>4.859</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this example, the hazard ratio equals 0.436, with a 95% confidence interval ranging from 0.200 to 0.949. This indicates that, at any given time, individuals in the treated group (‘PRED’ = True) have a hazard rate that is approximately 43.6% of the hazard rate in the control/reference group (‘PRED’ = False), assuming the proportional hazards assumption holds. In simpler terms, this suggests that treated patients are experiencing death at a significantly lower rate than control patients throughout the follow-up period.</p>
<p>Moreover, the 95% confidence interval for the HR does not include 1.0. This indicates that we can be 95% confident that the true hazard ratio in the population is not 1.0, i.e., the hazards are not equal between the two groups. This provides evidence for a statistically significant difference in survival experiences between the treated and control groups.
If the two survival curves were truly identical, the hazard ratio would indeed be 1.0. The fact that our confidence interval excludes 1.0 strengthens our conclusion that the treatment likely has a real effect on survival.</p>
</section>
<section id="assessing-the-proportional-hazards-assumption">
<h4>Assessing the proportional hazards assumption<a class="headerlink" href="#assessing-the-proportional-hazards-assumption" title="Link to this heading">#</a></h4>
<p>To ensure the validity of our model and the accuracy of these interpretations, it’s essential to check whether the proportional hazards assumption is reasonably met. The lifelines library provides a convenient method, <a class="reference external" href="https://lifelines.readthedocs.io/en/latest/jupyter_notebooks/Proportional%20hazard%20assumption.html"><code class="docutils literal notranslate"><span class="pre">check_assumptions()</span></code></a>, to assist in this assessment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cph</span><span class="o">.</span><span class="n">check_assumptions</span><span class="p">(</span>
    <span class="n">training_df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">p_value_threshold</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>  <span class="c1"># default 0.01</span>
    <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Bootstrapping lowess lines. May take a moment...

Proportional hazard assumption looks okay.
</pre></div>
</div>
<img alt="_images/4fc9e6f08246f762bf17be895cc8c47d861d4a84c7f828f4d4a56ac5e6d0b190.png" src="_images/4fc9e6f08246f762bf17be895cc8c47d861d4a84c7f828f4d4a56ac5e6d0b190.png" />
</div>
</div>
</section>
<section id="visualizing-the-impact-of-covariate-on-survival">
<h4>Visualizing the impact of covariate on survival<a class="headerlink" href="#visualizing-the-impact-of-covariate-on-survival" title="Link to this heading">#</a></h4>
<p>The Cox PH model allows us to estimate the effect of each covariate on the hazard rate. But how does this translate into actual changes in survival probabilities? The <code class="docutils literal notranslate"><span class="pre">plot_partial_effects_on_outcome</span></code> function provides a visual answer.</p>
<p>This function generates a plot showing the predicted survival curves for different values of a specific covariate (‘PRED’ in our case), while holding all other covariates (if any) constant at their average (or other specified) values. In essence, it lets us see how changing the value of ‘PRED’ would impact the survival experience, assuming everything else remains the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the effect of the predictor on survival curves</span>
<span class="n">cph</span><span class="o">.</span><span class="n">plot_partial_effects_on_outcome</span><span class="p">(</span>
    <span class="n">covariates</span><span class="o">=</span><span class="s1">&#39;PRED&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="n">plot_baseline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effect of &#39;PRED&#39; on survival&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (months)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Survival probability&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a53b78c0d02de318b76b9820ef57678d27fb68805569cff8ac69a740396e2ad5.png" src="_images/a53b78c0d02de318b76b9820ef57678d27fb68805569cff8ac69a740396e2ad5.png" />
</div>
</div>
<p>In the context of a Cox PH plot, the <strong>baseline curve</strong> represents the estimated survival function when all covariates in the model are set to their baseline or reference levels. The specific baseline level for each covariate depends on how it is coded in the model:</p>
<ul class="simple">
<li><p>Continuous covariates: the baseline level is typically the <em>mean or median</em> value of the covariate in the dataset.</p></li>
<li><p>Categorical covariates: the baseline level is usually the <em>reference category</em> (e.g., the “control” group or the most common category).</p></li>
</ul>
<p><em>It’s important to note that in the current version of lifelines, when dealing with categorical covariates, the reference or control group used for establishing the baseline is determined by the <strong>first category encountered in the dataset</strong> when the model is fit. In our case, since the first patient in the dataset has ‘PRED = False’, the baseline hazard and survival functions represent the untreated or control group. If ‘PRED’ were encoded numerically as 0 and 1, then 0 (representing the absence of prednisone treatment) would naturally become the baseline. Similarly, if the very first patient in the dataset had been assigned ‘PRED = True’, then the baseline would correspond to the prednisone-treated group.</em></p>
<p>This enhanced explanation provides a more accurate and nuanced understanding of how lifelines handles baseline selection for categorical covariates, which is crucial for interpreting the model results correctly.</p>
<p><em>Of note, in the current version of lifelines, the reference/control group chosen for the baseline is the first category of the dataset, i.e. in our example, ‘PRED = False’. If the very first patient of the dataset was set as ‘PRED = True’, then the baseline would be the prednisone group.</em></p>
<p>Essentially, the baseline curve shows the survival experience we would expect for an “average” individual or an individual belonging to the reference categories of all categorical covariates, assuming the proportional hazards assumption holds.</p>
<p>Why do the curves from both groups have the same shape? This is a direct consequence of the proportional hazards assumption, which is the core principle underlying the Cox PH model. The proportional hazards assumption states that the hazard ratio between any two individuals remains constant over time, regardless of their covariate values.</p>
<p>Mathematically, this means that the hazard function for one group is simply a <em>constant multiple of the hazard function for another group</em>. When plotting the survival curves, this constant proportionality translates into curves that have the same basic shape but are vertically shifted relative to each other. The vertical shift reflects the difference in hazard (and thus survival probability) between the groups due to their different covariate values.</p>
</section>
</section>
</section>
<section id="the-weibull-parametric-model">
<h2>The Weibull parametric model<a class="headerlink" href="#the-weibull-parametric-model" title="Link to this heading">#</a></h2>
<p>Having explored non-parametric and semi-parametric approaches, let’s now turn our attention to a fully <strong>parametric</strong> model for survival analysis. The Weibull model is a popular parametric model in survival analysis due to its flexibility in capturing various hazard patterns.</p>
<p>The Weibull distribution, <a class="reference external" href="https://en.wikipedia.org/wiki/Weibull_distribution">originally applied to model particle size distribution</a>, is a continuous probability distribution that models time-to-event data. Its probability density function is: <span class="math notranslate nohighlight">\(f(x; \lambda, \rho) = \frac{k}{\lambda}(\frac{x}{\lambda})^{\rho-1} \exp{-(x/\lambda)^k}, x \ge 0, \lambda &gt; 0, \rho &gt; 0\)</span>, where <span class="math notranslate nohighlight">\(\lambda\)</span> determines the scale and <span class="math notranslate nohighlight">\(\rho\)</span> the shape of the distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">weibull_min</span>

<span class="c1"># Create a range of values for x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Create the 1x2 subplot grid</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Left subplot: varying lambda with rho = 2</span>
<span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">weibull_min</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;λ=</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Weibull PDF (ρ =2)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Right subplot: varying rho with lambda = 1</span>
<span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">weibull_min</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ρ=</span><span class="si">{</span><span class="n">rho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Weibull PDF (λ=1)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability Density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/14f71dd6f417f6ab8b388504bb8862f01ae109ef268a5d60d5588d759310b5d5.png" src="_images/14f71dd6f417f6ab8b388504bb8862f01ae109ef268a5d60d5588d759310b5d5.png" />
</div>
</div>
<p>The Weibull distribution provides a parameterized form for the survival function: <span class="math notranslate nohighlight">\(S(t)=\exp[-(t / \lambda)^\rho]\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S(t)\)</span>: the survival function, representing the probability of surviving beyond time <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> (lambda): the <em>scale</em> parameter, which influences the time scale of the survival curve:</p>
<ul>
<li><p>It has a direct and intuitive interpretation: it represents the time at which 63.2% of the population has experienced the event of interest (e.g., death).</p></li>
<li><p>A larger <span class="math notranslate nohighlight">\(\lambda\)</span> indicates a longer time until 63.2% of the population experiences the event, suggesting a slower event rate overall.</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(\rho\)</span> (rho): the <em>shape</em> parameter, which controls the shape of the hazard function and, consequently, the survival curve:</p>
<ul>
<li><p>It governs the shape of the hazard function and determines whether the hazard rate is increasing, decreasing, or constant over time.</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho &lt; 1\)</span>: the hazard rate decreases over time (<em>decelerating hazard</em>). This might be suitable for modeling situations where the risk of the event diminishes as time progresses (e.g., infant mortality).</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho = 1\)</span>: the hazard rate is <em>constant</em> over time. This is equivalent to the exponential distribution, often used when the risk of the event remains stable.</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho &gt; 1\)</span>: the hazard rate increases over time (<em>accelerating hazard</em>). This could be applicable when the risk of the event escalates with time (e.g., the failure of aging machinery).</p></li>
</ul>
</li>
</ul>
<p>The Weibull model also provides explicit expressions for the hazard function and cumulative hazard function:</p>
<ul class="simple">
<li><p>Cumulative Hazard Function: <span class="math notranslate nohighlight">\(H(t) = (t / \lambda)^ρ\)</span></p></li>
<li><p>Hazard Function: <span class="math notranslate nohighlight">\(h(t) = (\rho / \lambda) * (t / \lambda)^{\rho - 1}\)</span></p></li>
</ul>
<p>The Weibull model has many advantages:</p>
<ul class="simple">
<li><p>Flexibility: can model various hazard shapes (increasing, decreasing, or constant).</p></li>
<li><p>Parametric: provides estimates of parameters (<span class="math notranslate nohighlight">\(\lambda\)</span> and <span class="math notranslate nohighlight">\(\rho\)</span>) that can be interpreted directly.</p></li>
<li><p>Handles covariates: allows for the inclusion of covariates to adjust for their effects on survival.</p></li>
</ul>
<p>We can consider opting for the Weibull model in scenarios where we have prior knowledge or evidence hinting at a particular hazard shape - be it increasing, decreasing, or constant. Additionally, it proves valuable when we seek parameters with straightforward interpretations, such as the time by which 63.2% of the population is expected to experience the event. Finally, the Weibull model emerges as a suitable alternative when the proportional hazards assumption, fundamental to the Cox PH model, appears to be violated in the data.</p>
<section id="application-to-the-prednisolone-data">
<h3>Application to the prednisolone data<a class="headerlink" href="#application-to-the-prednisolone-data" title="Link to this heading">#</a></h3>
<p>Now, let’s apply the Weibull model to our prednisolone dataset. We’ll fit separate Weibull models to the placebo and treatment groups, then visually compare their survival functions against the corresponding Kaplan-Meier estimates for a comprehensive understanding of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullFitter</span>

<span class="c1"># Fit Weibull models for each group</span>
<span class="n">wb_ctrl</span> <span class="o">=</span> <span class="n">WeibullFitter</span><span class="p">()</span>
<span class="n">wb_pred</span> <span class="o">=</span> <span class="n">WeibullFitter</span><span class="p">()</span>

<span class="n">wb_ctrl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">durations</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;placebo (Weibull)&#39;</span><span class="p">)</span>
<span class="n">wb_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone (Weibull)&#39;</span><span class="p">)</span>

<span class="c1"># Plot survival functions</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">wb_ctrl</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">()</span>
<span class="n">wb_pred</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Overlay Kaplan-Meier curves on the same plot</span>
<span class="n">kmf_ctrl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.75</span><span class="p">)</span>  <span class="c1"># Dashed line for KM</span>
<span class="n">kmf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.75</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Survival functions: Weibull Fit vs. Kaplan-Meier&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (months)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction survival&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b80fa4c9a3275d508c9b1f0cf7387173e6d8d24fdf37047ef997d7d7abbdb1b9.png" src="_images/b80fa4c9a3275d508c9b1f0cf7387173e6d8d24fdf37047ef997d7d7abbdb1b9.png" />
</div>
</div>
</section>
<section id="goodness-of-fit">
<h3>Goodness-of-fit<a class="headerlink" href="#goodness-of-fit" title="Link to this heading">#</a></h3>
<p>These interpretations are based on the assumption that the Weibull model provides a good fit to the data for both groups. It’s always advisable to assess the model fit and consider alternative models if necessary.</p>
<p>The visual comparison with the Kaplan-Meier plots is straightforward and intuitive as we can see how well the Weibull model captures the empirical survival patterns in the data. If the Weibull curves closely follow the Kaplan-Meier curves, it suggests a good fit. Large deviations between the curves indicate potential areas where the Weibull model might not be capturing the underlying survival patterns adequately.</p>
<p>We can leverage the log-likelihood and AIC values provided in the Weibull model summary table to gain some insights into the goodness-of-fit, but with certain considerations and limitations. In general, a higher log-likelihood value indicates a better fit of the model to the data, but the log-likelihood alone doesn’t tell if the model is a “good” fit in an absolute sense. It’s more useful for relative comparisons between models, e.g., when testing other parametric models as it will be discussed at the end of this chapter.</p>
<p>While AIC and visual comparisons of survival curves offer valuable insights into model fit, we can further assess the suitability of the Weibull model using a Quantile-Quantile (QQ) plot. The QQ plot compares the quantiles of the observed data to the quantiles we would expect if the data truly followed a Weibull distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">qq_plot</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># QQ plot for placebo group</span>
<span class="n">qq_plot</span><span class="p">(</span><span class="n">wb_ctrl</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;QQ plot for Weibull fit (placebo)&quot;</span><span class="p">)</span>

<span class="c1"># QQ plot for PRED Group</span>
<span class="n">qq_plot</span><span class="p">(</span><span class="n">wb_pred</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;QQ plot for Weibull fit (PRED)&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout and display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/30aefb7b97b4567dcdc6ec82677e581db55a7579eb492fbf5e8ffc702eeef9dc.png" src="_images/30aefb7b97b4567dcdc6ec82677e581db55a7579eb492fbf5e8ffc702eeef9dc.png" />
</div>
</div>
</section>
<section id="parameters-estimates">
<h3>Parameters estimates<a class="headerlink" href="#parameters-estimates" title="Link to this heading">#</a></h3>
<p>We can print the model summaries to see the estimated parameters and their confidence intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">:=</span><span class="s2">&quot;Model summary for the prednisone group&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="n">wb_pred</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model summary for the prednisone group
--------------------------------------
&lt;lifelines.WeibullFitter:&quot;prednisolone (Weibull)&quot;, fitted with 22 total observations, 11 right-censored observations&gt;
   number of observations = 22
number of events observed = 11
           log-likelihood = -70.27
               hypothesis = lambda_ != 1, rho_ != 1

---
          coef  se(coef)  coef lower 95%  coef upper 95%
lambda_ 224.72     79.37           69.16          380.27
rho_      0.95      0.27            0.43            1.48

         cmp to     z      p  -log2(p)
lambda_    1.00  2.82 &lt;0.005      7.70
rho_       1.00 -0.17   0.87      0.21
---
AIC = 144.54
</pre></div>
</div>
</div>
</div>
<p>Overall context:</p>
<ul class="simple">
<li><p>The table shows the results of fitting a Weibull survival model to your data, specifically for the group that received prednisone.</p></li>
<li><p>We have 22 observations in total, out of which 11 experienced the event of interest (presumably death or some other failure event), while the remaining 11 were right-censored (meaning they didn’t experience the event during the observation period).</p></li>
</ul>
<p>Model fit statistics:</p>
<ul class="simple">
<li><p><strong>log-likelihood = -70.27</strong>: his is a measure of how well the Weibull model fits the data. Higher values (less negative) indicate a better fit.</p></li>
<li><p><strong>AIC = 144.54</strong>: <em>Akaike Information Criterion</em>, another measure of model fit, penalizing for model complexity. Lower AIC values are generally preferred.</p></li>
</ul>
<p>Hypothesis test:</p>
<ul class="simple">
<li><p><strong>hypothesis = lambda_ != 1, rho_ != 1</strong>: the model is testing whether the estimated parameters (lambda and rho) are significantly different from 1. This is a common baseline to check if the Weibull model provides a better fit than the simpler exponential model (where rho = 1).</p></li>
</ul>
<p>Parameter estimates:</p>
<ul class="simple">
<li><p><strong>lambda_</strong></p>
<ul>
<li><p><strong>coef = 224.72</strong>: the estimated scale parameter (<span class="math notranslate nohighlight">\(\lambda\)</span>) is 224.72. This means that 63.2% of the individuals in the prednisone group are expected to experience the event by approximately 224.72 months, or 18.7 years.</p></li>
<li><p><strong>se(coef) = 79.37</strong>: the standard error of the lambda estimate, indicating the uncertainty around this estimate.</p></li>
<li><p><strong>coef lower 95% = 69.16, coef upper 95% = 380.27</strong>: the 95% confidence interval for the lambda coefficient.</p></li>
<li><p><strong>cmp to 1.00, z = 2.82, p &lt;0.005, -log2(p) = 7.70</strong>: these statistics test the null hypothesis that lambda is equal to 1. The very small P value (&lt;0.005) strongly suggests that lambda is significantly different from 1, indicating that the Weibull model is a better fit than the exponential model for this group.</p></li>
</ul>
</li>
<li><p><strong>rho_</strong></p>
<ul>
<li><p><strong>coef = 0.95</strong>: the estimated shape parameter (<span class="math notranslate nohighlight">\(\rho\)</span>) is 0.95. This is slightly less than 1, suggesting a hazard rate that decreases slightly over time for the prednisone group.</p></li>
<li><p><strong>se(coef) = 0.27</strong>: the standard error of the rho estimate.</p></li>
<li><p><strong>coef lower 95% = 0.43, coef upper 95% = 1.48</strong>: the 95% confidence interval for the rho coefficient. Note that this interval includes 1.</p></li>
<li><p><strong>cmp to 1.00, z = -0.17, p = 0.87, -log2(p) = 0.21</strong>: these statistics test the null hypothesis that rho is equal to 1. The large P value (0.87) indicates that we don’t have strong evidence to reject this null hypothesis. This suggests that the hazard rate might be close to constant, and an exponential model could also be a reasonable fit for this group, although the Weibull model with a slightly decreasing hazard might be slightly better.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">s</span> <span class="o">:=</span> <span class="s2">&quot;Model summary for the placebo group&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="n">wb_ctrl</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model summary for the placebo group
-----------------------------------
&lt;lifelines.WeibullFitter:&quot;placebo (Weibull)&quot;, fitted with 22 total observations, 6 right-censored observations&gt;
   number of observations = 22
number of events observed = 16
           log-likelihood = -86.43
               hypothesis = lambda_ != 1, rho_ != 1

---
         coef  se(coef)  coef lower 95%  coef upper 95%
lambda_ 88.79     30.92           28.20          149.39
rho_     0.72      0.15            0.42            1.02

         cmp to     z      p  -log2(p)
lambda_    1.00  2.84 &lt;0.005      7.79
rho_       1.00 -1.83   0.07      3.90
---
AIC = 176.87
</pre></div>
</div>
</div>
</div>
<p>Here in the placebo group, the λ value is significantly lower than that of the prednisone group (88.79 vs. 224.72). This indicates that the median survival time (time at which 63.2% of the population experiences the event) is considerably shorter for the placebo group compared to the prednisone group.</p>
<p>The ρ value for the placebo group is 0.72, which is less than 1. This suggests a decreasing hazard rate over time for the control group. The risk of the event is higher initially but decreases as time progresses. The value of ρ for the prednisone group is 0.95, which is close to 1. This suggests a hazard rate that is nearly constant over time for the prednisone group. The risk of the event remains relatively stable throughout the follow-up period.</p>
</section>
<section id="weibull-regression">
<h3>Weibull regression<a class="headerlink" href="#weibull-regression" title="Link to this heading">#</a></h3>
<p>When exploring the influence of one or more continuous variables (covariates) on survival, we turn to the <strong>Accelerated Failure Time (AFT)</strong> model. The AFT model, in the context of Weibull regression, provides a framework to understand how covariates accelerate or decelerate the time to an event, i.e., <span class="math notranslate nohighlight">\(Y_i = f(X_i, \beta)\)</span>. The core concept of the AFT model can be summarized as: <span class="math notranslate nohighlight">\(S_A(t) = S_B(t \times \lambda)\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S_A(t)\)</span> and <span class="math notranslate nohighlight">\(S_B(t)\)</span> are the survival functions for two individuals or groups with different covariate values. <span class="math notranslate nohighlight">\(S_B(t)\)</span> is accelerating (speeding up) or decelerating (slowing down) along <span class="math notranslate nohighlight">\(S_A(t)\)</span> by a factor of <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> (lambda) is the acceleration factor, which depends on the covariates and their coefficients.</p>
<ul>
<li><p>A <span class="math notranslate nohighlight">\(\lambda &gt; 1\)</span> indicates that the event is accelerated (occurs sooner) for the individual or group with those covariate values compared to the baseline.</p></li>
<li><p>A <span class="math notranslate nohighlight">\(\lambda &lt; 1\)</span> indicates that the event is decelerated (occurs later).</p></li>
</ul>
</li>
</ul>
<p>In the Weibull AFT model, the acceleration factor <span class="math notranslate nohighlight">\(\lambda\)</span> is modeled as: <span class="math notranslate nohighlight">\(\lambda(x) = \exp(\beta_0 + \beta_1 x_1 + \dots + \beta_n x_n)\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_n\)</span>  are the covariate values.</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_0, \beta_1, \dots, \beta_n\)</span> are the coefficients, quantifying the impact of each covariate on the acceleration factor.</p></li>
</ul>
<p>Optionally, the shape parameter ρ can also be modeled as a function of covariates: <span class="math notranslate nohighlight">\(\rho(y) = \exp(\alpha_0 + \alpha_1 y_1 + \dots + \alpha_n y_n)\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_1, y_2, \dots, y_n\)</span> are additional covariate values (if applicable).</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_0, \alpha_1, \dots, \alpha_n\)</span> are the coefficients for these covariates.</p></li>
</ul>
<p>The final Weibull survival function with covariates becomes <span class="math notranslate nohighlight">\(S(t; x, y) = \exp[-(t / \lambda(x))^{\rho(y)}]\)</span>, and the cumulative hazard function <span class="math notranslate nohighlight">\(H(t; x, y) = (t / \lambda(x))^{\rho(y)}\)</span>.</p>
<p>How do we interpret the Weibull AFT model? A positive <span class="math notranslate nohighlight">\(\beta_i\)</span> indicates that an increase in the corresponding covariate <span class="math notranslate nohighlight">\(x_i\)</span> is associated with an increase in the acceleration factor <span class="math notranslate nohighlight">\(\lambda\)</span>, leading to a faster time to the event (decreased survival time). A negative <span class="math notranslate nohighlight">\(\beta_i\)</span> indicates the opposite: an increase in <span class="math notranslate nohighlight">\(x_i\)</span> is associated with a decrease in <span class="math notranslate nohighlight">\(\lambda\)</span>, leading to a slower time to the event (increased survival time).</p>
<p>Note that, when there are no covariates, or all covariates are at their reference levels (typically 0 for continuous covariates and the reference category for categorical covariates), the Weibull model reduces to its basic form with parameters <span class="math notranslate nohighlight">\(\lambda_0\)</span> and <span class="math notranslate nohighlight">\(\rho_0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullAFTFitter</span>

<span class="c1"># Fit the Weibull AFT model</span>
<span class="n">aft</span> <span class="o">=</span> <span class="n">WeibullAFTFitter</span><span class="p">()</span>
<span class="n">aft</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
    <span class="n">event_col</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span>
    <span class="c1"># formula=&#39;PRED&#39;</span>
<span class="p">)</span>

<span class="c1"># Print the model summary</span>
<span class="n">aft</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>model</th>
      <td>lifelines.WeibullAFTFitter</td>
    </tr>
    <tr>
      <th>duration col</th>
      <td>'T'</td>
    </tr>
    <tr>
      <th>event col</th>
      <td>'E'</td>
    </tr>
    <tr>
      <th>number of observations</th>
      <td>44</td>
    </tr>
    <tr>
      <th>number of events observed</th>
      <td>27</td>
    </tr>
    <tr>
      <th>log-likelihood</th>
      <td>-157.02</td>
    </tr>
    <tr>
      <th>time fit was run</th>
      <td>2024-11-17 15:47:13 UTC</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;">coef</th>
      <th style="min-width: 12px;">exp(coef)</th>
      <th style="min-width: 12px;">se(coef)</th>
      <th style="min-width: 12px;">coef lower 95%</th>
      <th style="min-width: 12px;">coef upper 95%</th>
      <th style="min-width: 12px;">exp(coef) lower 95%</th>
      <th style="min-width: 12px;">exp(coef) upper 95%</th>
      <th style="min-width: 12px;">cmp to</th>
      <th style="min-width: 12px;">z</th>
      <th style="min-width: 12px;">p</th>
      <th style="min-width: 12px;">-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">lambda_</th>
      <th>PRED</th>
      <td>1.05</td>
      <td>2.87</td>
      <td>0.51</td>
      <td>0.06</td>
      <td>2.05</td>
      <td>1.06</td>
      <td>7.79</td>
      <td>0.00</td>
      <td>2.07</td>
      <td>0.04</td>
      <td>4.70</td>
    </tr>
    <tr>
      <th>Intercept</th>
      <td>4.48</td>
      <td>88.34</td>
      <td>0.32</td>
      <td>3.86</td>
      <td>5.10</td>
      <td>47.47</td>
      <td>164.38</td>
      <td>0.00</td>
      <td>14.14</td>
      <td>&lt;0.005</td>
      <td>148.43</td>
    </tr>
    <tr>
      <th>rho_</th>
      <th>Intercept</th>
      <td>-0.24</td>
      <td>0.79</td>
      <td>0.17</td>
      <td>-0.57</td>
      <td>0.09</td>
      <td>0.57</td>
      <td>1.10</td>
      <td>0.00</td>
      <td>-1.40</td>
      <td>0.16</td>
      <td>2.64</td>
    </tr>
  </tbody>
</table><br><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>Concordance</th>
      <td>0.63</td>
    </tr>
    <tr>
      <th>AIC</th>
      <td>320.03</td>
    </tr>
    <tr>
      <th>log-likelihood ratio test</th>
      <td>4.54 on 1 df</td>
    </tr>
    <tr>
      <th>-log2(p) of ll-ratio test</th>
      <td>4.92</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The results suggest that the treatment (‘PRED’) is associated with a significant increase in survival time. The positive coefficient for ‘PRED’ indicates that individuals in the treatment group (PRED = True) experience a deceleration in the time to the event compared to the control group (PRED = False). In other words, the treatment is associated with a longer survival time. The P value is less than 0.05, indicating that the effect of the treatment on survival time is statistically significant.</p>
<p>The intercept for λ represents the log of the baseline scale parameter (<span class="math notranslate nohighlight">\(\lambda_0\)</span>) in the Weibull AFT model. To get the actual baseline scale parameter, we need to exponentiate this value: <span class="math notranslate nohighlight">\(\lambda_0 = exp(4.48) \approx 88.34\)</span>. This means that, in the absence of any effect from the ‘PRED’ covariate (i.e., when PRED = False, which is often considered the baseline or reference group in this context), 63.2% of the individuals are expected to experience the event by approximately 88.34 months.</p>
<p>Finally, the intercept for ρ represents the log of the baseline shape parameter (<span class="math notranslate nohighlight">\(\rho_0\)</span>) in the Weibull AFT model. To get the actual baseline shape parameter, we need to exponentiate this value: <span class="math notranslate nohighlight">\(\rho_0 = exp(-0.24) \approx 0.79\)</span>. This indicates that the baseline hazard function (the hazard function when PRED = False) is decreasing over time. A shape parameter less than 1 implies a decreasing hazard rate, meaning the risk of the event is higher initially but diminishes as time progresses.</p>
</section>
<section id="visualization-and-prediction-with-weibull-model">
<h3>Visualization and prediction with Weibull model<a class="headerlink" href="#visualization-and-prediction-with-weibull-model" title="Link to this heading">#</a></h3>
<p>Having established the theoretical foundations of the Weibull AFT model, let’s demonstrate how the Weibull AFT model can be leveraged to gain valuable insights into real-world survival data. We can visualize the impact of covariates on survival and make predictions using a more complex dataset, showcasing the model’s versatility and power.</p>
<p>This data set is originally from <a class="reference external" href="https://rdrr.io/cran/carData/man/Rossi.html">Rossi et al. (1980)</a>, and is used as an example in <a class="reference external" href="https://www.oreilly.com/library/view/survival-analysis-using/9781555442798/">Allison (1995)</a>. The data pertain to 432 convicts who were released from Maryland state prisons in the 1970s and who were followed up for one year after release. Half the released convicts were assigned at random to an experimental treatment in which they were given financial aid; half did not receive aid.</p>
<p>Note that the visualization and prediction techniques described in this section are applicable to both the Weibull AFT and Cox PH models, allowing us to gain a deeper understanding of the relationships between covariates and survival outcomes, regardless of the specific model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_rossi</span>

<span class="n">rossi</span> <span class="o">=</span> <span class="n">load_rossi</span><span class="p">()</span>
<span class="n">rossi</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>week</th>
      <th>arrest</th>
      <th>fin</th>
      <th>age</th>
      <th>race</th>
      <th>wexp</th>
      <th>mar</th>
      <th>paro</th>
      <th>prio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>1</td>
      <td>0</td>
      <td>27</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17</td>
      <td>1</td>
      <td>0</td>
      <td>18</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25</td>
      <td>1</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>52</td>
      <td>0</td>
      <td>1</td>
      <td>23</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52</td>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can use formula to analyze linear models with interaction terms, e.g., <span class="math notranslate nohighlight">\(\beta_1 \text{fin} + \beta_2 \text{wexp} + \beta_3 \text{age} +\beta_4 \text{prio} + \beta_5 \text{age}.\text{prio}\)</span>, as in the example below. Note that it’s also possible to <a class="reference external" href="https://lifelines.readthedocs.io/en/latest/Survival%20Regression.html#modeling-ancillary-parameters">model the <span class="math notranslate nohighlight">\(\rho\)</span> parameter</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aft_rossi</span> <span class="o">=</span> <span class="n">WeibullAFTFitter</span><span class="p">()</span>
<span class="n">aft_rossi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">rossi</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">,</span>
    <span class="n">event_col</span><span class="o">=</span><span class="s1">&#39;arrest&#39;</span><span class="p">,</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;fin + wexp + age * prio&quot;</span>
<span class="p">)</span>

<span class="n">aft_rossi</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># access the results using aft.summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>model</th>
      <td>lifelines.WeibullAFTFitter</td>
    </tr>
    <tr>
      <th>duration col</th>
      <td>'week'</td>
    </tr>
    <tr>
      <th>event col</th>
      <td>'arrest'</td>
    </tr>
    <tr>
      <th>number of observations</th>
      <td>432</td>
    </tr>
    <tr>
      <th>number of events observed</th>
      <td>114</td>
    </tr>
    <tr>
      <th>log-likelihood</th>
      <td>-680.563</td>
    </tr>
    <tr>
      <th>time fit was run</th>
      <td>2024-11-17 15:47:56 UTC</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;">coef</th>
      <th style="min-width: 12px;">exp(coef)</th>
      <th style="min-width: 12px;">se(coef)</th>
      <th style="min-width: 12px;">coef lower 95%</th>
      <th style="min-width: 12px;">coef upper 95%</th>
      <th style="min-width: 12px;">exp(coef) lower 95%</th>
      <th style="min-width: 12px;">exp(coef) upper 95%</th>
      <th style="min-width: 12px;">cmp to</th>
      <th style="min-width: 12px;">z</th>
      <th style="min-width: 12px;">p</th>
      <th style="min-width: 12px;">-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">lambda_</th>
      <th>Intercept</th>
      <td>4.308</td>
      <td>74.261</td>
      <td>0.501</td>
      <td>3.325</td>
      <td>5.290</td>
      <td>27.805</td>
      <td>198.336</td>
      <td>0.000</td>
      <td>8.594</td>
      <td>&lt;0.0005</td>
      <td>56.727</td>
    </tr>
    <tr>
      <th>fin</th>
      <td>0.236</td>
      <td>1.266</td>
      <td>0.137</td>
      <td>-0.033</td>
      <td>0.505</td>
      <td>0.968</td>
      <td>1.657</td>
      <td>0.000</td>
      <td>1.722</td>
      <td>0.085</td>
      <td>3.556</td>
    </tr>
    <tr>
      <th>wexp</th>
      <td>0.169</td>
      <td>1.184</td>
      <td>0.150</td>
      <td>-0.125</td>
      <td>0.463</td>
      <td>0.883</td>
      <td>1.589</td>
      <td>0.000</td>
      <td>1.128</td>
      <td>0.259</td>
      <td>1.947</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.020</td>
      <td>1.020</td>
      <td>0.022</td>
      <td>-0.023</td>
      <td>0.063</td>
      <td>0.977</td>
      <td>1.065</td>
      <td>0.000</td>
      <td>0.916</td>
      <td>0.359</td>
      <td>1.476</td>
    </tr>
    <tr>
      <th>prio</th>
      <td>-0.220</td>
      <td>0.802</td>
      <td>0.122</td>
      <td>-0.460</td>
      <td>0.020</td>
      <td>0.631</td>
      <td>1.020</td>
      <td>0.000</td>
      <td>-1.801</td>
      <td>0.072</td>
      <td>3.801</td>
    </tr>
    <tr>
      <th>age:prio</th>
      <td>0.007</td>
      <td>1.007</td>
      <td>0.005</td>
      <td>-0.004</td>
      <td>0.018</td>
      <td>0.996</td>
      <td>1.018</td>
      <td>0.000</td>
      <td>1.282</td>
      <td>0.200</td>
      <td>2.323</td>
    </tr>
    <tr>
      <th>rho_</th>
      <th>Intercept</th>
      <td>0.341</td>
      <td>1.406</td>
      <td>0.089</td>
      <td>0.167</td>
      <td>0.515</td>
      <td>1.181</td>
      <td>1.674</td>
      <td>0.000</td>
      <td>3.833</td>
      <td>&lt;0.0005</td>
      <td>12.949</td>
    </tr>
  </tbody>
</table><br><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>Concordance</th>
      <td>0.640</td>
    </tr>
    <tr>
      <th>AIC</th>
      <td>1375.126</td>
    </tr>
    <tr>
      <th>log-likelihood ratio test</th>
      <td>32.123 on 5 df</td>
    </tr>
    <tr>
      <th>-log2(p) of ll-ratio test</th>
      <td>17.441</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can view all covariate estimates and their 95% confidence intervals in a forest plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aft_rossi</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/287311a1721380a7cacfd49852ab29d7d3bb0db255644cd05824782d741e8712.png" src="_images/287311a1721380a7cacfd49852ab29d7d3bb0db255644cd05824782d741e8712.png" />
</div>
</div>
<p>We can also observe the influence a variable, e.g., ‘prio’, in the model by plotting the outcome (i.e. survival) of changing the variable. By comparing the positions and shapes of these curves, we can visually assess how changes in this covariate affect the predicted survival time. In a Weibull AFT model, a negative coefficient for a covariate (like ‘prio’) indicates that an increase in that covariate is associated with a decrease in the acceleration factor λ. This implies that higher values of ‘prio’ should lead to a slower time to the event (i.e., increased survival time), and we would expect the survival curve to shift to the right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aft_rossi</span><span class="o">.</span><span class="n">plot_partial_effects_on_outcome</span><span class="p">(</span>
    <span class="n">covariates</span><span class="o">=</span><span class="s1">&#39;prio&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effect of &#39;prio&#39; on survival (Weibull AFT)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (weeks)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Survival probability&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9e35ab86c65eeb7e85a53cca8ed73b6a7cd5e2917a8ce7e04299b1ffdaabee1e.png" src="_images/9e35ab86c65eeb7e85a53cca8ed73b6a7cd5e2917a8ce7e04299b1ffdaabee1e.png" />
</div>
</div>
<p>In the current example, we observe that increasing ‘prio’ shifts the survival curve to the left, which typically indicates a faster time to the event (decreased survival time). This may be due to interaction effects. If the Weibull AFT model includes interaction terms involving ‘prio’, the interpretation of the main effect of ‘prio’ becomes more complex, and the effect of ‘prio’ on survival might depend on the values of other covariates involved in the interaction. In such cases, it’s essential to examine the <code class="docutils literal notranslate"><span class="pre">plot_partial_effects_on_outcome</span></code> for different combinations of covariate values to understand the full picture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a list of tuples representing combinations of &#39;prio&#39; and &#39;age&#39; values</span>
<span class="n">values_grid</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>

<span class="c1"># Plot the partial effects on outcome for the combined covariates</span>
<span class="n">aft_rossi</span><span class="o">.</span><span class="n">plot_partial_effects_on_outcome</span><span class="p">(</span>
    <span class="n">covariates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;prio&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">values_grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Paired_r&#39;</span><span class="p">)</span>

<span class="c1"># Enhance the plot with labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effect of &#39;prio:age&#39; interaction on survival (Weibull AFT)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (weeks)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Survival probability&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;prio=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">, age=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">values_grid</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7767816bd73459eec76ada2f15ef02ab0d55d4da3b514482c81be2d63f3de4f7.png" src="_images/7767816bd73459eec76ada2f15ef02ab0d55d4da3b514482c81be2d63f3de4f7.png" />
</div>
</div>
<p>Finally, we can obtain survival predictions for one or more new individuals from the fitted Weibull AFT model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict median survival time for a specific combination of covariates</span>
<span class="c1"># Note: don&#39;t feed `predict_median` with a Series but with a true DataFrame!</span>
<span class="n">median_survival</span> <span class="o">=</span> <span class="n">aft_rossi</span><span class="o">.</span><span class="n">predict_median</span><span class="p">(</span><span class="n">rossi</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">3</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted median survival time:&quot;</span><span class="p">)</span>
<span class="n">median_survival</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predicted median survival time:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3    128.088796
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict survival function for a new combination of covariates</span>
<span class="c1"># If a numpy array, columns must be in the same order as the training data, i.e.,</span>
<span class="c1"># [&#39;fin&#39;, &#39;age&#39;, &#39;race&#39;, &#39;wexp&#39;, &#39;mar&#39;, &#39;paro&#39;, &#39;prio&#39;]</span>

<span class="n">new_individual</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;fin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">],</span>
        <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="s1">&#39;race&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;wexp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;mar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;paro&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;prio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">survival_function</span> <span class="o">=</span> <span class="n">aft_rossi</span><span class="o">.</span><span class="n">predict_survival_function</span><span class="p">(</span><span class="n">new_individual</span><span class="p">)</span>

<span class="c1"># Plot the predicted survival function</span>
<span class="n">survival_function</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted survival function for varying &#39;age&#39; only&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (weeks)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Survival probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5e43c4acd85806aa2fb9711e2d371cafdbbda4d4ffde867c463b3902a5eb84ed.png" src="_images/5e43c4acd85806aa2fb9711e2d371cafdbbda4d4ffde867c463b3902a5eb84ed.png" />
</div>
</div>
</section>
<section id="alternative-parametric-models">
<h3>Alternative parametric models<a class="headerlink" href="#alternative-parametric-models" title="Link to this heading">#</a></h3>
<p>While the Weibull model offers flexibility in capturing different hazard shapes, it’s not the only parametric option available:</p>
<ul class="simple">
<li><p>Exponential model: assumes a constant hazard rate over time. It’s a special case of the Weibull model with the shape parameter (rho) equal to 1.</p></li>
<li><p>Log-Normal model: assumes that the logarithm of the survival times follows a normal distribution. It can be useful when the hazard rate initially increases and then decreases.</p></li>
<li><p>Log-logistic model: assumes that the logarithm of the odds of survival follows a logistic distribution. It can also model non-monotonic hazard rates.</p></li>
<li><p>Generalized gamma model: a more general model that encompasses the Weibull, exponential, and log-normal models as special cases. It offers additional flexibility but can be more complex to interpret</p></li>
</ul>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike information criterion (AIC)</a> is a useful metric for comparing the relative quality of different statistical models fit to the same data. It estimates the relative amount of information lost by a given model and penalizes large number of estimated parameters. Therefore, the less information a model loses, the higher the quality of that model, and the fewer parameters (less complex) a model is, the higher the quality of that model. It balances the model’s goodness-of-fit (measured by the log-likelihood) with its complexity (measured by the number of parameters).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullFitter</span><span class="p">,</span> <span class="n">ExponentialFitter</span><span class="p">,</span> <span class="n">LogNormalFitter</span><span class="p">,</span> \
    <span class="n">LogLogisticFitter</span><span class="p">,</span> <span class="n">GeneralizedGammaFitter</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Instantiate each fitter</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">WeibullFitter</span><span class="p">()</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">ExponentialFitter</span><span class="p">()</span>
<span class="n">lognorm</span> <span class="o">=</span> <span class="n">LogNormalFitter</span><span class="p">()</span>
<span class="n">loglogistic</span> <span class="o">=</span> <span class="n">LogLogisticFitter</span><span class="p">()</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">GeneralizedGammaFitter</span><span class="p">()</span>

<span class="c1"># Fit to data and display the AIC</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AIC values for different models fitting &#39;PRED&#39; data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="n">wb</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">loglogistic</span><span class="p">,</span> <span class="n">gamma</span><span class="p">]:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">durations</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
              <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">AIC_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC values for different models fitting &#39;PRED&#39; data:

WeibullFitter 	 144.54091487803493
ExponentialFitter 	 142.56870858109932
LogNormalFitter 	 146.80469733430616
LogLogisticFitter 	 145.8274267786253
GeneralizedGammaFitter 	 145.1972001057433
</pre></div>
</div>
</div>
</div>
<p>While numerical metrics like AIC provide valuable guidance in model selection, it’s always beneficial to complement them with visual inspection. Plotting the fitted survival curves from different parametric models alongside the non-parametric Kaplan-Meier curve offers a quick and intuitive way to gauge the quality of the fit. This visual comparison allows us to see how well each model captures the empirical survival patterns in the data and identify potential areas where a model might be oversimplifying or underfitting the complexities of the survival experience.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot for PRED Group</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Kaplan-Meier&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="n">wb</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">loglogistic</span><span class="p">,</span> <span class="n">gamma</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="s1">&#39;slategray&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;steelblue&#39;</span><span class="p">]):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s1">&#39;Fitter&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Survival functions for &#39;PRED=True&#39; group&quot;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (weeks)&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Survival probability&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># type: ignore</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/254eccf896574443d86b055b2f1bb969c28b1eabf15151c2e35abdc129d34535.png" src="_images/254eccf896574443d86b055b2f1bb969c28b1eabf15151c2e35abdc129d34535.png" />
</div>
</div>
<p>Given a set of candidate models for the data, the one with the minimum AIC value is the preferred model. To streamline the process of comparing different parametric models and selecting the best-fitting one based on the AIC criterion, we can leverage the convenient <code class="docutils literal notranslate"><span class="pre">find_best_parametric_model</span></code> function provided by lifelines. This function automates the fitting and comparison of multiple parametric models, ensuring consistency in the model selection process.</p>
<p>Let’s use this function to identify the best-fitting parametric model for both the ‘PRED’ and placebo groups in our prednisolone dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_best_parametric_model</span>

<span class="c1"># Find the best parametric model for the placebo group</span>
<span class="n">best_model_ctrl</span><span class="p">,</span> <span class="n">best_aic_ctrl</span> <span class="o">=</span> <span class="n">find_best_parametric_model</span><span class="p">(</span>
    <span class="n">event_times</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">scoring_method</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span>
<span class="p">)</span>

<span class="c1"># Print the best model and its AIC for the placebo group</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Parametric Model for placebo group:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">best_model_ctrl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC: </span><span class="si">{</span><span class="n">best_aic_ctrl</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Find the best parametric model for the &#39;PRED&#39; group</span>
<span class="n">best_model_pred</span><span class="p">,</span> <span class="n">best_aic_pred</span> <span class="o">=</span> <span class="n">find_best_parametric_model</span><span class="p">(</span>
    <span class="n">event_times</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">scoring_method</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span>
<span class="p">)</span>

<span class="c1"># Print the best model and its AIC for the &#39;PRED&#39; group</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Best Parametric Model for &#39;PRED&#39; group:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">best_model_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC: </span><span class="si">{</span><span class="n">best_aic_pred</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best Parametric Model for placebo group:
&lt;lifelines.LogNormalFitter:&quot;LogNormal_estimate&quot;, fitted with 22 total observations, 6 right-censored observations&gt;
AIC: 174.54


Best Parametric Model for &#39;PRED&#39; group:
&lt;lifelines.PiecewiseExponentialFitter:&quot;PiecewiseExponentialFitter: 1 breakpoint&quot;, fitted with 22 total observations, 11 right-censored observations&gt;
AIC: 142.35
</pre></div>
</div>
</div>
</div>
<p>Our exploration of parametric survival models has revealed the richness and depth of this field. Even within the realm of parametric models, there exists a wide array of options beyond the commonly used Weibull, exponential, and log-normal distributions. The lifelines library, with its extensive collection of fitters, provides a powerful toolkit for delving deeper into this fascinating domain.</p>
<p>The emergence of the <code class="docutils literal notranslate"><span class="pre">PiecewiseExponentialFitter</span></code> as the best-fitting model for the ‘PRED’ group underscores the importance of considering a diverse set of models and letting the data guide the selection process. While we’ve only scratched the surface in this chapter, the lifelines library offers many more advanced models and techniques for those seeking to master the intricacies of survival analysis.</p>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>In this chapter, we embarked on a comprehensive exploration of survival analysis, harnessing the capabilities of the lifelines library in Python. We commenced by elucidating the fundamental concepts of survival data and its visual representation through <strong>Kaplan-Meier</strong> curves. The <strong>log-rank test</strong> was then employed to rigorously assess the statistical significance of observed differences in survival between groups.</p>
<p>We further ventured into the realm of <strong>hazard ratios</strong>, quantifying the relative risks associated with distinct groups, and examined the <strong>Nelson-Aalen estimator</strong>, providing an alternative perspective on the accumulation of risk over time. The chapter subsequently focused on the power of <strong>parametric models</strong>, with a particular emphasis on the <strong>Cox proportional hazards model</strong> and the flexible <strong>Weibull model</strong>. These models allowed us to identify and quantify the impact of <strong>covariates</strong> on survival, enhancing our understanding of the complex interplay between variables and outcomes. The Weibull model’s adaptability in accommodating various hazard shapes proved particularly valuable when the proportional hazards assumption of the Cox model was potentially violated.</p>
<p>Throughout the chapter, we emphasized the synergy between visualization and prediction. Techniques like <code class="docutils literal notranslate"><span class="pre">plot_partial_effects_on_outcome</span></code> were employed to graphically illustrate the influence of covariates on survival, while functions such as <code class="docutils literal notranslate"><span class="pre">predict_median</span></code> enabled the extraction of concrete predictions from our models. The critical aspect of model selection was also addressed, utilizing the <strong>AIC criterion</strong> and visual inspections, including <strong>QQ plots</strong>, to guide informed decision-making.</p>
<p>In conclusion, this chapter has equipped readers with the theoretical foundations and practical tools necessary to navigate the complexities of survival analysis. The lifelines library, with its extensive suite of functionalities, empowers researchers and practitioners to unveil the intricate dynamics of time-to-event data across diverse fields. We encourage readers to apply these techniques to their own datasets, fostering a deeper understanding of survival phenomena and contributing to the advancement of knowledge in this critical domain.</p>
</section>
<section id="cheat-sheet">
<h2>Cheat sheet<a class="headerlink" href="#cheat-sheet" title="Link to this heading">#</a></h2>
<section id="kaplan-meier">
<h3>Kaplan-Meier<a class="headerlink" href="#kaplan-meier" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert datetimes to durations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetimes_to_durations</span>
<span class="n">T</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">datetimes_to_durations</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">,</span>  <span class="c1"># list/array of datatime values</span>
    <span class="n">end_date</span><span class="p">,</span>    <span class="c1"># list/array of datatime values</span>
    <span class="n">fill_date</span><span class="o">=</span><span class="s1">&#39;2013-10-15&#39;</span><span class="p">)</span>  <span class="c1"># value used for NaN</span>

<span class="c1"># Fit and plot Kaplan-Meier curves</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeierFitter</span>
<span class="n">kmf_pred</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone (KM)&#39;</span><span class="p">)</span>
<span class="n">kmf_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">durations</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="c1">#label=&#39;prednisolone (KM)&#39;</span>
<span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span>
    <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ci_alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
    <span class="n">censor_styles</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># style as dictionary</span>
<span class="c1"># Fit other groups and plot on the same axis</span>

<span class="c1"># Extract median survival times</span>
<span class="n">median_survival_pred</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">median_survival_time_</span>

<span class="c1"># Survival prediction</span>
<span class="n">months</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">12</span>  <span class="c1"># i.e., 5-year survival time</span>
<span class="n">kmf_pred</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="non-parametric-log-rank">
<h3>Non-parametric log-rank<a class="headerlink" href="#non-parametric-log-rank" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.statistics</span><span class="w"> </span><span class="kn">import</span> <span class="n">logrank_test</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">logrank_test</span><span class="p">(</span>
    <span class="n">durations_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">durations_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed_A</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">event_observed_B</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">],</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">.95</span><span class="p">)</span>

<span class="n">results</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
<span class="c1"># results.summary, results.p_value, results.test_statistic</span>
</pre></div>
</div>
</section>
<section id="nelson-aalen-cumulative-hazard">
<h3>Nelson-Aalen cumulative hazard<a class="headerlink" href="#nelson-aalen-cumulative-hazard" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">NelsonAalenFitter</span>

<span class="n">naf_pred</span> <span class="o">=</span> <span class="n">NelsonAalenFitter</span><span class="p">()</span>
<span class="n">naf_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone&#39;</span><span class="p">)</span>

<span class="n">naf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">naf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="semi-parametric-cox-ph">
<h3>Semi-parametric Cox PH<a class="headerlink" href="#semi-parametric-cox-ph" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoxPHFitter</span>

<span class="c1"># Fit the CoxPHFitter</span>
<span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span>
<span class="n">cph</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
    <span class="n">event_col</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">,</span>
    <span class="c1"># formula=&#39;PRED&#39;</span>
<span class="p">)</span>

<span class="c1"># Print the summary to see the coefficient and its significance</span>
<span class="n">cph</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Assessing the proportional hazards assumption a posteriori</span>
<span class="n">cph</span><span class="o">.</span><span class="n">check_assumptions</span><span class="p">(</span>
    <span class="n">training_df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">p_value_threshold</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>  <span class="c1"># default 0.01</span>
    <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualizing the impact of covariate</span>
<span class="n">cph</span><span class="o">.</span><span class="n">plot_partial_effects_on_outcome</span><span class="p">(</span>
    <span class="n">covariates</span><span class="o">=</span><span class="s1">&#39;PRED&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="n">plot_baseline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parametric-weibull">
<h3>Parametric Weibull<a class="headerlink" href="#parametric-weibull" title="Link to this heading">#</a></h3>
<section id="fitting-and-visualization">
<h4>Fitting and visualization<a class="headerlink" href="#fitting-and-visualization" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullFitter</span>

<span class="n">wb_pred</span> <span class="o">=</span> <span class="n">WeibullFitter</span><span class="p">()</span>
<span class="n">wb_pred</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prednisolone (Weibull)&#39;</span><span class="p">)</span>

<span class="n">wb_pred</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">wb_pred</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="goodness-of-fit-qq-plot">
<h4>Goodness-of-fit (QQ plot)<a class="headerlink" href="#goodness-of-fit-qq-plot" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">qq_plot</span>
<span class="n">qq_plot</span><span class="p">(</span><span class="n">wb_pred</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="aft-regression">
<h4>AFT regression<a class="headerlink" href="#aft-regression" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullAFTFitter</span>

<span class="n">aft_rossi</span> <span class="o">=</span> <span class="n">WeibullAFTFitter</span><span class="p">()</span>

<span class="n">aft_rossi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">rossi</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">,</span>
    <span class="n">event_col</span><span class="o">=</span><span class="s1">&#39;arrest&#39;</span><span class="p">,</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;fin + wexp + age * prio&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">aft_rossi</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Plot covariate and 95% CI forest plot</span>
<span class="n">aft_rossi</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># Plot effect of covariate on survival</span>
<span class="n">aft_rossi</span><span class="o">.</span><span class="n">plot_partial_effects_on_outcome</span><span class="p">(</span>
    <span class="n">covariates</span><span class="o">=</span><span class="s1">&#39;prio&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>

<span class="c1"># Prediction of median survival</span>
<span class="n">aft_rossi</span><span class="o">.</span><span class="n">predict_median</span><span class="p">(</span><span class="n">rossi</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">3</span><span class="p">]])</span>  <span class="c1"># don&#39;t feed predict_median with a Series but with a true DataFrame!</span>

<span class="c1"># Prediction of survival function for a new individual</span>
<span class="c1"># Enter values for the new individual(s)</span>
<span class="n">new_individual</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Could also be an np.array</span>
<span class="n">survival_function</span> <span class="o">=</span> <span class="n">aft_rossi</span><span class="o">.</span><span class="n">predict_survival_function</span><span class="p">(</span><span class="n">new_individual</span><span class="p">)</span>
<span class="n">survival_function</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h3>Alternative parametric models<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeibullFitter</span><span class="p">,</span> <span class="n">ExponentialFitter</span><span class="p">,</span> <span class="n">LogNormalFitter</span><span class="p">,</span> \
    <span class="n">LogLogisticFitter</span><span class="p">,</span> <span class="n">GeneralizedGammaFitter</span>

<span class="c1"># Instantiate each fitter</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">WeibullFitter</span><span class="p">()</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">ExponentialFitter</span><span class="p">()</span>
<span class="n">lognorm</span> <span class="o">=</span> <span class="n">LogNormalFitter</span><span class="p">()</span>
<span class="n">loglogistic</span> <span class="o">=</span> <span class="n">LogLogisticFitter</span><span class="p">()</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">GeneralizedGammaFitter</span><span class="p">()</span>

<span class="c1"># Fit to data and display the AIC</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AIC values for different models fitting &#39;PRED&#39; data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="n">wb</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">loglogistic</span><span class="p">,</span> <span class="n">gamma</span><span class="p">]:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">durations</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
        <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">AIC_</span><span class="p">)</span>

<span class="c1"># Plot each plot on the KMF curve</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">kmf_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="n">wb</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">loglogistic</span><span class="p">,</span> <span class="n">gamma</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="s1">&#39;slategray&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;steelblue&#39;</span><span class="p">]):</span>

    <span class="n">model</span><span class="o">.</span><span class="n">plot_survival_function</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s1">&#39;Fitter&#39;</span><span class="p">))</span>

<span class="c1"># Find the best parametric model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_best_parametric_model</span>

<span class="c1"># Find the best parametric model for the &#39;PRED&#39; group</span>
<span class="n">best_model_pred</span><span class="p">,</span> <span class="n">best_aic_pred</span> <span class="o">=</span> <span class="n">find_best_parametric_model</span><span class="p">(</span>
    <span class="n">event_times</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
    <span class="n">event_observed</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRED&#39;</span><span class="p">]][</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="n">scoring_method</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="session-information">
<h2>Session information<a class="headerlink" href="#session-information" title="Link to this heading">#</a></h2>
<p>The output below details all packages and version necessary to reproduce the results in this report.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>--version
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="c1"># List of packages we want to check the version</span>
<span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="s1">&#39;lifelines&#39;</span><span class="p">,</span> <span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn&#39;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">]</span>

<span class="c1"># Initialize an empty list to store the versions</span>
<span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop over the packages</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the version of the package</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="c1"># Append the version to the list</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_version</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Use a more general exception for broader compatibility</span>
        <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Not installed&#39;</span><span class="p">)</span>

<span class="c1"># Print the versions</span>
<span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.12.7
-------------
numpy: 1.26.4
pandas: 2.2.2
lifelines: 0.29.0
matplotlib: 3.9.2
seaborn: 0.13.2
scipy: 1.14.1
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="27%20-%20Comparing%20proportions.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comparing proportions</p>
      </div>
    </a>
    <a class="right-next"
       href="30%20-%20Comparing%20two%20unpaired%20means.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Comparing two unpaired means</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prednisolone-case-study">Prednisolone case study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-dates-in-survival-analysis">Handling dates in survival analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kaplan-meier-analysis">Kaplan-Meier analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-the-curves">Beyond the curves</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#median-survival">Median survival</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-predictions">Survival predictions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-function">Survival function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-log-rank-test">Non-parametric log-rank test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-little-bit-of-theory">A little bit of theory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-log-rank-test-in-python">Using log-rank test in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantel-haenszel-method">Mantel-Haenszel method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gehan-breslow-wilcoxon-method">Gehan-Breslow-Wilcoxon method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-ratio-for-quantifying-relative-risk">Hazard ratio for quantifying relative risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unveiling-hazards-with-the-nelson-aalen-estimator">Unveiling hazards with the Nelson-Aalen estimator</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mathematics-behind-the-model">The mathematics behind the model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-nelsonaalenfitter">Using the <code class="docutils literal notranslate"><span class="pre">NelsonAalenFitter</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connection-to-kaplan-meier-survival">Connection to Kaplan-Meier survival</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-link-with-hazard-ratio">The link with hazard ratio</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cox-proportional-hazards-model">Cox proportional hazards model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-cox-ph-model">Interpreting the Cox PH model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#assessing-the-proportional-hazards-assumption">Assessing the proportional hazards assumption</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-impact-of-covariate-on-survival">Visualizing the impact of covariate on survival</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-weibull-parametric-model">The Weibull parametric model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-to-the-prednisolone-data">Application to the prednisolone data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit">Goodness-of-fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-estimates">Parameters estimates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weibull-regression">Weibull regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-and-prediction-with-weibull-model">Visualization and prediction with Weibull model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-parametric-models">Alternative parametric models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cheat-sheet">Cheat sheet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kaplan-meier">Kaplan-Meier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric-log-rank">Non-parametric log-rank</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nelson-aalen-cumulative-hazard">Nelson-Aalen cumulative hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-parametric-cox-ph">Semi-parametric Cox PH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametric-weibull">Parametric Weibull</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-and-visualization">Fitting and visualization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit-qq-plot">Goodness-of-fit (QQ plot)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aft-regression">AFT regression</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Alternative parametric models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-information">Session information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sébastien Wieckowski
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>